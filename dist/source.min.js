(function(){function init(){container=document.getElementById("viewer"),$container=$(container),camera=new THREE.PerspectiveCamera(30,$container.width()/$container.height(),1,1e4),camera.position.set(140,140,140),camera.up.set(0,0,1),camera.lookAt(new THREE.Vector3(0,0,0)),scene=new THREE.Scene,renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setClearColor(16777215,1),renderer.setSize($container.width(),$container.height()),renderer.sortObjects=!1,container.appendChild(renderer.domElement),renderer.domElement.setAttribute("id","renderer_canvas"),makeGrid();var e=new THREE.AmbientLight(5592405);scene.add(e);var t=new THREE.DirectionalLight(12303291);t.position.set(50,30,50),scene.add(t);var t=new THREE.DirectionalLight(11184810);t.position.set(-0.2,-0.8,1).normalize(),scene.add(t),makeGrid(),controls=new THREE.OrbitControls(camera,container),window.addEventListener("resize",onWindowResize,!1),animate()}function makeGrid(){var e=60,t=new THREE.AxisHelper(e);scene.add(t);var n=new THREE.Geometry,r=new THREE.Geometry,i=e,s=2*e/i,o=10;for(var u=0;u<i+1;u++){var a=new THREE.Vector3(-e,-e+u*s,0),f=new THREE.Vector3(e,-e+u*s,0);n.vertices.push(a),n.vertices.push(f),u%o==0&&(r.vertices.push(a),r.vertices.push(f))}for(var u=0;u<i+1;u++){var a=new THREE.Vector3(-e+u*s,e,0),f=new THREE.Vector3(-e+u*s,-e,0);n.vertices.push(a),n.vertices.push(f),u%o==0&&(r.vertices.push(a),r.vertices.push(f))}var l=new THREE.LineBasicMaterial({color:15658734,linewidth:.1}),c=new THREE.LineBasicMaterial({color:15658734,linewidth:2}),h=new THREE.Line(n,l,THREE.LinePieces),p=new THREE.Line(r,c,THREE.LinePieces);scene.add(h),scene.add(p)}function onWindowResize(){windowHalfX=$container.width()/2,windowHalfY=$container.height()/2,camera.aspect=windowHalfX/windowHalfY,camera.updateProjectionMatrix(),renderer.setSize(2*windowHalfX,2*windowHalfY),render()}function animate(){requestAnimationFrame(animate),render()}function render(){controls.update(),renderer.render(scene,camera)}var requirejs,require,define;(function(e){function c(e,t){return f.call(e,t)}function h(e,t){var n,r,i,s,o,a,f,l,c,h,p=t&&t.split("/"),d=u.map,v=d&&d["*"]||{};if(e&&e.charAt(0)===".")if(t){p=p.slice(0,p.length-1),e=p.concat(e.split("/"));for(l=0;l<e.length;l+=1){h=e[l];if(h===".")e.splice(l,1),l-=1;else if(h===".."){if(l===1&&(e[2]===".."||e[0]===".."))break;l>0&&(e.splice(l-1,2),l-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((p||v)&&d){n=e.split("/");for(l=n.length;l>0;l-=1){r=n.slice(0,l).join("/");if(p)for(c=p.length;c>0;c-=1){i=d[p.slice(0,c).join("/")];if(i){i=i[r];if(i){s=i,o=l;break}}}if(s)break;!a&&v&&v[r]&&(a=v[r],f=l)}!s&&a&&(s=a,o=f),s&&(n.splice(0,o,s),e=n.join("/"))}return e}function p(t,r){return function(){return n.apply(e,l.call(arguments,0).concat([t,r]))}}function d(e){return function(t){return h(t,e)}}function v(e){return function(t){s[e]=t}}function m(n){if(c(o,n)){var r=o[n];delete o[n],a[n]=!0,t.apply(e,r)}if(!c(s,n)&&!c(a,n))throw new Error("No "+n);return s[n]}function g(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function y(e){return function(){return u&&u.config&&u.config[e]||{}}}var t,n,r,i,s={},o={},u={},a={},f=Object.prototype.hasOwnProperty,l=[].slice;r=function(e,t){var n,r=g(e),i=r[0];return e=r[1],i&&(i=h(i,t),n=m(i)),i?n&&n.normalize?e=n.normalize(e,d(t)):e=h(e,t):(e=h(e,t),r=g(e),i=r[0],e=r[1],i&&(n=m(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},i={require:function(e){return p(e)},exports:function(e){var t=s[e];return typeof t!="undefined"?t:s[e]={}},module:function(e){return{id:e,uri:"",exports:s[e],config:y(e)}}},t=function(t,n,u,f){var l,h,d,g,y,b=[],w;f=f||t;if(typeof u=="function"){n=!n.length&&u.length?["require","exports","module"]:n;for(y=0;y<n.length;y+=1){g=r(n[y],f),h=g.f;if(h==="require")b[y]=i.require(t);else if(h==="exports")b[y]=i.exports(t),w=!0;else if(h==="module")l=b[y]=i.module(t);else if(c(s,h)||c(o,h)||c(a,h))b[y]=m(h);else{if(!g.p)throw new Error(t+" missing "+h);g.p.load(g.n,p(f,!0),v(h),{}),b[y]=s[h]}}d=u.apply(s[t],b);if(t)if(l&&l.exports!==e&&l.exports!==s[t])s[t]=l.exports;else if(d!==e||!w)s[t]=d}else t&&(s[t]=u)},requirejs=require=n=function(s,o,a,f,l){return typeof s=="string"?i[s]?i[s](o):m(r(s,o).f):(s.splice||(u=s,o.splice?(s=o,o=a,a=null):s=e),o=o||function(){},typeof a=="function"&&(a=f,f=l),f?t(e,s,o,a):setTimeout(function(){t(e,s,o,a)},4),n)},n.config=function(e){return u=e,u.deps&&n(u.deps,u.callback),n},requirejs._defined=s,define=function(e,t,n){t.splice||(n=t,t=[]),!c(s,e)&&!c(o,e)&&(o[e]=[e,t,n])},define.amd={jQuery:!0}})(),define("almond",function(e){return function(){var t,n;return t||e.almond}}(this)),require.config({shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},List:{deps:["jquery"],exports:"List"},Three:{exports:"Three"},CSG:{exports:"CSG"},FLOODCSG:{deps:["CSG"],exports:"FLOODCSG"},Viewport:{deps:["Three","OrbitControls"],exports:"Viewport"},OrbitControls:{deps:["Three"],exports:"OrbitControls"},jqueryuislider:{deps:["jquery","jqueryuimouse","jqueryuicore","jqueryuiwidget"],exports:"jqueryuislider"},jqueryuidraggable:{deps:["jquery","jqueryuimouse","jqueryuicore","jqueryuiwidget"],exports:"jqueryuidraggable"},jqueryuimouse:{deps:["jquery","jqueryuiwidget"],exports:"jqueryuimouse"},jqueryuicore:{deps:["jquery"],exports:"jqueryuicore"},jqueryuiwidget:{deps:["jquery"],exports:"jqueryuiwidget"},bootstrap:{deps:["jquery"],exports:"bootstrap"},almond:{deps:[],exports:"almond"}},paths:{Connections:"collections/Connections",SearchElements:"collections/SearchElements",Nodes:"collections/Nodes",Workspaces:"collections/Workspaces",WorkspaceBrowserElements:"collections/WorkspaceBrowserElements",App:"models/App",Connection:"models/Connection",Marquee:"models/Marquee",Node:"models/Node",Search:"models/Search",SearchElement:"models/SearchElement",Workspace:"models/Workspace",Runner:"models/Runner",Help:"models/Help",Login:"models/Login",WorkspaceBrowserElement:"models/WorkspaceBrowserElement",WorkspaceBrowser:"models/WorkspaceBrowser",AppView:"views/AppView",ConnectionView:"views/ConnectionView",MarqueeView:"views/MarqueeView",SearchView:"views/SearchView",WorkspaceControlsView:"views/WorkspaceControlsView",SearchElementView:"views/SearchElementView",WorkspaceView:"views/WorkspaceView",WorkspaceTabView:"views/WorkspaceTabView",HelpView:"views/HelpView",LoginView:"views/LoginView",WorkspaceBrowserElementView:"views/WorkspaceBrowserElementView",WorkspaceBrowserView:"views/WorkspaceBrowserView",NodeViewTypes:"views/NodeViews/NodeViews",BaseNodeView:"views/NodeViews/Base",WatchNodeView:"views/NodeViews/Watch",NumNodeView:"views/NodeViews/Num",FormulaView:"views/NodeViews/Formula",InputView:"views/NodeViews/Input",OutputView:"views/NodeViews/Output",CSGNodeView:"views/NodeViews/ThreeCSG",OrbitControls:"lib/OrbitControls",Viewport:"lib/Viewport",FLOODCSG:"lib/flood/flood_csg",FLOOD:"lib/flood/flood",CSG:"lib/flood/csg",scheme:"lib/flood/scheme",almond:"../bower_components/almond/almond",bootstrap:"../bower_components/bootstrap/dist/js/bootstrap",List:"../bower_components/listjs/dist/list.min",Three:"../bower_components/threejs/build/three.min",jqueryuislider:"../bower_components/jquery.ui/ui/jquery.ui.slider",jqueryuidraggable:"../bower_components/jquery.ui/ui/jquery.ui.draggable",jqueryuicore:"../bower_components/jquery.ui/ui/jquery.ui.core",jqueryuimouse:"../bower_components/jquery.ui/ui/jquery.ui.mouse",jqueryuiwidget:"../bower_components/jquery.ui/ui/jquery.ui.widget",jquery:"../bower_components/jquery/jquery",backbone:"../bower_components/backbone-amd/backbone",underscore:"../bower_components/underscore-amd/underscore"}}),define("config",function(){}),function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){if(e instanceof x)return e;if(!(this instanceof x))return new x(e);this._wrapped=e};typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.4";var T=x.each=x.forEach=function(e,t,r){if(e==null)return;if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;i<s;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return e==null?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)});if(!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;e==null&&(e=[]);if(d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)});if(!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){if(t.call(n,e,i,s))return r=e,!0}),r},x.filter=x.select=function(e,t,n){var r=[];return e==null?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return e==null?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){if(!(i=i&&t.call(r,e,s,o)))return n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return e==null?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){if(i||(i=t.call(r,e,s,o)))return n}),!!i)};x.contains=x.include=function(e,t){return e==null?!1:y&&e.indexOf===y?e.indexOf(t)!=-1:C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2),r=x.isFunction(t);return x.map(e,function(e){return(r?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t,n){return x.isEmpty(t)?n?null:[]:x[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.findWhere=function(e,t){return x.where(e,t,!0)},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-Infinity;var r={computed:-Infinity,value:-Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return Infinity;var r={computed:Infinity,value:Infinity};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o<r.computed&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||n===void 0)return 1;if(n<r||r===void 0)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=n==null?x.identity:k(n);var i=n.call(r,t),s=0,o=e.length;while(s<o){var u=s+o>>>1;n.call(r,e[u])<i?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return e==null?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,0,t):e[0]},x.initial=function(e,t,n){return u.call(e,0,e.length-(t==null||n?1:t))},x.last=function(e,t,n){return e==null?void 0:t!=null&&!n?u.call(e,Math.max(e.length-t,0)):e[e.length-1]},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,t==null||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){if(t?!r||o[o.length-1]!==n:!x.contains(o,n))o.push(n),s.push(e[r])}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=new Array(t);for(var r=0;r<t;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(e==null)return{};var n={};for(var r=0,i=e.length;r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(e==null)return-1;var r=0,i=e.length;if(n){if(typeof n!="number")return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=n<0?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r<i;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(e==null)return-1;var r=n!=null;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);var i=r?n:e.length;while(i--)if(e[i]===t)return i;return-1},x.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=new Array(r);while(i<r)s[i++]=e,e+=n;return s},x.bind=function(e,t){if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));var n=u.call(arguments,2);return function(){return e.apply(t,n.concat(u.call(arguments)))}},x.partial=function(e){var t=u.call(arguments,1);return function(){return e.apply(this,t.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return t.length===0&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,f<=0?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t=!1,n;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){var t=arguments;for(var n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]==null&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var O=function(e,t,n,r){if(e===t)return e!==0||1/e==1/t;if(e==null||t==null)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:e==0?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if(typeof e!="object"||typeof t!="object")return!1;var s=n.length;while(s--)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if(i=="[object Array]"){o=e.length,u=o==t.length;if(u)while(o--)if(!(u=O(e[o],t[o],n,r)))break}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)){o++;if(!(u=x.has(t,c)&&O(e[c],t[c],n,r)))break}if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return O(e,t,[],[])},x.isEmpty=function(e){if(e==null)return!0;if(x.isArray(e)||x.isString(e))return e.length===0;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&e.nodeType===1},x.isArray=w||function(e){return f.call(e)=="[object Array]"},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),typeof /./!="function"&&(x.isFunction=function(e){return typeof e=="function"}),x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||f.call(e)=="[object Boolean]"},x.isNull=function(e){return e===null},x.isUndefined=function(e){return e===void 0},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){var r=Array(e);for(var i=0;i<e;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return t==null&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var M={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};M.unescape=x.invert(M.escape);var _={escape:new RegExp("["+x.keys(M.escape).join("")+"]","g"),unescape:new RegExp("("+x.keys(M.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return t==null?"":(""+t).replace(_[e],function(t){return M[e][t]})}}),x.result=function(e,t){if(e==null)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),j.call(this,n.apply(x,e))}})};var D=0;x.uniqueId=function(e){var t=++D+"";return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){var r;n=x.defaults({},n,x.templateSettings);var i=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(i,function(t,n,r,i,u){return o+=e.slice(s,u).replace(B,function(e){return"\\"+H[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(o+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),s=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{r=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return r(t,x);var a=function(e){return r.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},x.chain=function(e){return x(e).chain()};var j=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),(e=="shift"||e=="splice")&&n.length===0&&delete n[0],j.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return j.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),typeof define=="function"&&define.amd&&define("underscore",[],function(){return x})}.call(this),function(e,t){function P(e){var t=e.length,n=b.type(e);return b.isWindow(e)?!1:e.nodeType===1&&t?!0:n==="array"||n!=="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)}function B(e){var t=H[e]={};return b.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(e,n,r,i){if(!b.acceptData(e))return;var s,o,u=b.expando,a=typeof n=="string",f=e.nodeType,c=f?b.cache:e,h=f?e[u]:e[u]&&u;if((!h||!c[h]||!i&&!c[h].data)&&a&&r===t)return;h||(f?e[u]=h=l.pop()||b.guid++:h=u),c[h]||(c[h]={},f||(c[h].toJSON=b.noop));if(typeof n=="object"||typeof n=="function")i?c[h]=b.extend(c[h],n):c[h].data=b.extend(c[h].data,n);return s=c[h],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[b.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[b.camelCase(n)])):o=s,o}function q(e,t,n){if(!b.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?b.cache:e,a=o?e[b.expando]:b.expando;if(!u[a])return;if(t){s=n?u[a]:u[a].data;if(s){b.isArray(t)?t=t.concat(b.map(t,b.camelCase)):t in s?t=[t]:(t=b.camelCase(t),t in s?t=[t]:t=t.split(" "));for(r=0,i=t.length;r<i;r++)delete s[t[r]];if(!(n?U:b.isEmptyObject)(s))return}}if(!n){delete u[a].data;if(!U(u[a]))return}o?b.cleanData([e],!0):b.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null}function R(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(F,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:j.test(r)?b.parseJSON(r):r}catch(s){}b.data(e,n,r)}else r=t}return r}function U(e){var t;for(t in e){if(t==="data"&&b.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function it(){return!0}function st(){return!1}function ct(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ht(e,t,n){t=t||0;if(b.isFunction(t))return b.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return b.grep(e,function(e){return e===t===n});if(typeof t=="string"){var r=b.grep(e,function(e){return e.nodeType===1});if(at.test(t))return b.filter(t,r,!n);t=b.filter(t,r)}return b.grep(e,function(e){return b.inArray(e,t)>=0===n})}function pt(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Mt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function _t(e){var t=e.getAttributeNode("type");return e.type=(t&&t.specified)+"/"+e.type,e}function Dt(e){var t=Ct.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pt(e,t){var n,r=0;for(;(n=e[r])!=null;r++)b._data(n,"globalEval",!t||b._data(t[r],"globalEval"))}function Ht(e,t){if(t.nodeType!==1||!b.hasData(e))return;var n,r,i,s=b._data(e),o=b._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)b.event.add(t,n,u[n][r])}o.data&&(o.data=b.extend({},o.data))}function Bt(e,t){var n,r,i;if(t.nodeType!==1)return;n=t.nodeName.toLowerCase();if(!b.support.noCloneEvent&&t[b.expando]){i=b._data(t);for(r in i.events)b.removeEvent(t,r,i.handle);t.removeAttribute(b.expando)}if(n==="script"&&t.text!==e.text)_t(t).text=e.text,Dt(t);else if(n==="object")t.parentNode&&(t.outerHTML=e.outerHTML),b.support.html5Clone&&e.innerHTML&&!b.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML);else if(n==="input"&&xt.test(e.type))t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value);else if(n==="option")t.defaultSelected=t.selected=e.defaultSelected;else if(n==="input"||n==="textarea")t.defaultValue=e.defaultValue}function jt(e,n){var r,s,o=0,u=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!u)for(u=[],r=e.childNodes||e;(s=r[o])!=null;o++)!n||b.nodeName(s,n)?u.push(s):b.merge(u,jt(s,n));return n===t||n&&b.nodeName(e,n)?b.merge([e],u):u}function Ft(e){xt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--){t=en[i]+n;if(t in e)return t}return r}function nn(e,t){return e=t||e,b.css(e,"display")==="none"||!b.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,s=[],o=0,u=e.length;for(;o<u;o++){r=e[o];if(!r.style)continue;s[o]=b._data(r,"olddisplay"),n=r.style.display,t?(!s[o]&&n==="none"&&(r.style.display=""),r.style.display===""&&nn(r)&&(s[o]=b._data(r,"olddisplay",an(r.nodeName)))):s[o]||(i=nn(r),(n&&n!=="none"||!i)&&b._data(r,"olddisplay",i?n:b.css(r,"display")))}for(o=0;o<u;o++){r=e[o];if(!r.style)continue;if(!t||r.style.display==="none"||r.style.display==="")r.style.display=t?s[o]||"":"none"}return e}function sn(e,t,n){var r=$t.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function on(e,t,n,r,i){var s=n===(r?"border":"content")?4:t==="width"?1:0,o=0;for(;s<4;s+=2)n==="margin"&&(o+=b.css(e,n+Zt[s],!0,i)),r?(n==="content"&&(o-=b.css(e,"padding"+Zt[s],!0,i)),n!=="margin"&&(o-=b.css(e,"border"+Zt[s]+"Width",!0,i))):(o+=b.css(e,"padding"+Zt[s],!0,i),n!=="padding"&&(o+=b.css(e,"border"+Zt[s]+"Width",!0,i)));return o}function un(e,t,n){var r=!0,i=t==="width"?e.offsetWidth:e.offsetHeight,s=qt(e),o=b.support.boxSizing&&b.css(e,"boxSizing",!1,s)==="border-box";if(i<=0||i==null){i=Rt(e,t,s);if(i<0||i==null)i=e.style[t];if(Jt.test(i))return i;r=o&&(b.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+on(e,t,n||(o?"border":"content"),r,s)+"px"}function an(e){var t=s,n=Qt[e];if(!n){n=fn(e,t);if(n==="none"||!n)It=(It||b("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=fn(e,t),It.detach();Qt[e]=n}return n}function fn(e,t){var n=b(t.createElement(e)).appendTo(t.body),r=b.css(n[0],"display");return n.remove(),r}function vn(e,t,n,r){var i;if(b.isArray(t))b.each(t,function(t,i){n||cn.test(e)?r(e,i):vn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&b.type(t)==="object")for(i in t)vn(e+"["+i+"]",t[i],n,r);else r(e,t)}function _n(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(E)||[];if(b.isFunction(n))while(r=s[i++])r[0]==="+"?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Dn(e,t,n,r){function o(u){var a;return i[u]=!0,b.each(e[u]||[],function(e,u){var f=u(t,n,r);if(typeof f=="string"&&!s&&!i[f])return t.dataTypes.unshift(f),o(f),!1;if(s)return!(a=f)}),a}var i={},s=e===An;return o(t.dataTypes[0])||!i["*"]&&o("*")}function Pn(e,n){var r,i,s=b.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);return r&&b.extend(!0,e,r),e}function Hn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(u in l)u in r&&(n[l[u]]=r[u]);while(f[0]==="*")f.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"));if(s)for(u in a)if(a[u]&&a[u].test(s)){f.unshift(u);break}if(f[0]in r)o=f[0];else{for(u in r){if(!f[0]||e.converters[u+" "+f[0]]){o=u;break}i||(i=u)}o=o||i}if(o)return o!==f[0]&&f.unshift(o),r[o]}function Bn(e,t){var n,r,i,s,o={},u=0,a=e.dataTypes.slice(),f=a[0];e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(a[1])for(i in e.converters)o[i.toLowerCase()]=e.converters[i];for(;r=a[++u];)if(r!=="*"){if(f!=="*"&&f!==r){i=o[f+" "+r]||o["* "+r];if(!i)for(n in o){s=n.split(" ");if(s[1]===r){i=o[f+" "+s[0]]||o["* "+s[0]];if(i){i===!0?i=o[n]:o[n]!==!0&&(r=s[0],a.splice(u--,0,r));break}}}if(i!==!0)if(i&&e["throws"])t=i(t);else try{t=i(t)}catch(l){return{state:"parsererror",error:i?l:"No conversion from "+f+" to "+r}}}f=r}return{state:"success",data:t}}function zn(){try{return new e.XMLHttpRequest}catch(t){}}function Wn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Yn(){return setTimeout(function(){Xn=t}),Xn=b.now()}function Zn(e,t){b.each(t,function(t,n){var r=(Gn[t]||[]).concat(Gn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function er(e,t,n){var r,i,s=0,o=Qn.length,u=b.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Xn||Yn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;o<a;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),s<1&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:b.extend({},t),opts:b.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Yn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=b.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;i=!0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;tr(l,f.opts.specialEasing);for(;s<o;s++){r=Qn[s].call(f,e,l,f.opts);if(r)return r}return Zn(f,l),b.isFunction(f.opts.start)&&f.opts.start.call(e,f),b.fx.timer(b.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function tr(e,t){var n,r,i,s,o;for(i in e){r=b.camelCase(i),s=t[r],n=e[i],b.isArray(n)&&(s=n[1],n=e[i]=n[0]),i!==r&&(e[r]=n,delete e[i]),o=b.cssHooks[r];if(o&&"expand"in o){n=o.expand(n),delete e[r];for(i in n)i in e||(e[i]=n[i],t[i]=s)}else t[r]=s}}function nr(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},v=[],m=e.nodeType&&nn(e);n.queue||(l=b._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,b.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],b.css(e,"display")==="inline"&&b.css(e,"float")==="none"&&(!b.support.inlineBlockNeedsLayout||an(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",b.support.shrinkWrapBlocks||h.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(i in t){o=t[i];if($n.exec(o)){delete t[i],a=a||o==="toggle";if(o===(m?"hide":"show"))continue;v.push(i)}}s=v.length;if(s){u=b._data(e,"fxshow")||b._data(e,"fxshow",{}),"hidden"in u&&(m=u.hidden),a&&(u.hidden=!m),m?b(e).show():h.done(function(){b(e).hide()}),h.done(function(){var t;b._removeData(e,"fxshow");for(t in d)b.style(e,t,d[t])});for(i=0;i<s;i++)r=v[i],f=h.createTween(r,m?u[r]:0),d[r]=u[r]||b.style(e,r),r in u||(u[r]=f.start,m&&(f.end=f.start,f.start=r==="width"||r==="height"?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function sr(e){return b.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,s=e.document,o=e.location,u=e.jQuery,a=e.$,f={},l=[],c="1.9.1",h=l.concat,p=l.push,d=l.slice,v=l.indexOf,m=f.toString,g=f.hasOwnProperty,y=c.trim,b=function(e,t){return new b.fn.init(e,t,r)},w=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,E=/\S+/g,S=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,T=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,N=/^[\],:{}\s]*$/,C=/(?:^|:|,)(?:\s*\[)+/g,k=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,L=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,A=/^-ms-/,O=/-([\da-z])/gi,M=function(e,t){return t.toUpperCase()},_=function(e){if(s.addEventListener||e.type==="load"||s.readyState==="complete")D(),b.ready()},D=function(){s.addEventListener?(s.removeEventListener("DOMContentLoaded",_,!1),e.removeEventListener("load",_,!1)):(s.detachEvent("onreadystatechange",_),e.detachEvent("onload",_))};b.fn=b.prototype={jquery:c,constructor:b,init:function(e,n,r){var i,o;if(!e)return this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?i=[null,e,null]:i=x.exec(e);if(i&&(i[1]||!n)){if(i[1]){n=n instanceof b?n[0]:n,b.merge(this,b.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:s,!0));if(T.test(i[1])&&b.isPlainObject(n))for(i in n)b.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}o=s.getElementById(i[2]);if(o&&o.parentNode){if(o.id!==i[2])return r.find(e);this.length=1,this[0]=o}return this.context=s,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return e.nodeType?(this.context=this[0]=e,this.length=1,this):b.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),b.makeArray(e,this))},selector:"",length:0,size:function(){return this.length},toArray:function(){return d.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=b.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return b.each(this,e,t)},ready:function(e){return b.ready.promise().done(e),this},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(b.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:p,sort:[].sort,splice:[].splice},b.fn.init.prototype=b.fn,b.extend=b.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!b.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((s=arguments[a])!=null)for(i in s){e=u[i],r=s[i];if(u===r)continue;l&&r&&(b.isPlainObject(r)||(n=b.isArray(r)))?(n?(n=!1,o=e&&b.isArray(e)?e:[]):o=e&&b.isPlainObject(e)?e:{},u[i]=b.extend(l,o,r)):r!==t&&(u[i]=r)}return u},b.extend({noConflict:function(t){return e.$===b&&(e.$=a),t&&e.jQuery===b&&(e.jQuery=u),b},isReady:!1,readyWait:1,holdReady:function(e){e?b.readyWait++:b.ready(!0)},ready:function(e){if(e===!0?--b.readyWait:b.isReady)return;if(!s.body)return setTimeout(b.ready);b.isReady=!0;if(e!==!0&&--b.readyWait>0)return;n.resolveWith(s,[b]),b.fn.trigger&&b(s).trigger("ready").off("ready")},isFunction:function(e){return b.type(e)==="function"},isArray:Array.isArray||function(e){return b.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):typeof e=="object"||typeof e=="function"?f[m.call(e)]||"object":typeof e},isPlainObject:function(e){if(!e||b.type(e)!=="object"||e.nodeType||b.isWindow(e))return!1;try{if(e.constructor&&!g.call(e,"constructor")&&!g.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||g.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||typeof e!="string")return null;typeof t=="boolean"&&(n=t,t=!1),t=t||s;var r=T.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=b.buildFragment([e],t,i),i&&b(i).remove(),b.merge([],r.childNodes))},parseJSON:function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(t===null)return t;if(typeof t=="string"){t=b.trim(t);if(t&&N.test(t.replace(k,"@").replace(L,"]").replace(C,"")))return(new Function("return "+t))()}b.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&b.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&b.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(A,"ms-").replace(O,M)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=P(e);if(n)if(o)for(;i<s;i++){r=t.apply(e[i],n);if(r===!1)break}else for(i in e){r=t.apply(e[i],n);if(r===!1)break}else if(o)for(;i<s;i++){r=t.call(e[i],i,e[i]);if(r===!1)break}else for(i in e){r=t.call(e[i],i,e[i]);if(r===!1)break}return e},trim:y&&!y.call("﻿ ")?function(e){return e==null?"":y.call(e)}:function(e){return e==null?"":(e+"").replace(S,"")},makeArray:function(e,t){var n=t||[];return e!=null&&(P(Object(e))?b.merge(n,typeof e=="string"?[e]:e):p.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(v)return v.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=P(e),u=[];if(o)for(;i<s;i++)r=t(e[i],i,n),r!=null&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),r!=null&&(u[u.length]=r);return h.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(s=e[n],n=e,e=s),b.isFunction(e)?(r=d.call(arguments,2),i=function(){return e.apply(n||this,r.concat(d.call(arguments)))},i.guid=e.guid=e.guid||b.guid++,i):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=r==null;if(b.type(r)==="object"){s=!0;for(a in r)b.access(e,n,a,r[a],!0,o,u)}else if(i!==t){s=!0,b.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(b(e),n)}));if(n)for(;a<f;a++)n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)))}return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()}}),b.ready.promise=function(t){if(!n){n=b.Deferred();if(s.readyState==="complete")setTimeout(b.ready);else if(s.addEventListener)s.addEventListener("DOMContentLoaded",_,!1),e.addEventListener("load",_,!1);else{s.attachEvent("onreadystatechange",_),e.attachEvent("onload",_);var r=!1;try{r=e.frameElement==null&&s.documentElement}catch(i){}r&&r.doScroll&&function o(){if(!b.isReady){try{r.doScroll("left")}catch(e){return setTimeout(o,50)}D(),b.ready()}}()}}return n.promise(t)},b.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){f["[object "+t+"]"]=t.toLowerCase()}),r=b(s);var H={};b.Callbacks=function(e){e=typeof e=="string"?H[e]||B(e):b.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){r=e.memory&&t,i=!0,o=u||0,u=0,s=a.length,n=!0;for(;a&&o<s;o++)if(a[o].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,a&&(f?f.length&&l(f.shift()):r?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function i(t){b.each(t,function(t,n){var r=b.type(n);r==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&r!=="string"&&i(n)})})(arguments),n?s=a.length:r&&(u=t,l(r))}return this},remove:function(){return a&&b.each(arguments,function(e,t){var r;while((r=b.inArray(t,a,r))>-1)a.splice(r,1),n&&(r<=s&&s--,r<=o&&o--)}),this},has:function(e){return e?b.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],this},disable:function(){return a=f=r=t,this},disabled:function(){return!a},lock:function(){return f=t,r||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!i||f)&&(n?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},b.extend({Deferred:function(e){var t=[["resolve","done",b.Callbacks("once memory"),"resolved"],["reject","fail",b.Callbacks("once memory"),"rejected"],["notify","progress",b.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return b.Deferred(function(n){b.each(t,function(t,s){var o=s[0],u=b.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&b.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return e!=null?b.extend(e,r):r}},i={};return r.pipe=r.then,b.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=d.call(arguments),r=n.length,i=r!==1||e&&b.isFunction(e.promise)?r:0,s=i===1?e:b.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&b.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),b.support=function(){var t,n,r,o,u,a,f,l,c,h,p=s.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};u=s.createElement("select"),f=u.appendChild(s.createElement("option")),o=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={getSetAttribute:p.className!=="t",leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:!!o.value,optSelected:f.selected,enctype:!!s.createElement("form").enctype,html5Clone:s.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:s.compatMode==="CSS1Compat",deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},o.checked=!0,t.noCloneChecked=o.cloneNode(!0).checked,u.disabled=!0,t.optDisabled=!f.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}o=s.createElement("input"),o.setAttribute("value",""),t.input=o.getAttribute("value")==="",o.value="t",o.setAttribute("type","radio"),t.radioValue=o.value==="t",o.setAttribute("checked","t"),o.setAttribute("name","t"),a=s.createDocumentFragment(),a.appendChild(o),t.appendChecked=o.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).click());for(h in{submit:!0,change:!0,focusin:!0})p.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||p.attributes[l].expando===!1;return p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle=p.style.backgroundClip==="content-box",b(function(){var n,r,o,u="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=s.getElementsByTagName("body")[0];if(!a)return;n=s.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",o=p.getElementsByTagName("td"),o[0].style.cssText="padding:0;margin:0;border:0;display:none",c=o[0].offsetHeight===0,o[0].style.display="",o[1].style.display="none",t.reliableHiddenOffsets=c&&o[0].offsetHeight===0,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=p.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(p,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(p,null)||{width:"4px"}).width==="4px",r=p.appendChild(s.createElement("div")),r.style.cssText=p.style.cssText=u,r.style.marginRight=r.style.width="0",p.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof p.style.zoom!==i&&(p.innerHTML="",p.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=p.offsetWidth===3,p.style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",t.shrinkWrapBlocks=p.offsetWidth!==3,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=p=o=r=null}),n=u=a=f=r=o=null,t}();var j=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,F=/([A-Z])/g;b.extend({cache:{},expando:"jQuery"+(c+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?b.cache[e[b.expando]]:e[b.expando],!!e&&!U(e)},data:function(e,t,n){return I(e,t,n)},removeData:function(e,t){return q(e,t)},_data:function(e,t,n){return I(e,t,n,!0)},_removeData:function(e,t){return q(e,t,!0)},acceptData:function(e){if(e.nodeType&&e.nodeType!==1&&e.nodeType!==9)return!1;var t=e.nodeName&&b.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),b.fn.extend({data:function(e,n){var r,i,s=this[0],o=0,u=null;if(e===t){if(this.length){u=b.data(s);if(s.nodeType===1&&!b._data(s,"parsedAttrs")){r=s.attributes;for(;o<r.length;o++)i=r[o].name,i.indexOf("data-")||(i=b.camelCase(i.slice(5)),R(s,i,u[i]));b._data(s,"parsedAttrs",!0)}}return u}return typeof e=="object"?this.each(function(){b.data(this,e)}):b.access(this,function(n){if(n===t)return s?R(s,e,b.data(s,e)):null;this.each(function(){b.data(this,e,n)})},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){b.removeData(this,e)})}}),b.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=b._data(e,t),n&&(!r||b.isArray(n)?r=b._data(e,t,b.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=b.queue(e,t),r=n.length,i=n.shift(),s=b._queueHooks(e,t),o=function(){b.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),s.cur=i,i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return b._data(e,n)||b._data(e,n,{empty:b.Callbacks("once memory").add(function(){b._removeData(e,t+"queue"),b._removeData(e,n)})})}}),b.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?b.queue(this[0],e):n===t?this:this.each(function(){var t=b.queue(this,e,n);b._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&b.dequeue(this,e)})},dequeue:function(e){return this.each(function(){b.dequeue(this,e)})},delay:function(e,t){return e=b.fx?b.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=b.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=b._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var z,W,X=/[\t\r\n]/g,V=/\r/g,$=/^(?:input|select|textarea|button|object)$/i,J=/^(?:a|area)$/i,K=/^(?:checked|selected|autofocus|autoplay|async|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped)$/i,Q=/^(?:checked|selected)$/i,G=b.support.getSetAttribute,Y=b.support.input;b.fn.extend({attr:function(e,t){return b.access(this,b.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){b.removeAttr(this,e)})},prop:function(e,t){return b.access(this,b.prop,e,t,arguments.length>1)},removeProp:function(e){return e=b.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=typeof e=="string"&&e;if(b.isFunction(e))return this.each(function(t){b(this).addClass(e.call(this,t,this.className))});if(a){t=(e||"").match(E)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(X," "):" ");if(r){s=0;while(i=t[s++])r.indexOf(" "+i+" ")<0&&(r+=i+" ");n.className=b.trim(r)}}}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=arguments.length===0||typeof e=="string"&&e;if(b.isFunction(e))return this.each(function(t){b(this).removeClass(e.call(this,t,this.className))});if(a){t=(e||"").match(E)||[];for(;o<u;o++){n=this[o],r=n.nodeType===1&&(n.className?(" "+n.className+" ").replace(X," "):"");if(r){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?b.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return b.isFunction(e)?this.each(function(n){b(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var s,o=0,u=b(this),a=t,f=e.match(E)||[];while(s=f[o++])a=r?a:!u.hasClass(s),u[a?"addClass":"removeClass"](s)}else if(n===i||n==="boolean")this.className&&b._data(this,"__className__",this.className),this.className=this.className||e===!1?"":b._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(X," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return r=b.valHooks[s.type]||b.valHooks[s.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(s,"value"))!==t?n:(n=s.value,typeof n=="string"?n.replace(V,""):n==null?"":n);return}return i=b.isFunction(e),this.each(function(n){var s,o=b(this);if(this.nodeType!==1)return;i?s=e.call(this,n,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":b.isArray(s)&&(s=b.map(s,function(e){return e==null?"":e+""})),r=b.valHooks[this.type]||b.valHooks[this.nodeName.toLowerCase()];if(!r||!("set"in r)||r.set(this,s,"value")===t)this.value=s})}}),b.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(b.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!b.nodeName(n.parentNode,"optgroup"))){t=b(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=b.makeArray(t);return b(e).find("option").each(function(){this.selected=b.inArray(b(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attr:function(e,n,r){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(typeof e.getAttribute===i)return b.prop(e,n,r);o=a!==1||!b.isXMLDoc(e),o&&(n=n.toLowerCase(),s=b.attrHooks[n]||(K.test(n)?W:z));if(r===t)return s&&o&&"get"in s&&(u=s.get(e,n))!==null?u:(typeof e.getAttribute!==i&&(u=e.getAttribute(n)),u==null?t:u);if(r!==null)return s&&o&&"set"in s&&(u=s.set(e,r,n))!==t?u:(e.setAttribute(n,r+""),r);b.removeAttr(e,n)},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(E);if(s&&e.nodeType===1)while(n=s[i++])r=b.propFix[n]||n,K.test(n)?!G&&Q.test(n)?e[b.camelCase("default-"+n)]=e[r]=!1:e[r]=!1:b.attr(e,n,""),e.removeAttribute(G?n:r)},attrHooks:{type:{set:function(e,t){if(!b.support.radioValue&&t==="radio"&&b.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!b.isXMLDoc(e),o&&(n=b.propFix[n]||n,s=b.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):$.test(e.nodeName)||J.test(e.nodeName)&&e.href?0:t}}}}),W={get:function(e,n){var r=b.prop(e,n),i=typeof r=="boolean"&&e.getAttribute(n),s=typeof r=="boolean"?Y&&G?i!=null:Q.test(n)?e[b.camelCase("default-"+n)]:!!i:e.getAttributeNode(n);return s&&s.value!==!1?n.toLowerCase():t},set:function(e,t,n){return t===!1?b.removeAttr(e,n):Y&&G||!Q.test(n)?e.setAttribute(!G&&b.propFix[n]||n,n):e[b.camelCase("default-"+n)]=e[n]=!0,n}};if(!Y||!G)b.attrHooks.value={get:function(e,n){var r=e.getAttributeNode(n);return b.nodeName(e,"input")?e.defaultValue:r&&r.specified?r.value:t},set:function(e,t,n){if(!b.nodeName(e,"input"))return z&&z.set(e,t,n);e.defaultValue=t}};G||(z=b.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&(n==="id"||n==="name"||n==="coords"?r.value!=="":r.specified)?r.value:t},set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="",r==="value"||n===e.getAttribute(r)?n:t}},b.attrHooks.contenteditable={get:z.get,set:function(e,t,n){z.set(e,t===""?!1:t,n)}},b.each(["width","height"],function(e,t){b.attrHooks[t]=b.extend(b.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})})),b.support.hrefNormalized||(b.each(["href","src","width","height"],function(e,n){b.attrHooks[n]=b.extend(b.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r==null?t:r}})}),b.each(["href","src"],function(e,t){b.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}})),b.support.style||(b.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),b.support.optSelected||(b.propHooks.selected=b.extend(b.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),b.support.enctype||(b.propFix.enctype="encoding"),b.support.checkOn||b.each(["radio","checkbox"],function(){b.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),b.each(["radio","checkbox"],function(){b.valHooks[this]=b.extend(b.valHooks[this],{set:function(e,t){if(b.isArray(t))return e.checked=b.inArray(b(e).val(),t)>=0}})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;b.event={global:{},add:function(e,n,r,s,o){var u,a,f,l,c,h,p,d,v,m,g,y=b._data(e);if(!y)return;r.handler&&(l=r,r=l.handler,o=l.selector),r.guid||(r.guid=b.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(e){return typeof b===i||!!e&&b.event.triggered===e.type?t:b.event.dispatch.apply(h.elem,arguments)},h.elem=e),n=(n||"").match(E)||[""],f=n.length;while(f--){u=rt.exec(n[f])||[],v=g=u[1],m=(u[2]||"").split(".").sort(),c=b.event.special[v]||{},v=(o?c.delegateType:c.bindType)||v,c=b.event.special[v]||{},p=b.extend({type:v,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&b.expr.match.needsContext.test(o),namespace:m.join(".")},l);if(!(d=a[v])){d=a[v]=[],d.delegateCount=0;if(!c.setup||c.setup.call(e,s,m,h)===!1)e.addEventListener?e.addEventListener(v,h,!1):e.attachEvent&&e.attachEvent("on"+v,h)}c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,p):d.push(p),b.event.global[v]=!0}e=null},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=b.hasData(e)&&b._data(e);if(!m||!(l=m.events))return;t=(t||"").match(E)||[""],f=t.length;while(f--){u=rt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort();if(!p){for(p in l)b.event.remove(e,p+t[f],n,r,!0);continue}c=b.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=l[p]||[],u=u[2]&&new RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],(i||v===o.origType)&&(!n||n.guid===o.guid)&&(!u||u.test(o.namespace))&&(!r||r===o.selector||r==="**"&&o.selector)&&(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&((!c.teardown||c.teardown.call(e,d,m.handle)===!1)&&b.removeEvent(e,p,m.handle),delete l[p])}b.isEmptyObject(l)&&(delete m.handle,b._removeData(e,"events"))},trigger:function(n,r,i,o){var u,a,f,l,c,h,p,d=[i||s],v=g.call(n,"type")?n.type:n,m=g.call(n,"namespace")?n.namespace.split("."):[];f=h=i=i||s;if(i.nodeType===3||i.nodeType===8)return;if(nt.test(v+b.event.triggered))return;v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),a=v.indexOf(":")<0&&"on"+v,n=n[b.expando]?n:new b.Event(v,typeof n=="object"&&n),n.isTrigger=!0,n.namespace=m.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=r==null?[n]:b.makeArray(r,[n]),c=b.event.special[v]||{};if(!o&&c.trigger&&c.trigger.apply(i,r)===!1)return;if(!o&&!c.noBubble&&!b.isWindow(i)){l=c.delegateType||v,nt.test(l+v)||(f=f.parentNode);for(;f;f=f.parentNode)d.push(f),h=f;h===(i.ownerDocument||s)&&d.push(h.defaultView||h.parentWindow||e)}p=0;while((f=d[p++])&&!n.isPropagationStopped())n.type=p>1?l:c.bindType||v,u=(b._data(f,"events")||{})[n.type]&&b._data(f,"handle"),u&&u.apply(f,r),u=a&&f[a],u&&b.acceptData(f)&&u.apply&&u.apply(f,r)===!1&&n.preventDefault();n.type=v;if(!o&&!n.isDefaultPrevented()&&(!c._default||c._default.apply(i.ownerDocument,r)===!1)&&(v!=="click"||!b.nodeName(i,"a"))&&b.acceptData(i)&&a&&i[v]&&!b.isWindow(i)){h=i[a],h&&(i[a]=null),b.event.triggered=v;try{i[v]()}catch(y){}b.event.triggered=t,h&&(i[a]=h)}return n.result},dispatch:function(e){e=b.event.fix(e);var n,r,i,s,o,u=[],a=d.call(arguments),f=(b._data(this,"events")||{})[e.type]||[],l=b.event.special[e.type]||{};a[0]=e,e.delegateTarget=this;if(l.preDispatch&&l.preDispatch.call(this,e)===!1)return;u=b.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())if(!e.namespace_re||e.namespace_re.test(i.namespace))e.handleObj=i,e.data=i.data,r=((b.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation())}return l.postDispatch&&l.postDispatch.call(this,e),e.result},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||e.type!=="click"))for(;f!=this;f=f.parentNode||this)if(f.nodeType===1&&(f.disabled!==!0||e.type!=="click")){s=[];for(o=0;o<a;o++)i=n[o],r=i.selector+" ",s[r]===t&&(s[r]=i.needsContext?b(r,this).index(f)>=0:b.find(r,this,null,[f]).length),s[r]&&s.push(i);s.length&&u.push({elem:f,handlers:s})}return a<n.length&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[b.expando])return e;var t,n,r,i=e.type,o=e,u=this.fixHooks[i];u||(this.fixHooks[i]=u=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=u.props?this.props.concat(u.props):this.props,e=new b.Event(o),t=r.length;while(t--)n=r[t],e[n]=o[n];return e.target||(e.target=o.srcElement||s),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,u.filter?u.filter(e,o):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(i=e.target.ownerDocument||s,o=i.documentElement,r=i.body,e.pageX=n.clientX+(o&&o.scrollLeft||r&&r.scrollLeft||0)-(o&&o.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(o&&o.scrollTop||r&&r.scrollTop||0)-(o&&o.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},special:{load:{noBubble:!0},click:{trigger:function(){if(b.nodeName(this,"input")&&this.type==="checkbox"&&this.click)return this.click(),!1}},focus:{trigger:function(){if(this!==s.activeElement&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===s.activeElement&&this.blur)return this.blur(),!1},delegateType:"focusout"},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=b.extend(new b.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?b.event.trigger(i,null,t):b.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},b.removeEvent=s.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},b.Event=function(e,t){if(!(this instanceof b.Event))return new b.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:st):this.type=e,t&&b.extend(this,t),this.timeStamp=e&&e.timeStamp||b.now(),this[b.expando]=!0},b.Event.prototype={isDefaultPrevented:st,isPropagationStopped:st,isImmediatePropagationStopped:st,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},b.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){b.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;if(!i||i!==r&&!b.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),b.support.submitBubbles||(b.event.special.submit={setup:function(){if(b.nodeName(this,"form"))return!1;b.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=b.nodeName(n,"input")||b.nodeName(n,"button")?n.form:t;r&&!b._data(r,"submitBubbles")&&(b.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),b._data(r,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&b.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(b.nodeName(this,"form"))return!1;b.event.remove(this,"._submit")}}),b.support.changeBubbles||(b.event.special.change={setup:function(){if(Z.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")b.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),b.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),b.event.simulate("change",this,e,!0)});return!1}b.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!b._data(t,"changeBubbles")&&(b.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&b.event.simulate("change",this.parentNode,e,!0)}),b._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return b.event.remove(this,"._change"),!Z.test(this.nodeName)}}),b.support.focusinBubbles||b.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){b.event.simulate(t,e.target,b.event.fix(e),!0)};b.event.special[t]={setup:function(){n++===0&&s.addEventListener(e,r,!0)},teardown:function(){--n===0&&s.removeEventListener(e,r,!0)}}}),b.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(o in e)this.on(o,n,r,e[o],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=st;else if(!i)return this;return s===1&&(u=i,i=function(e){return b().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=b.guid++)),this.each(function(){b.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,b(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=st),this.each(function(){b.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){b.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return b.event.trigger(e,t,n,!0)}}),function(e,t){function rt(e){return J.test(e+"")}function it(){var e,t=[];return e=function(n,r){return t.push(n+=" ")>i.cacheLength&&delete e[t.shift()],e[n]=r}}function st(e){return e[w]=!0,e}function ot(e){var t=c.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}}function ut(e,t,n,r){var i,s,o,u,a,f,h,v,m,y;(t?t.ownerDocument||t:E)!==c&&l(t),t=t||c,n=n||[];if(!e||typeof e!="string")return n;if((u=t.nodeType)!==1&&u!==9)return[];if(!p&&!r){if(i=K.exec(e))if(o=i[1]){if(u===9){s=t.getElementById(o);if(!s||!s.parentNode)return n;if(s.id===o)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(o))&&g(t,s)&&s.id===o)return n.push(s),n}else{if(i[2])return _.apply(n,D.call(t.getElementsByTagName(e),0)),n;if((o=i[3])&&S.getByClassName&&t.getElementsByClassName)return _.apply(n,D.call(t.getElementsByClassName(o),0)),n}if(S.qsa&&!d.test(e)){h=!0,v=w,m=t,y=u===9&&e;if(u===1&&t.nodeName.toLowerCase()!=="object"){f=ht(e),(h=t.getAttribute("id"))?v=h.replace(Y,"\\$&"):t.setAttribute("id",v),v="[id='"+v+"'] ",a=f.length;while(a--)f[a]=v+pt(f[a]);m=$.test(e)&&t.parentNode||t,y=f.join(",")}if(y)try{return _.apply(n,D.call(m.querySelectorAll(y),0)),n}catch(b){}finally{h||t.removeAttribute("id")}}}return Et(e.replace(R,"$1"),t,n,r)}function at(e,t){var n=t&&e,r=n&&(~t.sourceIndex||A)-(~e.sourceIndex||A);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ft(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function lt(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function ct(e){return st(function(t){return t=+t,st(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ht(e,t){var n,r,s,o,u,a,f,l=C[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=U.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=z.exec(u))n=r.shift(),s.push({value:n,type:r[0].replace(R," ")}),u=u.slice(n.length);for(o in i.filter)(r=V[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(n=r.shift(),s.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ut.error(e):C(e,a).slice(0)}function pt(e){var t=0,n=e.length,r="";for(;t<n;t++)r+=e[t].value;return r}function dt(e,t,n){var i=t.dir,s=n&&i==="parentNode",o=T++;return t.first?function(t,n,r){while(t=t[i])if(t.nodeType===1||s)return e(t,n,r)}:function(t,n,u){var a,f,l,c=x+" "+o;if(u){while(t=t[i])if(t.nodeType===1||s)if(e(t,n,u))return!0}else while(t=t[i])if(t.nodeType===1||s){l=t[w]||(t[w]={});if((f=l[i])&&f[0]===c){if((a=f[1])===!0||a===r)return a===!0}else{f=l[i]=[c],f[1]=e(t,n,u)||r;if(f[1]===!0)return!0}}}}function vt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function mt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function gt(e,t,n,r,i,s){return r&&!r[w]&&(r=gt(r)),i&&!i[w]&&(i=gt(i,s)),st(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?mt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=mt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?P.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=mt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):_.apply(o,g)})}function yt(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,l=dt(function(e){return e===t},u,!0),c=dt(function(e){return P.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[dt(vt(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[w]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return gt(a>1&&vt(h),a>1&&pt(e.slice(0,a-1)).replace(R,"$1"),n,a<r&&yt(e.slice(a,r)),r<s&&yt(e=e.slice(r)),r<s&&pt(e))}h.push(n)}return vt(h)}function bt(e,t){var n=0,s=t.length>0,o=e.length>0,u=function(u,a,l,h,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=p!=null,S=f,T=u||o&&i.find.TAG("*",p&&a.parentNode||a),N=x+=S==null?1:Math.random()||.1;E&&(f=a!==c&&a,r=n);for(;(d=T[b])!=null;b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){h.push(d);break}E&&(x=N,r=++n)}s&&((d=!m&&d)&&y--,u&&w.push(d))}y+=b;if(s&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)!w[b]&&!g[b]&&(g[b]=M.call(h));g=mt(g)}_.apply(h,g),E&&!u&&g.length>0&&y+t.length>1&&ut.uniqueSort(h)}return E&&(x=N,f=S),w};return s?st(u):u}function wt(e,t,n){var r=0,i=t.length;for(;r<i;r++)ut(e,t[r],n);return n}function Et(e,t,n,r){var s,o,a,f,l,c=ht(e);if(!r&&c.length===1){o=c[0]=c[0].slice(0);if(o.length>2&&(a=o[0]).type==="ID"&&t.nodeType===9&&!p&&i.relative[o[1].type]){t=i.find.ID(a.matches[0].replace(et,tt),t)[0];if(!t)return n;e=e.slice(o.shift().value.length)}s=V.needsContext.test(e)?0:o.length;while(s--){a=o[s];if(i.relative[f=a.type])break;if(l=i.find[f])if(r=l(a.matches[0].replace(et,tt),$.test(o[0].type)&&t.parentNode||t)){o.splice(s,1),e=r.length&&pt(o);if(!e)return _.apply(n,D.call(r,0)),n;break}}}return u(e,c)(r,t,p,n,$.test(e)),n}function St(){}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,w="sizzle"+ -(new Date),E=e.document,S={},x=0,T=0,N=it(),C=it(),k=it(),L=typeof t,A=1<<31,O=[],M=O.pop,_=O.push,D=O.slice,P=O.indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},H="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",j=B.replace("w","w#"),F="([*^$|!~]?=)",I="\\["+H+"*("+B+")"+H+"*(?:"+F+H+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+j+")|)|)"+H+"*\\]",q=":("+B+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+I.replace(3,8)+")*)|.*)\\)|)",R=new RegExp("^"+H+"+|((?:^|[^\\\\])(?:\\\\.)*)"+H+"+$","g"),U=new RegExp("^"+H+"*,"+H+"*"),z=new RegExp("^"+H+"*([\\x20\\t\\r\\n\\f>+~])"+H+"*"),W=new RegExp(q),X=new RegExp("^"+j+"$"),V={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),NAME:new RegExp("^\\[name=['\"]?("+B+")['\"]?\\]"),TAG:new RegExp("^("+B.replace("w","w*")+")"),ATTR:new RegExp("^"+I),PSEUDO:new RegExp("^"+q),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+H+"*(even|odd|(([+-]|)(\\d*)n|)"+H+"*(?:([+-]|)"+H+"*(\\d+)|))"+H+"*\\)|)","i"),needsContext:new RegExp("^"+H+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+H+"*((?:-\\d)?\\d*)"+H+"*\\)|)(?=[^-]|$)","i")},$=/[\x20\t\r\n\f]*[+~]/,J=/^[^{]+\{\s*\[native code/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/'|\\/g,Z=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,et=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,tt=function(e,t){var n="0x"+t-65536;return n!==n?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,n&1023|56320)};try{D.call(E.documentElement.childNodes,0)[0].nodeType}catch(nt){D=function(e){var t,n=[];while(t=this[e++])n.push(t);return n}}o=ut.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},l=ut.setDocument=function(e){var n=e?e.ownerDocument||e:E;if(n===c||n.nodeType!==9||!n.documentElement)return c;c=n,h=n.documentElement,p=o(n),S.tagNameNoComments=ot(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName("*").length}),S.attributes=ot(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),S.getByClassName=ot(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),S.getByName=ot(function(e){e.id=w+0,e.innerHTML="<a name='"+w+"'></a><div name='"+w+"'></div>",h.insertBefore(e,h.firstChild);var t=n.getElementsByName&&n.getElementsByName(w).length===2+n.getElementsByName(w+0).length;return S.getIdNotName=!n.getElementById(w),h.removeChild(e),t}),i.attrHandle=ot(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==L&&e.firstChild.getAttribute("href")==="#"})?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},S.getIdNotName?(i.find.ID=function(e,t){if(typeof t.getElementById!==L&&!p){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){return e.getAttribute("id")===t}}):(i.find.ID=function(e,n){if(typeof n.getElementById!==L&&!p){var r=n.getElementById(e);return r?r.id===e||typeof r.getAttributeNode!==L&&r.getAttributeNode("id").value===e?[r]:t:[]}},i.filter.ID=function(e){var t=e.replace(et,tt);return function(e){var n=typeof e.getAttributeNode!==L&&e.getAttributeNode("id");return n&&n.value===t}}),i.find.TAG=S.tagNameNoComments?function(e,t){if(typeof t.getElementsByTagName!==L)return t.getElementsByTagName(e)}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if(e==="*"){while(n=s[i++])n.nodeType===1&&r.push(n);return r}return s},i.find.NAME=S.getByName&&function(e,t){if(typeof t.getElementsByName!==L)return t.getElementsByName(name)},i.find.CLASS=S.getByClassName&&function(e,t){if(typeof t.getElementsByClassName!==L&&!p)return t.getElementsByClassName(e)},v=[],d=[":focus"];if(S.qsa=rt(n.querySelectorAll))ot(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||d.push("\\["+H+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||d.push(":checked")}),ot(function(e){e.innerHTML="<input type='hidden' i=''/>",e.querySelectorAll("[i^='']").length&&d.push("[*^$]="+H+"*(?:\"\"|'')"),e.querySelectorAll(":enabled").length||d.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),d.push(",.*:")});return(S.matchesSelector=rt(m=h.matchesSelector||h.mozMatchesSelector||h.webkitMatchesSelector||h.oMatchesSelector||h.msMatchesSelector))&&ot(function(e){S.disconnectedMatch=m.call(e,"div"),m.call(e,"[s!='']:x"),v.push("!=",q)}),d=new RegExp(d.join("|")),v=new RegExp(v.join("|")),g=rt(h.contains)||h.compareDocumentPosition?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&r.nodeType===1&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&e.compareDocumentPosition(r)&16)}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},y=h.compareDocumentPosition?function(e,t){var r;if(e===t)return a=!0,0;if(r=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t))return r&1||e.parentNode&&e.parentNode.nodeType===11?e===n||g(E,e)?-1:t===n||g(E,t)?1:0:r&4?-1:1;return e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],f=[t];if(e===t)return a=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:0;if(s===o)return at(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)f.unshift(r);while(u[i]===f[i])i++;return i?at(u[i],f[i]):u[i]===E?-1:f[i]===E?1:0},a=!1,[0,0].sort(y),S.detectDuplicates=a,c},ut.matches=function(e,t){return ut(e,null,null,t)},ut.matchesSelector=function(e,t){(e.ownerDocument||e)!==c&&l(e),t=t.replace(Z,"='$1']");if(S.matchesSelector&&!p&&(!v||!v.test(t))&&!d.test(t))try{var n=m.call(e,t);if(n||S.disconnectedMatch||e.document&&e.document.nodeType!==11)return n}catch(r){}return ut(t,c,null,[e]).length>0},ut.contains=function(e,t){return(e.ownerDocument||e)!==c&&l(e),g(e,t)},ut.attr=function(e,t){var n;return(e.ownerDocument||e)!==c&&l(e),p||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):p||S.attributes?e.getAttribute(t):((n=e.getAttributeNode(t))||e.getAttribute(t))&&e[t]===!0?t:n&&n.specified?n.value:null},ut.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ut.uniqueSort=function(e){var t,n=[],r=1,i=0;a=!S.detectDuplicates,e.sort(y);if(a){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},s=ut.getText=function(e){var t,n="",r=0,i=e.nodeType;if(!i)for(;t=e[r];r++)n+=s(t);else if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue;return n},i=ut.selectors={cacheLength:50,createPseudo:st,match:V,find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(et,tt),e[3]=(e[4]||e[5]||"").replace(et,tt),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1].slice(0,3)==="nth"?(e[3]||ut.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(e[3]==="even"||e[3]==="odd")),e[5]=+(e[7]+e[8]||e[3]==="odd")):e[3]&&ut.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return V.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&W.test(n)&&(t=ht(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace(et,tt).toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=N[e+" "];return t||(t=new RegExp("(^|"+H+")"+e+"("+H+"|$)"))&&N(e,function(e){return t.test(e.className||typeof e.getAttribute!==L&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ut.attr(r,e);return i==null?t==="!=":t?(i+="",t==="="?i===n:t==="!="?i!==n:t==="^="?n&&i.indexOf(n)===0:t==="*="?n&&i.indexOf(n)>-1:t==="$="?n&&i.slice(-n.length)===n:t==="~="?(" "+i+" ").indexOf(n)>-1:t==="|="?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s=e.slice(0,3)!=="nth",o=e.slice(-4)!=="last",u=t==="of-type";return r===1&&i===0?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:c.nodeType===1)return!1;d=v=e==="only"&&!d&&"nextSibling"}return!0}d=[o?m.firstChild:m.lastChild];if(o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===x&&f[1],h=f[0]===x&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(c.nodeType===1&&++h&&c===t){l[e]=[x,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===x)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:c.nodeType===1)&&++h){y&&((c[w]||(c[w]={}))[e]=[x,h]);if(c===t)break}return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||ut.error("unsupported pseudo: "+e);return r[w]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?st(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=P.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:st(function(e){var t=[],n=[],r=u(e.replace(R,"$1"));return r[w]?st(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:st(function(e){return function(t){return ut(e,t).length>0}}),contains:st(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),lang:st(function(e){return X.test(e||"")||ut.error("unsupported lang: "+e),e=e.replace(et,tt).toLowerCase(),function(t){var n;do if(n=p?t.getAttribute("xml:lang")||t.getAttribute("lang"):t.lang)return n=n.toLowerCase(),n===e||n.indexOf(e+"-")===0;while((t=t.parentNode)&&t.nodeType===1);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===h},focus:function(e){return e===c.activeElement&&(!c.hasFocus||c.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||e.nodeType===3||e.nodeType===4)return!1;return!0},parent:function(e){return!i.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},text:function(e){var t;return e.nodeName.toLowerCase()==="input"&&e.type==="text"&&((t=e.getAttribute("type"))==null||t.toLowerCase()===e.type)},first:ct(function(){return[0]}),last:ct(function(e,t){return[t-1]}),eq:ct(function(e,t,n){return[n<0?n+t:n]}),even:ct(function(e,t){var n=0;for(;n<t;n+=2)e.push(n);return e}),odd:ct(function(e,t){var n=1;for(;n<t;n+=2)e.push(n);return e}),lt:ct(function(e,t,n){var r=n<0?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:ct(function(e,t,n){var r=n<0?n+t:n;for(;++r<t;)e.push(r);return e})}};for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})i.pseudos[n]=ft(n);for(n in{submit:!0,reset:!0})i.pseudos[n]=lt(n);u=ut.compile=function(e,t){var n,r=[],i=[],s=k[e+" "];if(!s){t||(t=ht(e)),n=t.length;while(n--)s=yt(t[n]),s[w]?r.push(s):i.push(s);s=k(e,bt(i,r))}return s},i.pseudos.nth=i.pseudos.eq,i.filters=St.prototype=i.pseudos,i.setFilters=new St,l(),ut.attr=b.attr,b.find=ut,b.expr=ut.selectors,b.expr[":"]=b.expr.pseudos,b.unique=ut.uniqueSort,b.text=ut.getText,b.isXMLDoc=ut.isXML,b.contains=ut.contains}(e);var ot=/Until$/,ut=/^(?:parents|prev(?:Until|All))/,at=/^.[^:#\[\.,]*$/,ft=b.expr.match.needsContext,lt={children:!0,contents:!0,next:!0,prev:!0};b.fn.extend({find:function(e){var t,n,r,i=this.length;if(typeof e!="string")return r=this,this.pushStack(b(e).filter(function(){for(t=0;t<i;t++)if(b.contains(r[t],this))return!0}));n=[];for(t=0;t<i;t++)b.find(e,this[t],n);return n=this.pushStack(i>1?b.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t,n=b(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(b.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ht(this,e,!1))},filter:function(e){return this.pushStack(ht(this,e,!0))},is:function(e){return!!e&&(typeof e=="string"?ft.test(e)?b(e,this.context).index(this[0])>=0:b.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ft.test(e)||typeof e!="string"?b(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:b.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return this.pushStack(s.length>1?b.unique(s):s)},index:function(e){return e?typeof e=="string"?b.inArray(this[0],b(e)):b.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?b(e,t):b.makeArray(e&&e.nodeType?[e]:e),r=b.merge(this.get(),n);return this.pushStack(b.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),b.fn.andSelf=b.fn.addBack,b.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return b.dir(e,"parentNode")},parentsUntil:function(e,t,n){return b.dir(e,"parentNode",n)},next:function(e){return ct(e,"nextSibling")},prev:function(e){return ct(e,"previousSibling")},nextAll:function(e){return b.dir(e,"nextSibling")},prevAll:function(e){return b.dir(e,"previousSibling")},nextUntil:function(e,t,n){return b.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return b.dir(e,"previousSibling",n)},siblings:function(e){return b.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return b.sibling(e.firstChild)},contents:function(e){return b.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:b.merge([],e.childNodes)}},function(e,t){b.fn[e]=function(n,r){var i=b.map(this,t,n);return ot.test(e)||(r=n),r&&typeof r=="string"&&(i=b.filter(r,i)),i=this.length>1&&!lt[e]?b.unique(i):i,this.length>1&&ut.test(e)&&(i=i.reverse()),this.pushStack(i)}}),b.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?b.find.matchesSelector(t[0],e)?[t[0]]:[]:b.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!b(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:null|\d+)"/g,mt=new RegExp("<(?:"+dt+")[\\s/>]","i"),gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style|link)/i,xt=/^(?:checkbox|radio)$/i,Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^$|\/(?:java|ecma)script/i,Ct=/^true\/(.*)/,kt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:b.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},At=pt(s),Ot=At.appendChild(s.createElement("div"));Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,b.fn.extend({text:function(e){return b.access(this,function(e){return e===t?b.text(this):this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(b.isFunction(e))return this.each(function(t){b(this).wrapAll(e.call(this,t))});if(this[0]){var t=b(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return b.isFunction(e)?this.each(function(t){b(this).wrapInner(e.call(this,t))}):this.each(function(){var t=b(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=b.isFunction(e);return this.each(function(n){b(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){b.nodeName(this,"body")||b(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&this.insertBefore(e,this.firstChild)})},before:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,!1,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||b.filter(e,[n]).length>0)!t&&n.nodeType===1&&b.cleanData(jt(n)),n.parentNode&&(t&&b.contains(n.ownerDocument,n)&&Pt(jt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&b.cleanData(jt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&b.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return b.clone(this,e,t)})},html:function(e){return b.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(vt,""):t;if(typeof e=="string"&&!St.test(e)&&(b.support.htmlSerialize||!mt.test(e))&&(b.support.leadingWhitespace||!gt.test(e))&&!Lt[(bt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(yt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(b.cleanData(jt(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){var t=b.isFunction(e);return!t&&typeof e!="string"&&(e=b(e).not(this).detach()),this.domManip([e],!0,function(e){var t=this.nextSibling,n=this.parentNode;n&&(b(this).remove(),n.insertBefore(e,t))})},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=h.apply([],e);var i,s,o,u,a,f,l=0,c=this.length,p=this,d=c-1,v=e[0],m=b.isFunction(v);if(m||!(c<=1||typeof v!="string"||b.support.checkClone||!Tt.test(v)))return this.each(function(i){var s=p.eq(i);m&&(e[0]=v.call(this,i,n?s.html():t)),s.domManip(e,n,r)});if(c){f=b.buildFragment(e,this[0].ownerDocument,!1,this),i=f.firstChild,f.childNodes.length===1&&(f=i);if(i){n=n&&b.nodeName(i,"tr"),u=b.map(jt(f,"script"),_t),o=u.length;for(;l<c;l++)s=f,l!==d&&(s=b.clone(s,!0,!0),o&&b.merge(u,jt(s,"script"))),r.call(n&&b.nodeName(this[l],"table")?Mt(this[l],"tbody"):this[l],s,l);if(o){a=u[u.length-1].ownerDocument,b.map(u,Dt);for(l=0;l<o;l++)s=u[l],Nt.test(s.type||"")&&!b._data(s,"globalEval")&&b.contains(a,s)&&(s.src?b.ajax({url:s.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):b.globalEval((s.text||s.textContent||s.innerHTML||"").replace(kt,"")))}f=i=null}}return this}}),b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){b.fn[e]=function(e){var n,r=0,i=[],s=b(e),o=s.length-1;for(;r<=o;r++)n=r===o?this:this.clone(!0),b(s[r])[t](n),p.apply(i,n.get());return this.pushStack(i)}}),b.extend({clone:function(e,t,n){var r,i,s,o,u,a=b.contains(e.ownerDocument,e);b.support.html5Clone||b.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Ot.innerHTML=e.outerHTML,Ot.removeChild(s=Ot.firstChild));if((!b.support.noCloneEvent||!b.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!b.isXMLDoc(e)){r=jt(s),u=jt(e);for(o=0;(i=u[o])!=null;++o)r[o]&&Bt(i,r[o])}if(t)if(n){u=u||jt(e),r=r||jt(s);for(o=0;(i=u[o])!=null;o++)Ht(i,r[o])}else Ht(e,s);return r=jt(s,"script"),r.length>0&&Pt(r,!a&&jt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=pt(t),p=[],d=0;for(;d<c;d++){s=e[d];if(s||s===0)if(b.type(s)==="object")b.merge(p,s.nodeType?[s]:s);else if(!Et.test(s))p.push(t.createTextNode(s));else{u=u||h.appendChild(t.createElement("div")),a=(bt.exec(s)||["",""])[1].toLowerCase(),l=Lt[a]||Lt._default,u.innerHTML=l[1]+s.replace(yt,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;!b.support.leadingWhitespace&&gt.test(s)&&p.push(t.createTextNode(gt.exec(s)[0]));if(!b.support.tbody){s=a==="table"&&!wt.test(s)?u.firstChild:l[1]==="<table>"&&!wt.test(s)?u:0,i=s&&s.childNodes.length;while(i--)b.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}b.merge(p,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=h.lastChild}}u&&h.removeChild(u),b.support.appendChecked||b.grep(jt(p,"input"),Ft),d=0;while(s=p[d++]){if(r&&b.inArray(s,r)!==-1)continue;o=b.contains(s.ownerDocument,s),u=jt(h.appendChild(s),"script"),o&&Pt(u);if(n){i=0;while(s=u[i++])Nt.test(s.type||"")&&n.push(s)}}return u=null,h},cleanData:function(e,t){var n,r,s,o,u=0,a=b.expando,f=b.cache,c=b.support.deleteExpando,h=b.event.special;for(;(n=e[u])!=null;u++)if(t||b.acceptData(n)){s=n[a],o=s&&f[s];if(o){if(o.events)for(r in o.events)h[r]?b.event.remove(n,r):b.removeEvent(n,r,o.handle);f[s]&&(delete f[s],c?delete n[a]:typeof n.removeAttribute!==i?n.removeAttribute(a):n[a]=null,l.push(s))}}}});var It,qt,Rt,Ut=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Vt=/^margin/,$t=new RegExp("^("+w+")(.*)$","i"),Jt=new RegExp("^("+w+")(?!px)[a-z%]+$","i"),Kt=new RegExp("^([+-])=("+w+")","i"),Qt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];b.fn.extend({css:function(e,n){return b.access(this,function(e,n,r){var i,s,o={},u=0;if(b.isArray(n)){s=qt(e),i=n.length;for(;u<i;u++)o[n[u]]=b.css(e,n[u],!1,s);return o}return r!==t?b.style(e,n,r):b.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){var t=typeof e=="boolean";return this.each(function(){(t?e:nn(this))?b(this).show():b(this).hide()})}}),b.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Rt(e,"opacity");return n===""?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":b.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=b.camelCase(n),f=e.style;n=b.cssProps[a]||(b.cssProps[a]=tn(f,a)),u=b.cssHooks[n]||b.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=Kt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(b.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!b.cssNumber[a]&&(r+="px"),!b.support.clearCloneStyle&&r===""&&n.indexOf("background")===0&&(f[n]="inherit");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=b.camelCase(n);return n=b.cssProps[a]||(b.cssProps[a]=tn(e.style,a)),u=b.cssHooks[n]||b.cssHooks[a],u&&"get"in u&&(o=u.get(e,!0,r)),o===t&&(o=Rt(e,n,i)),o==="normal"&&n in Yt&&(o=Yt[n]),r===""||r?(s=parseFloat(o),r===!0||b.isNumeric(s)?s||0:o):o},swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),e.getComputedStyle?(qt=function(t){return e.getComputedStyle(t,null)},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(a===""&&!b.contains(e.ownerDocument,e)&&(a=b.style(e,n)),Jt.test(a)&&Vt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):s.documentElement.currentStyle&&(qt=function(e){return e.currentStyle},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u[n]:t,f=e.style;return a==null&&f&&f[n]&&(a=f[n]),Jt.test(a)&&!Wt.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left=n==="fontSize"?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),a===""?"auto":a}),b.each(["height","width"],function(e,t){b.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&Xt.test(b.css(e,"display"))?b.swap(e,Gt,function(){return un(e,t,r)}):un(e,t,r)},set:function(e,n,r){var i=r&&qt(e);return sn(e,n,r?on(e,t,r,b.support.boxSizing&&b.css(e,"boxSizing",!1,i)==="border-box",i):0)}}}),b.support.opacity||(b.cssHooks.opacity={get:function(e,t){return zt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=b.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if((t>=1||t==="")&&b.trim(s.replace(Ut,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(t===""||r&&!r.filter)return}n.filter=Ut.test(s)?s.replace(Ut,i):s+" "+i}}),b(function(){b.support.reliableMarginRight||(b.cssHooks.marginRight={get:function(e,t){if(t)return b.swap(e,{display:"inline-block"},Rt,[e,"marginRight"])}}),!b.support.pixelPosition&&b.fn.position&&b.each(["top","left"],function(e,t){b.cssHooks[t]={get:function(e,n){if(n)return n=Rt(e,t),Jt.test(n)?b(e).position()[t]+"px":n}}})}),b.expr&&b.expr.filters&&(b.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!b.support.reliableHiddenOffsets&&(e.style&&e.style.display||b.css(e,"display"))==="none"},b.expr.filters.visible=function(e){return!b.expr.filters.hidden(e)}),b.each({margin:"",padding:"",border:"Width"},function(e,t){b.cssHooks[e+t]={expand:function(n){var r=0,i={},s=typeof n=="string"?n.split(" "):[n];for(;r<4;r++)i[e+Zt[r]+t]=s[r]||s[r-2]||s[0];return i}},Vt.test(e)||(b.cssHooks[e+t].set=sn)});var ln=/%20/g,cn=/\[\]$/,hn=/\r?\n/g,pn=/^(?:submit|button|image|reset|file)$/i,dn=/^(?:input|select|textarea|keygen)/i;b.fn.extend({serialize:function(){return b.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=b.prop(this,"elements");return e?b.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!b(this).is(":disabled")&&dn.test(this.nodeName)&&!pn.test(e)&&(this.checked||!xt.test(e))}).map(function(e,t){var n=b(this).val();return n==null?null:b.isArray(n)?b.map(n,function(e){return{name:t.name,value:e.replace(hn,"\r\n")}}):{name:t.name,value:n.replace(hn,"\r\n")}}).get()}}),b.param=function(e,n){var r,i=[],s=function(e,t){t=b.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=b.ajaxSettings&&b.ajaxSettings.traditional);if(b.isArray(e)||e.jquery&&!b.isPlainObject(e))b.each(e,function(){s(this.name,this.value)});else for(r in e)vn(r,e[r],n,s);return i.join("&").replace(ln,"+")},b.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){b.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),b.fn.hover=function(e,t){return this.mouseenter(e).mouseleave(t||e)};var mn,gn,yn=b.now(),bn=/\?/,wn=/#.*$/,En=/([?&])_=[^&]*/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,xn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Tn=/^(?:GET|HEAD)$/,Nn=/^\/\//,Cn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kn=b.fn.load,Ln={},An={},On="*/".concat("*");try{gn=o.href}catch(Mn){gn=s.createElement("a"),gn.href="",gn=gn.href}mn=Cn.exec(gn.toLowerCase())||[],b.fn.load=function(e,n,r){if(typeof e!="string"&&kn)return kn.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),b.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(o="POST"),u.length>0&&b.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,u.html(i?b("<div>").append(b.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,s||[e.responseText,t,e])}),this},b.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){b.fn[t]=function(e){return this.on(t,e)}}),b.each(["get","post"],function(e,n){b[n]=function(e,r,i,s){return b.isFunction(r)&&(s=s||i,i=r,r=t),b.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),b.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gn,type:"GET",isLocal:xn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":b.parseJSON,"text xml":b.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Pn(Pn(e,b.ajaxSettings),t):Pn(b.ajaxSettings,e)},ajaxPrefilter:_n(Ln),ajaxTransport:_n(An),ajax:function(e,n){function N(e,n,r,i){var l,g,y,E,S,T=n;if(w===2)return;w=2,u&&clearTimeout(u),f=t,o=i||"",x.readyState=e>0?4:0,r&&(E=Hn(c,x,r));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(b.lastModified[s]=S),S=x.getResponseHeader("etag"),S&&(b.etag[s]=S)),e===204?(l=!0,T="nocontent"):e===304?(l=!0,T="notmodified"):(l=Bn(c,E),T=l.state,g=l.data,y=l.error,l=!y);else{y=T;if(e||!T)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,y]),x.statusCode(m),m=t,a&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:y]),v.fireWith(h,[x,T]),a&&(p.trigger("ajaxComplete",[x,c]),--b.active||b.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=b.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?b(h):b.event,d=b.Deferred(),v=b.Callbacks("once memory"),m=c.statusCode||{},g={},y={},w=0,S="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(w===2){if(!l){l={};while(t=Sn.exec(o))l[t[1].toLowerCase()]=t[2]}t=l[e.toLowerCase()]}return t==null?null:t},getAllResponseHeaders:function(){return w===2?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return w||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return w||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(w<2)for(t in e)m[t]=[m[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||S;return f&&f.abort(t),N(0,t),this}};d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||gn)+"").replace(wn,"").replace(Nn,mn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=b.trim(c.dataType||"*").toLowerCase().match(E)||[""],c.crossDomain==null&&(r=Cn.exec(c.url.toLowerCase()),c.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||(r[1]==="http:"?80:443))==(mn[3]||(mn[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=b.param(c.data,c.traditional)),Dn(Ln,c,n,x);if(w===2)return x;a=c.global,a&&b.active++===0&&b.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Tn.test(c.type),s=c.url,c.hasContent||(c.data&&(s=c.url+=(bn.test(s)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=En.test(s)?s.replace(En,"$1_="+yn++):s+(bn.test(s)?"&":"?")+"_="+yn++)),c.ifModified&&(b.lastModified[s]&&x.setRequestHeader("If-Modified-Since",b.lastModified[s]),b.etag[s]&&x.setRequestHeader("If-None-Match",b.etag[s])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+On+"; q=0.01":""):c.accepts["*"]);for(i in c.headers)x.setRequestHeader(i,c.headers[i]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&w!==2){S="abort";for(i in{success:1,error:1,complete:1})x[i](c[i]);f=Dn(An,c,n,x);if(!f)N(-1,"No Transport");else{x.readyState=1,a&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{w=1,f.send(g,N)}catch(T){if(!(w<2))throw T;N(-1,T)}}return x}return x.abort()},getScript:function(e,n){return b.get(e,t,n,"script")},getJSON:function(e,t,n){return b.get(e,t,n,"json")}}),b.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return b.globalEval(e),e}}}),b.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),b.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=s.head||b("head")[0]||s.documentElement;return{send:function(t,i){n=s.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){if(t||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var jn=[],Fn=/(=)\?(?=&|$)|\?\?/;b.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jn.pop()||b.expando+"_"+yn++;return this[e]=!0,e}}),b.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Fn.test(n.url)?"url":typeof n.data=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(n.data)&&"data");if(a||n.dataTypes[0]==="jsonp")return s=n.jsonpCallback=b.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Fn,"$1"+s):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||b.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,jn.push(s)),u&&b.isFunction(o)&&o(u[0]),u=o=t}),"script"});var In,qn,Rn=0,Un=e.ActiveXObject&&function(){var e;for(e in In)In[e](t,!0)};b.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&zn()||Wn()}:zn,qn=b.ajaxSettings.xhr(),b.support.cors=!!qn&&"withCredentials"in qn,qn=b.support.ajax=!!qn,qn&&b.ajaxTransport(function(n){if(!n.crossDomain||b.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=b.noop,Un&&delete In[o]);if(i)a.readyState!==4&&a.abort();else{c={},u=a.status,f=a.getAllResponseHeaders(),typeof a.responseText=="string"&&(c.text=a.responseText);try{l=a.statusText}catch(h){l=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(p){i||s(-1,p)}c&&s(u,l,c,f)},n.async?a.readyState===4?setTimeout(r):(o=++Rn,Un&&(In||(In={},b(e).unload(Un)),In[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Vn,$n=/^(?:toggle|show|hide)$/,Jn=new RegExp("^(?:([+-])=|)("+w+")([a-z%]*)$","i"),Kn=/queueHooks$/,Qn=[nr],Gn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=Jn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(b.cssNumber[e]?"":"px");if(r!=="px"&&u){u=b.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,b.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};b.Animation=b.extend(er,{tweener:function(e,t){b.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Gn[n]=Gn[n]||[],Gn[n].unshift(t)},prefilter:function(e,t){t?Qn.unshift(e):Qn.push(e)}}),b.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(b.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.options.duration?this.pos=t=b.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=b.css(e.elem,e.prop,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){b.fx.step[e.prop]?b.fx.step[e.prop](e):e.elem.style&&(e.elem.style[b.cssProps[e.prop]]!=null||b.cssHooks[e.prop])?b.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},b.each(["toggle","show","hide"],function(e,t){var n=b.fn[t];b.fn[t]=function(e,r,i){return e==null||typeof e=="boolean"?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),b.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=b.isEmptyObject(e),s=b.speed(t,n,r),o=function(){var t=er(this,b.extend({},e),s);o.finish=function(){t.stop(!0)},(i||b._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=b.timers,o=b._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Kn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&b.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=b._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=b.timers,o=r?r.length:0;n.finish=!0,b.queue(this,e,[]),i&&i.cur&&i.cur.finish&&i.cur.finish.call(this);for(t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),b.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){b.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),b.speed=function(e,t,n){var r=e&&typeof e=="object"?b.extend({},e):{complete:n||!n&&t||b.isFunction(e)&&e,duration:e,easing:n&&t||t&&!b.isFunction(t)&&t};r.duration=b.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in b.fx.speeds?b.fx.speeds[r.duration]:b.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){b.isFunction(r.old)&&r.old.call(this),r.queue&&b.dequeue(this,r.queue)},r},b.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},b.timers=[],b.fx=rr.prototype.init,b.fx.tick=function(){var e,n=b.timers,r=0;Xn=b.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||b.fx.stop(),Xn=t},b.fx.timer=function(e){e()&&b.timers.push(e)&&b.fx.start()},b.fx.interval=13,b.fx.start=function(){Vn||(Vn=setInterval(b.fx.tick,b.fx.interval))},b.fx.stop=function(){clearInterval(Vn),Vn=null},b.fx.speeds={slow:600,fast:200,_default:400},b.fx.step={},b.expr&&b.expr.filters&&(b.expr.filters.animated=function(e){return b.grep(b.timers,function(t){return e===t.elem}).length}),b.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){b.offset.setOffset(this,e,t)});var n,r,s={top:0,left:0},o=this[0],u=o&&o.ownerDocument;if(!u)return;return n=u.documentElement,b.contains(n,o)?(typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect()),r=sr(u),{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):s},b.offset={setOffset:function(e,t,n){var r=b.css(e,"position");r==="static"&&(e.style.position="relative");var i=b(e),s=i.offset(),o=b.css(e,"top"),u=b.css(e,"left"),a=(r==="absolute"||r==="fixed")&&b.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),b.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},b.fn.extend({position:function(){if(!this[0])return;var e,t,n={top:0,left:0},r=this[0];return b.css(r,"position")==="fixed"?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),b.nodeName(e[0],"html")||(n=e.offset()),n.top+=b.css(e[0],"borderTopWidth",!0),n.left+=b.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-b.css(r,"marginTop",!0),left:t.left-n.left-b.css(r,"marginLeft",!0)}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||s.documentElement;while(e&&!b.nodeName(e,"html")&&b.css(e,"position")==="static")e=e.offsetParent;return e||s.documentElement})}}),b.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);b.fn[e]=function(i){return b.access(this,function(e,i,s){var o=sr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?b(o).scrollLeft():s,r?s:b(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),b.each({Height:"height",Width:"width"},function(e,n){b.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){b.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return b.access(this,function(n,r,i){var s;return b.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?b.css(n,r,u):b.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=b,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return b})}(window),function(e,t){typeof exports!="undefined"?t(e,exports,require("underscore")):typeof define=="function"&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,r,i){e.Backbone=t(e,i,n,r)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,r){var i=e.Backbone,s=[],o=s.push,u=s.slice,a=s.splice;t.VERSION="1.0.0",t.$=r,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var f=t.Events={on:function(e,t,n){if(!c(this,"on",e,[t,n])||!t)return this;this._events||(this._events={});var r=this._events[e]||(this._events[e]=[]);return r.push({callback:t,context:n,ctx:n||this}),this},once:function(e,t,r){if(!c(this,"once",e,[t,r])||!t)return this;var i=this,s=n.once(function(){i.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,r)},off:function(e,t,r){var i,s,o,u,a,f,l,h;if(!this._events||!c(this,"off",e,[t,r]))return this;if(!e&&!t&&!r)return this._events={},this;u=e?[e]:n.keys(this._events);for(a=0,f=u.length;a<f;a++){e=u[a];if(o=this._events[e]){this._events[e]=i=[];if(t||r)for(l=0,h=o.length;l<h;l++)s=o[l],(t&&t!==s.callback&&t!==s.callback._callback||r&&r!==s.context)&&i.push(s);i.length||delete this._events[e]}}return this},trigger:function(e){if(!this._events)return this;var t=u.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],r=this._events.all;return n&&h(n,t),r&&h(r,arguments),this},stopListening:function(e,t,n){var r=this._listeners;if(!r)return this;var i=!t&&!n;typeof t=="object"&&(n=this),e&&((r={})[e._listenerId]=e);for(var s in r)r[s].off(t,n,this),i&&delete this._listeners[s];return this}},l=/\s+/,c=function(e,t,n,r){if(!n)return!0;if(typeof n=="object"){for(var i in n)e[t].apply(e,[i,n[i]].concat(r));return!1}if(l.test(n)){var s=n.split(l);for(var o=0,u=s.length;o<u;o++)e[t].apply(e,[s[o]].concat(r));return!1}return!0},h=function(e,t){var n,r=-1,i=e.length,s=t[0],o=t[1],u=t[2];switch(t.length){case 0:while(++r<i)(n=e[r]).callback.call(n.ctx);return;case 1:while(++r<i)(n=e[r]).callback.call(n.ctx,s);return;case 2:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o);return;case 3:while(++r<i)(n=e[r]).callback.call(n.ctx,s,o,u);return;default:while(++r<i)(n=e[r]).callback.apply(n.ctx,t)}},p={listenTo:"on",listenToOnce:"once"};n.each(p,function(e,t){f[t]=function(t,r,i){var s=this._listeners||(this._listeners={}),o=t._listenerId||(t._listenerId=n.uniqueId("l"));return s[o]=t,typeof r=="object"&&(i=this),t[e](r,i,this),this}}),f.bind=f.on,f.unbind=f.off,n.extend(t,f);var d=t.Model=function(e,t){var r,i=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},n.extend(this,n.pick(t,v)),t.parse&&(i=this.parse(i,t)||{});if(r=n.result(this,"defaults"))i=n.defaults({},i,r);this.set(i,t),this.changed={},this.initialize.apply(this,arguments)},v=["url","urlRoot","collection"];n.extend(d.prototype,f,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return this.get(e)!=null},set:function(e,t,r){var i,s,o,u,a,f,l,c;if(e==null)return this;typeof e=="object"?(s=e,r=t):(s={})[e]=t,r||(r={});if(!this._validate(s,r))return!1;o=r.unset,a=r.silent,u=[],f=this._changing,this._changing=!0,f||(this._previousAttributes=n.clone(this.attributes),this.changed={}),c=this.attributes,l=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]);for(i in s)t=s[i],n.isEqual(c[i],t)||u.push(i),n.isEqual(l[i],t)?delete this.changed[i]:this.changed[i]=t,o?delete c[i]:c[i]=t;if(!a){u.length&&(this._pending=!0);for(var h=0,p=u.length;h<p;h++)this.trigger("change:"+u[h],this,c[u[h]],r)}if(f)return this;if(!a)while(this._pending)this._pending=!1,this.trigger("change",this,r);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var r in this.attributes)t[r]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return e==null?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?n.clone(this.changed):!1;var t,r=!1,i=this._changing?this._previousAttributes:this.attributes;for(var s in e){if(n.isEqual(i[s],t=e[s]))continue;(r||(r={}))[s]=t}return r},previous:function(e){return e==null||!this._previousAttributes?null:this._previousAttributes[e]},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=this,r=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;r&&r(t,n,e),t.trigger("sync",t,n,e)},F(this,e),this.sync("read",this,e)},save:function(e,t,r){var i,s,o,u=this.attributes;e==null||typeof e=="object"?(i=e,r=t):(i={})[e]=t;if(i&&(!r||!r.wait)&&!this.set(i,r))return!1;r=n.extend({validate:!0},r);if(!this._validate(i,r))return!1;i&&r.wait&&(this.attributes=n.extend({},u,i)),r.parse===void 0&&(r.parse=!0);var a=this,f=r.success;return r.success=function(e){a.attributes=u;var t=a.parse(e,r);r.wait&&(t=n.extend(i||{},t));if(n.isObject(t)&&!a.set(t,r))return!1;f&&f(a,e,r),a.trigger("sync",a,e,r)},F(this,r),s=this.isNew()?"create":r.patch?"patch":"update",s==="patch"&&(r.attrs=i),o=this.sync(s,this,r),i&&r.wait&&(this.attributes=u),o},destroy:function(e){e=e?n.clone(e):{};var t=this,r=e.success,i=function(){t.trigger("destroy",t,t.collection,e)};e.success=function(n){(e.wait||t.isNew())&&i(),r&&r(t,n,e),t.isNew()||t.trigger("sync",t,n,e)};if(this.isNew())return e.success(),!1;F(this,e);var s=this.sync("delete",this,e);return e.wait||i(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||j();return this.isNew()?e:e+(e.charAt(e.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var r=this.validationError=this.validate(e,t)||null;return r?(this.trigger("invalid",this,r,n.extend(t||{},{validationError:r})),!1):!0}});var m=["keys","values","pairs","invert","pick","omit"];n.each(m,function(e){d.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var g=t.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),t.comparator!==void 0&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},y={add:!0,remove:!0,merge:!0},b={add:!0,merge:!1,remove:!1};n.extend(g.prototype,f,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.defaults(t||{},b))},remove:function(e,t){e=n.isArray(e)?e.slice():[e],t||(t={});var r,i,s,o;for(r=0,i=e.length;r<i;r++){o=this.get(e[r]);if(!o)continue;delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o)}return this},set:function(e,t){t=n.defaults(t||{},y),t.parse&&(e=this.parse(e,t)),n.isArray(e)||(e=e?[e]:[]);var r,i,s,u,f,l,c=t.at,h=this.comparator&&c==null&&t.sort!==!1,p=n.isString(this.comparator)?this.comparator:null,d=[],v=[],m={};for(r=0,i=e.length;r<i;r++){if(!(s=this._prepareModel(e[r],t)))continue;(f=this.get(s))?(t.remove&&(m[f.cid]=!0),t.merge&&(f.set(s.attributes,t),h&&!l&&f.hasChanged(p)&&(l=!0))):t.add&&(d.push(s),s.on("all",this._onModelEvent,this),this._byId[s.cid]=s,s.id!=null&&(this._byId[s.id]=s))}if(t.remove){for(r=0,i=this.length;r<i;++r)m[(s=this.models[r]).cid]||v.push(s);v.length&&this.remove(v,t)}d.length&&(h&&(l=!0),this.length+=d.length,c!=null?a.apply(this.models,[c,0].concat(d)):o.apply(this.models,d)),l&&this.sort({silent:!0});if(t.silent)return this;for(r=0,i=d.length;r<i;r++)(s=d[r]).trigger("add",s,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var r=0,i=this.models.length;r<i;r++)this._removeReference(this.models[r]);return t.previousModels=this.models,this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){return e==null?void 0:this._byId[e.id!=null?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||this.comparator.length===1?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,r){t||(t=this.comparator);var i=n.isFunction(t)?t:function(e){return e.get(t)};return n.sortedIndex(this.models,e,i,r)},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){e=e?n.clone(e):{},e.parse===void 0&&(e.parse=!0);var t=e.success,r=this;return e.success=function(n){var i=e.reset?"reset":"set";r[i](n,e),t&&t(r,n,e),r.trigger("sync",r,n,e)},F(this,e),this.sync("read",this,e)},create:function(e,t){t=t?n.clone(t):{};if(!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var r=this,i=t.success;return t.success=function(n){t.wait&&r.add(e,t),i&&i(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,r){if((e==="add"||e==="remove")&&n!==this)return;e==="destroy"&&this.remove(t,r),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],t.id!=null&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments)}});var w=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];n.each(w,function(e){g.prototype[e]=function(){var t=u.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var E=["groupBy","countBy","sortBy"];n.each(E,function(e){g.prototype[e]=function(t,r){var i=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,i,r)}});var S=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},x=/^(\S+)\s*(.*)$/,T=["model","collection","el","id","attributes","className","tagName","events"];n.extend(S.prototype,f,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],n!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var r=e[t];n.isFunction(r)||(r=this[e[t]]);if(!r)continue;var i=t.match(x),s=i[1],o=i[2];r=n.bind(r,this),s+=".delegateEvents"+this.cid,o===""?this.$el.on(s,r):this.$el.on(s,o,r)}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),n.extend(this,n.pick(e,T)),this.options=e},_ensureElement:function(){if(!this.el){var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e["class"]=n.result(this,"className"));var r=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(r,!1)}else this.setElement(n.result(this,"el"),!1)}}),t.sync=function(e,r,i){var s=N[e];n.defaults(i||(i={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};i.url||(o.url=n.result(r,"url")||j()),i.data==null&&r&&(e==="create"||e==="update"||e==="patch")&&(o.contentType="application/json",o.data=JSON.stringify(i.attrs||r.toJSON(i))),i.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{});if(i.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){o.type="POST",i.emulateJSON&&(o.data._method=s);var u=i.beforeSend;i.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",s);if(u)return u.apply(this,arguments)}}o.type!=="GET"&&!i.emulateJSON&&(o.processData=!1),o.type==="PATCH"&&window.ActiveXObject&&(!window.external||!window.external.msActiveXFilteringEnabled)&&(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var a=i.xhr=t.ajax(n.extend(o,i));return r.trigger("request",r,a,i),a};var N={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var C=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},k=/\((.*?)\)/g,L=/(\(\?)?:\w+/g,A=/\*\w+/g,O=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(C.prototype,f,{initialize:function(){},route:function(e,r,i){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(r)&&(i=r,r=""),i||(i=this[r]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);i&&i.apply(s,o),s.trigger.apply(s,["route:"+r].concat(o)),s.trigger("route",r,o),t.history.trigger("route",s,r,o)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(!this.routes)return;this.routes=n.result(this,"routes");var e,t=n.keys(this.routes);while((e=t.pop())!=null)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(O,"\\$&").replace(k,"(?:$1)?").replace(L,function(e,t){return t?e:"([^/]+)"}).replace(A,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var r=e.exec(t).slice(1);return n.map(r,function(e){return e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),typeof window!="undefined"&&(this.location=window.location,this.history=window.history)},_=/^[#\/]|\s+$/g,D=/^\/+|\/+$/g,P=/msie [\w.]+/,H=/\/$/;M.started=!1,n.extend(M.prototype,f,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(e==null)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(H,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(_,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var r=this.getFragment(),i=document.documentMode,s=P.exec(navigator.userAgent.toLowerCase())&&(!i||i<=7);this.root=("/"+this.root+"/").replace(D,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(r)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=r;var o=this.location,u=o.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!u)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&u&&o.hash&&(this.fragment=this.getHash().replace(_,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search));if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe)));if(t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e),r=n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0});return r},navigate:function(e,t){if(!M.started)return!1;if(!t||t===!0)t={trigger:t};e=this.getFragment(e||"");if(this.fragment===e)return;this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)},_updateHash:function(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");e.replace(r+"#"+t)}else e.hash="#"+t}}),t.history=new M;var B=function(e,t){var r=this,i;e&&n.has(e,"constructor")?i=e.constructor:i=function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};d.extend=g.extend=C.extend=S.extend=M.extend=B;var j=function(){throw new Error('A "url" property or function must be specified')},F=function(e,t){var n=t.error;t.error=function(r){n&&n(e,r,t),e.trigger("error",e,r,t)}};return t});if(typeof require!="function"&&typeof window!="object")var FLOOD={},define=function(e,t){typeof e=="function"&&(FLOOD=e()),typeof t=="function"&&(FLOOD=t())};define("FLOOD",[],function(){function MultiOutResult(e){for(var t in e)this[t]=e[t]}function QuotedArray(){Array.apply(this,arguments)}function AnyType(){}function AnyTypeButQuotedArray(){}function isObjectTypeMatch(e,t){return t===undefined||t===null?!0:t===AnyType?!0:e===undefined||e===null?!1:t===AnyTypeButQuotedArray&&e.constructor!=QuotedArray?!0:t===AnyType&&e.constructor===QuotedArray?!1:e.constructor===t||e instanceof t}function isFastTypeMatch(e,t){var n=[e];for(var r=0;r<t.length;r++){n=n[0];if(!isObjectTypeMatch(n,t[r]))return!1}return!0}function doAllTypesMatch(e,t){if(!t)return!0;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!isFastTypeMatch(e[n],t[n]))return!1;return!0}function allQuotedArrays(e){for(var t=0;t<e.length;t++)if(!(e[t]instanceof QuotedArray))return!1;return!0}function newNestedQuotedArrayByElements(e){var t=new QuotedArray;for(var n=0;n<e.length;n++){var r=new QuotedArray;r.push(e[n]),t.push(r)}return t}if(!FLOOD)var FLOOD={};FLOOD.baseTypes={},FLOOD.nodeTypes={},FLOOD.internalNodeTypes={},typeof Object.create!="function"&&(Object.create=function(e){function t(){}return t.prototype=e,new t}),Function.prototype.curry=function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){return e.apply(this,t.concat(Array.prototype.slice.call(arguments)))}},Function.prototype.partial=function(){var e=this,t=Array.prototype.slice.call(arguments);return function(){var n=0;for(var r=0;r<t.length&&n<arguments.length;r++)t[r]===undefined&&(t[r]=arguments[n++]);return e.apply(this,t)}},Array.prototype.remove=function(e,t){var n=this.slice((t||e)+1||this.length);return this.length=e<0?this.length+e:e,this.push.apply(this,n)},Array.prototype.last=function(){return this[this.length-1]},Function.prototype.method=function(e,t){return this.prototype[e]=t,this},Function.method("inherits",function(e){this.prototype=new e;var t={},n=this.prototype;return this.prototype.constructor=e,this}),MultiOutResult.prototype=new Object,MultiOutResult.wrap=function(){return arguments.length===0?undefined:arguments.length===1?arguments[0]:new FLOOD.MultiOutResult(arguments)},MultiOutResult.prototype.constructor=MultiOutResult,FLOOD.MultiOutResult=MultiOutResult,QuotedArray.prototype=new Array,QuotedArray.prototype.toString=function(){if(this.length===0)return"[]";var e=[];for(var t=0;t<this.length;t++)e.push(this[t]);return"[ "+e.join(", ")+" ]"},Array.prototype.flatten=function(){return this.length===0?[]:isObjectTypeMatch(this[0],Array)?this[0].flatten().concat(this.slice(1).flatten()):[this[0]].concat(this.slice(1).flatten())},Array.prototype.toQuotedArray=function(){var e=new QuotedArray;for(var t=0;t<this.length;t++)e.push(this[t].toQuotedArray?this[t].toQuotedArray():this[t]);return e},QuotedArray.prototype.constructor=QuotedArray,FLOOD.QuotedArray=QuotedArray,FLOOD.baseTypes.NodeType=function(e){var t=this,e=e||{};this.replication=e.replication||"applyLongest",e.inputs?(e.inputs.forEach(function(e,n){e.parentNode=t,e.parentIndex=n}),this.inputs=e.inputs):this.inputs=[],e.outputs?(e.outputs.forEach(function(e,n){e.parentNode=t,e.parentIndex=n}),this.outputs=e.outputs):this.outputs=[],this.typeName=e.typeName||"noTypeName";var n=!0;this.extend=function(e){},this.alwaysDirty=!1,this.doPostProcess=!0,this.isDirty=function(){return this.alwaysDirty?!0:n},this.markClean=function(){n=!1},this.setDirty=function(){n=!0},this.inputTypes=function(){return this.inputs.map(function(e){return e.type})},this.getIndexOfInputNode=function(e){for(var t=0;t<this.inputs.length;t++)if(this.inputs[t].isConnectedTo(e))return t;return-1},this.markDirty=function(){return n=this.inputs.reduce(function(e,t){return t.oppNode?t.oppNode.markDirty()||e:e},!1)||n,n},this.printExpression=function(){return"("+this.typeName+" "+this.inputs.map(function(e){return e.printExpression()}).join(" ")+")"},this.addInputPort=function(e,t,n){this.inputs.push(new FLOOD.baseTypes.InputPort(e,t,n,this,this.inputs.length))},this.addOutputPort=function(e,t){this.outputs.push(new FLOOD.baseTypes.OutputPort(e,t,this,this.outputs.length))},this.evalComplete=function(){},this.evalFailed=function(){},this.evalBegin=function(){},this.compile=function(){var e=this,t=function(){return function(){var t=e.isDirty();try{e.evalBegin(e,t);if(t){var n=!0;for(var r=0;r<arguments.length;r++)if(arguments[r]===undefined){n=!1;break}if(n){var i={replication:e.replication,expected_arg_types:e.inputTypes()};try{e.value=e.eval.mapApply(e,Array.prototype.slice.call(arguments,0),i)}catch(s){e.value=null,e.evalFailed(e,s)}}else{var o=arguments;e.value=function(){return function(){return e.eval.partial.apply(e.eval,o).apply(e,arguments)}}()}e.markClean(),e.doPostProcess&&e.postProcess&&(e.prettyValue=e.postProcess(e.value))}e.evalComplete(e,arguments,t,e.value,e.prettyValue)}catch(s){return e.evalFailed(e,s),null}return e.value}}();return[t].concat(this.inputs.map(function(e){return e.compile()}))}},FLOOD.baseTypes.NodePort=function(e,t,n,r,i,s){this.name=e,this.type=t,this.parentNode=n,this.parentIndex=r!=undefined?r:0,this.oppNode=i,this.oppIndex=s!=undefined?s:0},FLOOD.baseTypes.OutputPort=function(e,t,n,r,i,s){FLOOD.baseTypes.NodePort.call(this,e,t,n,r,i,s),this.value=function(){return this.parentNode.value instanceof Array?this.parentNode.value[this.parentIndex]:this.parentNode.value},this.asInputPort=function(e,t,n){return new FLOOD.baseTypes.InputPort(this.name,this.type,n,e,t)}}.inherits(FLOOD.baseTypes.NodePort),FLOOD.baseTypes.InputPort=function(e,t,n,r,i,s,o){FLOOD.baseTypes.NodePort.call(this,e,t,r,i,s,o),this.defaultVal=n,this.useDefault=n===undefined?!1:!0,this.printExpression=function(){return this.oppNode&&this.oppIndex===0&&this.oppNode.outputs.length===1?this.oppNode.printExpression():this.oppNode?"(pick "+this.oppIndex+" "+this.oppNode.printExpression()+")":this.useDefault===!0?this.defaultVal:"_"};var u=function(e,t){return isObjectTypeMatch(t,QuotedArray)?t.map(u.curry(e)):isObjectTypeMatch(t,MultiOutResult)?t[e]!=undefined?t[e]:null:null};this.compile=function(){var e=null;return this.oppNode&&this.oppIndex===0&&this.oppNode.outputs.length===1?(e=this.oppNode.compile(),e):this.oppNode?(e=[u,this.oppIndex,this.oppNode.compile()],e):this.useDefault===!0?(e=this.defaultVal,e):undefined},this.isConnectedTo=function(e){return this.oppNode===e},this.connect=function(e,t){this.oppNode=e,this.oppIndex=t!=undefined?t:0,this.parentNode.setDirty()},this.disconnect=function(){this.oppNode=null,this.oppIndex=0,this.parentNode.setDirty()}}.inherits(FLOOD.baseTypes.NodePort),FLOOD.internalNodeTypes.CustomNode=function(e,t,n){var r={typeName:"CustomNode"};this.functionName=e,this.functionId=t,this.lambda=n;if(scheme)var i=new scheme.Interpreter;FLOOD.baseTypes.NodeType.call(this,r),this.eval=function(){this.lambda=FLOOD.environment[this.functionId];if(!this.lambda)throw new Error("The custom node is not yet compiled.");var e=Array.prototype.slice.call(arguments,0),t=[this.lambda].concat(e);return i.eval(t)},this.printExpression=function(){return"("+this.functionName+" "+this.inputs.map(function(e){return e.printExpression()}).join(" ")+")"},this.extend=function(e){e.functionName&&typeof e.functionName=="string"&&(this.functionName=e.functionName),e.functionId&&typeof e.functionId=="string"&&(this.functionId=e.functionId),e.numInputs&&typeof e.numInputs=="number"&&this.setNumInputs(e.numInputs),e.numOutputs&&typeof e.numOutputs=="number"&&this.setNumOutputs(e.numOutputs)};var s=this;this.setInputTypes=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].type=e[t]},this.setNumInputs=function(e){if(typeof e!="number"||e<0||this.inputs.length===e)return;this.inputs.length<e&&o(),this.inputs.length>e&&u(),this.setNumInputs(e)},this.setNumOutputs=function(e){if(typeof e!="number"||e<0||this.outputs.length===e)return;this.outputs.length<e&&a(),this.outputs.length>e&&f(),this.setNumOutputs(e)};var o=function(){var e=new FLOOD.baseTypes.InputPort(characters[s.inputs.length],[AnyTypeButQuotedArray],0);e.parentNode=s,e.parentIndex=s.inputs.length,s.inputs.push(e)},u=function(){if(s.inputs.length===0)return;s.inputs.pop()},a=function(){var e=new FLOOD.baseTypes.OutputPort(characters[s.outputs.length],[AnyType]);e.parentNode=s,e.parentIndex=s.outputs.length,s.outputs.push(e)},f=function(){if(s.outputs.length===0)return;s.outputs.pop()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.internalNodeTypes.CustomNode.nodesOfType=function(e,t){return t.filter(function(t){return t instanceof e})},FLOOD.internalNodeTypes.CustomNode.findInputTypes=function(e){var t=FLOOD.internalNodeTypes.CustomNode.nodesOfType(FLOOD.nodeTypes.Input,e);return t.map(function(t,n){var r=e.reduce(function(e,n){var r=n.getIndexOfInputNode(t);return r<0?e:(e.push(n.inputs[r].type),e)},[]);if(r.length===0)return AnyTypeButQuotedArray;var i=r[0],s=i.last();r.map(function(e){return e.last()}).forEach(function(e){if(e===s||e===AnyType||e===AnyTypeButQuotedArray)return;throw new TypeError("One of the inputs is connected to multiple nodes with incompatible types!")});var o=0,u=-1;for(var a=r.length-1;a>=0;a--)r[a].length>o&&(u=a,o=r[a].length);return r[o]})},FLOOD.internalNodeTypes.CustomNode.compileNodesToLambda=function(e){var t=e.filter(function(e){return e instanceof FLOOD.nodeTypes.Input}),n=e.filter(function(e){return e instanceof FLOOD.nodeTypes.Output}),r=t.map(function(e){return e.compile()}),i=n.map(function(e){return e.compile()}),s=i.length>1?[FLOOD.MultiOutResult.wrap].concat(i):i[0];return e.forEach(function(e){e.alwaysDirty=!0}),["lambda",r,s]},FLOOD.nodeTypes.Number=function(){var e={outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"Number"};this.lastValue=0,FLOOD.baseTypes.NodeType.call(this,e),this.printExpression=function(){return this.lastValue},this.compile=function(){return this.markClean(),this.lastValue},this.extend=function(e){e.value!=undefined&&typeof e.value=="number"?this.lastValue=e.value:this.lastValue=0}}.inherits(FLOOD.baseTypes.NodeType);var characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",currentInputChar=0;FLOOD.nodeTypes.Formula=function(){var typeData={inputs:[new FLOOD.baseTypes.InputPort("A",[AnyTypeButQuotedArray],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"Formula"};FLOOD.baseTypes.NodeType.call(this,typeData);var Sin=Math.sin,Cos=Math.cos,Abs=Math.abs,Tan=Math.tan,Random=Math.random,Asin=Math.asin,Atan=Math.atan,Acos=Math.acos,Exp=Math.exp,Sqrt=Math.sqrt,Pow=Math.pow,Pi=Math.PI,Eval=eval,Get=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText};this.eval=function(){var _fa=Array.prototype.slice.call(arguments,0),val=eval(this.expression);return val instanceof Array?val.toQuotedArray():val},this.script="A;",this.portNames="ABCDEFGHIJKLMNOPQRSTUVWXYZ",this.extend=function(e){e.script&&typeof e.script=="string"&&(this.script=e.script,compileExpression()),e.numInputs&&typeof e.numInputs=="number"&&this.setNumInputs(e.numInputs)},this.setNumInputs=function(e){if(typeof e!="number"||e<0||this.inputs.length===e)return compileExpression();this.inputs.length<e&&addFormulaInput(),this.inputs.length>e&&removeFormulaInput(),this.setNumInputs(e)};var that=this,prefix=function(){var e=that.inputs.map(function(e){return e.name}).join(",");return"(function("+e+") { return "},suffix=function(){var e=that.inputs.map(function(e,t){return"_fa["+t+"]"}).join(",");return"}("+e+"))"},compileExpression=function(){return that.expression=prefix()+that.script+suffix(),that.expression},addFormulaInput=function(){var e=new FLOOD.baseTypes.InputPort(that.portNames[that.inputs.length],[AnyTypeButQuotedArray],0);e.parentNode=that,e.parentIndex=that.inputs.length,that.inputs.push(e)},removeFormulaInput=function(){if(that.inputs.length===0)return;that.inputs.pop()};compileExpression()}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Pi=function(){var e={outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"Pi"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(){return Math.PI}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.TwoPi=function(){var e={outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"TwoPi"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(){return 2*Math.PI}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.E=function(){var e={outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"E"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(){return Math.E}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Add=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"Add"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e+t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Subtract=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"Subtract"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e-t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Negate=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],1)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"Negate"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e){return-1*e}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Multiply=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"Multiply"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e*t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Divide=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"Divide"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e/t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.GreaterThan=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Boolean])],typeName:"GreaterThan"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e>t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Input=function(e){var t={typeName:"Input",outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyTypeButQuotedArray])]};e===undefined&&(e=characters[currentInputChar++]),this.name=e,FLOOD.baseTypes.NodeType.call(this,t),this.compile=function(){return this.name},this.printExpression=function(){return this.name}}.inherits(FLOOD.baseTypes.NodeType);var currentOutputChar=0;FLOOD.nodeTypes.Output=function(e){var t={inputs:[new FLOOD.baseTypes.InputPort("⇒",[AnyType])],typeName:"Output"};e===undefined&&(e=characters[currentOutputChar++]),this.name=e,FLOOD.baseTypes.NodeType.call(this,t),this.compile=function(){return this.inputs[0].compile()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Eval=function(){var typeData={inputs:[new FLOOD.baseTypes.InputPort("Code",[String])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"Eval"};FLOOD.baseTypes.NodeType.call(this,typeData),this.eval=function(a){return eval(a)}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Apply=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Function",[Function]),new FLOOD.baseTypes.InputPort("Arguments",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"Apply"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e.apply(this,t)}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ApplyToLeaves=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Function",[Function]),new FLOOD.baseTypes.InputPort("Arguments",[QuotedArray,AnyTypeButQuotedArray])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"ApplyToLeaves"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e.apply(this,t)}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.LessThan=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Boolean])],typeName:"LessThan"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e<t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.LessThanOrEqual=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Boolean])],typeName:"LessThanOrEqual"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e<=t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.GreaterThanOrEqual=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[Number],0),new FLOOD.baseTypes.InputPort("B",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Boolean])],typeName:"GreaterThanOrEqual"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e>=t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Equal=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("A",[AnyType],0),new FLOOD.baseTypes.InputPort("B",[AnyType],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Boolean])],typeName:"Equal"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e===t}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.internalNodeTypes.Begin=function(){var e={typeName:"begin",isVisibleInLibrary:!1};FLOOD.baseTypes.NodeType.call(this,e),this.compile=function(){return[this.typeName].concat(this.inputs.map(function(e){return e.compile()}))}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Watch=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Anything",[AnyType],null)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"Watch"};FLOOD.baseTypes.NodeType.call(this,e),this.value=0,this.eval=function(e){return e}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.If=function(){var e={typeName:"if",inputs:[new FLOOD.baseTypes.InputPort("Test",[AnyType],!0),new FLOOD.baseTypes.InputPort("Then",[AnyType]),new FLOOD.baseTypes.InputPort("Else",[AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])]};FLOOD.baseTypes.NodeType.call(this,e),this.compile=function(){return[this.typeName,this.inputs[0].compile(),this.inputs[1].compile(),this.inputs[2].compile()]}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.Range=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Min",[Number],0),new FLOOD.baseTypes.InputPort("Max",[Number],1),new FLOOD.baseTypes.InputPort("Steps",[Number],10)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[QuotedArray,Number])],typeName:"Range"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t,n){var r=new QuotedArray;if(e>t||n<=0)return r;var i=(t-e)/n;for(var s=0;s<n;s++)r.push(e+s*i);return r}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListByRepeat=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Value",[AnyType],0),new FLOOD.baseTypes.InputPort("Count",[Number],0)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[QuotedArray,AnyType])],typeName:"ListRepeat"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){var n=new QuotedArray;if(t>0)for(var r=0;r<t;r++)n.push(e);return n}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListLength=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"ListLength"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e){return e.length}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListFirst=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"ListFirst"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e){return e[0]}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListLast=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"ListLast"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e){return e.length===0?null:e[e.length-1]}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListRest=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"ListRest"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e){return e.length<=1?[].toQuotedArray():e.slice(1).toQuotedArray()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListAddToFront=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Item",[AnyTypeButQuotedArray]),new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"ListAddToFront"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return[e].concat(t).toQuotedArray()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListItemAtIndex=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType]),new FLOOD.baseTypes.InputPort("Index",[Number])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"ListItemAtIndex"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e[t]}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListSort=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Function",[Function],function(e){return e}),new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType],new QuotedArray)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[QuotedArray,AnyType])],typeName:"ListSort"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return t.sort(e).toQuotedArray()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListMap=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Function",[Function],function(e){return e}),new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[QuotedArray,AnyType])],typeName:"ListMap"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return t.map(e).toQuotedArray()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListDivide=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType]),new FLOOD.baseTypes.InputPort("Length",[Number],1)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[QuotedArray,AnyType])],typeName:"ListDivide"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){if(e.length===0)return e;if(e.length<=t)return e;if(t<1)return e;var n=new QuotedArray;for(var r=0;r<e.length;r+=t){if(r+t>e.length)break;n.push(e.slice(r,r+t).toQuotedArray())}return n}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListReduce=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Function",[Function]),new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType]),new FLOOD.baseTypes.InputPort("Base",[AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"ListReduce"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t,n){return t.reduce(e,n)}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListFilter=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Function",[Function]),new FLOOD.baseTypes.InputPort("List",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[AnyType])],typeName:"Filter"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return t.filter(e).toQuotedArray()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.ListFlatten=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("Function",[QuotedArray,AnyType])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[QuotedArray,AnyType])],typeName:"ListFlatten"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e){return e.flatten().toQuotedArray()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.StringToNumber=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("String",[String])],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[Number])],typeName:"StringToNumber"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e){return parseFloat(e)}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.StringSplit=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("String",[String]," "),new FLOOD.baseTypes.InputPort("Delimiter",[String],",")],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[QuotedArray,String])],typeName:"StringSplit"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t){return e.split(t).toQuotedArray()}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.nodeTypes.StringSubString=function(){var e={inputs:[new FLOOD.baseTypes.InputPort("String",[String],""),new FLOOD.baseTypes.InputPort("Start",[Number],0),new FLOOD.baseTypes.InputPort("Length",[Number],-1)],outputs:[new FLOOD.baseTypes.OutputPort("⇒",[String])],typeName:"StringSubString"};FLOOD.baseTypes.NodeType.call(this,e),this.eval=function(e,t,n){return n<0&&(n=undefined),e.substring(t,n)}}.inherits(FLOOD.baseTypes.NodeType),FLOOD.AnyType=AnyType,FLOOD.AnyTypeButQuotedArray=AnyTypeButQuotedArray,FLOOD.isObjectTypeMatch=isObjectTypeMatch,FLOOD.isFastTypeMatch=isFastTypeMatch,FLOOD.doAllTypesMatch=doAllTypesMatch,Function.prototype.applyCartesian=function(e,t,n){var r=[];t[0]instanceof Array?t[0].map(function(e){r.push([e])}):r.push([t[0]]);for(var i=1;i<t.length;i++){var s=new QuotedArray;for(var o=0;o<r.length;o++){if(!(t[i]instanceof Array)){s.push(r[o].concat([t[i]]));continue}for(var u=0;u<t[i].length;u++)s.push(r[o].concat([t[i][u]]))}r=s}var a=new QuotedArray;for(var i=0;i<r.length;i++)a.push(this.mapApply(e,r[i],n));return a},Function.prototype.applyLongest=function(e,t,n){var r=t.map(function(e){return e instanceof Array?e.length:-1}),i=Math.max.apply(Math,r),s=new QuotedArray;for(var o=0;o<i;o++){var u=[];for(var a=0;a<t.length;a++){var f=t[a];if(f instanceof QuotedArray){var l=Math.min(i,f.length)-1;u.push(t[a][Math.min(o,l)])}else u.push(f)}s.push(this.mapApply(e,u,n))}return s};var prettyPrint=function(e,t){if(t instanceof Array)return t;if(typeof t=="function")return};return Function.prototype.mapApply=function(e,t,n){n=n||{};if(doAllTypesMatch(t,n.expected_arg_types))return this.apply(e,t);var r=n.replication||"applyLongest",i=this[r](e,t,n);if(i.length===0)throw new Error("You supplied the wrong input types. ");return i},FLOOD});var app=app||{};define("Node",["backbone","FLOOD"],function(e,t){return e.Model.extend({idAttribute:"_id",defaults:{name:"DefaultNodeName",position:[10,10],typeName:"Add",type:null,inputConnections:[],outputConnections:[],selected:!0,lastValue:null,failureMessage:null,visible:!0,replication:"applyLongest",extra:{},ignoreDefaults:[],isEvaluating:!1},initialize:function(e,n){e.typeName!=null&&t.nodeTypes[e.typeName]!=undefined?this.set("type",new t.nodeTypes[e.typeName]):e.typeName!=null&&t.internalNodeTypes[e.typeName]!=undefined?this.set("type",new t.internalNodeTypes[e.typeName]):this.set("type",new t.nodeTypes.Add),e.extra&&this.get("type").extend(e.extra),e.lastValue&&(this.get("type").value=e.lastValue);if(e.ignoreDefaults&&e.ignoreDefaults.length>0)for(var r=0;r<this.get("type").inputs.length;r++)this.get("type").inputs[r].useDefault=!e.ignoreDefaults[r];else e.ignoreDefaults=this.get("type").inputs.map(function(e){return!e.useDefault});this.set("ignoreDefaults",e.ignoreDefaults);var i=this;this.on("connection",this.onConnectPort),this.on("disconnection",this.onDisconnectPort),this.workspace=n.workspace,this.on("remove",this.onRemove),this.initializePorts()},serialize:function(){var e={name:this.get("name"),position:this.get("position"),typeName:this.get("typeName"),selected:this.get("selected"),visible:this.get("visible"),ignoreDefaults:this.get("ignoreDefaults"),_id:this.get("_id"),replication:this.get("replication"),extra:this.get("extra")};return e},initializePorts:function(){var e=this.get("type");this.set("inputConnections",new Array(e.inputs.length)),this.set("outputConnections",new Array(e.outputs.length))},onRemove:function(){this.trigger("removed")},onEvalFailed:function(e){this.trigger("evalFailed",e)},onEvalBegin:function(e){if(!e)return;this.trigger("evalBegin"),this.set("isEvaluating",!0)},onEvalComplete:function(e,t,n){if(!e)return;this.set("lastValue",t),this.set("prettyLastValue",n),this.set("isEvaluating",!1),this.trigger("evalComplete")},select:function(){this.set("selected",!1)},deselect:function(){this.set("selected",!0)},getPorts:function(e){return e?this.get("outputConnections"):this.get("inputConnections")},isPortConnected:function(e,t){if(!this.isValidPort(e,t))return!0;var n=this.getPorts(t);return n[e]!=null&&n[e].length>0},isPartialFunctionApplication:function(){var e=this.get("inputConnections").length;for(var t=0;t<e;t++)if(!this.isPortConnected(t,!1)&&!this.isInputPortUsingDefault(t))return!0;return!1},isInputPortUsingDefault:function(e){return this.isValidPort(e,!1)?!this.get("ignoreDefaults")[e]:!1},getPortType:function(e,t){if(e<0)return null;var n=this.get("type"),r=t?n.outputs:n.inputs;return r.length>e?r[e].type:null},isValidPort:function(e,t){return this.getPortType(e,t)!=null},getOppositeNodeAndPort:function(e,t){return this.isValidPort(e,t)?this.getPorts(t)[e]:null},isOutputNode:function(){return this.get("outputConnections").reduce(function(e,t){return e&&t.length===0},!0)},connectPort:function(e,t,n){if(!this.isValidPort(e,t))return null;this.getPorts(t)[e]===undefined&&(this.getPorts(t)[e]=[]),this.getPorts(t)[e].push(n);var r=this;return this.listenTo(n,"remove",function(){return function(){r.disconnectPort(e,n,t)}}()),this.trigger("connection",e,t,n),this.trigger("change"),this},getConnectionAtIndex:function(e,t,n){var r=this.getAllConnectionsAtPort(e,t);return r==null?null:(n===undefined&&(n=0),n>=r.length||n<0?null:r[n])},getAllConnectionsAtPort:function(e,t){if(!this.isValidPort(e,t))return null;t===undefined&&(t=!1);var n=this.getPorts(t)[e];return n},disconnectPort:function(e,t,n){if(!this.isValidPort(e,n))return;var r=this.getPorts(n)[e];if(r==null)return;var i=-1;if(t)var i=r.indexOf(t);else!n&&r.length>0&&(i=0,t=r[0],n=!1,this.workspace.get("connections").remove(t));if(i===-1)return;r.remove(i),this.trigger("disconnection",e,n,t),this.trigger("change")},onConnectPort:function(e,t,n){if(t)return;var r=this.get("type"),i=n.getOpposite(this),s=i.node.get("type"),o=i.portIndex;r.inputs[e].connect(s,o)},onDisconnectPort:function(e,t,n){if(t)return;t||this.get("type").inputs[e].disconnect(),this.workspace&&this.workspace.run()}})}),define("Nodes",["backbone","Node"],function(e,t){return e.Collection.extend({model:t,initialDragPositions:[],toJSON:function(){return this.models.map(function(e){return e.serialize()})},selectAll:function(){this.where({selected:!1}).forEach(function(e){e.set({selected:!0})})},deselectAll:function(){this.where({selected:!0}).forEach(function(e){e.set("selected",!1)})},moveSelected:function(e,t){var n=this,r=0;this.where({selected:!0}).forEach(function(i,s){if(i===t)return;var o=n.initialDragPositions[r++];i.set("position",[o[0]+e[0],o[1]+e[1]])})},startDragging:function(e){this.initialDragPositions=[];var t=this;this.where({selected:!0}).forEach(function(n){if(n===e)return;t.initialDragPositions.push(n.get("position"))})}})}),define("Connection",["backbone"],function(e){return e.Model.extend({idAttribute:"_id",defaults:{startNodeId:0,endNodeId:0,startPortIndex:0,endPortIndex:0,startProxy:!1,endProxy:!1,startProxyPosition:[0,0],endProxyPosition:[0,0],hidden:!1},workspace:null,startNode:null,endNode:null,initialize:function(e,t){this.workspace=t.workspace,e.startProxy||e.endProxy?this.workspace.bind("proxyMove",this.proxyMove,this):(this.startNode=this.workspace.get("nodes").get(e.startNodeId),this.endNode=this.workspace.get("nodes").get(e.endNodeId))},getOpposite:function(e){return e===this.startNode?{node:this.endNode,portIndex:this.get("endPortIndex")}:e===this.endNode?{node:this.startNode,portIndex:this.get("startPortIndex")}:{}}})}),define("Connections",["backbone","Connection"],function(e,t){return e.Collection.extend({model:t})});if(typeof define!="function"&&typeof require=="function")var define=require("amdefine")(module),async=require("./async.js");if(typeof require!="function"&&typeof window!="object")var scheme={},define=function(e,t){typeof e=="function"&&(scheme=e()),typeof t=="function"&&(scheme=t())};define("scheme",[],function(){function n(e){return e.add_methods(Math),e.add_methods(t),e}var e=function(e,t,n){e=typeof e!="undefined"?e:[],this.scope={};var r=this;e.forEach(function(e,n){r.scope[e]=t[n]}),n=typeof n!="undefined"?n:null,this.outer=n,this.find=function(e){if(this.scope[e]!=null)return this.scope;if(this.outer!=null)return this.outer.find(e);throw new Error("Could not find identifier: "+e)},this.add_methods=function(e){var t=this;Object.getOwnPropertyNames(e).forEach(function(n){typeof e[n]=="function"&&(t.scope[n]=e[n])})}},t={"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"<":function(e,t){return e<t},"<=":function(e,t){return e<=t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"%":function(e,t){return e%t},length:function(e){return e.length},cons:function(e,t){return e.push(t),e},car:function(e){return e[0]},cdr:function(e){return e.slice(1)},list:function(){return Array.prototype.slice.call(arguments,0)},"list?":function(e){return e instanceof Array},"null?":function(e){return e===[]},"symbol?":function(e){return typeof e=="string"},pick:function(e,t){return t[e]},map:function(e,t){return t.map(e)},reduce:function(e,t,n){return n.reduce(e,t)},filter:function(e,t){return t.filter(e)},reverse:function(e){return e.reverse()},sort:function(e,t){return e.sort(t)}},r=function(){function t(e){setTimeout(e,0)}this.global_env=n(new e),this.parse_eval=function(e){return this.eval(this.parse(e))},this.eval_async=function(n,r,i){r=typeof r!="undefined"?r:this.global_env;var s=this;if(typeof n=="string")t(function(){i(r.find(n)[n])});else if(n instanceof Array)if(n[0]==="quote")t(function(){i(n[1])});else if(n[0]==="if"){var o=n[1],u=n[2],a=n[3];this.eval_async(o,r,function(e){this.eval_async(e?u:a,r,i)})}else if(n[0]==="lambda"){var f=n[1],l=n[2];t(function(){i(function(t){return s.eval(l,new e(f,arguments,r))})})}else{if(n[0]==="begin"){n.shift();var c=n.map(function(e){return function(t){s.eval_async(e,r,function(e){t(null,e)})}});return async.parallel(c,function(e,n){t(function(){i(n[n.length-1])})})}var c=n.map(function(e){return function(t){s.eval_async(e,r,function(e){t(null,e)})}});async.parallel(c,function(e,n){t(function(){var e=n.shift();i(e.apply(s,n))})})}else t(function(){i(n)})},this.eval=function(t,n){n=typeof n!="undefined"?n:this.global_env;var r=this;if(typeof t=="string")return n.find(t)[t];if(!(t instanceof Array))return t;if(t[0]==="quote")return t[1];if(t[0]==="if"){var i=t[1],s=t[2],o=t[3];return this.eval(this.eval(i,n)?s:o,n)}if(t[0]==="set!"){var u=t[1],a=t[2];n.find(u)[u]=this.eval(a)}else{if(t[0]!=="define"){if(t[0]==="lambda"){var f=t[1],a=t[2];return function(t){return r.eval(a,new e(f,arguments,n))}}if(t[0]==="begin"){var l;for(var c=1,h=t.length;c<h;c++)l=this.eval(t[c]);return l}var r=this,p=t.map(function(e){return r.eval(e,n)}),d=p.shift();return d.apply(this,p)}var u=t[1],a=t[2];n.scope[u]=this.eval(a,n)}},this.parse=function(e){return this.read_from(this.tokenize(e))},this.tokenize=function(e){return e.replace(/\(/g," ( ").replace(/\)/g," ) ").split(" ").filter(function(e){return e})},this.read_from=function(e){if(e.length===0)throw"unexpected EOF";token=e.shift();if(token==="("){var t=[];while(e[0]!==")")t.push(this.read_from(e));return e.shift(),t}if(token===")")throw"expected )";return this.atom(token)},this.atom=function(e){var t=parseFloat(e);return isNaN(t)?e:t}};if(typeof exports!="object"||exports===undefined){if(!i)var i={};return i.Interpreter=r,i.Env=e,i}return exports.Interpreter=r,exports.Env=e,exports}),define("Runner",["backbone"],function(e){return e.Model.extend({defaults:{isRunning:!1},initialize:function(e,t){this.app=t.app;var n=t.workspace;this.workspace=n,this.set("id",n.get("_id")),this.reset(),t.workspace.get("connections").on("add",this.addConnection,this),t.workspace.get("connections").on("remove",this.removeConnection,this),t.workspace.get("nodes").on("add",this.addNode,this),t.workspace.get("nodes").on("remove",this.removeNode,this),this.runCount=0,this.averageRunTime=0},post:function(e,t){e.workspace_id||(e.workspace_id=this.workspace.get("_id")),this.worker.postMessage(e);if(t)return;this.trigger("post",e)},onWorkerMessage:function(e){var t=this["on_"+e.kind];t&&t.call(this,e)},initWorker:function(){this.worker=new Worker("scripts/lib/flood/flood_runner.js");var e=this;this.worker.addEventListener("message",function(t){return e.onWorkerMessage.call(e,t.data)},!1)},initWorkspace:function(){this.post({kind:"addWorkspace"});var e=this.workspace.toJSON(),t=function(){this.updateNode(node)},n=this;this.workspace.get("nodes").each(function(e){n.watchNodeEvents.call(n,e)}),e.kind="setWorkspaceContents",this.post(e)},on_nodeEvalComplete:function(e){var t=this.workspace.get("nodes").get(e._id);t&&t.onEvalComplete(e.isNew,e.value,e.prettyValue)},on_nodeEvalFailed:function(e){var t=this.workspace.get("nodes").get(e._id);t&&this.workspace.get("nodes").get(e._id).onEvalFailed(e.exception)},on_nodeEvalBegin:function(e){var t=this.workspace.get("nodes").get(e._id);t&&this.workspace.get("nodes").get(e._id).onEvalBegin(e.isNew)},on_run:function(e){console.log(e),this.set("isRunning",!1),this.runCount++},cancel:function(){this.set("isRunning",!1),this.worker.terminate(),this.reset()},runQueued:!1,run:_.throttle(function(e){this.post({kind:"run",bottom_ids:e}),this.set("isRunning",!0)},120),watchNodeEvents:function(e){var t=function(){this.updateNode(e)};e.on("change:replication",t,this),e.on("change:ignoreDefaults",t,this),e.on("updateRunner",t,this)},updateNode:function(e){var t=e.serialize();t.kind="updateNode",t.workspace_id=e.workspace.id,this.post(t)},addNode:function(e){var t=e.serialize();t.kind="addNode",t.workspace_id=e.workspace.id,this.watchNodeEvents(e),this.post(t)},removeNode:function(e){var t=e.serialize();t.kind="removeNode",t.workspace_id=e.workspace.id,this.post(t)},addConnection:function(e,t){var n=e.toJSON();n.kind="addConnection",n.id=e.get("_id"),n.workspace_id=e.workspace.id,this.post(n)},removeConnection:function(e){var t=e.toJSON();t.kind="removeConnection",t.id=e.get("endNodeId"),t.portIndex=e.get("endPortIndex"),t.workspace_id=e.workspace.id,this.post(t)},recompile:function(e){var t=e.toJSON();t.kind="recompile",this.post(t)},addDefinition:function(e){var t=e.toJSON();t.kind="addDefinition",t.workspace_id=t._id;var n=this;e.get("nodes").each(function(e){n.watchNodeEvents.call(n,e)}),e.get("connections").on("add",function(t){this.addConnection(t),this.recompile(e),this.workspace.trigger("requestRun")},this),e.get("connections").on("remove",function(t){this.removeConnection(t),this.recompile(e),this.workspace.trigger("requestRun")},this),e.get("nodes").on("add",function(t){this.addNode(t),this.recompile(e),this.workspace.trigger("requestRun")},this),e.get("nodes").on("remove",function(t){this.removeNode(t),this.recompile(e),this.workspace.trigger("requestRun")},this),this.post(t)},on_recompile:function(e){console.log(e)},reset:function(){this.initWorker(),this.initWorkspace()}})}),define("Marquee",["backbone"],function(e){return e.Model.extend({idAttribute:"_id",defaults:{x:10,y:10,width:50,height:50,hidden:!0},startCorner:[10,10],endCorner:[20,20],initialize:function(e,t){this.workspace=t.workspace},updateRawValues:function(){this.set("width",Math.abs(this.startCorner[0]-this.endCorner[0])),this.set("height",Math.abs(this.startCorner[1]-this.endCorner[1])),this.set("x",Math.min(this.startCorner[0],this.endCorner[0])),this.set("y",Math.min(this.startCorner[1],this.endCorner[1]))},setStartCorner:function(e){this.startCorner=e,this.endCorner=e,this.updateRawValues()},setEndCorner:function(e){this.endCorner=e,this.updateRawValues()}})}),define("Workspace",["backbone","Nodes","Connection","Connections","scheme","FLOOD","Runner","Node","Marquee"],function(e,t,n,r,i,s,o,u,a){return e.Model.extend({idAttribute:"_id",url:function(){return"/ws/"+this.get("_id")},defaults:{name:"Unnamed Workspace",nodes:null,connections:null,zoom:1,current:!1,isPublic:!1,isRunning:!1,lastSaved:Date.now(),offset:[0,0],undoStack:[],redoStack:[],clipBoard:[],workspaceDependencyIds:[],isCustomNode:!1},draggingProxy:!1,proxyConnection:null,dragSelect:!1,runAllowed:!1,initialize:function(e,i){e=e||{},this.app=i.app,this.set("nodes",new t(e.nodes,{workspace:this})),this.set("connections",new r(e.connections,{workspace:this})),_.each(this.get("connections").where({startProxy:!1,endProxy:!1}),function(e,t){this.get("nodes").get(e.get("startNodeId")).connectPort(e.get("startPortIndex"),!0,e),this.get("nodes").get(e.get("endNodeId")).connectPort(e.get("endPortIndex"),!1,e)},this);var s=this;this.get("connections").on("add remove",function(){s.trigger("change:connections"),s.trigger("requestRun")}),this.get("nodes").on("add remove",function(){s.trigger("change:nodes"),s.trigger("requestRun")}),this.proxyConnection=new n({_id:-1,startProxy:!0,endProxy:!0,startProxyPosition:[0,0],endProxyPosition:[0,0],hidden:!0},{workspace:this}),this.marquee=new a({_id:-1,hidden:!0},{workspace:this}),this.runAllowed=!0,this.get("isCustomNode")||this.initializeRunner(),this.sync=_.throttle(this.sync,2e3);var o=_.throttle(function(){this.sync("update",this)},1e3);this.on("runCommand",o,this),this.on("change:name",o,this),this.on("change:zoom",o,this),this.on("change:workspaceDependencyIds",o,this),this.on("requestRun",this.run,this),this.get("isCustomNode")&&this.initializeCustomNode(),this.initializeDependencies(this.get("workspaceDependencyIds")),this.app.trigger("workspaceLoaded",this)},initializeDependencies:function(e){if(e.length===0||!e){console.log(this.get("name")+" has no dependencies"),this.trigger("requestRun");return}this.awaitedWorkspaceDependencyIds=[],console.log(this.get("name")+" has dependencies: "+JSON.stringify(e));var t=this;this.app.get("workspaces").on("add",function(e){t.resolveDependency.call(t,e)},this),e.forEach(function(e){t.awaitOrResolveDependency.call(t,e)})},cleanupDependencies:function(){var e=this.get("workspaceDependencyIds");console.log("Before cleaning up, "+this.get("name")+" has dependencies: "+JSON.stringify(e));var t=this,n=e.reduce(function(e,n){var r=t.getCustomNodesWithId(n);return r&&r.length!=0&&e.push(n),e},[]);this.set("workspaceDependencyIds",n)},awaitOrResolveDependency:function(e){var t=this.app.getLoadedWorkspace(e);if(t)return this.resolveDependency(t);this.awaitedWorkspaceDependencyIds.push(e),this.app.setWorkspaceToBackground(e),this.app.loadWorkspace(e)},resolveDependency:function(e){if(e.id===this.id)return;var t=this.awaitedWorkspaceDependencyIds.indexOf(e.id);if(t<0)return;this.awaitedWorkspaceDependencyIds.remove(t),this.sendDefinitionToRunner(e.id),this.watchDependency(e),this.syncCustomNodesWithWorkspace(e),this.awaitedWorkspaceDependencyIds.length===0&&this.run()},watchDependency:function(e){var t=this;e.on("change:name",function(){t.syncCustomNodesWithWorkspace.call(t,e)},this),e.on("change:workspaceDependencyIds",function(){t.syncCustomNodesWithWorkspace.call(t,e)},this),e.on("requestRun",function(){t.syncCustomNodesWithWorkspace.call(t,e),t.trigger("requestRun")},this),e.on("updateRunner",function(){t.syncCustomNodesWithWorkspace.call(t,e),t.trigger("updateRunner")},this)},addWorkspaceDependency:function(e,t){console.log("Adding "+e+" as a dependency for "+this.get("name"));var n=this.app.getLoadedWorkspace(e);if(!n)throw new Error("You tried to add an unloaded workspace as a dependency!");t&&this.watchDependency(n);var r=n.get("workspaceDependencyIds"),i=this.get("workspaceDependencyIds"),s=_.union([e],i,r);console.log("After adding dependencies, the dependencies for "+this.get("name")+" is now "+s),this.set("workspaceDependencyIds",s)},getCustomNodeInputsOutputs:function(e){var t=e?"Output":"Input";return this.get("nodes").filter(function(e){return e.get("type").typeName===t})},getCustomNodes:function(){return this.get("nodes").filter(function(e){return e.get("type")instanceof s.internalNodeTypes.CustomNode})},getCustomNodesWithId:function(e){return this.getCustomNodes().filter(function(t){return t.get("type").functionId===e})},getIndirectlyAffectedCustomNodes:function(e){var t=this.getCustomNodes(),n=this.app;return t.filter(function(t){var r=t.get("type").functionId,i=n.getLoadedWorkspace(r).get("workspaceDependencyIds");return r!=e&&i.indexOf(e)!=-1})},syncCustomNodesWithWorkspace:function(e){typeof e=="string"&&(e=this.app.getLoadedWorkspace(e)),this.syncDirectlyAffectedCustomNodesWithWorkspace(e),this.syncIndirectlyAffectedCustomNodesWithWorkspace(e)},syncDirectlyAffectedCustomNodesWithWorkspace:function(e){var t=this.getCustomNodesWithId(e.id),n=e.getCustomNodeInputsOutputs(),r=e.getCustomNodeInputsOutputs(!0);t.forEach(function(t){var i=t.get("inputConnections"),s=n.length-i.length;if(s>0)for(var o=0;o<s;o++)i.push([]);else for(var o=0;o<-s;o++){var u=t.getConnectionAtIndex(i.length-1);u!=null&&t.workspace.removeConnection(u),i.pop()}var a=t.get("outputConnections"),f=r.length-a.length;if(f>0)for(var o=0;o<f;o++)a.push([]);else for(var o=0;o<-f;o++){var l=t.get("outputConnections").last();l&&l.slice(0).forEach(function(e){t.workspace.removeConnection(e)}),a.pop()}t.get("type").functionName=e.get("name"),t.get("type").setNumInputs(n.length),t.get("type").setNumOutputs(r.length);var c=JSON.parse(JSON.stringify(t.get("extra")));c.numInputs=n.length,c.numOutputs=r.length,c.functionName=e.get("name"),c.inputNames=n.map(function(e,t){var n=e.get("extra");return n===undefined||!n.name||n.name===""?String.fromCharCode(97+t):n.name}),c.inputNames.forEach(function(e,n){t.get("type").inputs[n].name=e}),c.outputNames=r.map(function(e,t){var n=e.get("extra");return n===undefined||!n.name||n.name===""?String.fromCharCode(97+t):n.name}),c.outputNames.forEach(function(e,n){t.get("type").outputs[n].name=e}),t.set("extra",c),t.trigger("requestRender"),t.trigger("updateRunner")}),t.length>0&&this.sync("update",this)},syncIndirectlyAffectedCustomNodesWithWorkspace:function(e){var t=this.getIndirectlyAffectedCustomNodes(e.id);t.forEach(function(e){e.trigger("updateRunner")}),t.length>0&&this.sync("update",this)},initializeRunner:function(){this.runner=new o({id:this.get("_id")},{workspace:this});var e=this;this.runner.on("change:isRunning",function(t){e.set("isRunning",t.get("isRunning"))})},customNode:null,initializeCustomNode:function(){this.customNode=new s.internalNodeTypes.CustomNode(this.get("name"),this.get("_id"));var e=this.get("nodes").where({typeName:"Input"}).length,t=this.get("nodes").where({typeName:"Output"}).length;this.customNode.setNumInputs(e),this.customNode.setNumOutputs(t),this.app.SearchElements.addCustomNode(this.customNode);var n=this;this.on("change:name",function(){n.customNode.functionName=n.get("name"),n.app.SearchElements.addCustomNode(n.customNode)},this)},toJSON:function(){this.set("undoStack",_.last(this.get("undoStack"),10)),this.set("redoStack",_.last(this.get("redoStack"),10));if(this._isSerializing)return this.id||this.cid;this._isSerializing=!0;var e=_.clone(this.attributes);return _.each(e,function(t,n){_.isFunction(t.toJSON)&&(e[n]=t.toJSON())}),this._isSerializing=!1,e},zoomIn:function(){if(this.get("zoom")>4)return;this.set("zoom",this.get("zoom")+.05)},zoomOut:function(){if(this.get("zoom")<.2)return;this.set("zoom",this.get("zoom")-.05)},parse:function(e){return e.nodes=new t(e.nodes),e.connections=new r(e.connections),e},printModel:function(){console.log(this.toJSON())},addToUndoAndClearRedo:function(e){this.get("undoStack").push(e),this.get("redoStack").length=0},removeSelected:function(){var e=this,t=!1,n={};this.get("nodes").each(function(e){e.get("selected")&&(t=!0,n[e.get("_id")]=e.serialize())});if(!t)return;var r={};this.get("connections").each(function(e){if(n[e.get("startNodeId")]||n[e.get("endNodeId")])r[e.get("_id")]||(r[e.get("_id")]=e.toJSON())});var i={kind:"multiple",commands:[]};for(var s in r){var o=r[s];o.kind="removeConnection",i.commands.push(o)}for(var u in n){var a=n[u];a.kind="removeNode",i.commands.push(a)}this.runInternalCommand(i),this.addToUndoAndClearRedo(i)},makeId:function(){return this.app.makeId()},copy:function(){var e=this,t=!1,n={};this.get("nodes").each(function(e){e.get("selected")&&(t=!0,n[e.get("_id")]=e.serialize())});if(!t)return;var r={},i=0;this.get("connections").each(function(e){if(e.get("_id")===-1||e.get("startProxy")||e.get("endProxy"))return;if(n[e.get("startNodeId")]&&n[e.get("endNodeId")]||n[e.get("endNodeId")])r[e.get("_id")]||(i++,r[e.get("_id")]=e.toJSON())}),console.log(i," connections copied"),this.app.set("clipboard",{nodes:n,connections:r})},paste:function(){var e=JSON.parse(JSON.stringify(this.app.get("clipboard"))),t=this,n={},r=Math.min(20,Math.abs(80*Math.random())),i=0;_.each(e.nodes,function(e){n[e._id]=e,n[e._id].position=[e.position[0]+r,e.position[1]+r],n[e._id]._id=t.makeId(),i++}),i>0&&this.get("nodes").deselectAll();var s={};_.each(e.connections,function(e){n[e.endNodeId]&&(e.endNodeId=n[e.endNodeId]._id),n[e.startNodeId]&&(e.startNodeId=n[e.startNodeId]._id),s[e._id]=e,s[e._id]._id=t.makeId()});var o={kind:"multiple",commands:[]};for(var u in n){var a=e.nodes[u];a.kind="addNode",o.commands.push(a)}for(var u in s){var f=s[u];f.kind="addConnection",o.commands.push(f)}this.runInternalCommand(o),this.addToUndoAndClearRedo(o)},addNodeByNameAndPosition:function(e,t){if(e===undefined||t===undefined)return;var n=this.app.SearchElements.where({name:e})[0];if(!n){console.warn("Could not find node with name in Library: "+e);return}if(n.get("isCustomNode")){var r={typeName:"CustomNode",position:t,_id:this.makeId()};return r.extra={functionId:n.get("functionId"),functionName:n.get("functionName"),numInputs:n.get("numInputs"),numOutputs:n.get("numOutputs")},this.addNode(r)}this.addNode({typeName:e,position:t,_id:this.makeId()})},addNode:function(e){if(e.typeName==="CustomNode"){var t=e.extra.functionId;this.addWorkspaceDependency(t,!0),this.sendDefinitionToRunner(t)}var n=JSON.parse(JSON.stringify(e));n.kind="addNode",this.runInternalCommand(n),this.addToUndoAndClearRedo(n),e.typeName==="CustomNode"&&this.syncCustomNodesWithWorkspace(t),this.trigger("requestRun")},sendDefinitionToRunner:function(e){if(!this.runner)return;this.runner.addDefinition(this.app.getLoadedWorkspace(e))},removeNode:function(e){var t=JSON.parse(JSON.stringify(e));t.kind="removeNode",this.runInternalCommand(t),this.addToUndoAndClearRedo(t)},addConnection:function(e){var t=JSON.parse(JSON.stringify(e));t.kind="addConnection",this.runInternalCommand(t),this.addToUndoAndClearRedo(t)},addConnectionAndRemoveExisting:function(e,t,n,r){var i={kind:"multiple",commands:[]},s=this.get("nodes").get(n);if(!s)return this;var o=s.getConnectionAtIndex(r);if(o!=null){var u=o.toJSON();u.kind="removeConnection",i.commands.push(u)}var a={kind:"addConnection",startNodeId:e,startPortIndex:t,endNodeId:n,endPortIndex:r,_id:this.app.makeId()};return i.commands.push(a),this.runInternalCommand(i),this.addToUndoAndClearRedo(i),this},removeConnection:function(e){var t=JSON.parse(JSON.stringify(e));t.kind="removeConnection",this.runInternalCommand(t),this.addToUndoAndClearRedo(t)},setNodeProperty:function(e){var t=JSON.parse(JSON.stringify(e));t.kind="setNodeProperty",this.runInternalCommand(t),this.addToUndoAndClearRedo(t)},internalCommands:{multiple:function(e){var t=this.runAllowed;this.runAllowed=!1;var n=this;e.commands.forEach(function(e){n.runInternalCommand.call(n,e)}),this.runAllowed=t,this.runRejected&&this.run()},addNode:function(e){var t=new u(e,{workspace:this});this.get("nodes").add(t)},removeNode:function(e){var t=this.get("nodes").get(e._id);this.get("nodes").remove(t)},addConnection:function(e){var t=this.get("nodes");if(!t.get(e.startNodeId)||!t.get(e.endNodeId))return;var r=new n(e,{workspace:this});this.get("connections").add(r),this.get("nodes").get(r.get("startNodeId")).connectPort(r.get("startPortIndex"),!0,r),this.get("nodes").get(r.get("endNodeId")).connectPort(r.get("endPortIndex"),!1,r)},removeConnection:function(e){var t=this.get("connections").get(e._id);t&&this.get("connections").remove(t)},setNodeProperty:function(e){var t=this.get("nodes").get(e._id),n=e.property;e.oldValue||(e.oldValue=JSON.parse(JSON.stringify(t.get(n)))),t.set(n,e.newValue)}},runInternalCommand:function(e){var t=this.internalCommands[e.kind];if(t){t.call(this,e),this.trigger("runCommand");return}console.warn("Could not find the command: "+t.kind)},redo:function(){var e=this.get("redoStack");if(e.length===0)return console.warn("Nothing to redo!");var t=e.pop();this.get("undoStack").push(t),this.runInternalCommand(t)},undo:function(){var e=this.get("undoStack");if(e.length===0)return;var t=e.pop(),n=this.invertCommand(t);this.get("redoStack").push(t),this.runInternalCommand(n)},invertCommand:function(e){var t=this.commandInversions[e.kind];return t?t.call(this,e):{}},commandInversions:{addNode:function(e){var t=JSON.parse(JSON.stringify(e));return t.kind="removeNode",t},multiple:function(e){var t=JSON.parse(JSON.stringify(e)),n=this;return t.commands=t.commands.map(function(e){return n.invertCommand.call(n,e)}),t.commands.reverse(),t},removeNode:function(e){var t=JSON.parse(JSON.stringify(e));return t.kind="addNode",t},addConnection:function(e){var t=JSON.parse(JSON.stringify(e));return t.kind="removeConnection",t},removeConnection:function(e){var t=JSON.parse(JSON.stringify(e));return t.kind="addConnection",t},setNodeProperty:function(e){var t=JSON.parse(JSON.stringify(e)),n=t.oldValue;return t.oldValue=t.newValue,t.newValue=n,t}},run:function(){if(!this.runAllowed||this.get("isCustomNode")){this.runRejected=!0;return}this.runReject=!1;if(this.get("nodes").length===0)return;var e=this.get("nodes").filter(function(e){return e.isOutputNode()&&e.get("type").outputs.length>0}).map(function(e){return e.get("_id")});this.runner.run(e)},startMarqueeSelect:function(e){return this.set("marqueeStart",e),this.set("marqueeEnd",e),this.set("marqueeSelectEnabled",!0),this},endMarqueeSelect:function(){return this.set("marqueeSelectEnabled",!1),this},startProxyConnection:function(e,t,n){return this.set("proxyStartId",e),this.set("proxyStartPortIndex",t),this.proxyConnection.set("hidden",!1),this.proxyConnection.set("startNodeId",e),this.proxyConnection.set("startPortIndex",t),this.proxyConnection.set("startProxy",!1),this.proxyConnection.set("endProxy",!0),this.proxyConnection.set("endProxyPosition",n),this.draggingProxy=!0,this.trigger("startProxyDrag"),this},completeProxyConnection:function(e,t){this.draggingProxy=!1,this.trigger("endProxyDrag");var n=this.proxyConnection.get("startNodeId"),r=this.proxyConnection.get("startPortIndex");return this.addConnectionAndRemoveExisting(n,r,e,t),this},endProxyConnection:function(){return this.proxyConnection.set("hidden",!0),this.draggingProxy=!1,this}})}),define("Workspaces",["backbone","Workspace"],function(e,t){return e.Collection.extend({model:t})}),define("Login",["backbone"],function(e){return e.Model.extend({defaults:{isLoggedIn:!1,failed:!1,failureMessage:"",showing:!1,email:""},initialize:function(e,t){this.app=t.app},fetch:function(){var e=this;$.get("/email",function(t){t.email?(e.set("email",t.email),e.set("isLoggedIn",!0)):e.set("isLoggedIn",!1)})},toggle:function(){return this.get("showing")?this.hide():this.show()},show:function(){this.set("showing",!0)},hide:function(){this.set("showing",!1)},signup:function(e){var t=this;$.post("/signup",e,function(e){if(e.length&&e.length>0)return t.set("failureMessage",e[0].msg),t.set("failed",!0);t.set("failed",!1),t.app.fetch()})},login:function(e){var t=this;$.post("/login",e,function(e){if(e.length&&e.length>0)return t.set("failureMessage",e[0].msg),t.set("failed",!0);t.set("failed",!1),t.app.fetch()})},logout:function(){var e=this;$.get("/logout",{},function(t){e.app.fetch()})}})}),define("SearchElement",["backbone"],function(e){return e.Model.extend({defaults:{name:null,isCustomNode:!1,functionId:-1},initialize:function(e,t){this.app=e.app}})}),define("SearchElements",["backbone","SearchElement","FLOOD"],function(e,t,n){return e.Collection.extend({model:t,initialize:function(e){this.app=e.app},addCustomNode:function(e){var n=this.where({functionId:e.functionId});n&&this.remove(n),this.add(new t({name:e.functionName,functionName:e.functionName,isCustomNode:!0,functionId:e.functionId,app:this.app,numInputs:e.inputs.length,numOutputs:e.outputs.length}))},fetch:function(){this.models.length=0;for(var e in n.nodeTypes)this.models.push(new t({name:e,app:this.app}))}})}),define("App",["backbone","Workspaces","Node","Login","Workspace","SearchElements"],function(e,t,n,r,i,s){return e.Model.extend({idAttribute:"_id",url:function(){return"/mys"},defaults:{name:"DefaultSession",workspaces:new t,backgroundWorkspaces:[],currentWorkspace:null,showingBrowser:!1,showingSearch:!1,showingFeedback:!1,showingHelp:!1,isFirstExperience:!1,clipBoard:{}},initialize:function(e,t){this.on("change:currentWorkspace",this.updateCurrentWorkspace,this),this.updateCurrentWorkspace(),this.login=new r({},{app:this}),this.SearchElements=new s({app:this}),this.SearchElements.fetch()},parse:function(e){var t=this.get("workspaces").slice();return this.get("workspaces").add(e.workspaces,{app:this}),this.get("workspaces").remove(t),e.workspaces=this.get("workspaces"),e},fetch:function(t){this.login.fetch(),e.Model.prototype.fetch.call(this,t)},toJSON:function(){if(this._isSerializing)return this.id||this.cid;this._isSerializing=!0;var e=_.clone(this.attributes);return _.each(e,function(t,n){_.isFunction(t.toJSON)&&(e[n]=t.toJSON())}),this._isSerializing=!1,e},enableAutosave:function(){this.get("workspaces").on("add remove",function(){this.sync("update",this)},this),this.on("change:currentWorkspace",function(){this.sync("update",this)},this),this.on("change:isFirstExperience",function(){this.sync("update",this)},this),this.on("change:backgroundWorkspaces",function(){this.sync("update",this)},this)},newNodePosition:[0,0],makeId:function(){return Math.floor(Math.random()*1e9)},getCurrentWorkspace:function(){return this.get("workspaces").get(this.get("currentWorkspace"))},getLoadedWorkspace:function(e){var t=this.get("workspaces").where({_id:e});return t.length===0?undefined:t[0]},newWorkspace:function(e){var t=this;$.get("/nws",function(n,r){var s=new i(n,{app:t});t.get("workspaces").add(s),t.set("currentWorkspace",s.get("_id")),e&&e(s)}).fail(function(){console.error("failed to get new workspace")})},newNodeWorkspace:function(e){var t=this;$.get("/nws",function(n,r){n.isCustomNode=!0;var s=new i(n,{app:t});t.get("workspaces").add(s),t.set("currentWorkspace",s.get("_id")),e&&e(s)}).fail(function(){console.error("failed to get new workspace")})},loadWorkspace:function(e,t){var n=this.get("workspaces").get(e),r=this;$.get("/ws/"+e,function(e,n){var s=new i(e,{app:r});r.get("workspaces").add(s),t&&t(s)}).fail(function(){console.error("failed to get workspace with id: "+e)})},isBackgroundWorkspace:function(e){return this.get("backgroundWorkspaces").indexOf(e)!=-1},setWorkspaceToBackground:function(e){if(!this.isBackgroundWorkspace(e)){var t=this.get("backgroundWorkspaces").slice(0);t.push(e),this.set("backgroundWorkspaces",t)}},removeWorkspaceFromBackground:function(e){if(this.isBackgroundWorkspace(e)){var t=this.get("backgroundWorkspaces").slice(0);t.remove(t.indexOf(e)),this.set("backgroundWorkspaces",t)}},openWorkspace:function(e,t){this.removeWorkspaceFromBackground(e);var n=this.get("workspaces").get(e);n&&this.set("currentWorkspace",e);var r=this;this.loadWorkspace(e,function(e){r.set("currentWorkspace",e.get("_id")),t&&t(e)})},updateCurrentWorkspace:function(){if(this.get("workspaces").length===0)return;this.get("workspaces").each(function(e){e.set("current",!1)});if(this.get("currentWorkspace")===null||!this.get("workspaces").get(this.get("currentWorkspace"))){var e=this.get("workspaces").at(0);this.set("currentWorkspace",e.get("_id"))}this.get("workspaces").get(this.get("currentWorkspace")).set("current",!0)}})}),define("ConnectionView",["backbone"],function(e){return e.View.extend({template:_.template($("#connection-template").html()),workspaceView:null,initialize:function(e){this.model=e.model,e.isProxy&&(this.isProxy=!0),this.workspace=e.workspace,this.workspaceView=e.workspaceView,this.model.startNode&&this.model.startNode.on("change:ignoreDefaults",this.render,this)},delegateEvents:function(){e.View.prototype.delegateEvents.apply(this,arguments);if(!this.isProxy){this.startId=this.model.get("startNodeId"),this.endId=this.model.get("endNodeId");var t=this.workspace.get("nodes");t.get(this.endId)!=undefined&&this.listenTo(t.get(this.endId),"change:position",this.render),t.get(this.startId)!=undefined&&this.listenTo(t.get(this.startId),"change:position",this.render)}this.listenTo(this.model,"change",this.render)},render:function(){return this.makeCurveOnce(),this.updateControlPoints().updateHidden().updateColor()},updateControlPoints:function(){return this.el.setAttribute("d",this.template(this.getControlPoints())),this},updateHidden:function(){return this.model.get("hidden")?this.el.setAttribute("class","connection collapsed"):this.el.setAttribute("class","connection"),this},updateColor:function(){var e=this.model.startNode;return e?(e.isPartialFunctionApplication()?this.el.setAttribute("class","partial-function-connection"):this.el.setAttribute("class","connection"),this):this},curveInit:!1,makeCurveOnce:function(){if(!this.curveInit){var e=document.createElementNS("http://www.w3.org/2000/svg","path");e.setAttribute("class","connection"),this.el=e,this.$el=$(e),this.curveInit=!0}return this.el},getControlPoints:function(){if(!this.model.get("startProxy")||!this.model.get("endProxy"))var e=this.workspaceView.nodeViews,t=this.model.get("startNodeId"),n=this.model.get("endNodeId"),r=this.model.get("startPortIndex"),i=this.model.get("endPortIndex");this.model.get("startProxy")?startPos=this.model.get("startProxyPosition"):(this.workspaceView.nodeViews[t]||(t=this.model.workspace.get("proxyStartId"),r=this.model.workspace.get("proxyStartPortIndex")),startPos=this.workspaceView.nodeViews[t].getPortPosition(r,!0)),this.model.get("endProxy")?endPos=this.model.get("endProxyPosition"):endPos=e[n].getPortPosition(i,!1);var s=.65*Math.sqrt(Math.pow(endPos[0]-startPos[0],2)+Math.pow(startPos[1]-endPos[1],2));return{aX:startPos[0],aY:startPos[1],bX:startPos[0]+s,bY:startPos[1],dX:endPos[0],dY:endPos[1],cX:endPos[0]-s,cY:endPos[1]}}})}),define("MarqueeView",["backbone"],function(e){return e.View.extend({workspaceView:null,initialize:function(e){this.model=e.model,this.workspace=e.workspace,this.workspaceView=e.workspaceView,this.listenTo(this.model,"change",this.render)},render:function(){return this.makeElementOnce(),this.updateCorners().updateHidden().updateColor().updateStroke()},updateCorners:function(){return this.el.setAttribute("d",this.template(this.getCorners())),this},updateHidden:function(){return this.model.get("hidden")?this.el.setAttribute("class","marquee collapsed"):this.el.setAttribute("class","marquee"),this},updateColor:function(){return this},curveInit:!1,makeElementOnce:function(){if(!this.curveInit){var e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("class","marquee"),this.updateCorners(),this.updateStroke(),this.el=e,this.$el=$(e),this.curveInit=!0}return this.el},updateCorners:function(){return this.el.setAttribute("x",this.model.get("x")),this.el.setAttribute("y",this.model.get("y")),this.el.setAttribute("width",this.model.get("width")),this.el.setAttribute("height",this.model.get("height")),this},updateStroke:function(){var e=1/this.workspace.get("zoom");return this.el.setAttribute("stroke-dasharray",e*4+","+e*4),this.el.setAttribute("stroke",e*2),this}})}),function(e,t){var n=0,r=Array.prototype.slice,i=e.cleanData;e.cleanData=function(t){for(var n=0,r;(r=t[n])!=null;n++)try{e(r).triggerHandler("remove")}catch(s){}i(t)},e.widget=function(t,n,r){var i,s,o,u,a={},f=t.split(".")[0];t=t.split(".")[1],i=f+"-"+t,r||(r=n,n=e.Widget),e.expr[":"][i.toLowerCase()]=function(t){return!!e.data(t,i)},e[f]=e[f]||{},s=e[f][t],o=e[f][t]=function(e,t){if(!this._createWidget)return new o(e,t);arguments.length&&this._createWidget(e,t)},e.extend(o,s,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),u=new n,u.options=e.widget.extend({},u.options),e.each(r,function(t,r){if(!e.isFunction(r)){a[t]=r;return}a[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t=this._super,n=this._superApply,s;return this._super=e,this._superApply=i,s=r.apply(this,arguments),this._super=t,this._superApply=n,s}}()}),o.prototype=e.widget.extend(u,{widgetEventPrefix:s?u.widgetEventPrefix:t},a,{constructor:o,namespace:f,widgetName:t,widgetFullName:i}),s?(e.each(s._childConstructors,function(t,n){var r=n.prototype;e.widget(r.namespace+"."+r.widgetName,o,n._proto)}),delete s._childConstructors):n._childConstructors.push(o),e.widget.bridge(t,o)},e.widget.extend=function(n){var i=r.call(arguments,1),s=0,o=i.length,u,a;for(;s<o;s++)for(u in i[s])a=i[s][u],i[s].hasOwnProperty(u)&&a!==t&&(e.isPlainObject(a)?n[u]=e.isPlainObject(n[u])?e.widget.extend({},n[u],a):e.widget.extend({},a):n[u]=a);return n},e.widget.bridge=function(n,i){var s=i.prototype.widgetFullName||n;e.fn[n]=function(o){var u=typeof o=="string",a=r.call(arguments,1),f=this;return o=!u&&a.length?e.widget.extend.apply(null,[o].concat(a)):o,u?this.each(function(){var r,i=e.data(this,s);if(!i)return e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+o+"'");if(!e.isFunction(i[o])||o.charAt(0)==="_")return e.error("no such method '"+o+"' for "+n+" widget instance");r=i[o].apply(i,a);if(r!==i&&r!==t)return f=r&&r.jquery?f.pushStack(r.get()):r,!1}):this.each(function(){var t=e.data(this,s);t?t.option(o||{})._init():e.data(this,s,new i(o,this))}),f}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,r){r=e(r||this.defaultElement||this)[0],this.element=e(r),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),r!==this&&(e.data(r,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===r&&this.destroy()}}),this.document=e(r.style?r.ownerDocument:r.document||r),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,r){var i=n,s,o,u;if(arguments.length===0)return e.widget.extend({},this.options);if(typeof n=="string"){i={},s=n.split("."),n=s.shift();if(s.length){o=i[n]=e.widget.extend({},this.options[n]);for(u=0;u<s.length-1;u++)o[s[u]]=o[s[u]]||{},o=o[s[u]];n=s.pop();if(r===t)return o[n]===t?null:o[n];o[n]=r}else{if(r===t)return this.options[n]===t?null:this.options[n];i[n]=r}}return this._setOptions(i),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,e==="disabled"&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,r){var i,s=this;typeof t!="boolean"&&(r=n,n=t,t=!1),r?(n=i=e(n),this.bindings=this.bindings.add(n)):(r=n,n=this.element,i=this.widget()),e.each(r,function(r,o){function u(){if(!t&&(s.options.disabled===!0||e(this).hasClass("ui-state-disabled")))return;return(typeof o=="string"?s[o]:o).apply(s,arguments)}typeof o!="string"&&(u.guid=o.guid=o.guid||u.guid||e.guid++);var a=r.match(/^(\w+)\s*(.*)$/),f=a[1]+s.eventNamespace,l=a[2];l?i.delegate(l,f,u):n.bind(f,u)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return(typeof e=="string"?r[e]:e).apply(r,arguments)}var r=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,r){var i,s,o=this.options[t];r=r||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],s=n.originalEvent;if(s)for(i in s)i in n||(n[i]=s[i]);return this.element.trigger(n,r),!(e.isFunction(o)&&o.apply(this.element[0],[n].concat(r))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(r,i,s){typeof i=="string"&&(i={effect:i});var o,u=i?i===!0||typeof i=="number"?n:i.effect||n:t;i=i||{},typeof i=="number"&&(i={duration:i}),o=!e.isEmptyObject(i),i.complete=s,i.delay&&r.delay(i.delay),o&&e.effects&&e.effects.effect[u]?r[t](i):u!==t&&r[u]?r[u](i.duration,i.easing,s):r.queue(function(n){e(this)[t](),s&&s.call(r[0]),n()})}})}(jQuery),define("jqueryuiwidget",["jquery"],function(e){return function(){var t,n;return t||e.jqueryuiwidget}}(this)),function(e,t){var n=!1;e(document).mouseup(function(){n=!1}),e.widget("ui.mouse",{version:"@VERSION",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){if(!0===e.data(n.target,t.widgetName+".preventClickEvent"))return e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(n)return;this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var r=this,i=t.which===1,s=typeof this.options.cancel=="string"&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;if(!i||s||!this._mouseCapture(t))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){r.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)){this._mouseStarted=this._mouseStart(t)!==!1;if(!this._mouseStarted)return t.preventDefault(),!0}return!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return r._mouseMove(e)},this._mouseUpDelegate=function(e){return r._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),n=!0,!0},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),define("jqueryuimouse",["jquery","jqueryuiwidget"],function(e){return function(){var t,n;return t||e.jqueryuimouse}}(this)),function(e,t){function i(t,n){var r,i,o,u=t.nodeName.toLowerCase();return"area"===u?(r=t.parentNode,i=r.name,!t.href||!i||r.nodeName.toLowerCase()!=="map"?!1:(o=e("img[usemap=#"+i+"]")[0],!!o&&s(o))):(/input|select|textarea|button|object/.test(u)?!t.disabled:"a"===u?t.href||n:n)&&s(t)}function s(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}var n=0,r=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"@VERSION",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(n,r){return typeof n=="number"?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},n)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?t=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):t=this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length){var r=e(this[0]),i,s;while(r.length&&r[0]!==document){i=r.css("position");if(i==="absolute"||i==="relative"||i==="fixed"){s=parseInt(r.css("zIndex"),10);if(!isNaN(s)&&s!==0)return s}r=r.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){r.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,r){function u(t,n,r,s){return e.each(i,function(){n-=parseFloat(e.css(t,"padding"+this))||0,r&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),s&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var i=r==="Width"?["Left","Right"]:["Top","Bottom"],s=r.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+r]=function(n){return n===t?o["inner"+r].call(this):this.each(function(){e(this).css(s,u(this,n)+"px")})},e.fn["outer"+r]=function(t,n){return typeof t!="number"?o["outer"+r].call(this,t):this.each(function(){e(this).css(s,u(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,r){var i,s=e.ui[t].prototype;for(i in r)s.plugins[i]=s.plugins[i]||[],s.plugins[i].push([n,r[i]])},call:function(e,t,n){var r,i=e.plugins[t];if(!i||!e.element[0].parentNode||e.element[0].parentNode.nodeType===11)return;for(r=0;r<i.length;r++)e.options[i[r][0]]&&i[r][1].apply(e.element,n)}},hasScroll:function(t,n){if(e(t).css("overflow")==="hidden")return!1;var r=n&&n==="left"?"scrollLeft":"scrollTop",i=!1;return t[r]>0?!0:(t[r]=1,i=t[r]>0,t[r]=0,i)}})}(jQuery),define("jqueryuicore",["jquery"],function(e){return function(){var t,n;return t||e.jqueryuicore}}(this)),function(e,t){e.widget("ui.draggable",e.ui.mouse,{version:"@VERSION",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){this.options.helper==="original"&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){this.offsetParentCssPosition==="fixed"&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute");if(!n){var r=this._uiHash();if(this._trigger("drag",t,r)===!1)return this._mouseUp({}),!1;this.position=r.position}if(!this.options.axis||this.options.axis!=="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!=="x")this.helper[0].style.top=this.position.top+"px";return e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=this,r=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(r=e.ui.ddmanager.drop(this,t)),this.dropped&&(r=this.dropped,this.dropped=!1),this.options.helper==="original"&&!e.contains(this.element[0].ownerDocument,this.element[0])?!1:(this.options.revert==="invalid"&&!r||this.options.revert==="valid"&&r||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",t)!==!1&&n._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1)},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var n=this.options,r=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):n.helper==="clone"?this.element.clone().removeAttr("id"):this.element;return r.parents("body").length||r.appendTo(n.appendTo==="parent"?this.element[0].parentNode:n.appendTo),r[0]!==this.element[0]&&!/(fixed|absolute)/.test(r.css("position"))&&r.css("position","absolute"),r},_adjustOffsetFromHelper:function(t){typeof t=="string"&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();this.cssPosition==="absolute"&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()==="html"&&e.ui.ie)t={top:0,left:0};return{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition==="relative"){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,n,r,i=this.options;if(!i.containment){this.containment=null;return}if(i.containment==="window"){this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(i.containment==="document"){this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];return}if(i.containment.constructor===Array){this.containment=i.containment;return}i.containment==="parent"&&(i.containment=this.helper[0].parentNode),n=e(i.containment),r=n[0];if(!r)return;t=n.css("overflow")!=="hidden",this.containment=[(parseInt(n.css("borderLeftWidth"),10)||0)+(parseInt(n.css("paddingLeft"),10)||0),(parseInt(n.css("borderTopWidth"),10)||0)+(parseInt(n.css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(n.css("borderRightWidth"),10)||0)-(parseInt(n.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(n.css("borderBottomWidth"),10)||0)-(parseInt(n.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n},_convertPositionTo:function(t,n){n||(n=this.position);var r=t==="absolute"?1:-1,i=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:i.scrollTop(),left:i.scrollLeft()}),{top:n.top+this.offset.relative.top*r+this.offset.parent.top*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top)*r,left:n.left+this.offset.relative.left*r+this.offset.parent.left*r-(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)*r}},_generatePosition:function(t){var n,r,i,s,o=this.options,u=this.cssPosition!=="absolute"||this.scrollParent[0]!==document&&!!e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=t.pageX,f=t.pageY;return this.offset.scroll||(this.offset.scroll={top:u.scrollTop(),left:u.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(r=this.relative_container.offset(),n=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):n=this.containment,t.pageX-this.offset.click.left<n[0]&&(a=n[0]+this.offset.click.left),t.pageY-this.offset.click.top<n[1]&&(f=n[1]+this.offset.click.top),t.pageX-this.offset.click.left>n[2]&&(a=n[2]+this.offset.click.left),t.pageY-this.offset.click.top>n[3]&&(f=n[3]+this.offset.click.top)),o.grid&&(i=o.grid[1]?this.originalPageY+Math.round((f-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,f=n?i-this.offset.click.top>=n[1]||i-this.offset.click.top>n[3]?i:i-this.offset.click.top>=n[1]?i-o.grid[1]:i+o.grid[1]:i,s=o.grid[0]?this.originalPageX+Math.round((a-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,a=n?s-this.offset.click.left>=n[0]||s-this.offset.click.left>n[2]?s:s-this.offset.click.left>=n[0]?s-o.grid[0]:s+o.grid[0]:s)),{top:f-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(this.cssPosition==="fixed"?-this.scrollParent.scrollTop():this.offset.scroll.top),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(this.cssPosition==="fixed"?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!==this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[n,r]),t==="drag"&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var r=e(this).data("ui-draggable"),i=r.options,s=e.extend({},n,{item:r.element});r.sortables=[],e(i.connectToSortable).each(function(){var n=e.data(this,"ui-sortable");n&&!n.options.disabled&&(r.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,s))})},stop:function(t,n){var r=e(this).data("ui-draggable"),i=e.extend({},n,{item:r.element});e.each(r.sortables,function(){this.instance.isOver?(this.instance.isOver=0,r.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,r.options.helper==="original"&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,n){var r=e(this).data("ui-draggable"),i=this;e.each(r.sortables,function(){var s=!1,o=this;this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(s=!0,e.each(r.sortables,function(){return this.instance.positionAbs=r.positionAbs,this.instance.helperProportions=r.helperProportions,this.instance.offset.click=r.offset.click,this!==o&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(o.instance.element[0],this.instance.element[0])&&(s=!1),s})),s?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=r.offset.click.top,this.instance.offset.click.left=r.offset.click.left,this.instance.offset.parent.left-=r.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=r.offset.parent.top-this.instance.offset.parent.top,r._trigger("toSortable",t),r.dropped=this.instance.element,r.currentItem=r.element,this.instance.fromOutside=r),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),r._trigger("fromSortable",t),r.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("ui-draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("opacity")&&(i._opacity=r.css("opacity")),r.css("opacity",i.opacity)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._opacity&&e(n.helper).css("opacity",r._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&t.scrollParent[0].tagName!=="HTML"&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("ui-draggable"),r=n.options,i=!1;if(n.scrollParent[0]!==document&&n.scrollParent[0].tagName!=="HTML"){if(!r.axis||r.axis!=="x")n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<r.scrollSensitivity?n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop+r.scrollSpeed:t.pageY-n.overflowOffset.top<r.scrollSensitivity&&(n.scrollParent[0].scrollTop=i=n.scrollParent[0].scrollTop-r.scrollSpeed);if(!r.axis||r.axis!=="y")n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<r.scrollSensitivity?n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft+r.scrollSpeed:t.pageX-n.overflowOffset.left<r.scrollSensitivity&&(n.scrollParent[0].scrollLeft=i=n.scrollParent[0].scrollLeft-r.scrollSpeed)}else{if(!r.axis||r.axis!=="x")t.pageY-e(document).scrollTop()<r.scrollSensitivity?i=e(document).scrollTop(e(document).scrollTop()-r.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<r.scrollSensitivity&&(i=e(document).scrollTop(e(document).scrollTop()+r.scrollSpeed));if(!r.axis||r.axis!=="y")t.pageX-e(document).scrollLeft()<r.scrollSensitivity?i=e(document).scrollLeft(e(document).scrollLeft()-r.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<r.scrollSensitivity&&(i=e(document).scrollLeft(e(document).scrollLeft()+r.scrollSpeed))}i!==!1&&e.ui.ddmanager&&!r.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var n=e(this),r=n.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:r.top,left:r.left})})},drag:function(t,n){var r,i,s,o,u,a,f,l,c,h,p=e(this).data("ui-draggable"),d=p.options,v=d.snapTolerance,m=n.offset.left,g=m+p.helperProportions.width,y=n.offset.top,b=y+p.helperProportions.height;for(c=p.snapElements.length-1;c>=0;c--){u=p.snapElements[c].left,a=u+p.snapElements[c].width,f=p.snapElements[c].top,l=f+p.snapElements[c].height;if(g<u-v||m>a+v||b<f-v||y>l+v||!e.contains(p.snapElements[c].item.ownerDocument,p.snapElements[c].item)){p.snapElements[c].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=!1;continue}d.snapMode!=="inner"&&(r=Math.abs(f-b)<=v,i=Math.abs(l-y)<=v,s=Math.abs(u-g)<=v,o=Math.abs(a-m)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f-p.helperProportions.height,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u-p.helperProportions.width}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left)),h=r||i||s||o,d.snapMode!=="outer"&&(r=Math.abs(f-y)<=v,i=Math.abs(l-b)<=v,s=Math.abs(u-m)<=v,o=Math.abs(a-g)<=v,r&&(n.position.top=p._convertPositionTo("relative",{top:f,left:0}).top-p.margins.top),i&&(n.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),s&&(n.position.left=p._convertPositionTo("relative",{top:0,left:u}).left-p.margins.left),o&&(n.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[c].snapping&&(r||i||s||o||h)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[c].item})),p.snapElements[c].snapping=r||i||s||o||h}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,n=this.data("ui-draggable").options,r=e.makeArray(e(n.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(!r.length)return;t=parseInt(e(r[0]).css("zIndex"),10)||0,e(r).each(function(n){e(this).css("zIndex",t+n)}),this.css("zIndex",t+r.length)}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var r=e(n.helper),i=e(this).data("ui-draggable").options;r.css("zIndex")&&(i._zIndex=r.css("zIndex")),r.css("zIndex",i.zIndex)},stop:function(t,n){var r=e(this).data("ui-draggable").options;r._zIndex&&e(n.helper).css("zIndex",r._zIndex)}})}(jQuery),define("jqueryuidraggable",["jquery","jqueryuimouse","jqueryuicore","jqueryuiwidget"],function(e){return function(){var t,n;return t||e.jqueryuidraggable}}(this));if(typeof jQuery=="undefined")throw new Error("Bootstrap requires jQuery");+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(e.style[n]!==undefined)return{end:t[n]}}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one(e.support.transition.end,function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t()})}(jQuery),+function(e){var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.prototype.close=function(t){function s(){i.trigger("closed.bs.alert").remove()}var n=e(this),r=n.attr("data-target");r||(r=n.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));var i=e(r);t&&t.preventDefault(),i.length||(i=n.hasClass("alert")?n:n.parent()),i.trigger(t=e.Event("close.bs.alert"));if(t.isDefaultPrevented())return;i.removeClass("in"),e.support.transition&&i.hasClass("fade")?i.one(e.support.transition.end,s).emulateTransitionEnd(150):s()};var r=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var r=e(this),i=r.data("bs.alert");i||r.data("bs.alert",i=new n(this)),typeof t=="string"&&i[t].call(r)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=r,this},e(document).on("click.bs.alert.data-api",t,n.prototype.close)}(jQuery),+function(e){var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r)};t.DEFAULTS={loadingText:"loading..."},t.prototype.setState=function(e){var t="disabled",n=this.$element,r=n.is("input")?"val":"html",i=n.data();e+="Text",i.resetText||n.data("resetText",n[r]()),n[r](i[e]||this.options[e]),setTimeout(function(){e=="loadingText"?n.addClass(t).attr(t,t):n.removeClass(t).removeAttr(t)},0)},t.prototype.toggle=function(){var e=this.$element.closest('[data-toggle="buttons"]'),t=!0;if(e.length){var n=this.$element.find("input");n.prop("type")==="radio"&&(n.prop("checked")&&this.$element.hasClass("active")?t=!1:e.find(".active").removeClass("active")),t&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}t&&this.$element.toggleClass("active")};var n=e.fn.button;e.fn.button=function(n){return this.each(function(){var r=e(this),i=r.data("bs.button"),s=typeof n=="object"&&n;i||r.data("bs.button",i=new t(this,s)),n=="toggle"?i.toggle():n&&i.setState(n)})},e.fn.button.Constructor=t,e.fn.button.noConflict=function(){return e.fn.button=n,this},e(document).on("click.bs.button.data-api","[data-toggle^=button]",function(t){var n=e(t.target);n.hasClass("btn")||(n=n.closest(".btn")),n.button("toggle"),t.preventDefault()})}(jQuery),+function(e){var t=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,this.options.pause=="hover"&&this.$element.on("mouseenter",e.proxy(this.pause,this)).on("mouseleave",e.proxy(this.cycle,this))};t.DEFAULTS={interval:5e3,pause:"hover",wrap:!0},t.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},t.prototype.getActiveIndex=function(){return this.$active=this.$element.find(".item.active"),this.$items=this.$active.parent().children(),this.$items.index(this.$active)},t.prototype.to=function(t){var n=this,r=this.getActiveIndex();if(t>this.$items.length-1||t<0)return;return this.sliding?this.$element.one("slid.bs.carousel",function(){n.to(t)}):r==t?this.pause().cycle():this.slide(t>r?"next":"prev",e(this.$items[t]))},t.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition.end&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},t.prototype.next=function(){if(this.sliding)return;return this.slide("next")},t.prototype.prev=function(){if(this.sliding)return;return this.slide("prev")},t.prototype.slide=function(t,n){var r=this.$element.find(".item.active"),i=n||r[t](),s=this.interval,o=t=="next"?"left":"right",u=t=="next"?"first":"last",a=this;if(!i.length){if(!this.options.wrap)return;i=this.$element.find(".item")[u]()}this.sliding=!0,s&&this.pause();var f=e.Event("slide.bs.carousel",{relatedTarget:i[0],direction:o});if(i.hasClass("active"))return;this.$indicators.length&&(this.$indicators.find(".active").removeClass("active"),this.$element.one("slid.bs.carousel",function(){var t=e(a.$indicators.children()[a.getActiveIndex()]);t&&t.addClass("active")}));if(e.support.transition&&this.$element.hasClass("slide")){this.$element.trigger(f);if(f.isDefaultPrevented())return;i.addClass(t),i[0].offsetWidth,r.addClass(o),i.addClass(o),r.one(e.support.transition.end,function(){i.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),a.sliding=!1,setTimeout(function(){a.$element.trigger("slid.bs.carousel")},0)}).emulateTransitionEnd(600)}else{this.$element.trigger(f);if(f.isDefaultPrevented())return;r.removeClass("active"),i.addClass("active"),this.sliding=!1,this.$element.trigger("slid.bs.carousel")}return s&&this.cycle(),this};var n=e.fn.carousel;e.fn.carousel=function(n){return this.each(function(){var r=e(this),i=r.data("bs.carousel"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n),o=typeof n=="string"?n:s.slide;i||r.data("bs.carousel",i=new t(this,s)),typeof n=="number"?i.to(n):o?i[o]():s.interval&&i.pause().cycle()})},e.fn.carousel.Constructor=t,e.fn.carousel.noConflict=function(){return e.fn.carousel=n,this},e(document).on("click.bs.carousel.data-api","[data-slide], [data-slide-to]",function(t){var n=e(this),r,i=e(n.attr("data-target")||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,"")),s=e.extend({},i.data(),n.data()),o=n.attr("data-slide-to");o&&(s.interval=!1),i.carousel(s),(o=n.attr("data-slide-to"))&&i.data("bs.carousel").to(o),t.preventDefault()}),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var t=e(this);t.carousel(t.data())})})}(jQuery),+function(e){var t=function(n,r){this.$element=e(n),this.options=e.extend({},t.DEFAULTS,r),this.transitioning=null,this.options.parent&&(this.$parent=e(this.options.parent)),this.options.toggle&&this.toggle()};t.DEFAULTS={toggle:!0},t.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},t.prototype.show=function(){if(this.transitioning||this.$element.hasClass("in"))return;var t=e.Event("show.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.$parent&&this.$parent.find("> .panel > .in");if(n&&n.length){var r=n.data("bs.collapse");if(r&&r.transitioning)return;n.collapse("hide"),r||n.data("bs.collapse",null)}var i=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[i](0),this.transitioning=1;var s=function(){this.$element.removeClass("collapsing").addClass("in")[i]("auto"),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return s.call(this);var o=e.camelCase(["scroll",i].join("-"));this.$element.one(e.support.transition.end,e.proxy(s,this)).emulateTransitionEnd(350)[i](this.$element[0][o])},t.prototype.hide=function(){if(this.transitioning||!this.$element.hasClass("in"))return;var t=e.Event("hide.bs.collapse");this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse").removeClass("in"),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.trigger("hidden.bs.collapse").removeClass("collapsing").addClass("collapse")};if(!e.support.transition)return r.call(this);this.$element[n](0).one(e.support.transition.end,e.proxy(r,this)).emulateTransitionEnd(350)},t.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()};var n=e.fn.collapse;e.fn.collapse=function(n){return this.each(function(){var r=e(this),i=r.data("bs.collapse"),s=e.extend({},t.DEFAULTS,r.data(),typeof n=="object"&&n);i||r.data("bs.collapse",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.collapse.Constructor=t,e.fn.collapse.noConflict=function(){return e.fn.collapse=n,this},e(document).on("click.bs.collapse.data-api","[data-toggle=collapse]",function(t){var n=e(this),r,i=n.attr("data-target")||t.preventDefault()||(r=n.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""),s=e(i),o=s.data("bs.collapse"),u=o?"toggle":n.data(),a=n.attr("data-parent"),f=a&&e(a);if(!o||!o.transitioning)f&&f.find('[data-toggle=collapse][data-parent="'+a+'"]').not(n).addClass("collapsed"),n[s.hasClass("in")?"addClass":"removeClass"]("collapsed");s.collapse(u)})}(jQuery),+function(e){function i(){e(t).remove(),e(n).each(function(t){var n=s(e(this));if(!n.hasClass("open"))return;n.trigger(t=e.Event("hide.bs.dropdown"));if(t.isDefaultPrevented())return;n.removeClass("open").trigger("hidden.bs.dropdown")})}function s(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}var t=".dropdown-backdrop",n="[data-toggle=dropdown]",r=function(t){e(t).on("click.bs.dropdown",this.toggle)};r.prototype.toggle=function(t){var n=e(this);if(n.is(".disabled, :disabled"))return;var r=s(n),o=r.hasClass("open");i();if(!o){"ontouchstart"in document.documentElement&&!r.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",i),r.trigger(t=e.Event("show.bs.dropdown"));if(t.isDefaultPrevented())return;r.toggleClass("open").trigger("shown.bs.dropdown"),n.focus()}return!1},r.prototype.keydown=function(t){if(!/(38|40|27)/.test(t.keyCode))return;var r=e(this);t.preventDefault(),t.stopPropagation();if(r.is(".disabled, :disabled"))return;var i=s(r),o=i.hasClass("open");if(!o||o&&t.keyCode==27)return t.which==27&&i.find(n).focus(),r.click();var u=e("[role=menu] li:not(.divider):visible a",i);if(!u.length)return;var a=u.index(u.filter(":focus"));t.keyCode==38&&a>0&&a--,t.keyCode==40&&a<u.length-1&&a++,~a||(a=0),u.eq(a).focus()};var o=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new r(this)),typeof t=="string"&&i[t].call(n)})},e.fn.dropdown.Constructor=r,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=o,this},e(document).on("click.bs.dropdown.data-api",i).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",n,r.prototype.toggle).on("keydown.bs.dropdown.data-api",n+", [role=menu]",r.prototype.keydown)}(jQuery),+function(e){var t=function(t,n){this.options=n,this.$element=e(t),this.$backdrop=this.isShown=null,this.options.remote&&this.$element.load(this.options.remote)};t.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},t.prototype.toggle=function(e){return this[this.isShown?"hide":"show"](e)},t.prototype.show=function(t){var n=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r);if(this.isShown||r.isDefaultPrevented())return;this.isShown=!0,this.escape(),this.$element.on("click.dismiss.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var r=e.support.transition&&n.$element.hasClass("fade");n.$element.parent().length||n.$element.appendTo(document.body),n.$element.show(),r&&n.$element[0].offsetWidth,n.$element.addClass("in").attr("aria-hidden",!1),n.enforceFocus();var i=e.Event("shown.bs.modal",{relatedTarget:t});r?n.$element.find(".modal-dialog").one(e.support.transition.end,function(){n.$element.focus().trigger(i)}).emulateTransitionEnd(300):n.$element.focus().trigger(i)})},t.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t);if(!this.isShown||t.isDefaultPrevented())return;this.isShown=!1,this.escape(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one(e.support.transition.end,e.proxy(this.hideModal,this)).emulateTransitionEnd(300):this.hideModal()},t.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]!==e.target&&!this.$element.has(e.target).length&&this.$element.focus()},this))},t.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.bs.modal",e.proxy(function(e){e.which==27&&this.hide()},this)):this.isShown||this.$element.off("keyup.dismiss.bs.modal")},t.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.removeBackdrop(),e.$element.trigger("hidden.bs.modal")})},t.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},t.prototype.backdrop=function(t){var n=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var i=e.support.transition&&r;this.$backdrop=e('<div class="modal-backdrop '+r+'" />').appendTo(document.body),this.$element.on("click.dismiss.modal",e.proxy(function(e){if(e.target!==e.currentTarget)return;this.options.backdrop=="static"?this.$element[0].focus.call(this.$element[0]):this.hide.call(this)},this)),i&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in");if(!t)return;i?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(e.support.transition.end,t).emulateTransitionEnd(150):t()):t&&t()};var n=e.fn.modal;e.fn.modal=function(n,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},t.DEFAULTS,i.data(),typeof n=="object"&&n);s||i.data("bs.modal",s=new t(this,o)),typeof n=="string"?s[n](r):o.show&&s.show(r)})},e.fn.modal.Constructor=t,e.fn.modal.noConflict=function(){return e.fn.modal=n,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(t){var n=e(this),r=n.attr("href"),i=e(n.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=i.data("modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},i.data(),n.data());t.preventDefault(),i.modal(s,this).one("hide",function(){n.is(":visible")&&n.focus()})}),e(document).on("show.bs.modal",".modal",function(){e(document.body).addClass("modal-open")}).on("hidden.bs.modal",".modal",function(){e(document.body).removeClass("modal-open")})}(jQuery),+function(e){var t=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1},t.prototype.init=function(t,n,r){this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r);var i=this.options.trigger.split(" ");for(var s=i.length;s--;){var o=i[s];if(o=="click")this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if(o!="manual"){var u=o=="hover"?"mouseenter":"focus",a=o=="hover"?"mouseleave":"blur";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(a+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&typeof t.delay=="number"&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},t.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(n.timeout),n.hoverState="in";if(!n.options.delay||!n.options.delay.show)return n.show();n.timeout=setTimeout(function(){n.hoverState=="in"&&n.show()},n.options.delay.show)},t.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type);clearTimeout(n.timeout),n.hoverState="out";if(!n.options.delay||!n.options.delay.hide)return n.hide();n.timeout=setTimeout(function(){n.hoverState=="out"&&n.hide()},n.options.delay.hide)},t.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);if(t.isDefaultPrevented())return;var n=this.tip();this.setContent(),this.options.animation&&n.addClass("fade");var r=typeof this.options.placement=="function"?this.options.placement.call(this,n[0],this.$element[0]):this.options.placement,i=/\s?auto?\s?/i,s=i.test(r);s&&(r=r.replace(i,"")||"top"),n.detach().css({top:0,left:0,display:"block"}).addClass(r),this.options.container?n.appendTo(this.options.container):n.insertAfter(this.$element);var o=this.getPosition(),u=n[0].offsetWidth,a=n[0].offsetHeight;if(s){var f=this.$element.parent(),l=r,c=document.documentElement.scrollTop||document.body.scrollTop,h=this.options.container=="body"?window.innerWidth:f.outerWidth(),p=this.options.container=="body"?window.innerHeight:f.outerHeight(),d=this.options.container=="body"?0:f.offset().left;r=r=="bottom"&&o.top+o.height+a-c>p?"top":r=="top"&&o.top-c-a<0?"bottom":r=="right"&&o.right+u>h?"left":r=="left"&&o.left-u<d?"right":r,n.removeClass(l).addClass(r)}var v=this.getCalculatedOffset(r,o,u,a);this.applyPlacement(v,r),this.$element.trigger("shown.bs."+this.type)}},t.prototype.applyPlacement=function(e,t){var n,r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),e.top=e.top+o,e.left=e.left+u,r.offset(e).addClass("in");var a=r[0].offsetWidth,f=r[0].offsetHeight;t=="top"&&f!=s&&(n=!0,e.top=e.top+s-f);if(/bottom|top/.test(t)){var l=0;e.left<0&&(l=e.left*-2,e.left=0,r.offset(e),a=r[0].offsetWidth,f=r[0].offsetHeight),this.replaceArrow(l-i+a,a,"left")}else this.replaceArrow(f-s,f,"top");n&&r.offset(e)},t.prototype.replaceArrow=function(e,t,n){this.arrow().css(n,e?50*(1-e/t)+"%":"")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(){function i(){t.hoverState!="in"&&n.detach()}var t=this,n=this.tip(),r=e.Event("hide.bs."+this.type);this.$element.trigger(r);if(r.isDefaultPrevented())return;return n.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?n.one(e.support.transition.end,i).emulateTransitionEnd(150):i(),this.$element.trigger("hidden.bs."+this.type),this},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||typeof e.attr("data-original-title")!="string")&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(){var t=this.$element[0];return e.extend({},typeof t.getBoundingClientRect=="function"?t.getBoundingClientRect():{width:t.offsetWidth,height:t.offsetHeight},this.$element.offset())},t.prototype.getCalculatedOffset=function(e,t,n,r){return e=="bottom"?{top:t.top+t.height,left:t.left+t.width/2-n/2}:e=="top"?{top:t.top-r,left:t.left+t.width/2-n/2}:e=="left"?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},t.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||(typeof n.title=="function"?n.title.call(t[0]):n.title),e},t.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.validate=function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var n=t?e(t.currentTarget)[this.type](this.getDelegateOptions()).data("bs."+this.type):this;n.tip().hasClass("in")?n.leave(n):n.enter(n)},t.prototype.destroy=function(){this.hide().$element.off("."+this.type).removeData("bs."+this.type)};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s=typeof n=="object"&&n;i||r.data("bs.tooltip",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(jQuery),+function(e){var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content")[this.options.html?"html":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||(typeof t.content=="function"?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},t.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var r=e(this),i=r.data("bs.popover"),s=typeof n=="object"&&n;i||r.data("bs.popover",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(jQuery),+function(e){function t(n,r){var i,s=e.proxy(this.process,this);this.$element=e(n).is("body")?e(window):e(n),this.$body=e("body"),this.$scrollElement=this.$element.on("scroll.bs.scroll-spy.data-api",s),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||(i=e(n).attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,"")||"")+" .nav li > a",this.offsets=e([]),this.targets=e([]),this.activeTarget=null,this.refresh(),this.process()}t.DEFAULTS={offset:10},t.prototype.refresh=function(){var t=this.$element[0]==window?"offset":"position";this.offsets=e([]),this.targets=e([]);var n=this,r=this.$body.find(this.selector).map(function(){var r=e(this),i=r.data("target")||r.attr("href"),s=/^#\w/.test(i)&&e(i);return s&&s.length&&[[s[t]().top+(!e.isWindow(n.$scrollElement.get(0))&&n.$scrollElement.scrollTop()),i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){n.offsets.push(this[0]),n.targets.push(this[1])})},t.prototype.process=function(){var e=this.$scrollElement.scrollTop()+this.options.offset,t=this.$scrollElement[0].scrollHeight||this.$body[0].scrollHeight,n=t-this.$scrollElement.height(),r=this.offsets,i=this.targets,s=this.activeTarget,o;if(e>=n)return s!=(o=i.last()[0])&&this.activate(o);for(o=r.length;o--;)s!=i[o]&&e>=r[o]&&(!r[o+1]||e<=r[o+1])&&this.activate(i[o])},t.prototype.activate=function(t){this.activeTarget=t,e(this.selector).parents(".active").removeClass("active");var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',r=e(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.bs.scrollspy")};var n=e.fn.scrollspy;e.fn.scrollspy=function(n){return this.each(function(){var r=e(this),i=r.data("bs.scrollspy"),s=typeof n=="object"&&n;i||r.data("bs.scrollspy",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=n,this},e(window).on("load",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);t.scrollspy(t.data())})})}(jQuery),+function(e){var t=function(t){this.element=e(t)};t.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,""));if(t.parent("li").hasClass("active"))return;var i=n.find(".active:last a")[0],s=e.Event("show.bs.tab",{relatedTarget:i});t.trigger(s);if(s.isDefaultPrevented())return;var o=e(r);this.activate(t.parent("li"),n),this.activate(o,o.parent(),function(){t.trigger({type:"shown.bs.tab",relatedTarget:i})})},t.prototype.activate=function(t,n,r){function o(){i.removeClass("active").find("> .dropdown-menu > .active").removeClass("active"),t.addClass("active"),s?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active"),r&&r()}var i=n.find("> .active"),s=r&&e.support.transition&&i.hasClass("fade");s?i.one(e.support.transition.end,o).emulateTransitionEnd(150):o(),i.removeClass("in")};var n=e.fn.tab;e.fn.tab=function(n){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new t(this)),typeof n=="string"&&i[n]()})},e.fn.tab.Constructor=t,e.fn.tab.noConflict=function(){return e.fn.tab=n,this},e(document).on("click.bs.tab.data-api",'[data-toggle="tab"], [data-toggle="pill"]',function(t){t.preventDefault(),e(this).tab("show")})}(jQuery),+function(e){var t=function(n,r){this.options=e.extend({},t.DEFAULTS,r),this.$window=e(window).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(n),this.affixed=this.unpin=null,this.checkPosition()};t.RESET="affix affix-top affix-bottom",t.DEFAULTS={offset:0},t.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},t.prototype.checkPosition=function(){if(!this.$element.is(":visible"))return;var n=e(document).height(),r=this.$window.scrollTop(),i=this.$element.offset(),s=this.options.offset,o=s.top,u=s.bottom;typeof s!="object"&&(u=o=s),typeof o=="function"&&(o=s.top()),typeof u=="function"&&(u=s.bottom());var a=this.unpin!=null&&r+this.unpin<=i.top?!1:u!=null&&i.top+this.$element.height()>=n-u?"bottom":o!=null&&r<=o?"top":!1;if(this.affixed===a)return;this.unpin&&this.$element.css("top",""),this.affixed=a,this.unpin=a=="bottom"?i.top-r:null,this.$element.removeClass(t.RESET).addClass("affix"+(a?"-"+a:"")),a=="bottom"&&this.$element.offset({top:document.body.offsetHeight-u-this.$element.height()})};var n=e.fn.affix;e.fn.affix=function(n){return this.each(function(){var r=e(this),i=r.data("bs.affix"),s=typeof n=="object"&&n;i||r.data("bs.affix",i=new t(this,s)),typeof n=="string"&&i[n]()})},e.fn.affix.Constructor=t,e.fn.affix.noConflict=function(){return e.fn.affix=n,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var t=e(this),n=t.data();n.offset=n.offset||{},n.offsetBottom&&(n.offset.bottom=n.offsetBottom),n.offsetTop&&(n.offset.top=n.offsetTop),t.affix(n)})})}(jQuery),define("bootstrap",["jquery"],function(e){return function(){var t,n;return t||e.bootstrap}}(this)),define("BaseNodeView",["backbone","jqueryuidraggable","bootstrap"],function(e,t,n){return e.View.extend({tagName:"div",className:"node",template:_.template($("#node-template").html()),portHeight:29,events:{"mousedown .node-port-output":"beginPortConnection","mouseup .node-port-input":"endPortConnection","mousedown .node-port-input":"beginPortDisconnection",click:"selectThis","change .use-default-checkbox":"useDefaultClick","click .toggle-vis":"toggleGeomVis","click .rep-type":"replicationClick"},initialize:function(e){this.workspace=e.workspace,this.workspaceView=e.workspaceView,this.listenTo(this.model,"requestRender",this.render),this.listenTo(this.model,"requestRender",this.renderKick),this.listenTo(this.model,"change:position",this.move),this.listenTo(this.model,"change:lastValue",this.renderLastValue),this.listenTo(this.model,"change:failureMessage",this.renderLastValue),this.listenTo(this.model,"change:ignoreDefaults",this.colorPorts),this.listenTo(this.model,"connection",this.colorPorts),this.listenTo(this.model,"disconnection",this.colorPorts),this.listenTo(this.model,"change:selected",this.colorSelected),this.listenTo(this.model,"change:visible",this.render),this.listenTo(this.model,"change:isEvaluating",this.colorEvaluating),this.model.on("evalFailed",this.onEvalFailed,this),this.model.on("evalBegin",this.onEvalBegin,this),this.makeDraggable(),this.$workspace_canvas=$("#workspace_canvas"),this.position=this.model.get("position")},renderKick:function(){console.log(this.model)},onEvalFailed:function(e){this.$el.addClass("node-failed"),this.model.set("failureMessage",e)},onEvalBegin:function(){this.$el.removeClass("node-failed")},useDefaultClick:function(e){var t=parseInt($(e.currentTarget).attr("data-index")),n=JSON.parse(JSON.stringify(this.model.get("ignoreDefaults")));n[t]=!$(e.target).is(":checked");var r={property:"ignoreDefaults",_id:this.model.get("_id"),newValue:n};this.model.workspace.setNodeProperty(r),this.model.workspace.run()},replicationClick:function(e){var t={property:"replication",_id:this.model.get("_id"),newValue:$(e.target).attr("data-rep-type")};this.model.workspace.setNodeProperty(t),this.model.workspace.run()},toggleGeomVis:function(e){this.model.set("visible",!this.model.get("visible")),e.stopPropagation()},makeDraggable:function(){var e=this;this.initPos=[],this.$el.draggable({drag:function(t,n){var r=1/e.workspace.get("zoom");n.position.left=r*n.position.left,n.position.top=r*n.position.top,e.workspace.get("nodes").moveSelected([n.position.left-e.initPos[0],n.position.top-e.initPos[1]],e),e.model.set("position",[n.position.left,n.position.top])},start:function(t){e.model.get("selected")||e.model.workspace.get("nodes").deselectAll(),e.model.set("selected",!0),e.workspace.get("nodes").startDragging(e);var n=1/e.model.workspace.get("zoom"),r=e.model.get("position");e.initPos=[r[0],r[1]]},stop:function(){var t=[e.initPos[0],e.initPos[1]],n=e.model.get("position"),r=[n[0],n[1]],i={property:"position",_id:e.model.get("_id"),oldValue:t,newValue:r};e.model.workspace.setNodeProperty(i)}}),this.$el.css("position","absolute")},beginPortDisconnection:function(e){var t=parseInt($(e.currentTarget).attr("data-index"));if(!this.model.isPortConnected(t,!1))return;var n=this.model.get("inputConnections"),r=n[t][0],i=r.getOpposite(this.model);this.workspace.startProxyConnection(i.node.get("_id"),i.portIndex,this.getPortPosition(t,!1)),this.workspace.removeConnection(r.toJSON()),e.stopPropagation()},endPortConnection:function(e){if(!this.workspace.draggingProxy)return;var t=parseInt($(e.currentTarget).attr("data-index"));this.workspace.completeProxyConnection(this.model.get("_id"),t),e.stopPropagation()},beginPortConnection:function(e){var t=parseInt($(e.currentTarget).attr("data-index"));this.workspace.startProxyConnection(this.model.get("_id"),t,this.getPortPosition(t,!0)),e.stopPropagation()},select:function(){this.model.set("selected",!0)},selectable:!0,selectThis:function(e){if(!this.selectable)return;this.model.get("selected")?this.workspace.get("nodes").deselectAll():(e.shiftKey||this.workspace.get("nodes").deselectAll(),this.model.set("selected",!0))},render:function(){return this.renderNode().colorSelected().colorEvaluating().moveNode().renderPorts(),this},renderNode:function(){var e=this.model.toJSON();return e.preview=this.formatPreview(e.lastValue),this.$el.html(this.template(e)),this.getCustomContents&&this.$el.find(".node-data-container").html(this.getCustomContents()),this},truncatePreview:function(e,t){if(typeof e=="string")return e;if(!e||e.length===undefined||e.length<100)return e;t===undefined&&(t=20);var n={},r=0;for(var i in e){if(r>t)break;n[i]=e[i],r++}return n.length=e.length,n},formatPreview:function(e){var t=this;return JSON.stringify(this.truncatePreview(e),function(e,n){return t.prettyPrint.call(t,e,n)})},prettyPrint:function(e,t){return typeof t=="number"?t.toPrecision(4):typeof t=="string"?t.replace(new RegExp("	","g"),"").replace(new RegExp("\n","g"),""):t&&t.length!=undefined&&t.length>100?this.truncatePreview(t):t},renderLastValue:function(){return this.renderNode()},colorEvaluating:function(){return this.model.get("isEvaluating")?this.$el.addClass("node-evaluating"):this.$el.removeClass("node-evaluating"),this},colorSelected:function(){return this.model.get("selected")?this.$el.addClass("node-selected"):this.$el.removeClass("node-selected"),this},svgTransform:function(){return"translate("+this.position[0]+" "+this.position[1]+")"},getPortPosition:function(e,t){var n=this.position[0],r=this.position[1];if(t)try{n+=parseInt(this.outputPorts[e].getAttribute("cx"))+5,r+=parseInt(this.outputPorts[e].getAttribute("cy"))}catch(i){}else try{n+=parseInt(this.inputPorts[e].getAttribute("cx"))-5,r+=parseInt(this.inputPorts[e].getAttribute("cy"))}catch(i){}return[n,r]},colorPorts:function(){var e=this,t=!1;return this.inputPorts.forEach(function(n,r){n.setAttribute("stroke","black"),e.model.isPortConnected(r,!1)?n.setAttribute("fill","black"):e.model.isInputPortUsingDefault(r)?n.setAttribute("fill","white"):(t=!0,n.setAttribute("fill","grey"),n.setAttribute("stroke","white"))}),this.outputPorts.forEach(function(n,r){n.setAttribute("stroke","black"),e.model.isPortConnected(r,!0)?n.setAttribute("fill","black"):t?(n.setAttribute("fill","grey"),n.setAttribute("stroke","white")):n.setAttribute("fill","white")}),this},move:function(){return this.moveNode().movePorts()},moveNode:function(){var e=this.model.get("position");return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),this.position=e,this.$el.css("left",this.position[0]),this.$el.css("top",this.position[1]),this},movePorts:function(){return this.portGroup&&this.portGroup.setAttribute("transform",this.svgTransform()),this},renderPorts:function(){this.portGroup?$(this.portGroup).empty():(this.portGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.portGroup.setAttribute("transform",this.svgTransform())),this.inputPorts=[],this.outputPorts=[];var e=this,t=0,n=0,r=1,i=this.$el.parent().css("transform");return i!="none"&&(r=i.match(/-?[0-9\.]+/g)[0]),this.$el.find(".node-port").each(function(i,s){var o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("r",3),o.setAttribute("stroke","black"),o.setAttribute("fill","white"),o.setAttribute("stroke-width","1.5"),$(s).hasClass("node-port-input")?(o.setAttribute("cx",0),o.setAttribute("cy",e.portHeight/2+1/r*$(s).position().top),e.inputPorts.push(o),t++):(o.setAttribute("cx",e.$el.width()+2.5),o.setAttribute("cy",e.portHeight/2+1/r*$(s).position().top),e.outputPorts.push(o),n++),e.portGroup.appendChild(o)}),this.colorPorts(),this},remove:function(){this.$el.remove(),this.portGroup.parentNode&&this.portGroup.parentNode.removeChild(this.portGroup)}})}),define("WatchNodeView",["backbone","underscore","jquery","BaseNodeView"],function(e,t,n,r){return r.extend({template:t.template(n("#node-watch-template").html()),initialize:function(e){r.prototype.initialize.apply(this,arguments),this.model.on("change:lastValue",this.renderNode,this),this.model.on("disconnection",this.renderNode,this)},renderNode:function(){var e=this.model.get("lastValue")!=undefined?JSON.stringify(this.model.get("lastValue"),this.prettyPrint,2):this.model.get("lastValue");return this.model.set("prettyValue",e),r.prototype.renderNode.apply(this,arguments)},prettyPrint:function(e,t){return typeof t=="number"?t.toPrecision(4):typeof t=="string"?t.replace(new RegExp("	","g"),"").replace(new RegExp("\n","g"),"<br>"):t}})}),function(e,t){var n=5;e.widget("ui.slider",e.ui.mouse,{version:"@VERSION",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,n,r=this.options,i=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",o=[];n=r.values&&r.values.length||1,i.length>n&&(i.slice(n).remove(),i=i.slice(0,n));for(t=i.length;t<n;t++)o.push(s);this.handles=i.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,n="";t.range?(t.range===!0&&(t.values?t.values.length&&t.values.length!==2?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),!this.range||!this.range.length?(this.range=e("<div></div>").appendTo(this.element),n="ui-slider-range ui-widget-header ui-corner-all"):this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}),this.range.addClass(n+(t.range==="min"||t.range==="max"?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var n,r,i,s,o,u,a,f,l=this,c=this.options;return c.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),n={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(n),i=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var n=Math.abs(r-l.values(t));if(i>n||i===n&&(t===l._lastChangedValue||l.values(t)===c.min))i=n,s=e(this),o=t}),u=this._start(t,o),u===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,s.addClass("ui-state-active").focus(),a=s.offset(),f=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=f?{left:0,top:0}:{left:t.pageX-a.left-s.width()/2,top:t.pageY-a.top-s.height()/2-(parseInt(s.css("borderTopWidth"),10)||0)-(parseInt(s.css("borderBottomWidth"),10)||0)+(parseInt(s.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},n=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,n),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,n,r,i,s;return this.orientation==="horizontal"?(t=this.elementSize.width,n=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,n=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),r=n/t,r>1&&(r=1),r<0&&(r=0),this.orientation==="vertical"&&(r=1-r),i=this._valueMax()-this._valueMin(),s=this._valueMin()+r*i,this._trimAlignValue(s)},_start:function(e,t){var n={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("start",e,n)},_slide:function(e,t,n){var r,i,s;this.options.values&&this.options.values.length?(r=this.values(t?0:1),this.options.values.length===2&&this.options.range===!0&&(t===0&&n>r||t===1&&n<r)&&(n=r),n!==this.values(t)&&(i=this.values(),i[t]=n,s=this._trigger("slide",e,{handle:this.handles[t],value:n,values:i}),r=this.values(t?0:1),s!==!1&&this.values(t,n,!0))):n!==this.value()&&(s=this._trigger("slide",e,{handle:this.handles[t],value:n}),s!==!1&&this.value(n))},_stop:function(e,t){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._trigger("stop",e,n)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var n={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(n.value=this.values(t),n.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,n)}},value:function(e){if(arguments.length){this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0);return}return this._value()},values:function(t,n){var r,i,s;if(arguments.length>1){this.options.values[t]=this._trimAlignValue(n),this._refreshValue(),this._change(null,t);return}if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();r=this.options.values,i=arguments[0];for(s=0;s<r.length;s+=1)r[s]=this._trimAlignValue(i[s]),this._change(null,s);this._refreshValue()},_setOption:function(t,n){var r,i=0;t==="range"&&this.options.range===!0&&(n==="min"?(this.options.value=this._values(0),this.options.values=null):n==="max"&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(i=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments);switch(t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":this._animateOff=!0,this._refreshValue();for(r=0;r<i;r+=1)this._change(null,r);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e),e},_values:function(e){var t,n,r;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t),t;if(this.options.values&&this.options.values.length){n=this.options.values.slice();for(r=0;r<n.length;r+=1)n[r]=this._trimAlignValue(n[r]);return n}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,n=(e-this._valueMin())%t,r=e-n;return Math.abs(n)*2>=t&&(r+=n>0?t:-t),parseFloat(r.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,n,r,i,s,o=this.options.range,u=this.options,a=this,f=this._animateOff?!1:u.animate,l={};this.options.values&&this.options.values.length?this.handles.each(function(r){n=(a.values(r)-a._valueMin())/(a._valueMax()-a._valueMin())*100,l[a.orientation==="horizontal"?"left":"bottom"]=n+"%",e(this).stop(1,1)[f?"animate":"css"](l,u.animate),a.options.range===!0&&(a.orientation==="horizontal"?(r===0&&a.range.stop(1,1)[f?"animate":"css"]({left:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({width:n-t+"%"},{queue:!1,duration:u.animate})):(r===0&&a.range.stop(1,1)[f?"animate":"css"]({bottom:n+"%"},u.animate),r===1&&a.range[f?"animate":"css"]({height:n-t+"%"},{queue:!1,duration:u.animate}))),t=n}):(r=this.value(),i=this._valueMin(),s=this._valueMax(),n=s!==i?(r-i)/(s-i)*100:0,l[this.orientation==="horizontal"?"left":"bottom"]=n+"%",this.handle.stop(1,1)[f?"animate":"css"](l,u.animate),o==="min"&&this.orientation==="horizontal"&&this.range.stop(1,1)[f?"animate":"css"]({width:n+"%"},u.animate),o==="max"&&this.orientation==="horizontal"&&this.range[f?"animate":"css"]({width:100-n+"%"},{queue:!1,duration:u.animate}),o==="min"&&this.orientation==="vertical"&&this.range.stop(1,1)[f?"animate":"css"]({height:n+"%"},u.animate),o==="max"&&this.orientation==="vertical"&&this.range[f?"animate":"css"]({height:100-n+"%"},{queue:!1,duration:u.animate}))},_handleEvents:{keydown:function(t){var r,i,s,o,u=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:t.preventDefault();if(!this._keySliding){this._keySliding=!0,e(t.target).addClass("ui-state-active"),r=this._start(t,u);if(r===!1)return}}o=this.options.step,this.options.values&&this.options.values.length?i=s=this.values(u):i=s=this.value();switch(t.keyCode){case e.ui.keyCode.HOME:s=this._valueMin();break;case e.ui.keyCode.END:s=this._valueMax();break;case e.ui.keyCode.PAGE_UP:s=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.PAGE_DOWN:s=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/n);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;s=this._trimAlignValue(i+o);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;s=this._trimAlignValue(i-o)}this._slide(t,u,s)},click:function(e){e.preventDefault()},keyup:function(t){var n=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,n),this._change(t,n),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),define("jqueryuislider",["jquery","jqueryuimouse","jqueryuicore","jqueryuiwidget"],function(e){return function(){var t,n;return t||e.jqueryuislider}}(this)),define("NumNodeView",["backbone","underscore","jquery","BaseNodeView","jqueryuislider"],function(e,t,n,r){return r.extend({template:t.template(n("#node-num-template").html()),initialize:function(e){r.prototype.initialize.apply(this,arguments),this.rendered=!1,this.model.on("change:extra",function(){var e=this.model.get("extra");this.silentSyncUI(e),this.model.trigger("updateRunner"),this.model.workspace.trigger("requestRun")},this)},render:function(){r.prototype.render.apply(this,arguments);if(this.rendered)return this;this.slider=this.$el.find(".slider");if(!this.slider)return;var e=this.model.get("extra"),t=e.min!=undefined?e.min:-150,i=e.max!=undefined?e.max:150,s=e.step!=undefined?e.step:.1,o=e.value!=undefined?e.value:0;o===undefined&&(o=this.model.get("lastValue"));var u=this;return this.slider.slider({min:t,max:i,step:s,value:o,change:function(e,t){u.inputSet.call(u,e,t)},slide:function(e,t){u.inputChanged.call(u,e,t)}}),this.currentValueInput=this.$el.find(".currentValue"),this.currentValueInput.val(o),this.currentValueInput.change(function(e){u.valChanged.call(u,e),e.stopPropagation()}),this.minInput=this.$el.find(".num-min"),this.minInput.val(t),this.minInput.change(function(e){u.minChanged.call(u,e),e.stopPropagation()}),this.maxInput=this.$el.find(".num-max"),this.maxInput.val(i),this.maxInput.change(function(e){u.maxChanged.call(u,e),e.stopPropagation()}),this.stepInput=this.$el.find(".num-step"),this.stepInput.val(s),this.stepInput.change(function(e){u.stepChanged.call(u,e),e.stopPropagation()}),n(".dropdown.keep-open").on({"shown.bs.dropdown":function(){u.selectable=!1,u.model.set("selected",!1),n(this).data("closable",!1)},mouseleave:function(){n(this).data("closable",!0)},click:function(){n(this).data("closable",!1)},"hide.bs.dropdown":function(){return n(this).data("closable")&&(u.selectable=!0),n(this).data("closable")}}),this},silentSyncUI:function(e){this.silent=!0,this.currentValueInput.val(e.value),this.setSliderValue(e.value),this.minInput.html(e.min),this.maxInput.html(e.max),this.stepInput.html(e.step),this.silent=!1},currentValue:function(){return this.slider.slider("option","value")},setSliderValue:function(e){return this.slider.slider("option","value",e)},valChanged:function(e){var e=parseFloat(this.currentValueInput.val());if(isNaN(e))return;return this.setSliderValue(e)},minChanged:function(e,t){var n=parseFloat(this.minInput.val());if(isNaN(n))return;this.currentValue<n&&this.setSliderValue(n),this.slider.slider("option","min",n)},maxChanged:function(e){var t=parseFloat(this.maxInput.val());if(isNaN(t))return;this.currentValue>t&&this.setSliderValue(t),this.slider.slider("option","max",t)},stepChanged:function(e){var t=parseFloat(this.stepInput.val());if(isNaN(t))return;this.slider.slider("option","step",t)},inputChanged:function(e,t){var n=t.value;this.$el.find(".currentValue").html(n)},inputSet:function(e,t){if(this.silent)return;var n={value:this.slider.slider("option","value"),min:this.slider.slider("option","min"),step:this.slider.slider("option","step"),max:this.slider.slider("option","max")};this.model.workspace.setNodeProperty({property:"extra",_id:this.model.get("_id"),newValue:n})}})}),define("CSGNodeView",["backbone","underscore","jquery","BaseNodeView"],function(e,t,n,r){return r.extend({initialize:function(e){r.prototype.initialize.apply(this,arguments),this.model.on("change:selected",this.colorSelected,this),this.model.on("change:visible",this.changeVisibility,this),this.model.on("remove",this.onRemove,this),this.model.on("change:prettyLastValue",this.onEvalComplete,this),this.model.workspace.on("change:current",this.changeVisibility,this),this.onEvalComplete()},setMaterials:function(e,t,n){this.threeGeom.traverse(function(r){r instanceof THREE.Mesh?r.material=t:r instanceof THREE.Line?r.material=n:r.material=e}),render()},colorSelected:function(){r.prototype.colorSelected.apply(this,arguments);if(!this.threeGeom||!this.model.get("visible"))return this;if(this.model.get("selected"))var e=new THREE.MeshPhongMaterial({color:6739711}),t=new THREE.ParticleBasicMaterial({color:6739711,size:3,sizeAttenuation:!1}),n=new THREE.LineBasicMaterial({color:6739711});else var e=new THREE.MeshPhongMaterial({color:10066329}),t=new THREE.ParticleBasicMaterial({color:10066329,size:3,sizeAttenuation:!1}),n=new THREE.LineBasicMaterial({color:0});return this.setMaterials(t,e,n),this},formatPreview:function(e){if(e==null||e===undefined)return r.prototype.formatPreview.apply(this,arguments);if(e.length===undefined&&!e.normal&&!e.polygons&&!e.vertices)return r.prototype.formatPreview.apply(this,arguments);if(e.length>0&&!e[0].normal&&!e[0].polygons&&!e[0].vertices)return r.prototype.formatPreview.apply(this,arguments);if(e.normal)return"Plane";if(e.polygons)return"Solid";if(e.vertices)return"Polygon";if(e.length){var t=0,n=0,i=0;for(var s=0;s<e.length;s++)e[s].polygons&&t++,e[s].normal&&i++,e[s].vertices&&n++;var o=t+" Solids",u=n+" Polygons",a=i+" Planes",f=[];return t>0&&f.push(o),i>0&&f.push(a),n>0&&f.push(u),i===0&&t===0&&n===0?"Nothing":f.join(",")}return"Nothing"},onRemove:function(){this.model.workspace.off("change:current",this.changeVisibility,this),scene.remove(this.threeGeom),render()},evaluated:!1,toThreeGeom:function(e){var t=new THREE.Geometry,n;if(!e)return t;if(!e.vertices&&!e.linestrip)return t;if(e.linestrip)return this.addLineStrip(e,t);if(e.vertices&&!e.faces)return this.addPoints(e,t);for(var r=0;r<e.vertices.length;r++){var i=e.vertices[r];t.vertices.push(new THREE.Vector3(i[0],i[1],i[2]))}if(!e.faces)return t;for(var r=0;r<e.faces.length;r++){var s=e.faces[r];n=new THREE.Face3(s[0],s[1],s[2],new THREE.Vector3(s[3][0],s[3][1],s[3][2])),t.faces.push(n)}return t._floodType=0,t},addPoints:function(e,t){for(var n=0;n<e.vertices.length;n++){var r=e.vertices[n];t.vertices.push(new THREE.Vector3(r[0],r[1],r[2]))}return t._floodType=1,t},addLineStrip:function(e,t){for(var n=0;n<e.linestrip.length;n++){var r=e.linestrip[n];t.vertices.push(new THREE.Vector3(r[0],r[1],r[2]))}return t._floodType=2,t},onEvalComplete:function(e,t,n){if(!n&&this.evaluated)return;this.evaluated=!0;var r=this.model.get("prettyLastValue"),i;if(!r)return;r.vertices||r.linestrip?(i=[],i.push(r)):i=r;var s=new THREE.Object3D;this.drawChunked(s,i,function(){this.threeGeom&&scene.remove(this.threeGeom),this.threeGeom=s,scene.add(this.threeGeom),this.changeVisibility()},this)},drawChunked:function(e,t,n,r){var i=0,s=function(){var o=(new Date).getTime();for(;i<t.length&&(new Date).getTime()-o<50;i++){var u=r.toThreeGeom(t[i]);if(r.model.get("selected"))var a=6739711;else var a=10066329;switch(u._floodType){case 0:e.add(new THREE.Mesh(u,new THREE.MeshPhongMaterial({color:a})));break;case 1:e.add(new THREE.ParticleSystem(u,new THREE.ParticleBasicMaterial({color:a,size:3,sizeAttenuation:!1})));break;case 2:e.add(new THREE.Line(u,new THREE.LineBasicMaterial({color:0})))}}i<t.length?setTimeout(s,25):n.call(r)};setTimeout(s,0)},changeVisibility:function(){if(!this.threeGeom)return;!this.model.get("visible")||!this.model.workspace.get("current")?scene.remove(this.threeGeom):this.model.get("visible")&&scene.add(this.threeGeom),render()},renderNode:function(){r.prototype.renderNode.apply(this,arguments),this.$toggleVis=this.$el.find(".toggle-vis"),this.$toggleVis.show();var e=this.$toggleVis.find("i"),t=this.$toggleVis.find("span");return this.model.get("visible")?(e.addClass("icon-eye-open"),e.removeClass("icon-eye-close"),t.html("Hide geometry")):(e.removeClass("icon-eye-open"),e.addClass("icon-eye-close"),t.html("Show geometry")),this}})}),define("FormulaView",["backbone","underscore","jquery","BaseNodeView","FLOOD"],function(e,t,n,r,i){return r.extend({initialize:function(e){r.prototype.initialize.apply(this,arguments),this.model.on("change:extra",this.onChangedExtra,this)},innerTemplate:t.template(n("#node-formula-template").html()),getCustomContents:function(){var e=this.model.toJSON();return e.extra.script||(e.extra.script=this.model.get("type").script),this.innerTemplate(e)},onChangedExtra:function(){var e=this.model.get("extra")||{};e.numInputs!=undefined&&(this.setNumInputConnections(e.numInputs),this.model.get("type").setNumInputs(e.numInputs)),this.render(),this.model.trigger("updateRunner"),this.model.workspace.run()},setNumInputConnections:function(e){if(e===undefined)return;var t=this.model.get("inputConnections"),n=e-t.length;if(n===0)return;if(n>0)for(var r=0;r<n;r++)t.push([]);else for(var r=0;r<-n;r++){var i=this.model.getConnectionAtIndex(t.length-1);i!=null&&this.model.workspace.removeConnection(i),t.pop()}},renderNode:function(){r.prototype.renderNode.apply(this,arguments),this.input=this.$el.find(".formula-text-input");var e=this;return this.input.focus(function(t){e.selectable=!1,e.model.set("selected",!1),t.stopPropagation()}),this.input.blur(function(){var t=JSON.parse(JSON.stringify(e.model.get("extra")));if(t.script===e.input.val())return;t.script=e.input.val(),e.model.workspace.setNodeProperty({property:"extra",_id:e.model.get("_id"),newValue:t}),e.selectable=!0}),this.$el.find(".add-input").click(function(){e.addInput.call(e)}),this.$el.find(".remove-input").click(function(){e.removeInput.call(e)}),this},setNumInputsProperty:function(e){if(e===undefined)return;var t=this.model.get("extra"),n=JSON.parse(JSON.stringify(t));n.numInputs=e,this.model.workspace.setNodeProperty({property:"extra",_id:this.model.get("_id"),newValue:n,oldValue:t})},addInput:function(){var e=this.model.get("type"),t=this.model.get("extra"),n=t.numInputs;n===undefined&&(n=0);if(e.inputs.length===26)return;this.setNumInputsProperty(n+1)},removeInput:function(){var e=this.model.get("type"),t=this.model.get("extra"),n=t.numInputs;n===undefined&&(n=1);if(e.inputs.length===0)return;this.setNumInputsProperty(n-1)}})}),define("OutputView",["backbone","underscore","jquery","BaseNodeView"],function(e,t,n,r){return r.extend({template:t.template(n("#node-output-template").html()),initialize:function(e){r.prototype.initialize.apply(this,arguments),this.model.on("change:extra",function(){var e=this.model.get("extra"),t=e!=undefined?e.name:"";this.silentSyncUI(t),this.model.trigger("updateRunner")},this)},render:function(){r.prototype.render.apply(this,arguments);var e=this,t=this.model.get("extra"),n=t.name!=undefined?t.name:"";return this.inputText=this.$el.find(".text-input"),this.inputText.val(n),this.inputText.change(function(t){e.nameChanged.call(e,t),t.stopPropagation()}),this},nameChanged:function(){this.inputSet(),this.model.workspace.trigger("updateRunner")},silentSyncUI:function(e){this.silent=!0,this.inputText.val(e),this.silent=!1},inputSet:function(e,t){if(this.silent)return;var n={name:this.inputText.val()};this.model.workspace.setNodeProperty({property:"extra",_id:this.model.get("_id"),newValue:n})}})}),define("InputView",["backbone","underscore","jquery","BaseNodeView"],function(e,t,n,r){return r.extend({template:t.template(n("#node-input-template").html()),initialize:function(e){r.prototype.initialize.apply(this,arguments),this.model.on("change:extra",function(){var e=this.model.get("extra"),t=e!=undefined?e.name:"";this.silentSyncUI(t),this.model.trigger("updateRunner")},this)},render:function(){r.prototype.render.apply(this,arguments);var e=this,t=this.model.get("extra"),n=t.name!=undefined?t.name:"";return this.inputText=this.$el.find(".text-input"),this.inputText.val(n),this.inputText.change(function(t){e.nameChanged.call(e,t),t.stopPropagation()}),this},nameChanged:function(){this.inputSet(),this.model.workspace.trigger("updateRunner")},silentSyncUI:function(e){this.silent=!0,this.inputText.val(e),this.silent=!1},inputSet:function(e,t){if(this.silent)return;var n={name:this.inputText.val()};this.model.workspace.setNodeProperty({property:"extra",_id:this.model.get("_id"),newValue:n})}})}),define("NodeViewTypes",["BaseNodeView","WatchNodeView","NumNodeView","CSGNodeView","FormulaView","OutputView","InputView"],function(e,t,n,r,i,s,o){var u={};return u.Base=r,u.Watch=t,u.Number=n,u.Formula=i,u.Input=o,u.Output=s,u}),define("WorkspaceView",["backbone","Workspace","ConnectionView","MarqueeView","NodeViewTypes"],function(e,t,n,r,i){return e.View.extend({tagName:"div",className:"workspace_container row",initialize:function(e){this.nodeViews={},this.connectionViews={},this.app=this.model.app,this.$workspace=$("<div/>",{"class":"workspace"}),this.$workspace_back=$("<div/>",{"class":"workspace_back"}),this.$workspace_canvas=$('<svg class="workspace_canvas" xmlns="http://www.w3.org/2000/svg" version="1.1" />'),this.$el.append(this.$workspace),this.$workspace.append(this.$workspace_back),this.$workspace.append(this.$workspace_canvas);var t=this;this.listenTo(this.model,"change:connections",function(){t.cleanup().renderConnections()}),this.model.on("change:zoom",this.updateZoom,this),this.model.on("change:offset",this.updateOffset,this),this.model.on("change:isRunning",this.renderRunnerStatus,this),this.listenTo(this.model,"change:nodes",function(){t.cleanup().renderNodes()}),this.listenTo(this.model,"change:current",this.onChangeCurrent),this.listenTo(this.model,"startProxyDrag",this.startProxyDrag),this.listenTo(this.model,"endProxyDrag",this.endProxyDrag),this.renderProxyConnection(),this.renderMarquee(),this.renderRunnerStatus()},events:{"mousedown .workspace_back":"deselectAll","mousedown .workspace_back":"startMarqueeDrag","dblclick .workspace_back":"showNodeSearch"},render:function(){return this.cleanup().renderNodes().renderConnections().renderNodes().renderRunnerStatus().updateZoom().updateOffset()},startMarqueeDrag:function(e){this.deselectAll();var t=this.$workspace.offset(),n=this.model.get("zoom"),r=[1/n*(e.pageX-t.left),1/n*(e.pageY-t.top)];this.model.marquee.setStartCorner(r),this.$workspace.bind("mousemove",$.proxy(this.marqueeDrag,this)),this.$workspace.bind("mouseup",$.proxy(this.endMarqueeDrag,this))},endMarqueeDrag:function(e){this.model.marquee.set("hidden",!0),this.$workspace.unbind("mousemove",this.marqueeDrag),this.$workspace.unbind("mouseup",this.endMarqueeDrag)},marqueeDrag:function(e){this.model.marquee.set("hidden",!1);var t=this.$workspace.offset(),n=this.model.get("zoom"),r=[1/n*(e.pageX-t.left),1/n*(e.pageY-t.top)];this.model.marquee.setEndCorner(r),this.doMarqueeSelect()},doMarqueeSelect:function(){var e=this.model.marquee.get("x"),t=this.model.marquee.get("y"),n=this.model.marquee.get("x")+this.model.marquee.get("width"),r=this.model.marquee.get("y")+this.model.marquee.get("height");for(var i in this.nodeViews){var s=this.nodeViews[i],o=s.$el.width(),u=s.$el.height(),a=s.model.get("position"),f=a[0],l=a[1],c=[[f,l],[f+o,l],[f+o,l+u],[f,l+u]],h=!1;c.forEach(function(i){var s=i[0],o=i[1];s<n&&s>e&&o>t&&o<r&&(h=!0)}),h&&!s.model.get("selected")?s.model.set("selected",!0):!h&&s.model.get("selected")&&s.model.set("selected",!1)}},getCenter:function(){var e=this.$el.width(),t=this.$el.height(),n=this.$el.scrollTop(),r=this.$el.scrollLeft(),i=1/this.model.get("zoom");return[r+e/2,n+t/2]},updateZoom:function(){var e=this.getCenter();return this.$workspace.css("transform","scale("+this.model.get("zoom")+")"),this.$workspace.css("transform-origin","0 0"),this.$workspace.css("display","none").height(),this.$workspace.css("display","block"),this},updateOffset:function(){return this},$runnerStatus:undefined,runnerTemplate:_.template($("#workspace-runner-status-template").html()),renderRunnerStatus:function(){return this},showNodeSearch:function(e){this.app.set("showingSearch",!0);var t=this.model.get("zoom"),n=t*(e.offsetX||e.clientX-$(e.target).offset().left),r=t*(e.offsetY||e.clientY-$(e.target).offset().top);this.app.newNodePosition=[n,r]},startProxyDrag:function(e){this.$workspace.bind("mousemove",$.proxy(this.proxyDrag,this)),this.$workspace.bind("mouseup",$.proxy(this.endProxyDrag,this))},endProxyDrag:function(e){this.$workspace.unbind("mousemove",this.proxyDrag),this.$workspace.unbind("mouseup",this.endProxyDrag),this.model.endProxyConnection()},proxyDrag:function(e){var t=this.$workspace.offset(),n=this.model.get("zoom"),r=[1/n*(e.pageX-t.left),1/n*(e.pageY-t.top)];this.model.proxyConnection.set("endProxyPosition",r)},renderProxyConnection:function(){var e=new n({model:this.model.proxyConnection,workspaceView:this,workspace:this.model,isProxy:!0});e.render(),this.$workspace_canvas.prepend(e.el)},renderMarquee:function(){var e=new r({model:this.model.marquee,workspaceView:this,workspace:this.model});e.render(),this.$workspace_canvas.prepend(e.el)},cleanup:function(){return this.clearDeadNodes(),this.clearDeadConnections(),this},renderNodes:function(){var e=this;return this.model.get("nodes").each(function(t){var n=e.nodeViews[t.get("_id")];if(n===undefined){var r=i.Base;i[t.get("typeName")]!=undefined&&(r=i[t.get("typeName")]),n=new r({model:t,workspaceView:e,workspace:e.model}),e.nodeViews[n.model.get("_id")]=n}e.$workspace.prepend(n.$el),n.render(),n.makeDraggable(),n.delegateEvents(),e.$workspace_canvas.append(n.portGroup)}),this},keydownHandler:function(e){var t=e.keyCode===46||e.keyCode===8;if(!e.metaKey&&!e.ctrlKey&&!t)return;if(e.originalEvent.srcElement&&e.originalEvent.srcElement.nodeName==="INPUT")return;if(e.target.nodeName==="INPUT")return;switch(e.keyCode){case 8:return this.model.removeSelected(),e.preventDefault();case 46:return this.model.removeSelected(),e.preventDefault();case 61:case 187:return this.model.zoomIn(),e.preventDefault();case 189:case 173:return this.model.zoomOut(),e.preventDefault();case 67:return this.model.copy(),e.preventDefault();case 86:return this.model.paste(),e.preventDefault();case 88:return this.model.copy(),this.model.removeSelected(),e.preventDefault();case 89:return this.model.redo(),e.preventDefault();case 90:return this.model.undo(),e.preventDefault()}},renderConnections:function(){var e=this;return this.model.get("connections").forEach(function(t){var r=e.connectionViews[t.get("_id")];e.connectionViews[t.get("_id")]===undefined&&(r=new n({model:t,workspaceView:e,workspace:e.model})),r.delegateEvents(),r.el.parentNode||(r.render(),e.$workspace_canvas.prepend(r.el),e.connectionViews[r.model.get("_id")]=r)}),this},clearDeadNodes:function(){for(var e in this.nodeViews)this.model.get("nodes").get(e)===undefined&&(this.nodeViews[e].remove(),delete this.nodeViews[e])},clearDeadConnections:function(){for(var e in this.connectionViews)this.model.get("connections").get(e)===undefined&&(this.connectionViews[e].remove(),delete this.connectionViews[e])},onRemove:function(){this.get("nodes").forEach(function(e){e.onRemove&&e.onRemove()})},deselectAll:function(){this.model.get("nodes").deselectAll()}})}),define("Search",["backbone","Connection"],function(e,t){return e.Model.extend({defaults:{},initialize:function(e,t){}})}),!function(){function e(t,n,r){var i=e.resolve(t);if(null==i){r=r||t,n=n||"root";var s=new Error('Failed to require "'+r+'" from "'+n+'"');throw s.path=r,s.parent=n,s.require=!0,s}var o=e.modules[i];if(!o._resolving&&!o.exports){var u={};u.exports={},u.client=u.component=!0,o._resolving=!0,o.call(this,u.exports,e.relative(i),u),delete o._resolving,o.exports=u.exports}return o.exports}e.modules={},e.aliases={},e.resolve=function(t){"/"===t.charAt(0)&&(t=t.slice(1));for(var n=[t,t+".js",t+".json",t+"/index.js",t+"/index.json"],r=0;r<n.length;r++){var t=n[r];if(e.modules.hasOwnProperty(t))return t;if(e.aliases.hasOwnProperty(t))return e.aliases[t]}},e.normalize=function(e,t){var n=[];if("."!=t.charAt(0))return t;e=e.split("/"),t=t.split("/");for(var r=0;r<t.length;++r)".."==t[r]?e.pop():"."!=t[r]&&""!=t[r]&&n.push(t[r]);return e.concat(n).join("/")},e.register=function(t,n){e.modules[t]=n},e.alias=function(t,n){if(!e.modules.hasOwnProperty(t))throw new Error('Failed to alias "'+t+'", it does not exist');e.aliases[n]=t},e.relative=function(t){function n(e,t){for(var n=e.length;n--;)if(e[n]===t)return n;return-1}function r(n){var i=r.resolve(n);return e(i,t,n)}var i=e.normalize(t,"..");return r.resolve=function(r){var s=r.charAt(0);if("/"==s)return r.slice(1);if("."==s)return e.normalize(i,r);var o=t.split("/"),u=n(o,"deps")+1;return u||(u=0),r=o.slice(0,u+1).join("/")+"/deps/"+r},r.exists=function(t){return e.modules.hasOwnProperty(r.resolve(t))},r},e.register("component-classes/index.js",function(e,t,n){function r(e){if(!e)throw new Error("A DOM element reference is required");this.el=e,this.list=e.classList}var i=t("indexof"),s=/\s+/,o=Object.prototype.toString;n.exports=function(e){return new r(e)},r.prototype.add=function(e){if(this.list)return this.list.add(e),this;var t=this.array(),n=i(t,e);return~n||t.push(e),this.el.className=t.join(" "),this},r.prototype.remove=function(e){if("[object RegExp]"==o.call(e))return this.removeMatching(e);if(this.list)return this.list.remove(e),this;var t=this.array(),n=i(t,e);return~n&&t.splice(n,1),this.el.className=t.join(" "),this},r.prototype.removeMatching=function(e){for(var t=this.array(),n=0;n<t.length;n++)e.test(t[n])&&this.remove(t[n]);return this},r.prototype.toggle=function(e){return this.list?(this.list.toggle(e),this):(this.has(e)?this.remove(e):this.add(e),this)},r.prototype.array=function(){var e=this.el.className.replace(/^\s+|\s+$/g,""),t=e.split(s);return""===t[0]&&t.shift(),t},r.prototype.has=r.prototype.contains=function(e){return this.list?this.list.contains(e):!!~i(this.array(),e)}}),e.register("segmentio-extend/index.js",function(e,t,n){n.exports=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=0;t=n[r];r++)if(t)for(var i in t)e[i]=t[i];return e}}),e.register("component-indexof/index.js",function(e,t,n){n.exports=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}}),e.register("component-event/index.js",function(e){var t=void 0!==window.addEventListener?"addEventListener":"attachEvent",n=void 0!==window.removeEventListener?"removeEventListener":"detachEvent",r="addEventListener"!==t?"on":"";e.bind=function(e,n,i,s){return e[t](r+n,i,s||!1),i},e.unbind=function(e,t,i,s){return e[n](r+t,i,s||!1),i}}),e.register("timoxley-is-collection/index.js",function(e,t,n){function r(e){return"object"==typeof e&&/^\[object (NodeList)\]$/.test(Object.prototype.toString.call(e))&&e.hasOwnProperty("length")&&(0==e.length||"object"==typeof e[0]&&e[0].nodeType>0)}var i=t("type");n.exports=function(e){var t=i(e);if("array"===t)return 1;switch(t){case"arguments":return 2;case"object":if(r(e))return 2;try{if("length"in e&&!e.tagName&&(!e.scrollTo||!e.document)&&!e.apply)return 2}catch(n){};default:return 0}}}),e.register("javve-events/index.js",function(e,t){var n=t("event"),r=t("is-collection");e.bind=function(e,t,i,s){if(r(e)){if(e&&void 0!==e[0])for(var o=0;o<e.length;o++)n.bind(e[o],t,i,s)}else n.bind(e,t,i,s)},e.unbind=function(e,t,i,s){if(r(e)){if(e&&void 0!==e[0])for(var o=0;o<e.length;o++)n.unbind(e[o],t,i,s)}else n.unbind(e,t,i,s)}}),e.register("javve-get-by-class/index.js",function(e,t,n){n.exports=function(){return document.getElementsByClassName?function(e,t,n){return n?e.getElementsByClassName(t)[0]:e.getElementsByClassName(t)}:document.querySelector?function(e,t,n){return n?e.querySelector(t):e.querySelectorAll(t)}:function(e,t,n){var r=[],i="*";null==e&&(e=document);for(var s=e.getElementsByTagName(i),o=s.length,u=new RegExp("(^|\\s)"+t+"(\\s|$)"),a=0,f=0;o>a;a++)if(u.test(s[a].className)){if(n)return s[a];r[f]=s[a],f++}return r}}()}),e.register("javve-get-attribute/index.js",function(e,t,n){n.exports=function(e,t){var n=e.getAttribute&&e.getAttribute(t)||null;if(!n)for(var r=e.attributes,i=r.length,s=0;i>s;s++)void 0!==t[s]&&t[s].nodeName===t&&(n=t[s].nodeValue);return n}}),e.register("javve-natural-sort/index.js",function(e,t,n){n.exports=function(e,t,n){var r,i,s=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,o=/(^[ ]*|[ ]*$)/g,u=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,a=/^0x[0-9a-f]+$/i,f=/^0/,n=n||{},l=function(e){return n.insensitive&&(""+e).toLowerCase()||""+e},c=l(e).replace(o,"")||"",h=l(t).replace(o,"")||"",p=c.replace(s,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),d=h.replace(s,"\0$1\0").replace(/\0$/,"").replace(/^\0/,"").split("\0"),v=parseInt(c.match(a))||1!=p.length&&c.match(u)&&Date.parse(c),m=parseInt(h.match(a))||v&&h.match(u)&&Date.parse(h)||null,g=n.desc?-1:1;if(m){if(m>v)return-1*g;if(v>m)return 1*g}for(var y=0,b=Math.max(p.length,d.length);b>y;y++){if(r=!(p[y]||"").match(f)&&parseFloat(p[y])||p[y]||0,i=!(d[y]||"").match(f)&&parseFloat(d[y])||d[y]||0,isNaN(r)!==isNaN(i))return isNaN(r)?1:-1;if(typeof r!=typeof i&&(r+="",i+=""),i>r)return-1*g;if(r>i)return 1*g}return 0}}),e.register("javve-to-string/index.js",function(e,t,n){n.exports=function(e){return e=void 0===e?"":e,e=null===e?"":e,e=e.toString()}}),e.register("component-type/index.js",function(e,t,n){var r=Object.prototype.toString;n.exports=function(e){switch(r.call(e)){case"[object Function]":return"function";case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object String]":return"string"}return null===e?"null":void 0===e?"undefined":e&&1===e.nodeType?"element":e===Object(e)?"object":typeof e}}),e.register("list.js/index.js",function(e,t,n){!function(e,r){var i=e.document,s=(t("events"),t("get-by-class")),o=t("extend"),u=t("indexof"),a=function(e,n,a){var l,c=this,p=t("./src/item")(c),v=t("./src/add-async")(c),m=t("./src/parse")(c);this.listClass="list",this.searchClass="search",this.sortClass="sort",this.page=200,this.i=1,this.items=[],this.visibleItems=[],this.matchingItems=[],this.searched=!1,this.filtered=!1,this.handlers={updated:[]},this.plugins={},o(this,n),this.listContainer="string"==typeof e?i.getElementById(e):e,this.listContainer&&(this.list=s(this.listContainer,this.listClass,!0),this.templater=t("./src/templater")(c),this.sort=t("./src/sort")(c),this.search=t("./src/search")(c),this.filter=t("./src/filter")(c),l={start:function(e){m(c.list),e!==r&&c.add(e),c.update(),this.plugins()},plugins:function(){for(var e=0;e<c.plugins.length;e++){var t=c.plugins[e];c[t.name]=t,t.init(c)}}},this.add=function(e,t){if(t)return v(e,t),void 0;var n=[],i=!1;e[0]===r&&(e=[e]);for(var s=0,o=e.length;o>s;s++){var u=null;e[s]instanceof p?(u=e[s],u.reload()):(i=c.items.length>c.page?!0:!1,u=new p(e[s],r,i)),c.items.push(u),n.push(u)}return c.update(),n},this.show=function(e,t){return this.i=e,this.page=t,c.update(),c},this.remove=function(e,t,n){for(var r=0,i=0,s=c.items.length;s>i;i++)c.items[i].values()[e]==t&&(c.templater.remove(c.items[i],n),c.items.splice(i,1),s--,i--,r++);return c.update(),r},this.get=function(e,t){for(var n=[],r=0,i=c.items.length;i>r;r++){var s=c.items[r];s.values()[e]==t&&n.push(s)}return n},this.size=function(){return c.items.length},this.clear=function(){return c.templater.clear(),c.items=[],c},this.on=function(e,t){return c.handlers[e].push(t),c},this.off=function(e,t){var n=c.handlers[e],r=u(n,t);return r>-1&&n.splice(r,1),c},this.trigger=function(e){for(var t=c.handlers[e].length;t--;)c.handlers[e][t](c);return c},this.reset={filter:function(){for(var e=c.items,t=e.length;t--;)e[t].filtered=!1;return c},search:function(){for(var e=c.items,t=e.length;t--;)e[t].found=!1;return c}},this.update=function(){var e=c.items,t=e.length;c.visibleItems=[],c.matchingItems=[],c.templater.clear();for(var n=0;t>n;n++)e[n].matching()&&c.matchingItems.length+1>=c.i&&c.visibleItems.length<c.page?(e[n].show(),c.visibleItems.push(e[n]),c.matchingItems.push(e[n])):e[n].matching()?(c.matchingItems.push(e[n]),e[n].hide()):e[n].hide();return c.trigger("updated"),c},l.start(a))};n.exports=a}(window)}),e.register("list.js/src/search.js",function(e,t,n){var r=t("events"),i=t("get-by-class"),s=t("to-string");n.exports=function(e){var t,n,o,u,a={resetList:function(){e.i=1,e.templater.clear(),u=void 0},setOptions:function(e){2==e.length&&e[1]instanceof Array?n=e[1]:2==e.length&&"function"==typeof e[1]?u=e[1]:3==e.length&&(n=e[1],u=e[2])},setColumns:function(){n=void 0===n?a.toArray(e.items[0].values()):n},setSearchString:function(e){e=s(e).toLowerCase(),e=e.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&"),o=e},toArray:function(e){var t=[];for(var n in e)t.push(n);return t}},l={list:function(){for(var t=0,n=e.items.length;n>t;t++)l.item(e.items[t])},item:function(e){e.found=!1;for(var t=0,r=n.length;r>t;t++)if(l.values(e.values(),n[t]))return e.found=!0,void 0},values:function(e,n){return e.hasOwnProperty(n)&&(t=s(e[n]).toLowerCase(),""!==o&&t.search(o)>-1)?!0:!1},reset:function(){e.reset.search(),e.searched=!1}},c=function(t){return e.trigger("searchStart"),a.resetList(),a.setSearchString(t),a.setOptions(arguments),a.setColumns(),""===o?l.reset():(e.searched=!0,u?u(o,n):l.list()),e.update(),e.trigger("searchComplete"),e.visibleItems};return e.handlers.searchStart=e.handlers.searchStart||[],e.handlers.searchComplete=e.handlers.searchComplete||[],r.bind(i(e.listContainer,e.searchClass),"keyup",function(e){var t=e.target||e.srcElement;c(t.value)}),c}}),e.register("list.js/src/sort.js",function(e,t,n){var r,i=t("natural-sort"),s=t("classes"),o=t("events"),u=t("get-by-class"),a=t("get-attribute"),f=function(){for(var e=0,t=r.length;t>e;e++)s(r[e]).remove("asc"),s(r[e]).remove("desc")};n.exports=function(e){var t=function(){var t,n={};if(arguments[0].currentTarget||arguments[0].srcElement){var r,o=arguments[0],u=o.currentTarget||o.srcElement;t=a(u,"data-sort"),s(u).has("desc")?(n.desc=!1,r="asc"):s(u).has("asc")?(n.desc=!0,r="desc"):(n.desc=!1,r="asc"),f(),s(u).add(r)}else t=arguments[0],n=arguments[1]||n;n.insensitive="undefined"==typeof n.insensitive?!0:n.insensitive,n.sortFunction=n.sortFunction||function(e,r){return i(e.values()[t],r.values()[t],n)},e.trigger("sortStart"),e.items.sort(n.sortFunction),e.update(),e.trigger("sortComplete")};return e.handlers.sortStart=e.handlers.sortStart||[],e.handlers.sortComplete=e.handlers.sortComplete||[],r=u(e.listContainer,e.sortClass),o.bind(r,"click",t),t}}),e.register("list.js/src/item.js",function(e,t,n){n.exports=function(e){return function(t,n,r){var i=this;this._values={},this.found=!1,this.filtered=!1;var s=function(t,n,r){if(void 0===n)r?i.values(t,r):i.values(t);else{i.elm=n;var s=e.templater.get(i,t);i.values(s)}};this.values=function(t,n){if(void 0===t)return i._values;for(var r in t)i._values[r]=t[r];n!==!0&&e.templater.set(i,i.values())},this.show=function(){e.templater.show(i)},this.hide=function(){e.templater.hide(i)},this.matching=function(){return e.filtered&&e.searched&&i.found&&i.filtered||e.filtered&&!e.searched&&i.filtered||!e.filtered&&e.searched&&i.found||!e.filtered&&!e.searched},this.visible=function(){return i.elm.parentNode==e.list?!0:!1},s(t,n,r)}}}),e.register("list.js/src/templater.js",function(e,t,n){var r=t("get-by-class"),i=function(e){function t(t){if(void 0===t){for(var n=e.list.childNodes,r=0,i=n.length;i>r;r++)if(void 0===n[r].data)return n[r];return null}if(-1!==t.indexOf("<")){var s=document.createElement("div");return s.innerHTML=t,s.firstChild}return document.getElementById(e.item)}var n=t(e.item),i=this;this.get=function(e,t){i.create(e);for(var n={},s=0,o=t.length;o>s;s++){var u=r(e.elm,t[s],!0);n[t[s]]=u?u.innerHTML:""}return n},this.set=function(e,t){if(!i.create(e))for(var n in t)if(t.hasOwnProperty(n)){var s=r(e.elm,n,!0);s&&("IMG"===s.tagName&&""!==t[n]?s.src=t[n]:s.innerHTML=t[n])}},this.create=function(e){if(void 0!==e.elm)return!1;var t=n.cloneNode(!0);return t.removeAttribute("id"),e.elm=t,i.set(e,e.values()),!0},this.remove=function(t){e.list.removeChild(t.elm)},this.show=function(t){i.create(t),e.list.appendChild(t.elm)},this.hide=function(t){void 0!==t.elm&&t.elm.parentNode===e.list&&e.list.removeChild(t.elm)},this.clear=function(){if(e.list.hasChildNodes())for(;e.list.childNodes.length>=1;)e.list.removeChild(e.list.firstChild)}};n.exports=function(e){return new i(e)}}),e.register("list.js/src/filter.js",function(e,t,n){n.exports=function(e){return e.handlers.filterStart=e.handlers.filterStart||[],e.handlers.filterComplete=e.handlers.filterComplete||[],function(t){if(e.trigger("filterStart"),e.i=1,e.reset.filter(),void 0===t)e.filtered=!1;else{e.filtered=!0;for(var n=e.items,r=0,i=n.length;i>r;r++){var s=n[r];s.filtered=t(s)?!0:!1}}return e.update(),e.trigger("filterComplete"),e.visibleItems}}}),e.register("list.js/src/add-async.js",function(e,t,n){n.exports=function(e){return function(t,n,r){var i=t.splice(0,100);r=r||[],r=r.concat(e.add(i)),t.length>0?setTimeout(function(){addAsync(t,n,r)},10):(e.update(),n(r))}}}),e.register("list.js/src/parse.js",function(e,t,n){n.exports=function(e){var n=t("./item")(e),r=function(e){for(var t=e.childNodes,n=[],r=0,i=t.length;i>r;r++)void 0===t[r].data&&n.push(t[r]);return n},i=function(t,r){for(var i=0,s=t.length;s>i;i++)e.items.push(new n(r,t[i]))},s=function(t,n){var r=t.splice(0,100);i(r,n),t.length>0?setTimeout(function(){init.items.indexAsync(t,n)},10):e.update()};return function(){var t=r(e.list),n=e.valueNames;e.indexAsync?s(t,n):i(t,n)}}}),e.alias("component-classes/index.js","list.js/deps/classes/index.js"),e.alias("component-classes/index.js","classes/index.js"),e.alias("component-indexof/index.js","component-classes/deps/indexof/index.js"),e.alias("segmentio-extend/index.js","list.js/deps/extend/index.js"),e.alias("segmentio-extend/index.js","extend/index.js"),e.alias("component-indexof/index.js","list.js/deps/indexof/index.js"),e.alias("component-indexof/index.js","indexof/index.js"),e.alias("javve-events/index.js","list.js/deps/events/index.js"),e.alias("javve-events/index.js","events/index.js"),e.alias("component-event/index.js","javve-events/deps/event/index.js"),e.alias("timoxley-is-collection/index.js","javve-events/deps/is-collection/index.js"),e.alias("component-type/index.js","timoxley-is-collection/deps/type/index.js"),e.alias("javve-get-by-class/index.js","list.js/deps/get-by-class/index.js"),e.alias("javve-get-by-class/index.js","get-by-class/index.js"),e.alias("javve-get-attribute/index.js","list.js/deps/get-attribute/index.js"),e.alias("javve-get-attribute/index.js","get-attribute/index.js"),e.alias("javve-natural-sort/index.js","list.js/deps/natural-sort/index.js"),e.alias("javve-natural-sort/index.js","natural-sort/index.js"),e.alias("javve-to-string/index.js","list.js/deps/to-string/index.js"),e.alias("javve-to-string/index.js","list.js/deps/to-string/index.js"),e.alias("javve-to-string/index.js","to-string/index.js"),e.alias("javve-to-string/index.js","javve-to-string/index.js"),e.alias("component-type/index.js","list.js/deps/type/index.js"),e.alias("component-type/index.js","type/index.js"),"object"==typeof exports?module.exports=e("list.js"):"function"==typeof define&&define.amd?define("List",[],function(){return e("list.js")}):this.List=e("list.js")}(),define("SearchElementView",["backbone"],function(e){return e.View.extend({tagName:"li",className:"search-element",template:_.template($("#search-element-template").html()),events:{click:"click"},initialize:function(e,t){this.app=t.app,this.appView=t.appView,this.elementClick=t.click},render:function(){this.$el.html(this.template(this.model.toJSON()))},click:function(e){if(!this.elementClick)return;this.elementClick(this)}})}),define("SearchView",["backbone","List","SearchElementView"],function(e,t,n){return e.View.extend({tagName:"div",className:"search-container row",initialize:function(e,t){this.app=t.app,this.app.on("change:showingSearch",this.highlightInput,this),this.app.SearchElements.on("add remove",this.render,this)},template:_.template($("#search-template").html()),events:{"keyup .library-search-input":"searchKeyup"},render:function(e){this.$el.html(this.template(this.model.toJSON())),this.$input=this.$(".library-search-input"),this.$list=this.$(".search-list"),this.$list.empty();var r=this;this.app.SearchElements.forEach(function(e){if(e.name===null)return;var t=new n({model:e},{app:r.app,click:function(e){r.elementClick.call(r,e)}});t.render(),r.$list.append(t.$el)});var i={valueNames:["name"]};this.list=new t(this.el,i)},highlightInput:function(){this.$input.focus().select()},addNode:function(e){this.app.getCurrentWorkspace().addNodeByNameAndPosition(e,this.app.newNodePosition)},elementClick:function(e){this.addNode(e.model.get("name")),this.app.set("showingSearch",!1)},searchKeyup:function(e){if(e.keyCode===13){var t=this.$list.find(".search-element").first().find(".name").first().html();if(t===undefined)return;this.addNode(t),this.app.set("showingSearch",!1)}else e.keyCode===27&&this.app.set("showingSearch",!1)}})}),define("WorkspaceControlsView",["backbone","List","SearchElementView","bootstrap"],function(e,t,n,r){return e.View.extend({tagName:"div",className:"workspace-search",initialize:function(e,t){this.app=t.app,this.appView=t.appView,this.app.SearchElements.on("add remove",this.render,this)},template:_.template($("#workspace-search-template").html()),events:{"keyup .library-search-input":"searchKeyup","focus .library-search-input":"focus","blur .library-search-input":"blur","click #delete-button":"deleteClick","click #undo-button":"undoClick","click #redo-button":"redoClick","click #copy-button":"copyClick","click #paste-button":"pasteClick","click #zoomin-button":"zoominClick","click #zoomout-button":"zoomoutClick","click #zoomreset-button":"zoomresetClick","click #export-button":"exportClick"},render:function(e){this.$el.html(this.template(this.model.toJSON())),this.$input=this.$(".library-search-input"),this.$list=this.$(".search-list"),this.$input.focus(function(){this.select()}),this.$list.empty();var r=this;this.app.SearchElements.forEach(function(e){var t=new n({model:e},{appView:r.appView,app:r.app,click:function(e){r.elementClick.call(r,e)}});t.render(),r.$list.append(t.$el)});var i={valueNames:["name"]};this.list=new t(this.el,i);var s={show:300};this.$el.find("#undo-button").tooltip({title:"Ctrl/Cmd Z",delay:s}),this.$el.find("#redo-button").tooltip({title:"Ctrl/Cmd Y",delay:s}),this.$el.find("#copy-button").tooltip({title:"Ctrl/Cmd C",delay:s}),this.$el.find("#paste-button").tooltip({title:"Ctrl/Cmd V",delay:s}),this.$el.find("#delete-button").tooltip({title:"Backspace/Delete",delay:s}),this.$el.find("#zoomin-button").tooltip({title:"Ctrl/Cmd +",delay:s}),this.$el.find("#zoomout-button").tooltip({title:"Ctrl/Cmd -",delay:s}),this.$el.find("#zoomreset-button").tooltip({title:"Ctrl/Cmd 0",delay:s})},focus:function(e){this.$(".search-list").show(),this.$(".library-search-input").select()},blur:function(e){var t=this;window.setTimeout(function(){t.$(".search-list").hide()},100)},currentWorkspace:function(){return this.app.get("workspaces").get(this.app.get("currentWorkspace"))},deleteClick:function(){this.currentWorkspace().removeSelected()},copyClick:function(){this.currentWorkspace().copy()},pasteClick:function(){this.currentWorkspace().paste()},undoClick:function(){this.currentWorkspace().undo()},redoClick:function(){this.currentWorkspace().redo()},zoomresetClick:function(){this.currentWorkspace().set("zoom",1)},zoominClick:function(){this.currentWorkspace().zoomIn()},zoomoutClick:function(){this.currentWorkspace().zoomOut()},getWorkspaceCenter:function(){var e=this.appView.currentWorkspaceView.$el.width(),t=this.appView.currentWorkspaceView.$el.height(),n=this.appView.currentWorkspaceView.$el.scrollTop(),r=this.appView.currentWorkspaceView.$el.scrollLeft(),i=1/this.currentWorkspace().get("zoom");return[i*(r+e/2),i*(n+t/2)]},addNode:function(e){if(e===undefined)return;this.currentWorkspace().addNodeByNameAndPosition(e,this.getWorkspaceCenter())},objConverter:function(e,t,n){if(!e||!e.vertices||!e.faces)return"";var r="";return t+=1,e.vertices.forEach(function(e){r+="v",r+=" "+e[0],r+=" "+e[1],r+=" "+e[2],r+="\n"}),e.faces.forEach(function(e){r+="f",r+=" "+(t+e[0]),r+=" "+(t+e[1]),r+=" "+(t+e[2]),r+="\n"}),r},stlConverter:function(e,t,n){if(!e||!e.vertices||!e.faces)return"";var r="solid s"+n+"\n";return e.faces.forEach(function(t){var n=e.vertices[t[0]],i=e.vertices[t[1]],s=e.vertices[t[2]],o=t[3];r+="facet normal",r+=" "+o[0],r+=" "+o[1],r+=" "+o[2],r+="\n",r+="	outer loop\n",r+="		vertex",r+=" "+n[0],r+=" "+n[1],r+=" "+n[2],r+="\n",r+="		vertex",r+=" "+i[0],r+=" "+i[1],r+=" "+i[2],r+="\n",r+="		vertex",r+=" "+s[0],r+=" "+s[1],r+=" "+s[2],r+="\n",r+="	endloop\n",r+="	endfacet\n"}),r+="endsolid\n",r},exportClick:function(e){var t=this.getFileFromSelected(this.stlConverter),n=this.currentWorkspace().get("name");this.download(n+".stl",t)},getFileFromSelected:function(e){var t=this.currentWorkspace(),n="",r=0;return t.get("nodes").filter(function(e){return e.get("selected")}).map(function(e){return e.get("prettyLastValue")}).flatten().reduce(function(t,n,i){var s=e(n,r,i)||"";return n&&n.vertices&&n.vertices.length!=undefined&&(r+=n.vertices.length),t+s},n)},download:function(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.click()},elementClick:function(e){this.addNode(e.model.get("name"))},searchKeyup:function(e){if(e.keyCode===13){var t=this.$list.find(".search-element").first().find(".name").first().html();if(t===undefined)return;this.addNode(t)}}})}),define("WorkspaceTabView",["backbone"],function(e){return e.View.extend({tagName:"div",className:"workspace-tab",initialize:function(e){this.app=this.model.app,this.listenTo(this.model,"change",this.render)},template:_.template($("#workspace-tab-template").html()),events:{click:"click","click .remove-button":"remove",mouseover:"showEditButton",mouseout:"hideEditButton","click .edit-button":"startEdit","blur .workspace-name":"endEdit"},render:function(){this.$el.html(this.template(this.model.toJSON())),this.model.get("current")===!0?this.$el.addClass("current-workspace"):this.$el.removeClass("current-workspace"),this.$input=this.$(".workspace-name")},showEditButton:function(){this.$(".edit-button").css("visibility","visible")},startEdit:function(e){this.$input.prop("disabled",!1),this.$input.focus(),this.$input.css("pointer-events","auto"),e.stopPropagation()},endEdit:function(){this.$input.prop("disabled",!0),this.$input.css("pointer-events","none"),this.model.set("name",this.$input.val())},hideEditButton:function(){this.$(".edit-button").css("visibility","hidden")},click:function(e){this.model.app.set("currentWorkspace",this.model.get("_id"))},remove:function(e){this.model.app.get("workspaces").remove(this.model),e.stopPropagation()}})}),define("WorkspaceBrowserElement",["backbone"],function(e){return e.Model.extend({idAttribute:"_id",defaults:{name:"Unnamed Workspace",isPublic:!1,isCustomNode:!1,lastSaved:Date.now()},initialize:function(e,t){}})}),define("WorkspaceBrowserElements",["backbone","WorkspaceBrowserElement"],function(e,t){return e.Collection.extend({url:"/ws",model:t})}),define("WorkspaceBrowser",["backbone","WorkspaceBrowserElements"],function(e,t){return e.Model.extend({defaults:{workspaces:new t},initialize:function(e,t){this.get("workspaces").fetch()},refresh:function(){this.get("workspaces").reset(),this.get("workspaces").fetch()}})}),define("WorkspaceBrowserElementView",["backbone"],function(e){return e.View.extend({tagName:"li",className:"workspace-browser-element",template:_.template($("#workspace-browser-element-template").html()),events:{click:"clickOpen","click .delete-workspace":"clickDelete",mouseenter:"mouseenter",mouseleave:"mouseleave"},initialize:function(e,t){this.app=t.app},render:function(){var e=this.model.toJSON(),t=this.model.get("lastSaved");typeof t=="string"?e.prettyDate=this.prettyDate(new Date(t)):e.prettyDate="Unknown",this.$el.html(this.template(e)),this.$open=this.$el.find(".workspace-browser-element-open")},prettyDate:function(e){var t=((new Date).getTime()-e.getTime())/1e3,n=Math.floor(t/86400);if(isNaN(n)||n<0||n>=31)return;return n==0&&(t<60&&"just now"||t<120&&"1 minute ago"||t<3600&&Math.floor(t/60)+" minutes ago"||t<7200&&"1 hour ago"||t<86400&&Math.floor(t/3600)+" hours ago")||n==1&&"Yesterday"||n<7&&n+" days ago"||n<31&&Math.ceil(n/7)+" weeks ago"},clickOpen:function(e){this.app.openWorkspace(this.model.get("_id"))},clickDelete:function(e){}})}),define("WorkspaceBrowserView",["backbone","WorkspaceBrowserElementView"],function(e,t){return e.View.extend({el:"#workspace-browser",initialize:function(e,t){this.app=t.app,this.model.get("workspaces").on("reset",this.render,this),this.model.get("workspaces").on("add",this.addWorkspaceElement,this),this.model.get("workspaces").on("remove",this.removeWorkspaceElement,this),this.render()},template:_.template($("#workspace-browser-template").html()),events:{"click .workspace-browser-refresh":"refreshClick","click #workspace-browser-header-custom-nodes":"customNodeHeaderClick","click #workspace-browser-header-projects":"projectHeaderClick"},render:function(e){this.$el.html(this.template(this.model.toJSON())),this.contents=this.$el.find("#workspace-browser-contents"),this.customNodes=this.$el.find("#workspace-browser-custom-nodes"),this.customNodes.empty(),this.projects=this.$el.find("#workspace-browser-projects"),this.projects.empty()},refreshClick:function(e){this.model.refresh(),e.stopPropagation()},customNodeHeaderClick:function(e){this.projects.hide(),this.customNodes.show(),$("#workspace-browser-header-custom-nodes").css("bottom","").css("top","40px")},projectHeaderClick:function(e){this.customNodes.hide(),this.projects.show(),$("#workspace-browser-header-custom-nodes").css("bottom","0").css("top","")},addWorkspaceElement:function(e){this.contents||this.render();var n=new t({model:e},{app:this.app});n.render(),e.get("isCustomNode")?this.customNodes.append(n.$el):this.projects.append(n.$el)},removeWorkspaceElement:function(e){if(!this.contents)return;this.contents.find(".workspace-browser-element[data-id*="+e.get("_id")+"]").remove()}})}),define("HelpView",["backbone"],function(e){return e.View.extend({el:"#help",events:{"click .exit-help":"hide","click .enter-help-section":"clickEnterHelpSection","click .exit-all-help":"hide","click .exit-help-section":"clickExitHelpSection"},initialize:function(e,t){this.app=t.app},render:function(){var e=_.template($("#help-section-template").html()),t=this;return this.$el.empty(),this.model.get("sections").forEach(function(n){var r=$("#"+n.targetId);if(!r)return;var i=r.offset(),s=r.height(),o=r.width();n.offset[0]<0&&(o=-10),n.offset[1]<0&&(s=-10,o-=10),n.elementPosition=[i.left+o,i.top+s],t.$el.append(e(n))}),this},getHelpSection:function(e){var t=$(event.target),n=t.attr("data-target-id");return this.$el.find(".help-section[data-target-id='"+n+"']")},clickEnterHelpSection:function(e){var t=this.getHelpSection(e),n=$(event.target);t.fadeIn(),n.fadeOut()},clickExitHelpSection:function(e){var t=this.getHelpSection(e);t.fadeOut()},hide:function(){this.app.set("showingHelp",!1)}})}),define("Help",["backbone"],function(e){return e.Model.extend({defaults:{sections:[{title:"Workspace Tabs",targetId:"add-workspace-button",offset:[5,5],text:"Switch between or add new active workspaces"},{title:"Node Library",targetId:"bottom-search",offset:[5,-110],text:"This is one place where you can add new nodes.  You can also double click to search"},{title:"3D Focus Control",targetId:"workspace_hide",offset:[-170,-100],text:"Toggle between the 3D view and your workspace"},{title:"Workspace Browser",targetId:"workspace-browser-button",offset:[-170,0],text:"You can find all of your past work in the Workspace Browser"},{title:"Export STL",targetId:"export-button",offset:[20,-110],text:"Export your work for 3D printing by selecting nodes and clicking this button"}]}})}),define("LoginView",["backbone"],function(e){return e.View.extend({el:"#login",template:_.template($("#login-template").html()),events:{"submit #login-form":"login","submit #signup-form":"signup","click #logout":"logout","click .exit-login":"hide","click #signup-tab-button":"focusSignup","click #login-tab-button":"focusLogin"},initialize:function(e,t){this.app=t.app,this.model.on("change:showing",this.render,this),this.model.on("change:isLoggedIn",this.render,this),this.model.on("change:failed",this.render,this),this.model.on("change:failureMessage",this.render,this);var n=this;$("#login-button").click(function(){n.tabClick.apply(n)})},rendered:!1,render:function(){this.rendered||(this.$el.html(this.template(this.model.toJSON())),this.rendered=!0);var e=this.$el.find("#login-failure-message");return this.model.get("failed")?(e.html(this.model.get("failureMessage")),e.show()):e.hide(),this.model.get("showing")===!0?this.$el.show():this.$el.hide(),this.renderLoginState(),this},focusSignup:function(e){this.model.set("failed",!1),this.$el.find("#login-tab-button").removeClass("tab-button-hilite"),this.$el.find("#signup-tab-button").addClass("tab-button-hilite"),this.$el.find("#login-form").hide(),this.$el.find("#signup-form").show()},focusLogin:function(e){this.model.set("failed",!1),this.$el.find("#signup-tab-button").removeClass("tab-button-hilite"),this.$el.find("#login-tab-button").addClass("tab-button-hilite"),this.$el.find("#signup-form").hide(),this.$el.find("#login-form").show()},renderLoginState:function(){return this.model.get("isLoggedIn")?($("#login-button").html("Logout"),this.model.hide()):($("#login-button").html("Login"),this.$el.show()),this},tabClick:function(){this.model.get("isLoggedIn")?this.model.logout():this.model.toggle()},signup:function(e){e.preventDefault(),this.model.signup(this.$("#signup-form").serialize())},login:function(e){e.preventDefault(),this.model.login(this.$("#login-form").serialize())}})}),define("AppView",["backbone","App","WorkspaceView","Search","SearchView","WorkspaceControlsView","WorkspaceTabView","Workspace","WorkspaceBrowser","WorkspaceBrowserView","HelpView","Help","LoginView","Login"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){return e.View.extend({el:"#app",initialize:function(){this.listenTo(this.model,"change",this.render),this.$workspace_tabs=this.$("#workspace-tabs"),this.model.get("workspaces").on("add",this.addWorkspaceTab,this),this.model.get("workspaces").on("remove",this.removeWorkspaceTab,this),this.model.on("change:showingSettings",this.viewSettings,this),this.model.on("change:showingFeedback",this.viewFeedback,this),this.model.on("change:showingHelp",this.viewHelp,this),this.model.on("change:showingBrowser",this.viewBrowser,this),this.model.login.on("change:isLoggedIn",this.showHelpOnFirstExperience,this),this.model.login.on("change:showing",this.showHelpOnFirstExperience,this),$(document).bind("keydown",$.proxy(this.keydownHandler,this)),$(document).bind("contextmenu",function(e){return!1})},events:{"click #save-button":"saveClick","click .workspaces_curtain":"endSearch","click #help-button":"showHelp","click #settings-button":"showSettings","click #workspace_hide":"toggleViewer","click #workspace-browser-button":"toggleBrowser","click #add-project-workspace":"newWorkspace","click #add-node-workspace":"newNodeWorkspace","mouseover #add-workspace-button":"showAddWorkspaceSelect","mouseout #add-workspace-button":"hideAddWorkspaceSelect","mouseover #add-workspace-select-element":"showAddWorkspaceSelect","mouseout #add-workspace-select-element":"hideAddWorkspaceSelect"},showHelpOnFirstExperience:function(){var e=this;e.model.login.get("isLoggedIn")&&e.model.get("isFirstExperience")?setTimeout(function(){e.model.set("showingHelp",!0),e.model.set("isFirstExperience",!1)},800):e.model.set("showingHelp",!1)},showAddWorkspaceSelect:function(){$("#add-workspace-select-element").show()},hideAddWorkspaceSelect:function(){$("#add-workspace-select-element").hide()},newWorkspace:function(){this.model.newWorkspace(),this.hideAddWorkspaceSelect()},newNodeWorkspace:function(){this.model.newNodeWorkspace(),this.hideAddWorkspaceSelect()},keydownHandler:function(e){var t=e.keyCode===46||e.keyCode===8;if(!e.metaKey&&!e.ctrlKey&&!t)return;if(e.originalEvent.srcElement&&e.originalEvent.srcElement.nodeName==="INPUT")return;if(e.target.nodeName==="INPUT")return;switch(e.keyCode){case 78:return this.newWorkspace(),e.preventDefault()}this.currentWorkspaceView.keydownHandler(e)},saveClick:function(e){this.model.sync("update",this.model)},endSearch:function(){this.model.set("showingSearch",!1)},toggleBrowser:function(e){this.model.get("showingBrowser")===!0?($(e.currentTarget).removeClass("workspace-browser-button-active"),this.model.set("showingBrowser",!1)):($(e.currentTarget).addClass("workspace-browser-button-active"),this.model.set("showingBrowser",!0))},viewBrowser:function(){this.browserView||(this.browserView=new f({model:new a},{app:this.model}),this.browserView.render()),this.model.get("showingBrowser")===!0?this.browserView.$el.show():this.browserView.$el.hide()},viewHelp:function(){this.helpView||(this.helpView=new l({model:new c},{app:this.model})),this.model.get("showingHelp")===!0?(this.focusWorkspace(),this.helpView.render(),this.helpView.$el.fadeIn()):this.helpView.$el.fadeOut()},viewFeedback:function(){this.feedbackView||(this.feedbackView=new FeedbackView({model:new Feedback},{app:this.model}),this.feedbackView.render()),this.model.get("showingFeedback")===!0?this.feedbackView.$el.fadeIn():this.feedbackView.$el.fadeOut()},showHelp:function(){this.model.set("showingHelp",!0)},hideHelp:function(){this.model.set("showingHelp",!0)},showFeedback:function(){this.model.set("showingFeedback",!0)},hideFeedback:function(){this.model.set("showingFeedback",!0)},showLogin:function(){this.model.set("showingLogin",!0)},showSettings:function(){this.model.showSettings()},showSearch:function(){this.model.get("showingSearch")===!0?(this.$el.find(".workspaces_curtain").css("display","block"),this.searchView===undefined?(this.searchView=new i({model:new r},{app:this.model}),this.searchView.render(),this.$el.find("#workspaces").prepend(this.searchView.$el)):this.searchView.$el.css("display","block"),$(".workspace_container").addClass("blur"),this.searchView.$el.find(".library-search-input").focus()):($(".workspace_container").removeClass("blur"),this.$el.find(".workspaces_curtain").css("display","none"),this.searchView!=undefined&&this.searchView.$el.css("display","none"))},showingHelp:!1,showingBrowser:!1,showingSettings:!1,showingSearch:!1,showingLogin:!1,currentWorkspaceView:null,currentWorkspaceId:null,workspaceTabViews:{},workspaceViews:{},workspaceCounter:1,addWorkspaceTab:function(e){if(this.model.isBackgroundWorkspace(e.id))return;if(this.workspaceTabViews[e.get("_id")]!=undefined)return;var t=new o({model:e});this.workspaceTabViews[e.get("_id")]=t,t.render(),this.$workspace_tabs.append(t.$el)},removeWorkspaceTab:function(e){e.set("current",!1);if(e.get("_id")==this.model.get("currentWorkspace"))if(this.model.get("workspaces").length!=0)this.model.set("currentWorkspace",this.model.get("workspaces").first().get("_id"));else{var t=this;this.newWorkspace()}this.workspaceTabViews[e.get("_id")].$el.remove(),delete this.workspaceTabViews[e.get("_id")]},getWorkspaceView:function(e){if(!e)return;var t=e.get("_id");if(!this.workspaceViewIsInstantiated(t)){var r=new n({model:e,app:this});this.workspaceViews[t]=r}else var r=this.workspaceViews[t];return r},workspaceViewIsInstantiated:function(e){return this.workspaceViews[e]!=undefined},hideWorkspace:function(e){e!=undefined&&e.$el.hide()},showWorkspace:function(e){this.model.removeWorkspaceFromBackground(e.model.id),this.addWorkspaceTab(e.model),$.contains(document.documentElement,e.$el[0])||this.$el.children("#workspaces").append(this.currentWorkspaceView.$el),e.$el.show()},render:function(e){var t=this.model,n=this.model.get("workspaces"),i=this.model.get("currentWorkspace");if(!i)var o=n.first();else var o=n.get(i);return this.model.updateCurrentWorkspace(),this.workspaceControlsView||(this.workspaceControlsView=new s({model:new r},{app:this.model,appView:this}),this.workspaceControlsView.render(),this.$el.find("#workspaces").prepend(this.workspaceControlsView.$el)),this.workspaceTabViews||(this.workspaceTabViews={},n.each(this.addWorkspaceTab,this)),this.model.changed.currentWorkspace&&o&&(this.hideWorkspace(this.currentWorkspaceView),this.currentWorkspaceView=this.getWorkspaceView(o),this.showWorkspace(this.currentWorkspaceView),this.currentWorkspaceView.render(),this.currentWorkspaceId=i,this.focusWorkspace()),this.showSearch(),this.renderLogin(),this},renderLogin:function(){this.loginView||(this.loginView=new h({model:this.model.login},{app:this.model}),this.loginView.render())},lookingAtViewer:!1,focusWorkspace:function(){this.$el.find("#workspace_hide").removeClass("leftside"),this.$el.find("#workspace_hide").addClass("rightside"),this.$el.find("#workspace_hide i").removeClass("icon-arrow-right"),this.$el.find("#workspace_hide i").addClass("icon-arrow-left"),this.currentWorkspaceView.$el.show(),this.workspaceControlsView.$el.show(),$("#viewer").addClass("blur")},focusViewer:function(){this.$el.find("#workspace_hide").addClass("leftside"),this.$el.find("#workspace_hide").removeClass("rightside"),this.$el.find("#workspace_hide i").removeClass("icon-arrow-left"),this.$el.find("#workspace_hide i").addClass("icon-arrow-right"),this.currentWorkspaceView.$el.hide(),this.workspaceControlsView.$el.hide(),$("#viewer").removeClass("blur")},getCurrentWorkspace:function(){return this.get("workspaces").get(this.get("currentWorkspace"))},toggleViewer:function(e){this.lookingAtViewer=!this.lookingAtViewer,this.lookingAtViewer?this.focusViewer():this.focusWorkspace()}})});var THREE={REVISION:"67"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!self.requestAnimationFrame;++n)self.requestAnimationFrame=self[t[n]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[n]+"CancelAnimationFrame"]||self[t[n]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=self.setTimeout(function(){t(n+r)},r);return e=n+r,i}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var r=function(e,t,n){return 0>n&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e};t=.5>=n?n*(1+t):n+t-n*t,n=2*n-t,this.r=r(n,t,e+1/3),this.g=r(n,t,e),this.b=r(n,t,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e))return e=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e),this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this;if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e))return e=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e),this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(e))return e=/^\#([0-9a-f]{6})$/i.exec(e),this.setHex(parseInt(e[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e))return e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e),this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this;if(/^(\w+)$/i.test(e))return this.setHex(THREE.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e=e||{h:0,s:0,l:0};var t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),s=Math.min(t,n,r),o,u=(s+i)/2;if(s===i)s=o=0;else{var a=i-s,s=.5>=u?a/(i+s):a/(2-i-s);switch(i){case t:o=(n-r)/a+(n<r?6:0);break;case n:o=(r-t)/a+2;break;case r:o=(t-n)/a+4}o/=6}return e.h=o,e.s=s,e.l=u,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get w(){return this._w},set w(e){this._w=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(0==e instanceof THREE.Euler)throw Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var n=Math.cos(e._x/2),r=Math.cos(e._y/2),i=Math.cos(e._z/2),s=Math.sin(e._x/2),o=Math.sin(e._y/2),u=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=s*r*i+n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i-s*o*u):"YXZ"===e.order?(this._x=s*r*i+n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i+s*o*u):"ZXY"===e.order?(this._x=s*r*i-n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i-s*o*u):"ZYX"===e.order?(this._x=s*r*i-n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i+s*o*u):"YZX"===e.order?(this._x=s*r*i+n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i-s*o*u):"XZY"===e.order&&(this._x=s*r*i-n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i+s*o*u),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0];e=t[4];var r=t[8],i=t[1],s=t[5],o=t[9],u=t[2],a=t[6],t=t[10],f=n+s+t;return 0<f?(n=.5/Math.sqrt(f+1),this._w=.25/n,this._x=(a-o)*n,this._y=(r-u)*n,this._z=(i-e)*n):n>s&&n>t?(n=2*Math.sqrt(1+n-s-t),this._w=(a-o)/n,this._x=.25*n,this._y=(e+i)/n,this._z=(r+u)/n):s>t?(n=2*Math.sqrt(1+s-n-t),this._w=(r-u)/n,this._x=(e+i)/n,this._y=.25*n,this._z=(o+a)/n):(n=2*Math.sqrt(1+t-n-s),this._w=(i-e)/n,this._x=(r+u)/n,this._y=(o+a)/n,this._z=.25*n),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t;return function(n,r){return void 0===e&&(e=new THREE.Vector3),t=n.dot(r)+1,1e-6>t?(t=0,Math.abs(n.x)>Math.abs(n.z)?e.set(-n.y,n.x,0):e.set(0,-n.z,n.y)):e.crossVectors(n,r),this._x=e.x,this._y=e.y,this._z=e.z,this._w=t,this.normalize(),this}}(),inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,u=t._y,a=t._z,f=t._w;return this._x=n*f+s*o+r*a-i*u,this._y=r*f+s*u+i*o-n*a,this._z=i*f+s*a+n*u-r*o,this._w=s*f-n*o-r*u-i*a,this.onChangeCallback(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this._x,r=this._y,i=this._z,s=this._w,o=s*e._w+n*e._x+r*e._y+i*e._z;0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e);if(1<=o)return this._w=s,this._x=n,this._y=r,this._z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);return.001>Math.abs(a)?(this._w=.5*(s+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this):(o=Math.sin((1-t)*u)/a,u=Math.sin(t*u)/a,this._w=s*o+this._w*u,this._x=n*o+this._x*u,this._y=r*o+this._y*u,this._z=i*o+this._z*u,this.onChangeCallback(),this)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e):this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(n,n),t.set(r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return e=this.y-e.y,t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return 0==t instanceof THREE.Euler&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,n){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,n)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r+e[12],this.y=e[1]*t+e[5]*n+e[9]*r+e[13],this.z=e[2]*t+e[6]*n+e[10]*r+e[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z;e=e.elements;var i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z;e=e.w;var u=e*t+s*r-o*n,a=e*n+o*t-i*r,f=e*r+i*n-s*t,t=-i*t-s*n-o*r;return this.x=u*e+t*-i+a*-o-f*-s,this.y=a*e+t*-s+f*-i-u*-o,this.z=f*e+t*-o+u*-s-a*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,u=t.z;return this.x=r*u-i*o,this.y=i*s-n*u,this.z=n*o-r*s,this},projectOnVector:function(){var e,t;return function(n){return void 0===e&&(e=new THREE.Vector3),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/(this.length()*e.length()),Math.acos(THREE.Math.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return e=this.z-e.z,t*t+n*n+e*e},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length();return e=this.set(e.elements[8],e.elements[9],e.elements[10]).length(),this.x=t,this.y=n,this.z=e,this},setFromMatrixColumn:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r;e=e.elements;var i=e[0];r=e[4];var s=e[8],o=e[1],u=e[5],a=e[9];n=e[2],t=e[6];var f=e[10];return.01>Math.abs(r-o)&&.01>Math.abs(s-n)&&.01>Math.abs(a-t)?.1>Math.abs(r+o)&&.1>Math.abs(s+n)&&.1>Math.abs(a+t)&&.1>Math.abs(i+u+f-3)?(this.set(1,0,0,0),this):(e=Math.PI,i=(i+1)/2,u=(u+1)/2,f=(f+1)/2,r=(r+o)/4,s=(s+n)/4,a=(a+t)/4,i>u&&i>f?.01>i?(t=0,r=n=.707106781):(t=Math.sqrt(i),n=r/t,r=s/t):u>f?.01>u?(t=.707106781,n=0,r=.707106781):(n=Math.sqrt(u),t=r/n,r=a/n):.01>f?(n=t=.707106781,r=0):(r=Math.sqrt(f),t=s/r,n=a/r),this.set(t,n,r,e),this):(e=Math.sqrt((t-a)*(t-a)+(s-n)*(s-n)+(o-r)*(o-r)),.001>Math.abs(e)&&(e=1),this.x=(t-a)/e,this.y=(s-n)/e,this.z=(o-r)/e,this.w=Math.acos((i+u+f-1)/2),this)},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(e){this._x=e,this.onChangeCallback()},get y(){return this._y},set y(e){this._y=e,this.onChangeCallback()},get z(){return this._z},set z(e){this._z=e,this.onChangeCallback()},get order(){return this._order},set order(e){this._order=e,this.onChangeCallback()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this.onChangeCallback(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t){var n=THREE.Math.clamp,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[1],a=r[5],f=r[9],l=r[2],c=r[6],r=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(n(o,-1,1)),.99999>Math.abs(o)?(this._x=Math.atan2(-f,r),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(c,a),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(f,-1,1)),.99999>Math.abs(f)?(this._y=Math.atan2(o,r),this._z=Math.atan2(u,a)):(this._y=Math.atan2(-l,i),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(c,-1,1)),.99999>Math.abs(c)?(this._y=Math.atan2(-l,r),this._z=Math.atan2(-s,a)):(this._y=0,this._z=Math.atan2(u,i))):"ZYX"===t?(this._y=Math.asin(-n(l,-1,1)),.99999>Math.abs(l)?(this._x=Math.atan2(c,r),this._z=Math.atan2(u,i)):(this._x=0,this._z=Math.atan2(-s,a))):"YZX"===t?(this._z=Math.asin(n(u,-1,1)),.99999>Math.abs(u)?(this._x=Math.atan2(-f,a),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(o,r))):"XZY"===t?(this._z=Math.asin(-n(s,-1,1)),.99999>Math.abs(s)?(this._x=Math.atan2(c,a),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-f,r),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this.onChangeCallback(),this},setFromQuaternion:function(e,t,n){var r=THREE.Math.clamp,i=e.x*e.x,s=e.y*e.y,o=e.z*e.z,u=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),u-i-s+o),this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w),-1,1)),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u+i-s-o)):"YXZ"===t?(this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u-i-s+o),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u-i+s-o)):"ZXY"===t?(this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z),-1,1)),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),u-i-s+o),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u-i+s-o)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),u-i-s+o),this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z),-1,1)),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u+i-s-o)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),u-i+s-o),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),u+i-s-o),this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w),-1,1))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),u-i+s-o),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u+i-s-o),this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y),-1,1))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==n&&this.onChangeCallback(),this},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new THREE.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),i=t.dot(e)/i;return r&&(i=THREE.Math.clamp(i,0,1)),i}}(),closestPointToPoint:function(e,t,n){return e=this.closestPointToPointParameter(e,t),n=n||new THREE.Vector3,this.delta(n).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(Infinity,Infinity),this.max=void 0!==t?t:new THREE.Vector2(-Infinity,-Infinity)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){return(t||new THREE.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(Infinity,Infinity,Infinity),this.max=void 0!==t?t:new THREE.Vector3(-Infinity,-Infinity,-Infinity)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){return e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var t=1,n=e.length;t<n;t++)this.addPoint(e[t])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var r=t.geometry.vertices,i=0,s=r.length;i<s;i++)e.copy(r[i]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){return(t||new THREE.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){return t=t||new THREE.Sphere,t.center=this.center(),t.radius=.5*this.size(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,n,r,i,s,o,u,a){var f=this.elements=new Float32Array(9);f[0]=void 0!==e?e:1,f[3]=t||0,f[6]=n||0,f[1]=r||0,f[4]=void 0!==i?i:1,f[7]=s||0,f[2]=o||0,f[5]=u||0,f[8]=void 0!==a?a:1},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var i=0;i<r;i+=3,n+=3)e.x=t[n],e.y=t[n+1],e.z=t[n+2],e.applyMatrix3(this),t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],e=e[8];return t*s*e-t*o*a-n*i*e+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4],n=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(0===n){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements=new Float32Array(16);m[0]=void 0!==e?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=void 0!==s?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=void 0!==l?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=void 0!==v?v:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var n=this.elements;t=t.elements;var r=1/e.set(t[0],t[1],t[2]).length(),i=1/e.set(t[4],t[5],t[6]).length(),s=1/e.set(t[8],t[9],t[10]).length();return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[4]=t[4]*i,n[5]=t[5]*i,n[6]=t[6]*i,n[8]=t[8]*s,n[9]=t[9]*s,n[10]=t[10]*s,this}}(),makeRotationFromEuler:function(e){0==e instanceof THREE.Euler&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var t=this.elements,n=e.x,r=e.y,i=e.z,s=Math.cos(n),n=Math.sin(n),o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i);if("XYZ"===e.order){e=s*u;var a=s*i,f=n*u,l=n*i;t[0]=o*u,t[4]=-o*i,t[8]=r,t[1]=a+f*r,t[5]=e-l*r,t[9]=-n*o,t[2]=l-e*r,t[6]=f+a*r,t[10]=s*o}else"YXZ"===e.order?(e=o*u,a=o*i,f=r*u,l=r*i,t[0]=e+l*n,t[4]=f*n-a,t[8]=s*r,t[1]=s*i,t[5]=s*u,t[9]=-n,t[2]=a*n-f,t[6]=l+e*n,t[10]=s*o):"ZXY"===e.order?(e=o*u,a=o*i,f=r*u,l=r*i,t[0]=e-l*n,t[4]=-s*i,t[8]=f+a*n,t[1]=a+f*n,t[5]=s*u,t[9]=l-e*n,t[2]=-s*r,t[6]=n,t[10]=s*o):"ZYX"===e.order?(e=s*u,a=s*i,f=n*u,l=n*i,t[0]=o*u,t[4]=f*r-a,t[8]=e*r+l,t[1]=o*i,t[5]=l*r+e,t[9]=a*r-f,t[2]=-r,t[6]=n*o,t[10]=s*o):"YZX"===e.order?(e=s*o,a=s*r,f=n*o,l=n*r,t[0]=o*u,t[4]=l-e*i,t[8]=f*i+a,t[1]=i,t[5]=s*u,t[9]=-n*u,t[2]=-r*u,t[6]=a*i+f,t[10]=e-l*i):"XZY"===e.order&&(e=s*o,a=s*r,f=n*o,l=n*r,t[0]=o*u,t[4]=-i,t[8]=r*u,t[1]=e*i+l,t[5]=s*u,t[9]=a*i-f,t[2]=f*i-a,t[6]=n*u,t[10]=l*i+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i;e=n*o;var f=n*u,n=n*a,l=r*u,r=r*a,i=i*a,o=s*o,u=s*u,s=s*a;return t[0]=1-(l+i),t[4]=f-s,t[8]=n+u,t[1]=f+s,t[5]=1-(e+i),t[9]=r-o,t[2]=n-u,t[6]=r+o,t[10]=1-(e+l),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s){var o=this.elements;return n.subVectors(r,i).normalize(),0===n.length()&&(n.z=1),e.crossVectors(s,n).normalize(),0===e.length()&&(n.x+=1e-4,e.crossVectors(s,n).normalize()),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],n=n[15],w=r[0],E=r[4],S=r[8],x=r[12],T=r[1],N=r[5],C=r[9],k=r[13],L=r[2],A=r[6],O=r[10],M=r[14],_=r[3],D=r[7],P=r[11],r=r[15];return i[0]=s*w+o*T+u*L+a*_,i[4]=s*E+o*N+u*A+a*D,i[8]=s*S+o*C+u*O+a*P,i[12]=s*x+o*k+u*M+a*r,i[1]=f*w+l*T+c*L+h*_,i[5]=f*E+l*N+c*A+h*D,i[9]=f*S+l*C+c*O+h*P,i[13]=f*x+l*k+c*M+h*r,i[2]=p*w+d*T+v*L+m*_,i[6]=p*E+d*N+v*A+m*D,i[10]=p*S+d*C+v*O+m*P,i[14]=p*x+d*k+v*M+m*r,i[3]=g*w+y*T+b*L+n*_,i[7]=g*E+y*N+b*A+n*D,i[11]=g*S+y*C+b*O+n*P,i[15]=g*x+y*k+b*M+n*r,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead."),this.applyToVector3Array(e)},applyToVector3Array:function(){var e=new THREE.Vector3;return function(t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.length);for(var i=0;i<r;i+=3,n+=3)e.x=t[n],e.y=t[n+1],e.z=t[n+2],e.applyMatrix4(this),t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14];return e[3]*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+e[7]*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+e[11]*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+e[15]*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],r=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*r+f*d*r,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*r-s*d*r,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*r+s*l*r,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*r-a*d*r,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*r+i*d*r,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*r-i*l*r,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*r+a*p*r,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*r-i*p*r,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*r+i*f*r,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d,n=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(0==n){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y;return e=e.z,t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new THREE.Vector3,t=new THREE.Matrix4;return function(n,r,i){var s=this.elements,o=e.set(s[0],s[1],s[2]).length(),u=e.set(s[4],s[5],s[6]).length(),f=e.set(s[8],s[9],s[10]).length();0>this.determinant()&&(o=-o),n.x=s[12],n.y=s[13],n.z=s[14],t.elements.set(this.elements),n=1/o;var s=1/u,l=1/f;return t.elements[0]*=n,t.elements[1]*=n,t.elements[2]*=n,t.elements[4]*=s,t.elements[5]*=s,t.elements[6]*=s,t.elements[8]*=l,t.elements[9]*=l,t.elements[10]*=l,r.setFromRotationMatrix(t),i.x=o,i.y=u,i.z=f,this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+i)/(s-i),o[14]=-2*s*i/(s-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,r){e=n*Math.tan(THREE.Math.degToRad(.5*e));var i=-e;return this.makeFrustum(i*t,e*t,i,e,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-((t+e)/u),o[1]=0,o[5]=2/a,o[9]=0,o[13]=-((n+r)/a),o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-((s+i)/f),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new THREE.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new THREE.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);return 0>r?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return 0>n?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5),s=t.clone().sub(e).normalize(),o=.5*e.distanceTo(t),u=this.origin.clone().sub(i);e=-this.direction.dot(s),t=u.dot(this.direction);var a=-u.dot(s),f=u.lengthSq(),l=Math.abs(1-e*e),c,h;return 0<=l?(u=e*a-t,c=e*t-a,h=o*l,0<=u?c>=-h?c<=h?(o=1/l,u*=o,c*=o,e=u*(u+e*c+2*t)+c*(e*u+c+2*a)+f):(c=o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f):(c=-o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f):c<=-h?(u=Math.max(0,-(-e*o+t)),c=0<u?-o:Math.min(Math.max(-o,-a),o),e=-u*u+c*(c+2*a)+f):c<=h?(u=0,c=Math.min(Math.max(-o,-a),o),e=c*(c+2*a)+f):(u=Math.max(0,-(e*o+t)),c=0<u?o:Math.min(Math.max(-o,-a),o),e=-u*u+c*(c+2*a)+f)):(c=0<e?-o:o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f),n&&n.copy(this.direction.clone().multiplyScalar(u).add(this.origin)),r&&r.copy(s.clone().multiplyScalar(c).add(i)),e},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0==t?0==e.distanceToPoint(this.origin)?0:null:(e=-(this.origin.dot(e.normal)+e.constant)/t,0<=e?e:null)},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var n,r,i,s,o;r=1/this.direction.x,s=1/this.direction.y,o=1/this.direction.z;var u=this.origin;0<=r?(n=(e.min.x-u.x)*r,r*=e.max.x-u.x):(n=(e.max.x-u.x)*r,r*=e.min.x-u.x),0<=s?(i=(e.min.y-u.y)*s,s*=e.max.y-u.y):(i=(e.max.y-u.y)*s,s*=e.min.y-u.y);if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;0<=o?(i=(e.min.z-u.z)*o,o*=e.max.z-u.z):(i=(e.max.z-u.z)*o,o*=e.min.z-u.z);if(n>o||i>r)return null;if(i>n||n!==n)n=i;if(o<r||r!==r)r=o;return 0>r?null:this.at(0<=n?n:r,t)},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3;return function(i,s,o,u,f){t.subVectors(s,i),n.subVectors(o,i),r.crossVectors(t,n),s=this.direction.dot(r);if(0<s){if(u)return null;u=1}else{if(!(0>s))return null;u=-1,s=-s}return e.subVectors(this.origin,i),i=u*this.direction.dot(n.crossVectors(e,n)),0>i?null:(o=u*this.direction.dot(t.cross(e)),0>o||i+o>s?null:(i=-u*e.dot(r),0>i?null:this.at(i/s,f)))}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,n){var r=this.center;void 0!==n?r.copy(n):e.setFromPoints(t).center(r);for(var i=0,s=0,o=t.length;s<o;s++)i=Math.max(i,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),r=t||new THREE.Vector3;return r.copy(e),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){return e=e||new THREE.Box3,e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,n,r,i,s){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==s?s:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},copy:function(e){for(var t=this.planes,n=0;6>n;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements;e=n[0];var r=n[1],i=n[2],s=n[3],o=n[4],u=n[5],a=n[6],f=n[7],l=n[8],c=n[9],h=n[10],p=n[11],d=n[12],v=n[13],m=n[14],n=n[15];return t[0].setComponents(s-e,f-o,p-l,n-d).normalize(),t[1].setComponents(s+e,f+o,p+l,n+d).normalize(),t[2].setComponents(s+r,f+u,p+c,n+v).normalize(),t[3].setComponents(s-r,f-u,p-c,n-v).normalize(),t[4].setComponents(s-i,f-a,p-h,n-m).normalize(),t[5].setComponents(s+i,f+a,p+h,n+m).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,n=e.center;e=-e.radius;for(var r=0;6>r;r++)if(t[r].distanceToPoint(n)<e)return!1;return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){for(var r=this.planes,i=0;6>i;i++){var s=r[i];e.x=0<s.normal.x?n.min.x:n.max.x,t.x=0<s.normal.x?n.max.x:n.min.x,e.y=0<s.normal.y?n.min.y:n.max.y,t.y=0<s.normal.y?n.max.y:n.min.y,e.z=0<s.normal.z?n.min.z:n.max.z,t.z=0<s.normal.z?n.max.z:n.min.z;var o=s.distanceToPoint(e),s=s.distanceToPoint(t);if(0>o&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;6>n;n++)if(0>t[n].distanceToPoint(e))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r,i){return r=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize(),this.setFromNormalAndCoplanarPoint(r,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);return(t||new THREE.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectLine:function(){var e=new THREE.Vector3;return function(t,n){var r=n||new THREE.Vector3,i=t.delta(e),s=this.normal.dot(i);if(0!=s)return s=-(t.start.dot(this.normal)+this.constant)/s,0>s||1<s?void 0:r.copy(i).multiplyScalar(s).add(t.start);if(0==this.distanceToPoint(t.start))return r.copy(t.start)}}(),coplanarPoint:function(e){return(e||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Matrix3;return function(r,i){var s=i||n.getNormalMatrix(r),s=e.copy(this.normal).applyMatrix3(s),o=this.coplanarPoint(t);return o.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(s,o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=Array(36),n=0,r;return function(){for(var i=0;36>i;i++)8==i||13==i||18==i||23==i?t[i]="-":14==i?t[i]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),r=n&15,n>>=4,t[i]=e[19==i?r&3|8:r]);return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:0<e?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e}},THREE.Spline=function(e){function t(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=e;var n=[],r={x:0,y:0,z:0},i,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,s=Math.floor(i),o=i-s,n[0]=0===s?s:s-1,n[1]=s,n[2]=s>this.points.length-2?this.points.length-1:s+1,n[3]=s>this.points.length-3?this.points.length-1:s+2,f=this.points[n[0]],l=this.points[n[1]],c=this.points[n[2]],h=this.points[n[3]],u=o*o,a=o*u,r.x=t(f.x,l.x,c.x,h.x,o,u,a),r.y=t(f.y,l.y,c.y,h.y,o,u,a),r.z=t(f.z,l.z,c.z,h.z,o,u,a),r},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i=t=t=0,s=new THREE.Vector3,o=new THREE.Vector3,u=[],a=0;u[0]=0,e||(e=100),n=this.points.length*e,s.copy(this.points[0]);for(e=1;e<n;e++)t=e/n,r=this.getPoint(t),o.copy(r),a+=o.distanceTo(s),s.copy(r),t*=this.points.length-1,t=Math.floor(t),t!=i&&(u[t]=a,i=t);return u[u.length]=a,{chunks:u,total:a}},this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u=[],a=new THREE.Vector3,f=this.getLength();u.push(a.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){n=f.chunks[t]-f.chunks[t-1],o=Math.ceil(e*n/f.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1);for(n=1;n<o-1;n++)r=i+1/o*n*(s-i),r=this.getPoint(r),u.push(a.copy(r).clone());u.push(a.copy(this.points[t]).clone())}this.points=u}},THREE.Triangle=function(e,t,n){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==n?n:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,n,r,i){return i=i||new THREE.Vector3,i.subVectors(r,n),e.subVectors(t,n),i.cross(e),t=i.lengthSq(),0<t?i.multiplyScalar(1/Math.sqrt(t)):i.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s,o,u){e.subVectors(o,i),t.subVectors(s,i),n.subVectors(r,i),r=e.dot(e),i=e.dot(t),s=e.dot(n);var f=t.dot(t);o=t.dot(n);var l=r*f-i*i;return u=u||new THREE.Vector3,0==l?u.set(-2,-1,-1):(l=1/l,f=(f*s-i*o)*l,r=(r*o-i*s)*l,u.set(1-f-r,r,f))}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,n,r,i){return t=THREE.Triangle.barycoordFromPoint(t,n,r,i,e),0<=t.x&&0<=t.y&&1>=t.x+t.y}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=[],r=t.length,i=0;i<r;i++)n[i]=t[i];for(i=0;i<r;i++)n[i].call(this,e)}}}},function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),this.near=r||0,this.far=i||Infinity};var t=new e.Sphere,n=new e.Ray;new e.Plane,new e.Vector3;var r=new e.Vector3,i=new e.Matrix4,s=function(e,t){return e.distance-t.distance},o=new e.Vector3,u=new e.Vector3,a=new e.Vector3,f=function(s,l,p){if(s instanceof e.Sprite){r.setFromMatrixPosition(s.matrixWorld);var v=l.ray.distanceToPoint(r);if(v>s.scale.x)return p;p.push({distance:v,point:s.position,face:null,object:s})}else if(s instanceof e.LOD)r.setFromMatrixPosition(s.matrixWorld),v=l.ray.origin.distanceTo(r),f(s.getObjectForDistance(v),l,p);else if(s instanceof e.Mesh){var m=s.geometry;null===m.boundingSphere&&m.computeBoundingSphere(),t.copy(m.boundingSphere),t.applyMatrix4(s.matrixWorld);if(!1===l.ray.isIntersectionSphere(t))return p;i.getInverse(s.matrixWorld),n.copy(l.ray).applyMatrix4(i);if(null!==m.boundingBox&&!1===n.isIntersectionBox(m.boundingBox))return p;if(m instanceof e.BufferGeometry){var y=s.material;if(void 0===y)return p;var w=m.attributes,E,S,x=l.precision;if(void 0!==w.index){var T=w.index.array,N=w.position.array,C=m.offsets;0===C.length&&(C=[{start:0,count:N.length,index:0}]);for(var L=0,A=C.length;L<A;++L)for(var w=C[L].start,O=C[L].index,m=w,M=w+C[L].count;m<M;m+=3){w=O+T[m],E=O+T[m+1],S=O+T[m+2],o.set(N[3*w],N[3*w+1],N[3*w+2]),u.set(N[3*E],N[3*E+1],N[3*E+2]),a.set(N[3*S],N[3*S+1],N[3*S+2]);var _=y.side===e.BackSide?n.intersectTriangle(a,u,o,!0):n.intersectTriangle(o,u,a,y.side!==e.DoubleSide);null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,indices:[w,E,S],face:null,faceIndex:null,object:s}))}}else for(N=w.position.array,m=0,M=w.position.array.length;m<M;m+=3)w=m,E=m+1,S=m+2,o.set(N[3*w],N[3*w+1],N[3*w+2]),u.set(N[3*E],N[3*E+1],N[3*E+2]),a.set(N[3*S],N[3*S+1],N[3*S+2]),_=y.side===e.BackSide?n.intersectTriangle(a,u,o,!0):n.intersectTriangle(o,u,a,y.side!==e.DoubleSide),null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,indices:[w,E,S],face:null,faceIndex:null,object:s}))}else if(m instanceof e.Geometry)for(N=s.material instanceof e.MeshFaceMaterial,C=!0===N?s.material.materials:null,x=l.precision,T=m.vertices,L=0,A=m.faces.length;L<A;L++)if(O=m.faces[L],y=!0===N?C[O.materialIndex]:s.material,void 0!==y){w=T[O.a],E=T[O.b],S=T[O.c];if(!0===y.morphTargets){v=m.morphTargets,_=s.morphTargetInfluences,o.set(0,0,0),u.set(0,0,0),a.set(0,0,0);for(var M=0,D=v.length;M<D;M++){var P=_[M];if(0!==P){var H=v[M].vertices;o.x+=(H[O.a].x-w.x)*P,o.y+=(H[O.a].y-w.y)*P,o.z+=(H[O.a].z-w.z)*P,u.x+=(H[O.b].x-E.x)*P,u.y+=(H[O.b].y-E.y)*P,u.z+=(H[O.b].z-E.z)*P,a.x+=(H[O.c].x-S.x)*P,a.y+=(H[O.c].y-S.y)*P,a.z+=(H[O.c].z-S.z)*P}}o.add(w),u.add(E),a.add(S),w=o,E=u,S=a}_=y.side===e.BackSide?n.intersectTriangle(S,E,w,!0):n.intersectTriangle(w,E,S,y.side!==e.DoubleSide),null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,face:O,faceIndex:L,object:s}))}}else if(s instanceof e.Line){x=l.linePrecision,y=x*x,m=s.geometry,null===m.boundingSphere&&m.computeBoundingSphere(),t.copy(m.boundingSphere),t.applyMatrix4(s.matrixWorld);if(!1===l.ray.isIntersectionSphere(t))return p;i.getInverse(s.matrixWorld),n.copy(l.ray).applyMatrix4(i);if(m instanceof e.Geometry)for(T=m.vertices,x=T.length,w=new e.Vector3,E=new e.Vector3,S=s.type===e.LineStrip?1:2,m=0;m<x-1;m+=S)n.distanceSqToSegment(T[m],T[m+1],E,w)>y||(v=n.origin.distanceTo(E),v<l.near||v>l.far||p.push({distance:v,point:w.clone().applyMatrix4(s.matrixWorld),face:null,faceIndex:null,object:s}))}},l=function(e,t,n){e=e.getDescendants();for(var r=0,i=e.length;r<i;r++)f(e[r],t,n)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var n=[];return!0===t&&l(e,this,n),f(e,this,n),n.sort(s),n},e.Raycaster.prototype.intersectObjects=function(e,t){for(var n=[],r=0,i=e.length;r<i;r++)f(e[r],this,n),!0===t&&l(e[r],this,n);return n.sort(s),n}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3;var e=this;Object.defineProperties(this,{rotation:{enumerable:!0,value:(new THREE.Euler).onChange(function(){e.quaternion.setFromEuler(e.rotation,!1)})},quaternion:{enumerable:!0,value:(new THREE.Quaternion).onChange(function(){e.rotation.setFromQuaternion(e.quaternion,void 0,!1)})},scale:{enumerable:!0,value:new THREE.Vector3(1,1,1)}}),this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!1,this.visible=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,n){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1);for(t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.id===e||!0===t&&(i=i.getObjectById(e,t),void 0!==i))return i}},getObjectByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e||!0===t&&(i=i.getObjectByName(e,t),void 0!==i))return i}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===e)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){void 0===e&&(e=new THREE.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData));if(!0===t)for(var n=0;n<this.children.length;n++)e.add(this.children[n].clone());return e}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(l===h){var e=new THREE.RenderableVertex;return c.push(e),h++,l++,e}return c[l++]}function t(){if(d===m){var e=new THREE.RenderableFace;return v.push(e),m++,d++,e}return v[d++]}function n(){if(y===w){var e=new THREE.RenderableLine;return b.push(e),w++,y++,e}return b[y++]}function r(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function i(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return 0<=i&&0<=s&&0<=o&&0<=u?!0:0>i&&0>s||0>o&&0>u?!1:(0>i?n=Math.max(n,i/(i-s)):0>s&&(r=Math.min(r,i/(i-s))),0>o?n=Math.max(n,o/(o-u)):0>u&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var s,o,u=[],a=0,f,l,c=[],h=0,p,d,v=[],m=0,g,y,b=[],w=0,E,S,x=[],T=0,N={objects:[],lights:[],elements:[]},C=new THREE.Vector3,k=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Vector3,O=new THREE.Vector4,M=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),_=new THREE.Box3,D=Array(3),P=new THREE.Matrix4,H=new THREE.Matrix4,B,j=new THREE.Matrix4,F=new THREE.Matrix3,I=new THREE.Frustum,q=new THREE.Vector4,R=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(H)},this.unprojectVector=function(){var e=new THREE.Matrix4;return function(t,n){return e.getInverse(n.projectionMatrix),H.multiplyMatrices(n.matrixWorld,e),t.applyProjection(H)}}(),this.pickingRay=function(e,t){e.z=-1;var n=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(n,t),n.sub(e).normalize(),new THREE.Raycaster(e,n)};var U=function(e){if(!1!==e.visible){if(e instanceof THREE.Light)N.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Sprite)if(!1===e.frustumCulled||!0===I.intersectsObject(e)){if(o===a){var t=new THREE.RenderableObject;u.push(t),a++,o++,s=t}else s=u[o++];s.id=e.id,s.object=e,null!==e.renderDepth?s.z=e.renderDepth:(A.setFromMatrixPosition(e.matrixWorld),A.applyProjection(H),s.z=A.z),N.objects.push(s)}for(var t=0,n=e.children.length;t<n;t++)U(e.children[t])}},z=new function(){var r=[],i=[],s=null,o=null,u=new THREE.Matrix3,a=function(e){var t=e.positionWorld,n=e.positionScreen;t.copy(e.position).applyMatrix4(B),n.copy(t).applyMatrix4(H),t=1/n.w,n.x*=t,n.y*=t,n.z*=t,e.visible=-1<=n.x&&1>=n.x&&-1<=n.y&&1>=n.y&&-1<=n.z&&1>=n.z},l=function(e,t,n){return!0===e.visible||!0===t.visible||!0===n.visible?!0:(D[0]=e.positionScreen,D[1]=t.positionScreen,D[2]=n.positionScreen,M.isIntersectionBox(_.setFromPoints(D)))},h=function(e,t,n){return 0>(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x)};return{setObject:function(e){s=e,o=s.material,u.getNormalMatrix(s.matrixWorld),r.length=0,i.length=0},projectVertex:a,checkTriangleVisibility:l,checkBackfaceCulling:h,pushVertex:function(t,n,r){f=e(),f.position.set(t,n,r),a(f)},pushNormal:function(e,t,n){r.push(e,t,n)},pushUv:function(e,t){i.push(e,t)},pushLine:function(e,t){var r=c[e],i=c[t];g=n(),g.id=s.id,g.v1.copy(r),g.v2.copy(i),g.z=(r.positionScreen.z+i.positionScreen.z)/2,g.material=s.material,N.elements.push(g)},pushTriangle:function(e,n,a){var f=c[e],d=c[n],v=c[a];if(!1!==l(f,d,v)&&(o.side===THREE.DoubleSide||!0===h(f,d,v))){p=t(),p.id=s.id,p.v1.copy(f),p.v2.copy(d),p.v3.copy(v),p.z=(f.positionScreen.z+d.positionScreen.z+v.positionScreen.z)/3;for(f=0;3>f;f++)d=3*arguments[f],v=p.vertexNormalsModel[f],v.set(r[d],r[d+1],r[d+2]),v.applyMatrix3(u).normalize(),d=2*arguments[f],p.uvs[f].set(i[d],i[d+1]);p.vertexNormalsLength=3,p.material=s.material,N.elements.push(p)}}}};this.projectScene=function(s,u,a,f){var h,v,m,b,w,A,M,_;S=y=d=0,N.elements.length=0,!0===s.autoUpdate&&s.updateMatrixWorld(),void 0===u.parent&&u.updateMatrixWorld(),P.copy(u.matrixWorldInverse.getInverse(u.matrixWorld)),H.multiplyMatrices(u.projectionMatrix,P),I.setFromMatrix(H),o=0,N.objects.length=0,N.lights.length=0,U(s),!0===a&&N.objects.sort(r),s=0;for(a=N.objects.length;s<a;s++)if(h=N.objects[s].object,v=h.geometry,z.setObject(h),B=h.matrixWorld,l=0,h instanceof THREE.Mesh){if(v instanceof THREE.BufferGeometry){if(A=v.attributes,h=v.offsets,void 0!==A.position){M=A.position.array,v=0;for(b=M.length;v<b;v+=3)z.pushVertex(M[v],M[v+1],M[v+2]);if(void 0!==A.normal)for(_=A.normal.array,v=0,b=_.length;v<b;v+=3)z.pushNormal(_[v],_[v+1],_[v+2]);if(void 0!==A.uv)for(_=A.uv.array,v=0,b=_.length;v<b;v+=2)z.pushUv(_[v],_[v+1]);if(void 0!==A.index)if(A=A.index.array,0<h.length)for(s=0;s<h.length;s++)for(b=h[s],M=b.index,v=b.start,b=b.start+b.count;v<b;v+=3)z.pushTriangle(A[v]+M,A[v+1]+M,A[v+2]+M);else for(v=0,b=A.length;v<b;v+=3)z.pushTriangle(A[v],A[v+1],A[v+2]);else for(v=0,b=M.length/3;v<b;v+=3)z.pushTriangle(v,v+1,v+2)}}else if(v instanceof THREE.Geometry){m=v.vertices,b=v.faces,A=v.faceVertexUvs[0],F.getNormalMatrix(B),M=h.material instanceof THREE.MeshFaceMaterial,_=!0===M?h.material:null;for(var D=0,$=m.length;D<$;D++){var Z=m[D];z.pushVertex(Z.x,Z.y,Z.z)}D=0;for($=b.length;D<$;D++){m=b[D];var et=!0===M?_.materials[m.materialIndex]:h.material;if(void 0!==et){var tt=et.side,Z=c[m.a],nt=c[m.b],rt=c[m.c];if(!0===et.morphTargets){w=v.morphTargets;var it=h.morphTargetInfluences,st=Z.position,ot=nt.position,ut=rt.position;C.set(0,0,0),k.set(0,0,0),L.set(0,0,0);for(var at=0,ft=w.length;at<ft;at++){var lt=it[at];if(0!==lt){var ct=w[at].vertices;C.x+=(ct[m.a].x-st.x)*lt,C.y+=(ct[m.a].y-st.y)*lt,C.z+=(ct[m.a].z-st.z)*lt,k.x+=(ct[m.b].x-ot.x)*lt,k.y+=(ct[m.b].y-ot.y)*lt,k.z+=(ct[m.b].z-ot.z)*lt,L.x+=(ct[m.c].x-ut.x)*lt,L.y+=(ct[m.c].y-ut.y)*lt,L.z+=(ct[m.c].z-ut.z)*lt}}Z.position.add(C),nt.position.add(k),rt.position.add(L),z.projectVertex(Z),z.projectVertex(nt),z.projectVertex(rt)}if(!1!==z.checkTriangleVisibility(Z,nt,rt)){it=z.checkBackfaceCulling(Z,nt,rt);if(tt!==THREE.DoubleSide){if(tt===THREE.FrontSide&&!1===it)continue;if(tt===THREE.BackSide&&!0===it)continue}p=t(),p.id=h.id,p.v1.copy(Z),p.v2.copy(nt),p.v3.copy(rt),p.normalModel.copy(m.normal),!1!==it||tt!==THREE.BackSide&&tt!==THREE.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(F).normalize(),w=m.vertexNormals,st=0;for(ot=Math.min(w.length,3);st<ot;st++)ut=p.vertexNormalsModel[st],ut.copy(w[st]),!1!==it||tt!==THREE.BackSide&&tt!==THREE.DoubleSide||ut.negate(),ut.applyMatrix3(F).normalize();p.vertexNormalsLength=w.length,tt=A[D];if(void 0!==tt)for(w=0;3>w;w++)p.uvs[w].copy(tt[w]);p.color=m.color,p.material=et,p.z=(Z.positionScreen.z+nt.positionScreen.z+rt.positionScreen.z)/3,N.elements.push(p)}}}}}else if(h instanceof THREE.Line){if(v instanceof THREE.BufferGeometry){if(A=v.attributes,void 0!==A.position){M=A.position.array,v=0;for(b=M.length;v<b;v+=3)z.pushVertex(M[v],M[v+1],M[v+2]);if(void 0!==A.index)for(A=A.index.array,v=0,b=A.length;v<b;v+=2)z.pushLine(A[v],A[v+1]);else for(v=0,b=M.length/3-1;v<b;v++)z.pushLine(v,v+1)}}else if(v instanceof THREE.Geometry&&(j.multiplyMatrices(H,B),m=h.geometry.vertices,0!==m.length))for(Z=e(),Z.positionScreen.copy(m[0]).applyMatrix4(j),v=h.type===THREE.LinePieces?2:1,D=1,$=m.length;D<$;D++)Z=e(),Z.positionScreen.copy(m[D]).applyMatrix4(j),0<(D+1)%v||(nt=c[l-2],q.copy(Z.positionScreen),R.copy(nt.positionScreen),!0===i(q,R)&&(q.multiplyScalar(1/q.w),R.multiplyScalar(1/R.w),g=n(),g.id=h.id,g.v1.positionScreen.copy(q),g.v2.positionScreen.copy(R),g.z=Math.max(q.z,R.z),g.material=h.material,h.material.vertexColors===THREE.VertexColors&&(g.vertexColors[0].copy(h.geometry.colors[D]),g.vertexColors[1].copy(h.geometry.colors[D-1])),N.elements.push(g)))}else h instanceof THREE.Sprite&&(O.set(B.elements[12],B.elements[13],B.elements[14],1),O.applyMatrix4(H),v=1/O.w,O.z*=v,-1<=O.z&&1>=O.z&&(S===T?(b=new THREE.RenderableSprite,x.push(b),T++,S++,E=b):E=x[S++],E.id=h.id,E.x=O.x*v,E.y=O.y*v,E.z=O.z,E.object=h,E.rotation=h.rotation,E.scale.x=h.scale.x*Math.abs(E.x-(O.x+u.projectionMatrix.elements[0])/(O.w+u.projectionMatrix.elements[12])),E.scale.y=h.scale.y*Math.abs(E.y-(O.y+u.projectionMatrix.elements[5])/(O.w+u.projectionMatrix.elements[13])),E.material=h.material,N.elements.push(E)));return!0===f&&N.elements.sort(r),N}},THREE.Face3=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,n,r,i,s,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,n,i,s,o)},THREE.BufferAttribute=function(){},THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},set:function(e){this.array.set(e)},setX:function(e,t){this.array[e*this.itemSize]=t},setY:function(e,t){this.array[e*this.itemSize+1]=t},setZ:function(e,t){this.array[e*this.itemSize+2]=t},setXY:function(e,t,n){e*=this.itemSize,this.array[e]=t,this.array[e+1]=n},setXYZ:function(e,t,n,r){e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r},setXYZW:function(e,t,n,r,i){e*=this.itemSize,this.array[e]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i}},THREE.Int8Attribute=function(e,t){this.array=new Int8Array(e*t),this.itemSize=t},THREE.Int8Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint8Attribute=function(e,t){this.array=new Uint8Array(e*t),this.itemSize=t},THREE.Uint8Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint8ClampedAttribute=function(e,t){this.array=new Uint8ClampedArray(e*t),this.itemSize=t},THREE.Uint8ClampedAttribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Int16Attribute=function(e,t){this.array=new Int16Array(e*t),this.itemSize=t},THREE.Int16Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint16Attribute=function(e,t){this.array=new Uint16Array(e*t),this.itemSize=t},THREE.Uint16Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Int32Attribute=function(e,t){this.array=new Int32Array(e*t),this.itemSize=t},THREE.Int32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Uint32Attribute=function(e,t){this.array=new Uint32Array(e*t),this.itemSize=t},THREE.Uint32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Float32Attribute=function(e,t){this.array=new Float32Array(e*t),this.itemSize=t},THREE.Float32Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.Float64Attribute=function(e,t){this.array=new Float64Array(e*t),this.itemSize=t},THREE.Float64Attribute.prototype=Object.create(THREE.BufferAttribute.prototype),THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.attributes={},this.offsets=this.drawcalls=[],this.boundingSphere=this.boundingBox=null},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t,n){0==t instanceof THREE.BufferAttribute?(console.warn("DEPRECATED: BufferGeometry's addAttribute() now expects ( name, attribute )."),this.attributes[e]={array:t,itemSize:n}):this.attributes[e]=t},getAttribute:function(e){return this.attributes[e]},addDrawCall:function(e,t,n){this.drawcalls.push({start:e,count:t,index:void 0!==n?n:0})},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToVector3Array(t.array),t.needsUpdate=!0),t=this.attributes.normal,void 0!==t&&((new THREE.Matrix3).getNormalMatrix(e).applyToVector3Array(t.array),t.needsUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;3<=e.length&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var n=3,r=e.length;n<r;n+=3){var i=e[n],s=e[n+1],o=e[n+2];i<t.min.x?t.min.x=i:i>t.max.x&&(t.max.x=i),s<t.min.y?t.min.y=s:s>t.max.y&&(t.max.y=s),o<t.min.z?t.min.z=o:o>t.max.z&&(t.max.z=o)}}if(void 0===e||0===e.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();for(var r=this.boundingSphere.center,i=0,s=n.length;i<s;i+=3)t.set(n[i],n[i+1],n[i+2]),e.addPoint(t);e.center(r);for(var o=0,i=0,s=n.length;i<s;i+=3)t.set(n[i],n[i+1],n[i+2]),o=Math.max(o,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){if(this.attributes.position){var e,t,n,r;e=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(e)};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var i=this.attributes.position.array,s=this.attributes.normal.array,o,u,a,f,l,c,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,v=new THREE.Vector3,m=new THREE.Vector3;if(this.attributes.index){var g=this.attributes.index.array,y=0<this.offsets.length?this.offsets:[{start:0,count:g.length,index:0}];n=0;for(r=y.length;n<r;++n){t=y[n].start,o=y[n].count;var b=y[n].index;e=t;for(t+=o;e<t;e+=3)o=b+g[e],u=b+g[e+1],a=b+g[e+2],f=i[3*o],l=i[3*o+1],c=i[3*o+2],h.set(f,l,c),f=i[3*u],l=i[3*u+1],c=i[3*u+2],p.set(f,l,c),f=i[3*a],l=i[3*a+1],c=i[3*a+2],d.set(f,l,c),v.subVectors(d,p),m.subVectors(h,p),v.cross(m),s[3*o]+=v.x,s[3*o+1]+=v.y,s[3*o+2]+=v.z,s[3*u]+=v.x,s[3*u+1]+=v.y,s[3*u+2]+=v.z,s[3*a]+=v.x,s[3*a+1]+=v.y,s[3*a+2]+=v.z}}else for(e=0,t=i.length;e<t;e+=9)f=i[e],l=i[e+1],c=i[e+2],h.set(f,l,c),f=i[e+3],l=i[e+4],c=i[e+5],p.set(f,l,c),f=i[e+6],l=i[e+7],c=i[e+8],d.set(f,l,c),v.subVectors(d,p),m.subVectors(h,p),v.cross(m),s[e]=v.x,s[e+1]=v.y,s[e+2]=v.z,s[e+3]=v.x,s[e+4]=v.y,s[e+5]=v.z,s[e+6]=v.x,s[e+7]=v.y,s[e+8]=v.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeTangents:function(){function e(e,t,n){c=r[3*e],h=r[3*e+1],p=r[3*e+2],d=r[3*t],v=r[3*t+1],m=r[3*t+2],g=r[3*n],y=r[3*n+1],b=r[3*n+2],w=s[2*e],E=s[2*e+1],S=s[2*t],x=s[2*t+1],T=s[2*n],N=s[2*n+1],C=d-c,k=g-c,L=v-h,A=y-h,O=m-p,M=b-p,_=S-w,D=T-w,P=x-E,H=N-E,B=1/(_*H-D*P),j.set((H*C-P*k)*B,(H*L-P*A)*B,(H*O-P*M)*B),F.set((_*k-D*C)*B,(_*A-D*L)*B,(_*M-D*O)*B),a[e].add(j),a[t].add(j),a[n].add(j),f[e].add(F),f[t].add(F),f[n].add(F)}function t(e){J.x=i[3*e],J.y=i[3*e+1],J.z=i[3*e+2],K.copy(J),G=a[e],V.copy(G),V.sub(J.multiplyScalar(J.dot(G))).normalize(),$.crossVectors(K,G),Y=$.dot(f[e]),Q=0>Y?-1:1,u[4*e]=V.x,u[4*e+1]=V.y,u[4*e+2]=V.z,u[4*e+3]=Q}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var n=this.attributes.index.array,r=this.attributes.position.array,i=this.attributes.normal.array,s=this.attributes.uv.array,o=r.length/3;void 0===this.attributes.tangent&&(this.attributes.tangent={itemSize:4,array:new Float32Array(4*o)});for(var u=this.attributes.tangent.array,a=[],f=[],l=0;l<o;l++)a[l]=new THREE.Vector3,f[l]=new THREE.Vector3;var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j=new THREE.Vector3,F=new THREE.Vector3,I,q,R,U,z,W=this.offsets,l=0;for(q=W.length;l<q;++l){I=W[l].start,R=W[l].count;var X=W[l].index,o=I;for(I+=R;o<I;o+=3)R=X+n[o],U=X+n[o+1],z=X+n[o+2],e(R,U,z)}var V=new THREE.Vector3,$=new THREE.Vector3,J=new THREE.Vector3,K=new THREE.Vector3,Q,G,Y,l=0;for(q=W.length;l<q;++l)for(I=W[l].start,R=W[l].count,X=W[l].index,o=I,I+=R;o<I;o+=3)R=X+n[o],U=X+n[o+1],z=X+n[o+2],t(R),t(U),t(z)}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535),Date.now(),e=this.attributes.index.array;for(var n=this.attributes.position.array,r=e.length/3,i=new Uint16Array(e.length),s=0,o=0,u=[{start:0,count:0,index:0}],a=u[0],f=0,l=0,c=new Int32Array(6),h=new Int32Array(n.length),p=new Int32Array(n.length),d=0;d<n.length;d++)h[d]=-1,p[d]=-1;for(n=0;n<r;n++){for(var v=l=0;3>v;v++)d=e[3*n+v],-1==h[d]?(c[2*v]=d,c[2*v+1]=-1,l++):h[d]<a.index?(c[2*v]=d,c[2*v+1]=-1,f++):(c[2*v]=d,c[2*v+1]=h[d]);if(o+l>a.index+t)for(a={start:s,count:0,index:o},u.push(a),l=0;6>l;l+=2)v=c[l+1],-1<v&&v<a.index&&(c[l+1]=-1);for(l=0;6>l;l+=2)d=c[l],v=c[l+1],-1===v&&(v=o++),h[d]=v,p[v]=d,i[s++]=v-a.index,a.count++}return this.reorderBuffers(i,p,o),this.offsets=u},merge:function(){console.log("BufferGeometry.merge(): TODO")},normalizeNormals:function(){for(var e=this.attributes.normal.array,t,n,r,i=0,s=e.length;i<s;i+=3)t=e[i],n=e[i+1],r=e[i+2],t=1/Math.sqrt(t*t+n*n+r*r),e[i]*=t,e[i+1]*=t,e[i+2]*=t},reorderBuffers:function(e,t,n){var r={},i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],s;for(s in this.attributes)if("index"!=s)for(var o=this.attributes[s].array,u=0,a=i.length;u<a;u++){var f=i[u];if(o instanceof f){r[s]=new f(this.attributes[s].itemSize*n);break}}for(i=0;i<n;i++)for(s in o=t[i],this.attributes)if("index"!=s)for(var u=this.attributes[s].array,a=this.attributes[s].itemSize,f=r[s],l=0;l<a;l++)f[i*a+l]=u[o*a+l];this.attributes.index.array=e;for(s in this.attributes)"index"!=s&&(this.attributes[s].array=r[s],this.attributes[s].numItems=this.attributes[s].itemSize*n)},clone:function(){var e=new THREE.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],n;for(n in this.attributes){for(var r=this.attributes[n],i=r.array,s={itemSize:r.itemSize,array:null},r=0,o=t.length;r<o;r++){var u=t[r];if(i instanceof u){s.array=new u(i);break}}e.attributes[n]=s}r=0;for(o=this.offsets.length;r<o;r++)t=this.offsets[r],e.offsets.push({start:t.start,index:t.index,count:t.count});return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);n=0;for(r=this.faces.length;n<r;n++){e=this.faces[n],e.normal.applyMatrix3(t).normalize();for(var i=0,s=e.vertexNormals.length;i<s;i++)e.vertexNormals[i].applyMatrix3(t).normalize()}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],s=this.vertices[i.a],o=this.vertices[i.b];e.subVectors(this.vertices[i.c],o),t.subVectors(s,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r;r=Array(this.vertices.length),t=0;for(n=this.vertices.length;t<n;t++)r[t]=new THREE.Vector3;if(e){var i,s,o,u=new THREE.Vector3,a=new THREE.Vector3;new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],i=this.vertices[n.a],s=this.vertices[n.b],o=this.vertices[n.c],u.subVectors(o,s),a.subVectors(i,s),u.cross(a),r[n.a].add(u),r[n.b].add(u),r[n.c].add(u)}else for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],r[n.a].add(n.normal),r[n.b].add(n.normal),r[n.c].add(n.normal);t=0;for(n=this.vertices.length;t<n;t++)r[t].normalize();e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n.vertexNormals[0]=r[n.a].clone(),n.vertexNormals[1]=r[n.b].clone(),n.vertexNormals[2]=r[n.c].clone()},computeMorphNormals:function(){var e,t,n,r,i;n=0;for(r=this.faces.length;n<r;n++)for(i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var s=new THREE.Geometry;s.faces=this.faces,e=0;for(t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[],i=this.morphNormals[e].faceNormals;var o=this.morphNormals[e].vertexNormals,u,a;n=0;for(r=this.faces.length;n<r;n++)u=new THREE.Vector3,a={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},i.push(u),o.push(a)}o=this.morphNormals[e],s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals(),n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],u=o.faceNormals[n],a=o.vertexNormals[n],u.copy(i.normal),a.a.copy(i.vertexNormals[0]),a.b.copy(i.vertexNormals[1]),a.c.copy(i.vertexNormals[2])}n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=[],y=[];n=new THREE.Vector3;var b=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3,S=new THREE.Vector3;e=0;for(t=this.vertices.length;e<t;e++)g[e]=new THREE.Vector3,y[e]=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)i=this.faces[e],s=this.faceVertexUvs[0][e],r=i.a,m=i.b,i=i.c,o=this.vertices[r],u=this.vertices[m],a=this.vertices[i],f=s[0],l=s[1],c=s[2],s=u.x-o.x,h=a.x-o.x,p=u.y-o.y,d=a.y-o.y,u=u.z-o.z,o=a.z-o.z,a=l.x-f.x,v=c.x-f.x,l=l.y-f.y,f=c.y-f.y,c=1/(a*f-v*l),n.set((f*s-l*h)*c,(f*p-l*d)*c,(f*u-l*o)*c),b.set((a*h-v*s)*c,(a*d-v*p)*c,(a*o-v*u)*c),g[r].add(n),g[m].add(n),g[i].add(n),y[r].add(b),y[m].add(b),y[i].add(b);b=["a","b","c","d"],e=0;for(t=this.faces.length;e<t;e++)for(i=this.faces[e],n=0;n<Math.min(i.vertexNormals.length,3);n++)S.copy(i.vertexNormals[n]),r=i[b[n]],m=g[r],w.copy(m),w.sub(S.multiplyScalar(S.dot(m))).normalize(),E.crossVectors(i.vertexNormals[n],m),r=E.dot(y[r]),r=0>r?-1:1,i.vertexTangents[n]=new THREE.Vector4(w.x,w.y,w.z,r);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,r=t.length;n<r;n++)0<n&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(0==e instanceof THREE.Geometry)console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);else{var r,i=this.vertices.length,s=this.vertices,o=e.vertices,u=this.faces,a=e.faces,f=this.faceVertexUvs[0];e=e.faceVertexUvs[0],void 0===n&&(n=0),void 0!==t&&(r=(new THREE.Matrix3).getNormalMatrix(t));for(var l=0,c=o.length;l<c;l++){var h=o[l].clone();void 0!==t&&h.applyMatrix4(t),s.push(h)}l=0;for(c=a.length;l<c;l++){var o=a[l],p,d=o.vertexNormals,v=o.vertexColors,h=new THREE.Face3(o.a+i,o.b+i,o.c+i);h.normal.copy(o.normal),void 0!==r&&h.normal.applyMatrix3(r).normalize(),t=0;for(s=d.length;t<s;t++)p=d[t].clone(),void 0!==r&&p.applyMatrix3(r).normalize(),h.vertexNormals.push(p);h.color.copy(o.color),t=0;for(s=v.length;t<s;t++)p=v[t],h.vertexColors.push(p.clone());h.materialIndex=o.materialIndex+n,u.push(h)}l=0;for(c=e.length;l<c;l++)if(n=e[l],r=[],void 0!==n){t=0;for(s=n.length;t<s;t++)r.push(new THREE.Vector2(n[t].x,n[t].y));f.push(r)}}},mergeVertices:function(){var e={},t=[],n=[],r,i=Math.pow(10,4),s,o;s=0;for(o=this.vertices.length;s<o;s++)r=this.vertices[s],r=Math.round(r.x*i)+"_"+Math.round(r.y*i)+"_"+Math.round(r.z*i),void 0===e[r]?(e[r]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[r]];e=[],s=0;for(o=this.faces.length;s<o;s++)for(i=this.faces[s],i.a=n[i.a],i.b=n[i.b],i.c=n[i.c],i=[i.a,i.b,i.c],r=0;3>r;r++)if(i[r]==i[(r+1)%3]){e.push(s);break}for(s=e.length-1;0<=s;s--)for(i=e[s],this.faces.splice(i,1),n=0,o=this.faceVertexUvs.length;n<o;n++)this.faceVertexUvs[n].splice(i,1);return s=this.vertices.length-t.length,this.vertices=t,s},makeGroups:function(){var e=0;return function(t,n){var r,i,s,o,u={},f=this.morphTargets.length,l=this.morphNormals.length;this.geometryGroups={},r=0;for(i=this.faces.length;r<i;r++)s=this.faces[r],s=t?s.materialIndex:0,s in u||(u[s]={hash:s,counter:0}),o=u[s].hash+"_"+u[s].counter,o in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:f,numMorphNormals:l}),this.geometryGroups[o].vertices+3>n&&(u[s].counter+=1,o=u[s].hash+"_"+u[s].counter,o in this.geometryGroups||(this.geometryGroups[o]={faces3:[],materialIndex:s,vertices:0,numMorphTargets:f,numMorphNormals:l})),this.geometryGroups[o].faces3.push(r),this.geometryGroups[o].vertices+=3;this.geometryGroupsList=[];for(var c in this.geometryGroups)this.geometryGroups[c].id=e++,this.geometryGroupsList.push(this.geometryGroups[c])}}(),clone:function(){for(var e=new THREE.Geometry,t=this.vertices,n=0,r=t.length;n<r;n++)e.vertices.push(t[n].clone());t=this.faces,n=0;for(r=t.length;n<r;n++)e.faces.push(t[n].clone());t=this.faceVertexUvs[0],n=0;for(r=t.length;n<r;n++){for(var i=t[n],s=[],o=0,u=i.length;o<u;o++)s.push(new THREE.Vector2(i[o].x,i[o].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(e){return void 0===e&&(e=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,n=-t,r=e*n,e=Math.abs(e*t-r),n=Math.abs(t-n);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraLeft=this.shadowCameraLeft,e.shadowCameraRight=this.shadowCameraRight,e.shadowCameraTop=this.shadowCameraTop,e.shadowCameraBottom=this.shadowCameraBottom,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e.shadowCascade=this.shadowCascade,e.shadowCascadeOffset.copy(this.shadowCascadeOffset),e.shadowCascadeCount=this.shadowCascadeCount,e.shadowCascadeBias=this.shadowCascadeBias.slice(0),e.shadowCascadeWidth=this.shadowCascadeWidth.slice(0),e.shadowCascadeHeight=this.shadowCascadeHeight.slice(0),e.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0),e.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0),e},THREE.HemisphereLight=function(e,t,n){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==n?n:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,n,r,i){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==i?i:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e.shadowCameraNear=this.shadowCameraNear,e.shadowCameraFar=this.shadowCameraFar,e.shadowCameraFov=this.shadowCameraFov,e.shadowCameraVisible=this.shadowCameraVisible,e.shadowBias=this.shadowBias,e.shadowDarkness=this.shadowDarkness,e.shadowMapWidth=this.shadowMapWidth,e.shadowMapHeight=this.shadowMapHeight,e},THREE.Cache=function(){this.files={}},THREE.Cache.prototype={constructor:THREE.Cache,add:function(e,t){this.files[e]=t},get:function(e){return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.imageLoader=new THREE.ImageLoader,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1024).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(e,t){for(var n=[],r=0;r<e.length;++r)n[r]=this.createMaterial(e[r],t);return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++)if(e[t]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function n(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function r(e,r,i,o,u,a,l){var h=/\.dds$/i.test(i),p=t+i;if(h){var d=THREE.ImageUtils.loadCompressedTexture(p);e[r]=d}else d=document.createElement("canvas"),e[r]=new THREE.Texture(d);e[r].sourceFile=i,o&&(e[r].repeat.set(o[0],o[1]),1!==o[0]&&(e[r].wrapS=THREE.RepeatWrapping),1!==o[1]&&(e[r].wrapT=THREE.RepeatWrapping)),u&&e[r].offset.set(u[0],u[1]),a&&(i={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==i[a[0]]&&(e[r].wrapS=i[a[0]]),void 0!==i[a[1]]&&(e[r].wrapT=i[a[1]])),l&&(e[r].anisotropy=l),h||(d=e[r],s.imageLoader.crossOrigin=s.crossOrigin,s.imageLoader.load(p,function(e){if(!1===THREE.Math.isPowerOfTwo(e.width)||!1===THREE.Math.isPowerOfTwo(e.height)){var t=n(e.width),r=n(e.height);d.image.width=t,d.image.height=r,d.image.getContext("2d").drawImage(e,0,0,t,r)}else d.image=e;d.needsUpdate=!0}))}function i(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var s=this,o="MeshLambertMaterial",u={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var a=e.shading.toLowerCase();"phong"===a?o="MeshPhongMaterial":"basic"===a&&(o="MeshBasicMaterial")}void 0!==e.blending&&void 0!==THREE[e.blending]&&(u.blending=THREE[e.blending]);if(void 0!==e.transparent||1>e.opacity)u.transparent=e.transparent;return void 0!==e.depthTest&&(u.depthTest=e.depthTest),void 0!==e.depthWrite&&(u.depthWrite=e.depthWrite),void 0!==e.visible&&(u.visible=e.visible),void 0!==e.flipSided&&(u.side=THREE.BackSide),void 0!==e.doubleSided&&(u.side=THREE.DoubleSide),void 0!==e.wireframe&&(u.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?u.vertexColors=THREE.FaceColors:e.vertexColors&&(u.vertexColors=THREE.VertexColors)),e.colorDiffuse?u.color=i(e.colorDiffuse):e.DbgColor&&(u.color=e.DbgColor),e.colorSpecular&&(u.specular=i(e.colorSpecular)),e.colorAmbient&&(u.ambient=i(e.colorAmbient)),e.colorEmissive&&(u.emissive=i(e.colorEmissive)),e.transparency&&(u.opacity=e.transparency),e.specularCoef&&(u.shininess=e.specularCoef),e.mapDiffuse&&t&&r(u,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&r(u,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&r(u,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&r(u,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&r(u,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(u.bumpScale=e.mapBumpScale),e.mapNormal?(o=THREE.ShaderLib.normalmap,a=THREE.UniformsUtils.clone(o.uniforms),a.tNormal.value=u.normalMap,e.mapNormalFactor&&a.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),u.map&&(a.tDiffuse.value=u.map,a.enableDiffuse.value=!0),u.specularMap&&(a.tSpecular.value=u.specularMap,a.enableSpecular.value=!0),u.lightMap&&(a.tAO.value=u.lightMap,a.enableAO.value=!0),a.diffuse.value.setHex(u.color),a.specular.value.setHex(u.specular),a.ambient.value.setHex(u.ambient),a.shininess.value=u.shininess,void 0!==u.opacity&&(a.opacity.value=u.opacity),o=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:a,lights:!0,fog:!0}),u.transparent&&(o.transparent=!0)):o=new THREE[o](u),void 0!==e.DbgName&&(o.name=e.DbgName),o}},THREE.XHRLoader=function(e){this.cache=new THREE.Cache,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,n,r){var i=this,s=i.cache.get(e);void 0!==s?t(s):(s=new XMLHttpRequest,void 0!==t&&s.addEventListener("load",function(n){i.cache.add(e,n.target.responseText),t(n.target.responseText),i.manager.itemEnd(e)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==r&&s.addEventListener("error",function(e){r(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.open("GET",e,!0),s.send(null),i.manager.itemStart(e))},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ImageLoader=function(e){this.cache=new THREE.Cache,this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,n,r){var i=this,s=i.cache.get(e);if(void 0===s)return s=document.createElement("img"),void 0!==t&&s.addEventListener("load",function(n){i.cache.add(e,this),t(this),i.manager.itemEnd(e)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==r&&s.addEventListener("error",function(e){r(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,i.manager.itemStart(e),s;t(s)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(200===s.status||0===s.status){if(s.responseText){var u=JSON.parse(s.responseText);if(void 0!==u.metadata&&"scene"===u.metadata.type){console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}u=e.parse(u,r),n(u.geometry,u.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+s.status+")");else s.readyState===s.LOADING?i&&(0===o&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&void 0!==i&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.withCredentials=this.withCredentials,s.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){var n=new THREE.Geometry,r=void 0!==e.scale?1/e.scale:1;return function(t){var r,i,s,o,u,f,l,h,p,d,v,m,g,y=e.faces;f=e.vertices;var b=e.normals,w=e.colors,E=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&E++;for(r=0;r<E;r++)n.faceVertexUvs[r]=[]}o=0;for(u=f.length;o<u;)r=new THREE.Vector3,r.x=f[o++]*t,r.y=f[o++]*t,r.z=f[o++]*t,n.vertices.push(r);o=0;for(u=y.length;o<u;)if(t=y[o++],p=t&1,s=t&2,r=t&8,l=t&16,d=t&32,f=t&64,t&=128,p){p=new THREE.Face3,p.a=y[o],p.b=y[o+1],p.c=y[o+3],v=new THREE.Face3,v.a=y[o+1],v.b=y[o+2],v.c=y[o+3],o+=4,s&&(s=y[o++],p.materialIndex=s,v.materialIndex=s),s=n.faces.length;if(r)for(r=0;r<E;r++)for(m=e.uvs[r],n.faceVertexUvs[r][s]=[],n.faceVertexUvs[r][s+1]=[],i=0;4>i;i++)h=y[o++],g=m[2*h],h=m[2*h+1],g=new THREE.Vector2(g,h),2!==i&&n.faceVertexUvs[r][s].push(g),0!==i&&n.faceVertexUvs[r][s+1].push(g);l&&(l=3*y[o++],p.normal.set(b[l++],b[l++],b[l]),v.normal.copy(p.normal));if(d)for(r=0;4>r;r++)l=3*y[o++],d=new THREE.Vector3(b[l++],b[l++],b[l]),2!==r&&p.vertexNormals.push(d),0!==r&&v.vertexNormals.push(d);f&&(f=y[o++],f=w[f],p.color.setHex(f),v.color.setHex(f));if(t)for(r=0;4>r;r++)f=y[o++],f=w[f],2!==r&&p.vertexColors.push(new THREE.Color(f)),0!==r&&v.vertexColors.push(new THREE.Color(f));n.faces.push(p),n.faces.push(v)}else{p=new THREE.Face3,p.a=y[o++],p.b=y[o++],p.c=y[o++],s&&(s=y[o++],p.materialIndex=s),s=n.faces.length;if(r)for(r=0;r<E;r++)for(m=e.uvs[r],n.faceVertexUvs[r][s]=[],i=0;3>i;i++)h=y[o++],g=m[2*h],h=m[2*h+1],g=new THREE.Vector2(g,h),n.faceVertexUvs[r][s].push(g);l&&(l=3*y[o++],p.normal.set(b[l++],b[l++],b[l]));if(d)for(r=0;3>r;r++)l=3*y[o++],d=new THREE.Vector3(b[l++],b[l++],b[l]),p.vertexNormals.push(d);f&&(f=y[o++],p.color.setHex(w[f]));if(t)for(r=0;3>r;r++)f=y[o++],p.vertexColors.push(new THREE.Color(w[f]));n.faces.push(p)}}(r),function(){var t=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,i=e.skinWeights.length;r<i;r+=t)n.skinWeights.push(new THREE.Vector4(e.skinWeights[r],1<t?e.skinWeights[r+1]:0,2<t?e.skinWeights[r+2]:0,3<t?e.skinWeights[r+3]:0));if(e.skinIndices)for(r=0,i=e.skinIndices.length;r<i;r+=t)n.skinIndices.push(new THREE.Vector4(e.skinIndices[r],1<t?e.skinIndices[r+1]:0,2<t?e.skinIndices[r+2]:0,3<t?e.skinIndices[r+3]:0));n.bones=e.bones,n.bones&&0<n.bones.length&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match."),n.animation=e.animation,n.animations=e.animations}(),function(t){if(void 0!==e.morphTargets){var r,i,s,o,u,f;r=0;for(i=e.morphTargets.length;r<i;r++)for(n.morphTargets[r]={},n.morphTargets[r].name=e.morphTargets[r].name,n.morphTargets[r].vertices=[],u=n.morphTargets[r].vertices,f=e.morphTargets[r].vertices,s=0,o=f.length;s<o;s+=3){var l=new THREE.Vector3;l.x=f[s]*t,l.y=f[s+1]*t,l.z=f[s+2]*t,u.push(l)}}if(void 0!==e.morphColors)for(r=0,i=e.morphColors.length;r<i;r++)for(n.morphColors[r]={},n.morphColors[r].name=e.morphColors[r].name,n.morphColors[r].colors=[],o=n.morphColors[r].colors,u=e.morphColors[r].colors,t=0,s=u.length;t<s;t+=3)f=new THREE.Color(16755200),f.setRGB(u[t],u[t+1],u[t+2]),o.push(f)}(r),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:n}:(r=this.initMaterials(e.materials,t),this.needsTangents(r)&&n.computeTangents(),{geometry:n,materials:r})},THREE.LoadingManager=function(e,t,n){var r=this,i=0,s=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++},this.itemEnd=function(e){i++,void 0!==r.onProgress&&r.onProgress(e,i,s),i===s&&void 0!==r.onLoad&&r.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader,n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry,n=e.attributes,r=e.offsets;e=e.boundingSphere;for(var i in n){var s=n[i];t.attributes[i]={itemSize:s.itemSize,array:new self[s.type](s.array)}}return void 0!==r&&(t.offsets=JSON.parse(JSON.stringify(r))),void 0!==e&&(t.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==e.center?e.center:[0,0,0]),e.radius)),t}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader,n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe);if(void 0!==e.materials)for(var n=0,r=e.materials.length;n<r;n++)t.materials.push(this.parse(e.materials[n]));return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader(i.manager),n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),n=this.parseMaterials(e.materials);return this.parseObject(e.object,t,n)},parseGeometries:function(e){var t={};if(void 0!==e)for(var n=new THREE.JSONLoader,r=new THREE.BufferGeometryLoader,i=0,s=e.length;i<s;i++){var o,u=e[i];switch(u.type){case"PlaneGeometry":o=new THREE.PlaneGeometry(u.width,u.height,u.widthSegments,u.heightSegments);break;case"BoxGeometry":case"CubeGeometry":o=new THREE.BoxGeometry(u.width,u.height,u.depth,u.widthSegments,u.heightSegments,u.depthSegments);break;case"CircleGeometry":o=new THREE.CircleGeometry(u.radius,u.segments);break;case"CylinderGeometry":o=new THREE.CylinderGeometry(u.radiusTop,u.radiusBottom,u.height,u.radialSegments,u.heightSegments,u.openEnded);break;case"SphereGeometry":o=new THREE.SphereGeometry(u.radius,u.widthSegments,u.heightSegments,u.phiStart,u.phiLength,u.thetaStart,u.thetaLength);break;case"IcosahedronGeometry":o=new THREE.IcosahedronGeometry(u.radius,u.detail);break;case"TorusGeometry":o=new THREE.TorusGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.arc);break;case"TorusKnotGeometry":o=new THREE.TorusKnotGeometry(u.radius,u.tube,u.radialSegments,u.tubularSegments,u.p,u.q,u.heightScale);break;case"BufferGeometry":o=r.parse(u.data);break;case"Geometry":o=n.parse(u.data).geometry}o.uuid=u.uuid,void 0!==u.name&&(o.name=u.name),t[u.uuid]=o}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var n=new THREE.MaterialLoader,r=0,i=e.length;r<i;r++){var s=e[r],o=n.parse(s);o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),t[s.uuid]=o}return t},parseObject:function(){var e=new THREE.Matrix4;return function(t,n,r){var i;switch(t.type){case"Scene":i=new THREE.Scene;break;case"PerspectiveCamera":i=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":i=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":i=new THREE.AmbientLight(t.color);break;case"DirectionalLight":i=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":i=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":i=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":i=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":i=n[t.geometry];var s=r[t.material];void 0===i&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===s&&console.error("THREE.ObjectLoader: Undefined material "+t.material),i=new THREE.Mesh(i,s);break;case"Sprite":s=r[t.material],void 0===s&&console.error("THREE.ObjectLoader: Undefined material "+t.material),i=new THREE.Sprite(s);break;default:i=new THREE.Object3D}i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.userData&&(i.userData=t.userData);if(void 0!==t.children)for(var o in t.children)i.add(this.parseObject(t.children[o],n,r));return i}}()},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader(i.manager),n.setCrossOrigin(this.crossOrigin),n.load(e,function(n){i.parse(JSON.parse(n),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,n){function r(e,t){return"relativeToHTML"==t?e:p+e}function i(){s(T.scene,C.objects)}function s(e,t){var n,i,o,u,f,l;for(l in t){var c=T.objects[l],p=t[l];if(void 0===c){if(p.type&&p.type in h.hierarchyHandlers){if(void 0===p.loading){n={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var g={},y;for(y in p)y in n||(g[y]=p[y]);v=T.materials[p.material],p.loading=!0,n=h.hierarchyHandlers[p.type].loaderObject,n.options?n.load(r(p.url,C.urlBaseType),a(l,e,v,p)):n.load(r(p.url,C.urlBaseType),a(l,e,v,p),g)}}else if(void 0!==p.geometry){if(d=T.geometries[p.geometry]){c=!1,v=T.materials[p.material],c=v instanceof THREE.ShaderMaterial,i=p.position,o=p.rotation,u=p.scale,n=p.matrix,f=p.quaternion,p.material||(v=new THREE.MeshFaceMaterial(T.face_materials[p.geometry])),v instanceof THREE.MeshFaceMaterial&&0===v.materials.length&&(v=new THREE.MeshFaceMaterial(T.face_materials[p.geometry]));if(v instanceof THREE.MeshFaceMaterial)for(g=0;g<v.materials.length;g++)c=c||v.materials[g]instanceof THREE.ShaderMaterial;c&&d.computeTangents(),p.skin?c=new THREE.SkinnedMesh(d,v):p.morph?(c=new THREE.MorphAnimMesh(d,v),void 0!==p.duration&&(c.duration=p.duration),void 0!==p.time&&(c.time=p.time),void 0!==p.mirroredLoop&&(c.mirroredLoop=p.mirroredLoop),v.morphNormals&&d.computeMorphNormals()):c=new THREE.Mesh(d,v),c.name=l,n?(c.matrixAutoUpdate=!1,c.matrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])):(c.position.fromArray(i),f?c.quaternion.fromArray(f):c.rotation.fromArray(o),c.scale.fromArray(u)),c.visible=p.visible,c.castShadow=p.castShadow,c.receiveShadow=p.receiveShadow,e.add(c),T.objects[l]=c}}else if("AmbientLight"===p.type||"PointLight"===p.type||"DirectionalLight"===p.type||"SpotLight"===p.type||"HemisphereLight"===p.type||"AreaLight"===p.type){g=p.color,n=p.intensity,i=p.distance,o=p.position,u=p.rotation;switch(p.type){case"AmbientLight":b=new THREE.AmbientLight(g);break;case"PointLight":b=new THREE.PointLight(g,n,i),b.position.fromArray(o);break;case"DirectionalLight":b=new THREE.DirectionalLight(g,n),b.position.fromArray(p.direction);break;case"SpotLight":b=new THREE.SpotLight(g,n,i,1),b.angle=p.angle,b.position.fromArray(o),b.target.set(o[0],o[1]-i,o[2]),b.target.applyEuler(new THREE.Euler(u[0],u[1],u[2],"XYZ"));break;case"HemisphereLight":b=new THREE.DirectionalLight(g,n,i),b.target.set(o[0],o[1]-i,o[2]),b.target.applyEuler(new THREE.Euler(u[0],u[1],u[2],"XYZ"));break;case"AreaLight":b=new THREE.AreaLight(g,n),b.position.fromArray(o),b.width=p.size,b.height=p.size_y}e.add(b),b.name=l,T.lights[l]=b,T.objects[l]=b}else"PerspectiveCamera"===p.type||"OrthographicCamera"===p.type?(i=p.position,o=p.rotation,f=p.quaternion,"PerspectiveCamera"===p.type?m=new THREE.PerspectiveCamera(p.fov,p.aspect,p.near,p.far):"OrthographicCamera"===p.type&&(m=new THREE.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far)),m.name=l,m.position.fromArray(i),void 0!==f?m.quaternion.fromArray(f):void 0!==o&&m.rotation.fromArray(o),e.add(m),T.cameras[l]=m,T.objects[l]=m):(i=p.position,o=p.rotation,u=p.scale,f=p.quaternion,c=new THREE.Object3D,c.name=l,c.position.fromArray(i),f?c.quaternion.fromArray(f):c.rotation.fromArray(o),c.scale.fromArray(u),c.visible=void 0!==p.visible?p.visible:!1,e.add(c),T.objects[l]=c,T.empties[l]=c);if(c){if(void 0!==p.userData)for(var w in p.userData)c.userData[w]=p.userData[w];if(void 0!==p.groups)for(g=0;g<p.groups.length;g++)n=p.groups[g],void 0===T.groups[n]&&(T.groups[n]=[]),T.groups[n].push(l)}}void 0!==c&&void 0!==p.children&&s(c,p.children)}}function o(e,t,n,r,s){var o=s.rotation,u=s.quaternion,a=s.scale;e.position.fromArray(s.position),u?e.quaternion.fromArray(u):e.rotation.fromArray(o),e.scale.fromArray(a),r&&e.traverse(function(e){e.material=r});var f=void 0!==s.visible?s.visible:!0;e.traverse(function(e){e.visible=f}),n.add(e),e.name=t,T.objects[t]=e,i()}function u(e){return function(t,n){t.name=e,T.geometries[e]=t,T.face_materials[e]=n,i(),w-=1,h.onLoadComplete(),l()}}function a(e,t,n,r){return function(i){o(i.content?i.content:i.dae?i.scene:i,e,t,n,r),w-=1,h.onLoadComplete(),l()}}function f(e){return function(t,n){t.name=e,T.geometries[e]=t,T.face_materials[e]=n}}function l(){h.callbackProgress({totalModels:S,totalTextures:x,loadedModels:S-w,loadedTextures:x-E},T),h.onLoadProgress();if(0===w&&0===E){for(var e=0;e<N.length;e++){var n=N[e],r=T.objects[n.targetName];r?n.object.target=r:(n.object.target=new THREE.Object3D,T.scene.add(n.object.target)),n.object.target.userData.targetInverse=n.object}t(T)}}function c(e,t){t(e);if(void 0!==e.children)for(var n in e.children)c(e.children[n],t)}var h=this,p=THREE.Loader.prototype.extractUrlBase(n),d,v,m,g,y,b,w,E,S,x,T,N=[],C=e,k;for(k in this.geometryHandlers)e=this.geometryHandlers[k].loaderClass,this.geometryHandlers[k].loaderObject=new e;for(k in this.hierarchyHandlers)e=this.hierarchyHandlers[k].loaderClass,this.hierarchyHandlers[k].loaderObject=new e;E=w=0,T={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},C.transform&&(k=C.transform.position,e=C.transform.rotation,n=C.transform.scale,k&&T.scene.position.fromArray(k),e&&T.scene.rotation.fromArray(e),n&&T.scene.scale.fromArray(n),k||e||n)&&(T.scene.updateMatrix(),T.scene.updateMatrixWorld()),k=function(e){return function(){E-=e,l(),h.onLoadComplete()}};for(var L in C.fogs)e=C.fogs[L],"linear"===e.type?g=new THREE.Fog(0,e.near,e.far):"exp2"===e.type&&(g=new THREE.FogExp2(0,e.density)),e=e.color,g.color.setRGB(e[0],e[1],e[2]),T.fogs[L]=g;for(var A in C.geometries)g=C.geometries[A],g.type in this.geometryHandlers&&(w+=1,h.onLoadStart());for(var O in C.objects)c(C.objects[O],function(e){e.type&&e.type in h.hierarchyHandlers&&(w+=1,h.onLoadStart())});S=w;for(A in C.geometries)if(g=C.geometries[A],"cube"===g.type)d=new THREE.BoxGeometry(g.width,g.height,g.depth,g.widthSegments,g.heightSegments,g.depthSegments),d.name=A,T.geometries[A]=d;else if("plane"===g.type)d=new THREE.PlaneGeometry(g.width,g.height,g.widthSegments,g.heightSegments),d.name=A,T.geometries[A]=d;else if("sphere"===g.type)d=new THREE.SphereGeometry(g.radius,g.widthSegments,g.heightSegments),d.name=A,T.geometries[A]=d;else if("cylinder"===g.type)d=new THREE.CylinderGeometry(g.topRad,g.botRad,g.height,g.radSegs,g.heightSegs),d.name=A,T.geometries[A]=d;else if("torus"===g.type)d=new THREE.TorusGeometry(g.radius,g.tube,g.segmentsR,g.segmentsT),d.name=A,T.geometries[A]=d;else if("icosahedron"===g.type)d=new THREE.IcosahedronGeometry(g.radius,g.subdivisions),d.name=A,T.geometries[A]=d;else if(g.type in this.geometryHandlers){O={};for(y in g)"type"!==y&&"url"!==y&&(O[y]=g[y]);this.geometryHandlers[g.type].loaderObject.load(r(g.url,C.urlBaseType),u(A),O)}else"embedded"===g.type&&(O=C.embeds[g.id],O.metadata=C.metadata,O&&(O=this.geometryHandlers.ascii.loaderObject.parse(O,""),f(A)(O.geometry,O.materials)));for(var M in C.textures)if(A=C.textures[M],A.url instanceof Array)for(E+=A.url.length,y=0;y<A.url.length;y++)h.onLoadStart();else E+=1,h.onLoadStart();x=E;for(M in C.textures){A=C.textures[M],void 0!==A.mapping&&void 0!==THREE[A.mapping]&&(A.mapping=new THREE[A.mapping]);if(A.url instanceof Array){O=A.url.length,g=[];for(y=0;y<O;y++)g[y]=r(A.url[y],C.urlBaseType);y=(y=/\.dds$/i.test(g[0]))?THREE.ImageUtils.loadCompressedTextureCube(g,A.mapping,k(O)):THREE.ImageUtils.loadTextureCube(g,A.mapping,k(O))}else y=/\.dds$/i.test(A.url),O=r(A.url,C.urlBaseType),g=k(1),y=y?THREE.ImageUtils.loadCompressedTexture(O,A.mapping,g):THREE.ImageUtils.loadTexture(O,A.mapping,g),void 0!==THREE[A.minFilter]&&(y.minFilter=THREE[A.minFilter]),void 0!==THREE[A.magFilter]&&(y.magFilter=THREE[A.magFilter]),A.anisotropy&&(y.anisotropy=A.anisotropy),A.repeat&&(y.repeat.set(A.repeat[0],A.repeat[1]),1!==A.repeat[0]&&(y.wrapS=THREE.RepeatWrapping),1!==A.repeat[1]&&(y.wrapT=THREE.RepeatWrapping)),A.offset&&y.offset.set(A.offset[0],A.offset[1]),A.wrap&&(O={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==O[A.wrap[0]]&&(y.wrapS=O[A.wrap[0]]),void 0!==O[A.wrap[1]]&&(y.wrapT=O[A.wrap[1]]));T.textures[M]=y}var _,D;for(_ in C.materials){M=C.materials[_];for(D in M.parameters)"envMap"===D||"map"===D||"lightMap"===D||"bumpMap"===D?M.parameters[D]=T.textures[M.parameters[D]]:"shading"===D?M.parameters[D]="flat"===M.parameters[D]?THREE.FlatShading:THREE.SmoothShading:"side"===D?M.parameters[D]="double"==M.parameters[D]?THREE.DoubleSide:"back"==M.parameters[D]?THREE.BackSide:THREE.FrontSide:"blending"===D?M.parameters[D]=M.parameters[D]in THREE?THREE[M.parameters[D]]:THREE.NormalBlending:"combine"===D?M.parameters[D]=M.parameters[D]in THREE?THREE[M.parameters[D]]:THREE.MultiplyOperation:"vertexColors"===D?"face"==M.parameters[D]?M.parameters[D]=THREE.FaceColors:M.parameters[D]&&(M.parameters[D]=THREE.VertexColors):"wrapRGB"===D&&(k=M.parameters[D],M.parameters[D]=new THREE.Vector3(k[0],k[1],k[2]));void 0!==M.parameters.opacity&&1>M.parameters.opacity&&(M.parameters.transparent=!0),M.parameters.normalMap?(k=THREE.ShaderLib.normalmap,A=THREE.UniformsUtils.clone(k.uniforms),y=M.parameters.color,O=M.parameters.specular,g=M.parameters.ambient,L=M.parameters.shininess,A.tNormal.value=T.textures[M.parameters.normalMap],M.parameters.normalScale&&A.uNormalScale.value.set(M.parameters.normalScale[0],M.parameters.normalScale[1]),M.parameters.map&&(A.tDiffuse.value=M.parameters.map,A.enableDiffuse.value=!0),M.parameters.envMap&&(A.tCube.value=M.parameters.envMap,A.enableReflection.value=!0,A.reflectivity.value=M.parameters.reflectivity),M.parameters.lightMap&&(A.tAO.value=M.parameters.lightMap,A.enableAO.value=!0),M.parameters.specularMap&&(A.tSpecular.value=T.textures[M.parameters.specularMap],A.enableSpecular.value=!0),M.parameters.displacementMap&&(A.tDisplacement.value=T.textures[M.parameters.displacementMap],A.enableDisplacement.value=!0,A.uDisplacementBias.value=M.parameters.displacementBias,A.uDisplacementScale.value=M.parameters.displacementScale),A.diffuse.value.setHex(y),A.specular.value.setHex(O),A.ambient.value.setHex(g),A.shininess.value=L,M.parameters.opacity&&(A.opacity.value=M.parameters.opacity),v=new THREE.ShaderMaterial({fragmentShader:k.fragmentShader,vertexShader:k.vertexShader,uniforms:A,lights:!0,fog:!0})):v=new THREE[M.type](M.parameters),v.name=_,T.materials[_]=v}for(_ in C.materials)if(M=C.materials[_],M.parameters.materials){D=[];for(y=0;y<M.parameters.materials.length;y++)D.push(T.materials[M.parameters.materials[y]]);T.materials[_].materials=D}i(),T.cameras&&C.defaults.camera&&(T.currentCamera=T.cameras[C.defaults.camera]),T.fogs&&C.defaults.fog&&(T.scene.fog=T.fogs[C.defaults.fog]),h.callbackSync(T),l()}},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,n,r){n=new THREE.ImageLoader(this.manager),n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){e=new THREE.Texture(e),e.needsUpdate=!0,void 0!==t&&t(e)})},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.needsUpdate=this.visible=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0===n)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if(t in this){var r=this[t];r instanceof THREE.Color?r.set(n):r instanceof THREE.Vector3&&n instanceof THREE.Vector3?r.copy(n):this[t]="overdraw"==t?Number(n):n}}},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.wrapAround=this.metal=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=this.morphTargets=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){for(var e=new THREE.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},THREE.ParticleSystemMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleSystemMaterial.prototype.clone=function(){var e=new THREE.ParticleSystemMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial,THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.RawShaderMaterial=function(e){THREE.ShaderMaterial.call(this,e)},THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype),THREE.RawShaderMaterial.prototype.clone=function(){var e=new THREE.RawShaderMaterial;return THREE.ShaderMaterial.prototype.clone.call(this,e),e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial,THREE.Texture=function(e,t,n,r,i,s,o,u,a){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:THREE.LinearFilter,this.minFilter=void 0!==s?s:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==a?a:1,this.format=void 0!==o?o:THREE.RGBAFormat,this.type=void 0!==u?u:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={width:t,height:n},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={data:e,width:t,height:n}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.ParticleSystemMaterial({color:16777215*Math.random()}),this.frustumCulled=this.sortParticles=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e,t){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e,t),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0,this.accumulatedSclWeight=this.accumulatedPosWeight=this.accumulatedRotWeight=0;for(var n=0,r=this.children.length;n<r;n++)this.children[n].update(this.skinMatrix,t)},THREE.Skeleton=function(e,t){this.useVertexTexture=void 0!==t?t:!0,this.bones=[],this.boneMatrices=[];var n,r,i,s,o;if(void 0!==e){for(var u=0;u<e.length;++u)r=e[u],i=r.pos,s=r.rotq,o=r.scl,n=this.addBone(),n.name=r.name,n.position.set(i[0],i[1],i[2]),n.quaternion.set(s[0],s[1],s[2],s[3]),void 0!==o?n.scale.set(o[0],o[1],o[2]):n.scale.set(1,1,1);for(u=0;u<e.length;++u)r=e[u],-1!==r.parent&&this.bones[r.parent].add(this.bones[u]);n=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=n=256<n?64:64<n?32:16<n?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*n)}},THREE.Skeleton.prototype=Object.create(THREE.Mesh.prototype),THREE.Skeleton.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.Skeleton.prototype.calculateInverses=function(e){this.boneInverses=[],e=0;for(var t=this.bones.length;e<t;++e){var n=new THREE.Matrix4;n.getInverse(this.bones[e].skinMatrix),this.boneInverses.push(n)}},THREE.SkinnedMesh=function(e,t,n){THREE.Mesh.call(this,e,t),this.skeleton=new THREE.Skeleton(this.geometry&&this.geometry.bones,n);for(e=0;e<this.skeleton.bones.length;++e)t=this.skeleton.bones[e],void 0===t.parent&&this.add(t);this.identityMatrix=new THREE.Matrix4,this.pose()},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new THREE.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;t=0;for(var n=this.children.length;t<n;t++){var r=this.children[t];r instanceof THREE.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}void 0===this.skeleton.boneInverses&&this.skeleton.calculateInverses(),t=0;for(n=this.skeleton.bones.length;t<n;t++)e.multiplyMatrices(this.skeleton.bones[t].skinMatrix,this.skeleton.boneInverses[t]),e.flattenToArrayOffset(this.skeleton.boneMatrices,16*t);this.skeleton.useVertexTexture&&(this.skeleton.boneTexture.needsUpdate=!0)}}(),THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();Infinity!==n?t.multiplyScalar(n):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i].name.match(r);if(o&&1<o.length){o=o[1],n[o]||(n[o]={start:Infinity,end:-Infinity});var u=n[o];i<u.start&&(u.start=i),i>u.end&&(u.end=i),t||(t=o)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){if(1<this.objects.length){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld),n=e.distanceTo(t),this.objects[0].object.visible=!0;for(var r=1,i=this.objects.length;r<i;r++){if(!(n>=this.objects[r].distance))break;this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0}for(;r<i;r++)this.objects[r].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(e){void 0===e&&(e=new THREE.LOD),THREE.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var r=this.objects[t].object.clone();r.visible=0===t,e.addLevel(r,this.objects[t].distance)}return e},THREE.Sprite=function(){var e=new THREE.Float32Attribute(3,3);e.set([-0.5,-0.5,0,.5,-0.5,0,.5,.5,0]);var t=new THREE.BufferGeometry;return t.addAttribute("position",e),function(e){THREE.Object3D.call(this),this.geometry=t,this.material=void 0!==e?e:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Particle=THREE.Sprite,THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}this.dispatchEvent({type:"objectAdded",object:e}),e.dispatchEvent({type:"addedToScene",scene:this});for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1);if(e.shadowCascadeArray)for(t=0;t<e.shadowCascadeArray.length;t++)this.__removeObject(e.shadowCascadeArray[t])}else e instanceof THREE.Camera||(this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),-1!==t&&this.__objectsAdded.splice(t,1));this.dispatchEvent({type:"objectRemoved",object:e}),e.dispatchEvent({type:"removedFromScene",scene:this});for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},THREE.Scene.prototype.clone=function(e){return void 0===e&&(e=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},THREE.Fog=function(e,t,n){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(e,t,n,r){f(t),l(n),c(r),h(e.getStyle()),C.stroke(),at.expandByScalar(2*t)}function n(e){p(e.getStyle()),C.fill()}function r(e){i(e.target)}function i(e){var t=e.wrapS===THREE.RepeatWrapping,n=e.wrapT===THREE.RepeatWrapping,r=e.image,i=document.createElement("canvas");i.width=r.width,i.height=r.height;var s=i.getContext("2d");s.setTransform(1,0,0,-1,0,r.height),s.drawImage(r,0,0),Y[e.id]=C.createPattern(i,!0===t&&!0===n?"repeat":!0===t&&!1===n?"repeat-x":!1===t&&!0===n?"repeat-y":"no-repeat")}function s(e,t,n,s,o,u,a,f,l,c,h,d,v){if(!(v instanceof THREE.DataTexture)){!1===v.hasEventListener("update",r)&&(void 0!==v.image&&0<v.image.width&&i(v),v.addEventListener("update",r));var m=Y[v.id];if(void 0!==m){p(m);var m=v.offset.x/v.repeat.x,g=v.offset.y/v.repeat.y,y=v.image.width*v.repeat.x;v=v.image.height*v.repeat.y,a=(a+m)*y,f=(f+g)*v,n-=e,s-=t,o-=e,u-=t,l=(l+m)*y-a,c=(c+g)*v-f,h=(h+m)*y-a,d=(d+g)*v-f,v=l*d-h*c,0!==v&&(m=1/v,v=(d*n-c*o)*m,c=(d*s-c*u)*m,n=(l*o-h*n)*m,s=(l*u-h*s)*m,e=e-v*a-n*f,t=t-c*a-s*f,C.save(),C.transform(v,c,n,s,e,t),C.fill(),C.restore())}else p("rgba(0,0,0,1)"),C.fill()}}function o(e,t,n){var r=t.x-e.x,i=t.y-e.y,s=r*r+i*i;0!==s&&(n/=Math.sqrt(s),r*=n,i*=n,t.x+=r,t.y+=i,e.x-=r,e.y-=i)}function u(e){A!==e&&(A=C.globalAlpha=e)}function a(e){O!==e&&(e===THREE.NormalBlending?C.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?C.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(C.globalCompositeOperation="darker"),O=e)}function f(e){D!==e&&(D=C.lineWidth=e)}function l(e){P!==e&&(P=C.lineCap=e)}function c(e){H!==e&&(H=C.lineJoin=e)}function h(e){M!==e&&(M=C.strokeStyle=e)}function p(e){_!==e&&(_=C.fillStyle=e)}function d(e,t){if(B!==e||j!==t)C.setLineDash([e,t]),B=e,j=t}console.log("THREE.CanvasRenderer",THREE.REVISION);var v=THREE.Math.smoothstep;e=e||{};var m=this,g,y,b,w=new THREE.Projector,E=void 0!==e.canvas?e.canvas:document.createElement("canvas"),S=E.width,x=E.height,T=Math.floor(S/2),N=Math.floor(x/2),C=E.getContext("2d",{alpha:!0===e.alpha}),k=new THREE.Color(0),L=0,A=1,O=0,M=null,_=null,D=null,P=null,H=null,B=null,j=0,F,I,q,R;new THREE.RenderableVertex,new THREE.RenderableVertex;var U,z,W,X,V,$,J=new THREE.Color;new THREE.Color,new THREE.Color,new THREE.Color,new THREE.Color;var K=new THREE.Color,Q=new THREE.Color,G=new THREE.Color,Y={},Z,et,tt,nt,rt,it,st,ot=new THREE.Box2,ut=new THREE.Box2,at=new THREE.Box2,ft=new THREE.Color,lt=new THREE.Color,ct=new THREE.Color,ht=new THREE.Vector3,pt=new THREE.Vector3,dt=new THREE.Vector3,vt=new THREE.Matrix3;void 0===C.setLineDash&&(C.setLineDash=function(){}),this.domElement=E,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,n){S=e*this.devicePixelRatio,x=t*this.devicePixelRatio,E.width=S,E.height=x,T=Math.floor(S/2),N=Math.floor(x/2),!1!==n&&(E.style.width=e+"px",E.style.height=t+"px"),ot.min.set(-T,-N),ot.max.set(T,N),ut.min.set(-T,-N),ut.max.set(T,N),A=1,O=0,H=P=D=_=M=null,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,r){C.setTransform(n*this.devicePixelRatio/S,0,0,-(r*this.devicePixelRatio)/x,e*this.devicePixelRatio,x-t*this.devicePixelRatio),C.translate(T,N)},this.setScissor=function(){},this.enableScissorTest=function(){},this.setClearColor=function(e,t){k.set(e),L=void 0!==t?t:1,ut.min.set(-T,-N),ut.max.set(T,N)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){!1===ut.empty()&&(ut.intersect(ot),ut.expandByScalar(2),1>L&&C.clearRect(ut.min.x|0,ut.min.y|0,ut.max.x-ut.min.x|0,ut.max.y-ut.min.y|0),0<L&&(a(THREE.NormalBlending),u(1),p("rgba("+Math.floor(255*k.r)+","+Math.floor(255*k.g)+","+Math.floor(255*k.b)+","+L+")"),C.fillRect(ut.min.x|0,ut.min.y|0,ut.max.x-ut.min.x|0,ut.max.y-ut.min.y|0)),ut.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,E){if(0==E instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),m.info.render.vertices=0,m.info.render.faces=0,g=w.projectScene(e,E,this.sortObjects,this.sortElements),y=g.elements,b=g.lights,F=E,vt.getNormalMatrix(E.matrixWorldInverse),ft.setRGB(0,0,0),lt.setRGB(0,0,0),ct.setRGB(0,0,0);for(var S=0,x=b.length;S<x;S++){var k=b[S],L=k.color;k instanceof THREE.AmbientLight?ft.add(L):k instanceof THREE.DirectionalLight?lt.add(L):k instanceof THREE.PointLight&&ct.add(L)}S=0;for(x=y.length;S<x;S++){var A=y[S],O=A.material;if(void 0!==O&&0!==O.opacity){at.makeEmpty();if(A instanceof THREE.RenderableSprite){I=A,I.x*=T,I.y*=N;var k=I,M=A,L=O;u(L.opacity),a(L.blending);var _=M.scale.x*T,M=M.scale.y*N,A=.5*Math.sqrt(_*_+M*M);at.min.set(k.x-A,k.y-A),at.max.set(k.x+A,k.y+A);if(L instanceof THREE.SpriteMaterial||L instanceof THREE.ParticleSystemMaterial){var D=L.map;if(null!==D){!1===D.hasEventListener("update",r)&&(void 0!==D.image&&0<D.image.width&&i(D),D.addEventListener("update",r)),A=Y[D.id],void 0!==A?p(A):p("rgba( 0, 0, 0, 1 )");var P=D.image,A=P.width*D.offset.x,O=P.height*D.offset.y,H=P.width*D.repeat.x,D=P.height*D.repeat.y,P=_/H,B=M/D;C.save(),C.translate(k.x,k.y),0!==L.rotation&&C.rotate(L.rotation),C.translate(-_/2,-M/2),C.scale(P,B),C.translate(-A,-O),C.fillRect(A,O,H,D)}else p(L.color.getStyle()),C.save(),C.translate(k.x,k.y),0!==L.rotation&&C.rotate(L.rotation),C.scale(_,-M),C.fillRect(-0.5,-0.5,1,1);C.restore()}else L instanceof THREE.SpriteCanvasMaterial&&(h(L.color.getStyle()),p(L.color.getStyle()),C.save(),C.translate(k.x,k.y),0!==L.rotation&&C.rotate(L.rotation),C.scale(_,M),L.program(C),C.restore())}else if(A instanceof THREE.RenderableLine){if(I=A.v1,q=A.v2,I.positionScreen.x*=T,I.positionScreen.y*=N,q.positionScreen.x*=T,q.positionScreen.y*=N,at.setFromPoints([I.positionScreen,q.positionScreen]),!0===ot.isIntersectionBox(at))if(k=I,L=q,_=A,M=O,u(M.opacity),a(M.blending),C.beginPath(),C.moveTo(k.positionScreen.x,k.positionScreen.y),C.lineTo(L.positionScreen.x,L.positionScreen.y),M instanceof THREE.LineBasicMaterial){f(M.linewidth),l(M.linecap),c(M.linejoin);if(M.vertexColors!==THREE.VertexColors)h(M.color.getStyle());else if(A=_.vertexColors[0].getStyle(),_=_.vertexColors[1].getStyle(),A===_)h(A);else{try{var j=C.createLinearGradient(k.positionScreen.x,k.positionScreen.y,L.positionScreen.x,L.positionScreen.y);j.addColorStop(0,A),j.addColorStop(1,_)}catch(mt){j=A}h(j)}C.stroke(),at.expandByScalar(2*M.linewidth)}else M instanceof THREE.LineDashedMaterial&&(f(M.linewidth),l(M.linecap),c(M.linejoin),h(M.color.getStyle()),d(M.dashSize,M.gapSize),C.stroke(),at.expandByScalar(2*M.linewidth),d(null,null))}else if(A instanceof THREE.RenderableFace){I=A.v1,q=A.v2,R=A.v3;if(-1>I.positionScreen.z||1<I.positionScreen.z)continue;if(-1>q.positionScreen.z||1<q.positionScreen.z)continue;if(-1>R.positionScreen.z||1<R.positionScreen.z)continue;I.positionScreen.x*=T,I.positionScreen.y*=N,q.positionScreen.x*=T,q.positionScreen.y*=N,R.positionScreen.x*=T,R.positionScreen.y*=N,0<O.overdraw&&(o(I.positionScreen,q.positionScreen,O.overdraw),o(q.positionScreen,R.positionScreen,O.overdraw),o(R.positionScreen,I.positionScreen,O.overdraw)),at.setFromPoints([I.positionScreen,q.positionScreen,R.positionScreen]);if(!0===ot.isIntersectionBox(at)){L=I,_=q,M=R,k=O,m.info.render.vertices+=3,m.info.render.faces++,u(k.opacity),a(k.blending),U=L.positionScreen.x,z=L.positionScreen.y,W=_.positionScreen.x,X=_.positionScreen.y,V=M.positionScreen.x,$=M.positionScreen.y;var O=U,H=z,D=W,P=X,B=V,gt=$;C.beginPath(),C.moveTo(O,H),C.lineTo(D,P),C.lineTo(B,gt),C.closePath();if((k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial)&&null===k.map){K.copy(k.color),Q.copy(k.emissive),k.vertexColors===THREE.FaceColors&&K.multiply(A.color),J.copy(ft),pt.copy(L.positionWorld).add(_.positionWorld).add(M.positionWorld).divideScalar(3),L=pt,_=A.normalModel,M=J,A=0;for(O=b.length;A<O;A++)H=b[A],G.copy(H.color),H instanceof THREE.DirectionalLight?(D=ht.setFromMatrixPosition(H.matrixWorld).normalize(),P=_.dot(D),0>=P||(P*=H.intensity,M.add(G.multiplyScalar(P)))):H instanceof THREE.PointLight&&(D=ht.setFromMatrixPosition(H.matrixWorld),P=_.dot(ht.subVectors(D,L).normalize()),0>=P||(P*=0==H.distance?1:1-Math.min(L.distanceTo(D)/H.distance,1),0!=P&&(P*=H.intensity,M.add(G.multiplyScalar(P)))));J.multiply(K).add(Q),!0===k.wireframe?t(J,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):n(J)}else k instanceof THREE.MeshBasicMaterial||k instanceof THREE.MeshLambertMaterial||k instanceof THREE.MeshPhongMaterial?null!==k.map?k.map.mapping instanceof THREE.UVMapping&&(Z=A.uvs,s(U,z,W,X,V,$,Z[0].x,Z[0].y,Z[1].x,Z[1].y,Z[2].x,Z[2].y,k.map)):null!==k.envMap?k.envMap.mapping instanceof THREE.SphericalReflectionMapping?(dt.copy(A.vertexNormalsModel[0]).applyMatrix3(vt),et=.5*dt.x+.5,tt=.5*dt.y+.5,dt.copy(A.vertexNormalsModel[1]).applyMatrix3(vt),nt=.5*dt.x+.5,rt=.5*dt.y+.5,dt.copy(A.vertexNormalsModel[2]).applyMatrix3(vt),it=.5*dt.x+.5,st=.5*dt.y+.5,s(U,z,W,X,V,$,et,tt,nt,rt,it,st,k.envMap)):k.envMap.mapping instanceof THREE.SphericalRefractionMapping&&(dt.copy(A.vertexNormalsModel[0]).applyMatrix3(vt),et=-0.5*dt.x+.5,tt=-0.5*dt.y+.5,dt.copy(A.vertexNormalsModel[1]).applyMatrix3(vt),nt=-0.5*dt.x+.5,rt=-0.5*dt.y+.5,dt.copy(A.vertexNormalsModel[2]).applyMatrix3(vt),it=-0.5*dt.x+.5,st=-0.5*dt.y+.5,s(U,z,W,X,V,$,et,tt,nt,rt,it,st,k.envMap)):(J.copy(k.color),k.vertexColors===THREE.FaceColors&&J.multiply(A.color),!0===k.wireframe?t(J,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):n(J)):(k instanceof THREE.MeshDepthMaterial?J.r=J.g=J.b=1-v(L.positionScreen.z*L.positionScreen.w,F.near,F.far):k instanceof THREE.MeshNormalMaterial?(dt.copy(A.normalModel).applyMatrix3(vt),J.setRGB(dt.x,dt.y,dt.z).multiplyScalar(.5).addScalar(.5)):J.setRGB(1,1,1),!0===k.wireframe?t(J,k.wireframeLinewidth,k.wireframeLinecap,k.wireframeLinejoin):n(J))}}ut.union(at)}}}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\n	uniform vec3 fogColor;\n	#ifdef FOG_EXP2\n		uniform float fogDensity;\n	#else\n		uniform float fogNear;\n		uniform float fogFar;\n	#endif\n#endif",fog_fragment:"#ifdef USE_FOG\n	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	#ifdef FOG_EXP2\n		const float LOG2 = 1.442695;\n		float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\n		fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n	#else\n		float fogFactor = smoothstep( fogNear, fogFar, depth );\n	#endif\n	gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n	uniform float reflectivity;\n	uniform samplerCube envMap;\n	uniform float flipEnvMap;\n	uniform int combine;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n		uniform bool useRefract;\n		uniform float refractionRatio;\n	#else\n		varying vec3 vReflect;\n	#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n	vec3 reflectVec;\n	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n		vec3 worldNormal = normalize( vec3( vec4( normal, 0.0 ) * viewMatrix ) );\n		if ( useRefract ) {\n			reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n		} else { \n			reflectVec = reflect( cameraToVertex, worldNormal );\n		}\n	#else\n		reflectVec = vReflect;\n	#endif\n	#ifdef DOUBLE_SIDED\n		float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n		vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#else\n		vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n	#endif\n	#ifdef GAMMA_INPUT\n		cubeColor.xyz *= cubeColor.xyz;\n	#endif\n	if ( combine == 1 ) {\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n	} else if ( combine == 2 ) {\n		gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n	} else {\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n	}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n	varying vec3 vReflect;\n	uniform float refractionRatio;\n	uniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n	#ifdef USE_SKINNING\n		vec4 worldPosition = modelMatrix * skinned;\n	#endif\n	#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n		vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n	#endif\n	#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\n		vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\n	vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\n	worldNormal = normalize( worldNormal );\n	vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n	if ( useRefract ) {\n		vReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n	} else {\n		vReflect = reflect( cameraToVertex, worldNormal );\n	}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\n	gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	varying vec2 vUv;\n	uniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	varying vec2 vUv;\n#endif\n#ifdef USE_MAP\n	uniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\n	vUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n	vec4 texelColor = texture2D( map, vUv );\n	#ifdef GAMMA_INPUT\n		texelColor.xyz *= texelColor.xyz;\n	#endif\n	gl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n	varying vec2 vUv2;\n	uniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\n	varying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\n	gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\n	vUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n	uniform sampler2D bumpMap;\n	uniform float bumpScale;\n	vec2 dHdxy_fwd() {\n		vec2 dSTdx = dFdx( vUv );\n		vec2 dSTdy = dFdy( vUv );\n		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n		return vec2( dBx, dBy );\n	}\n	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n		vec3 vSigmaX = dFdx( surf_pos );\n		vec3 vSigmaY = dFdy( surf_pos );\n		vec3 vN = surf_norm;\n		vec3 R1 = cross( vSigmaY, vN );\n		vec3 R2 = cross( vN, vSigmaX );\n		float fDet = dot( vSigmaX, R1 );\n		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n		return normalize( abs( fDet ) * surf_norm - vGrad );\n	}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n	uniform sampler2D normalMap;\n	uniform vec2 normalScale;\n	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n		vec3 q0 = dFdx( eye_pos.xyz );\n		vec3 q1 = dFdy( eye_pos.xyz );\n		vec2 st0 = dFdx( vUv.st );\n		vec2 st1 = dFdy( vUv.st );\n		vec3 S = normalize(  q0 * st1.t - q1 * st0.t );\n		vec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n		vec3 N = normalize( surf_norm );\n		vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n		mapN.xy = normalScale * mapN.xy;\n		mat3 tsn = mat3( S, T, N );\n		return normalize( tsn * mapN );\n	}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n	uniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n	vec4 texelSpecular = texture2D( specularMap, vUv );\n	specularStrength = texelSpecular.r;\n#else\n	specularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n	vLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n	vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n	vec3 dirVector = normalize( lDirection.xyz );\n	float dotProduct = dot( transformedNormal, dirVector );\n	vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n	#ifdef DOUBLE_SIDED\n		vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n		#ifdef WRAP_AROUND\n			vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n		#endif\n	#endif\n	#ifdef WRAP_AROUND\n		vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n		directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n		#ifdef DOUBLE_SIDED\n			directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n		#endif\n	#endif\n	vLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n	#ifdef DOUBLE_SIDED\n		vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n	#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\n	for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float dotProduct = dot( transformedNormal, lVector );\n		vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n		#ifdef DOUBLE_SIDED\n			vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n			#ifdef WRAP_AROUND\n				vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n			#endif\n		#endif\n		#ifdef WRAP_AROUND\n			vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n			pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n			#ifdef DOUBLE_SIDED\n				pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n			#endif\n		#endif\n		vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n		#ifdef DOUBLE_SIDED\n			vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n		#endif\n	}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz - mvPosition.xyz;\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n			spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n			float lDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n			lVector = normalize( lVector );\n			float dotProduct = dot( transformedNormal, lVector );\n			vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n			#ifdef DOUBLE_SIDED\n				vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n				#ifdef WRAP_AROUND\n					vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n				#endif\n			#endif\n			#ifdef WRAP_AROUND\n				vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n				spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n				#ifdef DOUBLE_SIDED\n					spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n				#endif\n			#endif\n			vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n			#ifdef DOUBLE_SIDED\n				vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n			#endif\n		}\n	}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n		float dotProduct = dot( transformedNormal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n		vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n		#ifdef DOUBLE_SIDED\n			vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n		#endif\n	}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\n	vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	varying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	vWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n	varying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\n	normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\n	normal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\n	vec3 pointDiffuse  = vec3( 0.0 );\n	vec3 pointSpecular = vec3( 0.0 );\n	for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n		float lDistance = 1.0;\n		if ( pointLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float dotProduct = dot( normal, lVector );\n		#ifdef WRAP_AROUND\n			float pointDiffuseWeightFull = max( dotProduct, 0.0 );\n			float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n			vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n		#else\n			float pointDiffuseWeight = max( dotProduct, 0.0 );\n		#endif\n		pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\n		vec3 pointHalfVector = normalize( lVector + viewPosition );\n		float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n		float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n		pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n	}\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	vec3 spotDiffuse  = vec3( 0.0 );\n	vec3 spotSpecular = vec3( 0.0 );\n	for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n		vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n		vec3 lVector = lPosition.xyz + vViewPosition.xyz;\n		float lDistance = 1.0;\n		if ( spotLightDistance[ i ] > 0.0 )\n			lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\n		lVector = normalize( lVector );\n		float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n		if ( spotEffect > spotLightAngleCos[ i ] ) {\n			spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n			float dotProduct = dot( normal, lVector );\n			#ifdef WRAP_AROUND\n				float spotDiffuseWeightFull = max( dotProduct, 0.0 );\n				float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n				vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n			#else\n				float spotDiffuseWeight = max( dotProduct, 0.0 );\n			#endif\n			spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\n			vec3 spotHalfVector = normalize( lVector + viewPosition );\n			float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n			float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n			spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n		}\n	}\n#endif\n#if MAX_DIR_LIGHTS > 0\n	vec3 dirDiffuse  = vec3( 0.0 );\n	vec3 dirSpecular = vec3( 0.0 );\n	for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n		vec3 dirVector = normalize( lDirection.xyz );\n		float dotProduct = dot( normal, dirVector );\n		#ifdef WRAP_AROUND\n			float dirDiffuseWeightFull = max( dotProduct, 0.0 );\n			float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n			vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n		#else\n			float dirDiffuseWeight = max( dotProduct, 0.0 );\n		#endif\n		dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\n		vec3 dirHalfVector = normalize( dirVector + viewPosition );\n		float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n		float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n		dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n	}\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	vec3 hemiDiffuse  = vec3( 0.0 );\n	vec3 hemiSpecular = vec3( 0.0 );\n	for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n		vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n		vec3 lVector = normalize( lDirection.xyz );\n		float dotProduct = dot( normal, lVector );\n		float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n		vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n		hemiDiffuse += diffuse * hemiColor;\n		vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n		float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n		float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n		vec3 lVectorGround = -lVector;\n		vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n		float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n		float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n		float dotProductGround = dot( normal, lVectorGround );\n		float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n		vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n		vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n		hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n	}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\n	totalDiffuse += dirDiffuse;\n	totalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	totalDiffuse += hemiDiffuse;\n	totalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\n	totalDiffuse += pointDiffuse;\n	totalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	totalDiffuse += spotDiffuse;\n	totalSpecular += spotSpecular;\n#endif\n#ifdef METAL\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\n	gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n	varying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\n	gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n	varying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n	#ifdef GAMMA_INPUT\n		vColor = color * color;\n	#else\n		vColor = color;\n	#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n	#ifdef BONE_TEXTURE\n		uniform sampler2D boneTexture;\n		uniform int boneTextureWidth;\n		uniform int boneTextureHeight;\n		mat4 getBoneMatrix( const in float i ) {\n			float j = i * 4.0;\n			float x = mod( j, float( boneTextureWidth ) );\n			float y = floor( j / float( boneTextureWidth ) );\n			float dx = 1.0 / float( boneTextureWidth );\n			float dy = 1.0 / float( boneTextureHeight );\n			y = dy * ( y + 0.5 );\n			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n			mat4 bone = mat4( v1, v2, v3, v4 );\n			return bone;\n		}\n	#else\n		uniform mat4 boneGlobalMatrices[ MAX_BONES ];\n		mat4 getBoneMatrix( const in float i ) {\n			mat4 bone = boneGlobalMatrices[ int(i) ];\n			return bone;\n		}\n	#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\n	mat4 boneMatX = getBoneMatrix( skinIndex.x );\n	mat4 boneMatY = getBoneMatrix( skinIndex.y );\n	mat4 boneMatZ = getBoneMatrix( skinIndex.z );\n	mat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n	#ifdef USE_MORPHTARGETS\n	vec4 skinVertex = vec4( morphed, 1.0 );\n	#else\n	vec4 skinVertex = vec4( position, 1.0 );\n	#endif\n	vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n	skinned      += boneMatY * skinVertex * skinWeight.y;\n	skinned      += boneMatZ * skinVertex * skinWeight.z;\n	skinned      += boneMatW * skinVertex * skinWeight.w;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n	#ifndef USE_MORPHNORMALS\n	uniform float morphTargetInfluences[ 8 ];\n	#else\n	uniform float morphTargetInfluences[ 4 ];\n	#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n	vec3 morphed = vec3( 0.0 );\n	morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n	morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n	morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n	morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n	#ifndef USE_MORPHNORMALS\n	morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n	morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n	morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n	morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n	#endif\n	morphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\n	mvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\n	mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\n	mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n	vec3 morphedNormal = vec3( 0.0 );\n	morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n	morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n	morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n	morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n	morphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n	mat4 skinMatrix = skinWeight.x * boneMatX;\n	skinMatrix 	+= skinWeight.y * boneMatY;\n	skinMatrix 	+= skinWeight.z * boneMatZ;\n	skinMatrix 	+= skinWeight.w * boneMatW;\n	#ifdef USE_MORPHNORMALS\n	vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n	#else\n	vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n	#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\n	objectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\n	objectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\n	objectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\n	objectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n	uniform sampler2D shadowMap[ MAX_SHADOWS ];\n	uniform vec2 shadowMapSize[ MAX_SHADOWS ];\n	uniform float shadowDarkness[ MAX_SHADOWS ];\n	uniform float shadowBias[ MAX_SHADOWS ];\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	float unpackDepth( const in vec4 rgba_depth ) {\n		const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n		float depth = dot( rgba_depth, bit_shift );\n		return depth;\n	}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n	#ifdef SHADOWMAP_DEBUG\n		vec3 frustumColors[3];\n		frustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n		frustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n		frustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n	#endif\n	#ifdef SHADOWMAP_CASCADE\n		int inFrustumCount = 0;\n	#endif\n	float fDepth;\n	vec3 shadowColor = vec3( 1.0 );\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n		vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n		bool inFrustum = all( inFrustumVec );\n		#ifdef SHADOWMAP_CASCADE\n			inFrustumCount += int( inFrustum );\n			bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n		#else\n			bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n		#endif\n		bool frustumTest = all( frustumTestVec );\n		if ( frustumTest ) {\n			shadowCoord.z += shadowBias[ i ];\n			#if defined( SHADOWMAP_TYPE_PCF )\n				float shadow = 0.0;\n				const float shadowDelta = 1.0 / 9.0;\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n				float dx0 = -1.25 * xPixelOffset;\n				float dy0 = -1.25 * yPixelOffset;\n				float dx1 = 1.25 * xPixelOffset;\n				float dy1 = 1.25 * yPixelOffset;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				if ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n			#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n				float shadow = 0.0;\n				float xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n				float yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n				float dx0 = -1.0 * xPixelOffset;\n				float dy0 = -1.0 * yPixelOffset;\n				float dx1 = 1.0 * xPixelOffset;\n				float dy1 = 1.0 * yPixelOffset;\n				mat3 shadowKernel;\n				mat3 depthKernel;\n				depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n				depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n				depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n				depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n				depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n				depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n				depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n				depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n				depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n				vec3 shadowZ = vec3( shadowCoord.z );\n				shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n				shadowKernel[0] *= vec3(0.25);\n				shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n				shadowKernel[1] *= vec3(0.25);\n				shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n				shadowKernel[2] *= vec3(0.25);\n				vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n				shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n				shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n				vec4 shadowValues;\n				shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n				shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n				shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n				shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n				shadow = dot( shadowValues, vec4( 1.0 ) );\n				shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n			#else\n				vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n				float fDepth = unpackDepth( rgbaDepth );\n				if ( fDepth < shadowCoord.z )\n					shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n			#endif\n		}\n		#ifdef SHADOWMAP_DEBUG\n			#ifdef SHADOWMAP_CASCADE\n				if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n			#else\n				if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n			#endif\n		#endif\n	}\n	#ifdef GAMMA_OUTPUT\n		shadowColor *= shadowColor;\n	#endif\n	gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n	varying vec4 vShadowCoord[ MAX_SHADOWS ];\n	uniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n	for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n		vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n	}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n	if ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\n	gl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n	#ifdef USE_LOGDEPTHBUF_EXT\n		varying float vFragDepth;\n	#endif\n	uniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n	gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;\n	#ifdef USE_LOGDEPTHBUF_EXT\n		vFragDepth = 1.0 + gl_Position.w;\n#else\n		gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n	#endif\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n	uniform float logDepthBufFC;\n	#ifdef USE_LOGDEPTHBUF_EXT\n		#extension GL_EXT_frag_depth : enable\n		varying float vFragDepth;\n	#endif\n#endif",logdepthbuf_fragment:"#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n	gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++)for(n in r=this.clone(e[t]),r)i[n]=r[n];return i},clone:function(e){var t,n,r,i={};for(t in e)for(n in i[t]={},e[t])r=e[t][n],i[t][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r;return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n	varying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"	#ifdef DOUBLE_SIDED\n		if ( gl_FrontFacing )\n			gl_FragColor.xyz *= vLightFront;\n		else\n			gl_FragColor.xyz *= vLightBack;\n	#else\n		gl_FragColor.xyz *= vLightFront;\n	#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"	vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( vec3( 1.0 ), opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	#ifdef USE_SIZEATTENUATION\n		gl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n	#else\n		gl_PointSize = size;\n	#endif\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"	vLineDistance = scale * lineDistance;\n	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	if ( mod( vLineDistance, totalSize ) > dashSize ) {\n		discard;\n	}\n	gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float mNear;\nuniform float mFar;\nuniform float opacity;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		float depth = gl_FragDepthEXT / gl_FragCoord.w;\n	#else\n		float depth = gl_FragCoord.z / gl_FragCoord.w;\n	#endif\n	float color = 1.0 - smoothstep( mNear, mFar, depth );\n	gl_FragColor = vec4( vec3( color ), opacity );\n}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vNormal;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float refractionRatio;\nuniform float reflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\n	uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n	uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\n	uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n	uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\n	uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n	uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n	uniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\n	uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n	uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n	uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\n	uniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	gl_FragColor = vec4( vec3( 1.0 ), opacity );\n	vec3 specularTex = vec3( 1.0 );\n	vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\n	normalTex.xy *= uNormalScale;\n	normalTex = normalize( normalTex );\n	if( enableDiffuse ) {\n		#ifdef GAMMA_INPUT\n			vec4 texelColor = texture2D( tDiffuse, vUv );\n			texelColor.xyz *= texelColor.xyz;\n			gl_FragColor = gl_FragColor * texelColor;\n		#else\n			gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n		#endif\n	}\n	if( enableAO ) {\n		#ifdef GAMMA_INPUT\n			vec4 aoColor = texture2D( tAO, vUv );\n			aoColor.xyz *= aoColor.xyz;\n			gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n		#else\n			gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n		#endif\n	}\n	if( enableSpecular )\n		specularTex = texture2D( tSpecular, vUv ).xyz;\n	mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\n	vec3 finalNormal = tsb * normalTex;\n	#ifdef FLIP_SIDED\n		finalNormal = -finalNormal;\n	#endif\n	vec3 normal = normalize( finalNormal );\n	vec3 viewPosition = normalize( vViewPosition );\n	#if MAX_POINT_LIGHTS > 0\n		vec3 pointDiffuse = vec3( 0.0 );\n		vec3 pointSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n			vec3 pointVector = lPosition.xyz + vViewPosition.xyz;\n			float pointDistance = 1.0;\n			if ( pointLightDistance[ i ] > 0.0 )\n				pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\n			pointVector = normalize( pointVector );\n			#ifdef WRAP_AROUND\n				float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\n				float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\n				vec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n			#else\n				float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n			#endif\n			pointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;\n			vec3 pointHalfVector = normalize( pointVector + viewPosition );\n			float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n			float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\n			pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n		}\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		vec3 spotDiffuse = vec3( 0.0 );\n		vec3 spotSpecular = vec3( 0.0 );\n		for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n			vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n			vec3 spotVector = lPosition.xyz + vViewPosition.xyz;\n			float spotDistance = 1.0;\n			if ( spotLightDistance[ i ] > 0.0 )\n				spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\n			spotVector = normalize( spotVector );\n			float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n			if ( spotEffect > spotLightAngleCos[ i ] ) {\n				spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n				#ifdef WRAP_AROUND\n					float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\n					float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\n					vec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n				#else\n					float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n				#endif\n				spotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;\n				vec3 spotHalfVector = normalize( spotVector + viewPosition );\n				float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n				float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n				float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n				vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\n				spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n			}\n		}\n	#endif\n	#if MAX_DIR_LIGHTS > 0\n		vec3 dirDiffuse = vec3( 0.0 );\n		vec3 dirSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\n			vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\n			vec3 dirVector = normalize( lDirection.xyz );\n			#ifdef WRAP_AROUND\n				float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\n				float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\n				vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n			#else\n				float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n			#endif\n			dirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;\n			vec3 dirHalfVector = normalize( dirVector + viewPosition );\n			float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n			float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\n			dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n		}\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		vec3 hemiDiffuse  = vec3( 0.0 );\n		vec3 hemiSpecular = vec3( 0.0 );\n		for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n			vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\n			vec3 lVector = normalize( lDirection.xyz );\n			float dotProduct = dot( normal, lVector );\n			float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n			vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n			hemiDiffuse += diffuse * hemiColor;\n			vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n			float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n			float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\n			vec3 lVectorGround = -lVector;\n			vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n			float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n			float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\n			float dotProductGround = dot( normal, lVectorGround );\n			float specularNormalization = ( shininess + 2.0001 ) / 8.0;\n			vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\n			vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\n			hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n		}\n	#endif\n	vec3 totalDiffuse = vec3( 0.0 );\n	vec3 totalSpecular = vec3( 0.0 );\n	#if MAX_DIR_LIGHTS > 0\n		totalDiffuse += dirDiffuse;\n		totalSpecular += dirSpecular;\n	#endif\n	#if MAX_HEMI_LIGHTS > 0\n		totalDiffuse += hemiDiffuse;\n		totalSpecular += hemiSpecular;\n	#endif\n	#if MAX_POINT_LIGHTS > 0\n		totalDiffuse += pointDiffuse;\n		totalSpecular += pointSpecular;\n	#endif\n	#if MAX_SPOT_LIGHTS > 0\n		totalDiffuse += spotDiffuse;\n		totalSpecular += spotSpecular;\n	#endif\n	#ifdef METAL\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n	#else\n		gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n	#endif\n	if ( enableReflection ) {\n		vec3 vReflect;\n		vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n		if ( useRefract ) {\n			vReflect = refract( cameraToVertex, normal, refractionRatio );\n		} else {\n			vReflect = reflect( cameraToVertex, normal );\n		}\n		vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n		#ifdef GAMMA_INPUT\n			cubeColor.xyz *= cubeColor.xyz;\n		#endif\n		gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );\n	}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\n	uniform sampler2D tDisplacement;\n	uniform float uDisplacementScale;\n	uniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"	#ifdef USE_SKINNING\n		vNormal = normalize( normalMatrix * skinnedNormal.xyz );\n		vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\n		vTangent = normalize( normalMatrix * skinnedTangent.xyz );\n	#else\n		vNormal = normalize( normalMatrix * normal );\n		vTangent = normalize( normalMatrix * tangent.xyz );\n	#endif\n	vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\n	vUv = uv * uRepeat + uOffset;\n	vec3 displacedPosition;\n	#ifdef VERTEX_TEXTURES\n		if ( enableDisplacement ) {\n			vec3 dv = texture2D( tDisplacement, uv ).xyz;\n			float df = uDisplacementScale * dv.x + uDisplacementBias;\n			displacedPosition = position + normalize( normal ) * df;\n		} else {\n			#ifdef USE_SKINNING\n				vec4 skinVertex = vec4( position, 1.0 );\n				vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n				skinned 	  += boneMatY * skinVertex * skinWeight.y;\n				skinned 	  += boneMatZ * skinVertex * skinWeight.z;\n				skinned 	  += boneMatW * skinVertex * skinWeight.w;\n				displacedPosition  = skinned.xyz;\n			#else\n				displacedPosition = position;\n			#endif\n		}\n	#else\n		#ifdef USE_SKINNING\n			vec4 skinVertex = vec4( position, 1.0 );\n			vec4 skinned  = boneMatX * skinVertex * skinWeight.x;\n			skinned 	  += boneMatY * skinVertex * skinWeight.y;\n			skinned 	  += boneMatZ * skinVertex * skinWeight.z;\n			skinned 	  += boneMatW * skinVertex * skinWeight.w;\n			displacedPosition  = skinned.xyz;\n		#else\n			displacedPosition = position;\n		#endif\n	#endif\n	vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\n	vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\n	gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"	vWorldPosition = worldPosition.xyz;\n	vViewPosition = -mvPosition.xyz;\n	#ifdef USE_SHADOWMAP\n		for( int i = 0; i < MAX_SHADOWS; i ++ ) {\n			vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n		}\n	#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {\n	vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n	vWorldPosition = worldPosition.xyz;\n	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"void main() {\n	gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n"),fragmentShader:[THREE.ShaderChunk.logdepthbuf_pars_fragment,"vec4 pack_depth( const in float depth ) {\n	const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\n	const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\n	vec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );\n	res -= res.xxyz * bit_mask;\n	return res;\n}\nvoid main() {",THREE.ShaderChunk.logdepthbuf_fragment,"	#ifdef USE_LOGDEPTHBUF_EXT\n		gl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );\n	#else\n		gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n	#endif\n}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;"v2"===s.type?o=2:"v3"===s.type?o=3:"v4"===s.type?o=4:"c"===s.type&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=Nt.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function n(e,t){var n=t.geometry,o=e.faces3,u=3*o.length,a=1*o.length,f=3*o.length,o=r(t,e),l=s(o),c=i(o),h=o.vertexColors?o.vertexColors:!1;e.__vertexArray=new Float32Array(3*u),c&&(e.__normalArray=new Float32Array(3*u)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*u)),h&&(e.__colorArray=new Float32Array(3*u)),l&&(0<n.faceVertexUvs.length&&(e.__uvArray=new Float32Array(2*u)),1<n.faceVertexUvs.length&&(e.__uv2Array=new Float32Array(2*u))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*u),e.__skinWeightArray=new Float32Array(4*u)),n=null!==Ot&&21845<a?Uint32Array:Uint16Array,e.__typeArray=n,e.__faceArray=new n(3*a),e.__lineArray=new n(2*f);if(e.numMorphTargets)for(e.__morphTargetsArrays=[],n=0,l=e.numMorphTargets;n<l;n++)e.__morphTargetsArrays.push(new Float32Array(3*u));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],n=0,l=e.numMorphNormals;n<l;n++)e.__morphNormalsArrays.push(new Float32Array(3*u));e.__webglFaceCount=3*a,e.__webglLineCount=2*f;if(o.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in o.attributes){var a=o.attributes[p],f={},d;for(d in a)f[d]=a[d];if(!f.__webglInitialized||f.createUniqueBuffers)f.__webglInitialized=!0,n=1,"v2"===f.type?n=2:"v3"===f.type?n=3:"v4"===f.type?n=4:"c"===f.type&&(n=3),f.size=n,f.array=new Float32Array(u*n),f.buffer=Nt.createBuffer(),f.buffer.belongsToAttribute=p,a.needsUpdate=!0,f.__original=a;e.__webglCustomAttributesList.push(f)}}e.__inittedArrays=!0}function r(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function i(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&void 0!==e.shading&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function s(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function o(e,t,n,r){for(var i in t){var s=t[i],o=n[i];if(0<=s)if(o){var u=o.itemSize;Nt.bindBuffer(Nt.ARRAY_BUFFER,o.buffer),a(s),Nt.vertexAttribPointer(s,u,Nt.FLOAT,!1,0,r*u*4)}else e.defaultAttributeValues&&(2===e.defaultAttributeValues[i].length?Nt.vertexAttrib2fv(s,e.defaultAttributeValues[i]):3===e.defaultAttributeValues[i].length&&Nt.vertexAttrib3fv(s,e.defaultAttributeValues[i]))}f()}function u(){for(var e=0,t=mt.length;e<t;e++)mt[e]=0}function a(e){mt[e]=1,0===gt[e]&&(Nt.enableVertexAttribArray(e),gt[e]=1)}function f(){for(var e=0,t=gt.length;e<t;e++)gt[e]!==mt[e]&&(Nt.disableVertexAttribArray(e),gt[e]=0)}function l(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function c(e,t){return t[0]-e[0]}function h(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)Q=V=null,J=K=Z=Y=st=it=et=-1,xt=!0,e[r].render(t,n,dt,vt),Q=V=null,J=K=Z=Y=st=it=et=-1,xt=!0}function p(e,t,n,r,i,s,o,u){var a,f,l,c;t?(f=e.length-1,c=t=-1):(f=0,t=e.length,c=1);for(var h=f;h!==t;h+=c)if(a=e[h],a.render){f=a.object,l=a.buffer;if(u)a=u;else{a=a[n];if(!a)continue;o&&W.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),W.setDepthTest(a.depthTest),W.setDepthWrite(a.depthWrite),k(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}W.setMaterialFaces(a),l instanceof THREE.BufferGeometry?W.renderBufferDirect(r,i,s,a,l,f):W.renderBuffer(r,i,s,a,l,f)}}function d(e,t,n,r,i,s,o){for(var u,a,f=0,l=e.length;f<l;f++)if(u=e[f],a=u.object,a.visible){if(o)u=o;else{u=u[t];if(!u)continue;s&&W.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),W.setDepthTest(u.depthTest),W.setDepthWrite(u.depthWrite),k(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}W.renderImmediateObject(n,r,i,u,a)}}function v(e,r){var i,s,o;if(void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,s=e.geometry,void 0!==s&&void 0===s.__webglInit))if(s.__webglInit=!0,s.addEventListener("dispose",zt),s instanceof THREE.BufferGeometry)for(o in s.attributes){var u="index"===o?Nt.ELEMENT_ARRAY_BUFFER:Nt.ARRAY_BUFFER,a=s.attributes[o];a.buffer=Nt.createBuffer(),Nt.bindBuffer(u,a.buffer),Nt.bufferData(u,a.array,Nt.STATIC_DRAW)}else if(e instanceof THREE.Mesh){for(i in o=e.material,void 0===s.geometryGroups&&s.makeGroups(o instanceof THREE.MeshFaceMaterial,Ot?4294967296:65535),s.geometryGroups)if(o=s.geometryGroups[i],!o.__webglVertexBuffer){u=o,u.__webglVertexBuffer=Nt.createBuffer(),u.__webglNormalBuffer=Nt.createBuffer(),u.__webglTangentBuffer=Nt.createBuffer(),u.__webglColorBuffer=Nt.createBuffer(),u.__webglUVBuffer=Nt.createBuffer(),u.__webglUV2Buffer=Nt.createBuffer(),u.__webglSkinIndicesBuffer=Nt.createBuffer(),u.__webglSkinWeightsBuffer=Nt.createBuffer(),u.__webglFaceBuffer=Nt.createBuffer(),u.__webglLineBuffer=Nt.createBuffer();var f=a=void 0;if(u.numMorphTargets)for(u.__webglMorphTargetsBuffers=[],a=0,f=u.numMorphTargets;a<f;a++)u.__webglMorphTargetsBuffers.push(Nt.createBuffer());if(u.numMorphNormals)for(u.__webglMorphNormalsBuffers=[],a=0,f=u.numMorphNormals;a<f;a++)u.__webglMorphNormalsBuffers.push(Nt.createBuffer());W.info.memory.geometries++,n(o,e),s.verticesNeedUpdate=!0,s.morphTargetsNeedUpdate=!0,s.elementsNeedUpdate=!0,s.uvsNeedUpdate=!0,s.normalsNeedUpdate=!0,s.tangentsNeedUpdate=!0,s.colorsNeedUpdate=!0}}else e instanceof THREE.Line?s.__webglVertexBuffer||(o=s,o.__webglVertexBuffer=Nt.createBuffer(),o.__webglColorBuffer=Nt.createBuffer(),o.__webglLineDistanceBuffer=Nt.createBuffer(),W.info.memory.geometries++,o=s,u=o.vertices.length,o.__vertexArray=new Float32Array(3*u),o.__colorArray=new Float32Array(3*u),o.__lineDistanceArray=new Float32Array(1*u),o.__webglLineCount=u,t(o,e),s.verticesNeedUpdate=!0,s.colorsNeedUpdate=!0,s.lineDistancesNeedUpdate=!0):e instanceof THREE.ParticleSystem&&!s.__webglVertexBuffer&&(o=s,o.__webglVertexBuffer=Nt.createBuffer(),o.__webglColorBuffer=Nt.createBuffer(),W.info.memory.geometries++,o=s,u=o.vertices.length,o.__vertexArray=new Float32Array(3*u),o.__colorArray=new Float32Array(3*u),o.__sortArray=[],o.__webglParticleCount=u,t(o,e),s.verticesNeedUpdate=!0,s.colorsNeedUpdate=!0);if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){if(s=e.geometry,s instanceof THREE.BufferGeometry)m(r.__webglObjects,s,e);else if(s instanceof THREE.Geometry)for(i in s.geometryGroups)o=s.geometryGroups[i],m(r.__webglObjects,o,e)}else e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(s=e.geometry,m(r.__webglObjects,s,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?r.__webglObjectsImmediate.push({id:null,object:e,opaque:null,transparent:null,z:0}):e instanceof THREE.Sprite?r.__webglSprites.push(e):e instanceof THREE.LensFlare&&r.__webglFlares.push(e);e.__webglActive=!0}}function m(e,t,n){e.push({id:null,buffer:t,object:n,opaque:null,transparent:null,z:0})}function g(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function y(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function b(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Line?w(t.__webglObjects,e):e instanceof THREE.Sprite?E(t.__webglSprites,e):e instanceof THREE.LensFlare?E(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&w(t.__webglObjectsImmediate,e),delete e.__webglActive}function w(e,t){for(var n=e.length-1;0<=n;n--)e[n].object===t&&e.splice(n,1)}function E(e,t){for(var n=e.length-1;0<=n;n--)e[n]===t&&e.splice(n,1)}function S(e,t,n,r,i){G=0,r.needsUpdate&&(r.program&&Jt(r),W.initMaterial(r,t,n,i),r.needsUpdate=!1),r.morphTargets&&!i.__webglMorphTargetInfluences&&(i.__webglMorphTargetInfluences=new Float32Array(W.maxMorphTargets));var s=!1,o=r.program,u=o.uniforms,a=r.uniforms;o.id!==V&&(Nt.useProgram(o.program),V=o.id,s=!0),r.id!==J&&(J=r.id,s=!0);if(s||e!==Q)Nt.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),R&&Nt.uniform1f(u.logDepthBufFC,2/(Math.log(e.far+1)/Math.LN2)),e!==Q&&(Q=e);if(r.skinning)if(Bt&&i.skeleton.useVertexTexture){if(null!==u.boneTexture){var f=x();Nt.uniform1i(u.boneTexture,f),W.setTexture(i.skeleton.boneTexture,f)}null!==u.boneTextureWidth&&Nt.uniform1i(u.boneTextureWidth,i.skeleton.boneTextureWidth),null!==u.boneTextureHeight&&Nt.uniform1i(u.boneTextureHeight,i.skeleton.boneTextureHeight)}else null!==u.boneGlobalMatrices&&Nt.uniformMatrix4fv(u.boneGlobalMatrices,!1,i.skeleton.boneMatrices);if(s){n&&r.fog&&(a.fogColor.value=n.color,n instanceof THREE.Fog?(a.fogNear.value=n.near,a.fogFar.value=n.far):n instanceof THREE.FogExp2&&(a.fogDensity.value=n.density));if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(xt){var l,c=f=0,h=0,p,d,v,m=Tt,g=m.directional.colors,y=m.directional.positions,b=m.point.colors,w=m.point.positions,E=m.point.distances,S=m.spot.colors,C=m.spot.positions,k=m.spot.distances,A=m.spot.directions,O=m.spot.anglesCos,D=m.spot.exponents,P=m.hemi.skyColors,H=m.hemi.groundColors,B=m.hemi.positions,j=0,F=0,I=0,q=0,U=0,z=0,X=0,$=0,K=l=0;n=v=K=0;for(s=t.length;n<s;n++)if(l=t[n],!l.onlyShadow)if(p=l.color,d=l.intensity,v=l.distance,l instanceof THREE.AmbientLight)l.visible&&(W.gammaInput?(f+=p.r*p.r,c+=p.g*p.g,h+=p.b*p.b):(f+=p.r,c+=p.g,h+=p.b));else if(l instanceof THREE.DirectionalLight){if(U+=1,l.visible&&(St.setFromMatrixPosition(l.matrixWorld),Et.setFromMatrixPosition(l.target.matrixWorld),St.sub(Et),St.normalize(),0!==St.x||0!==St.y||0!==St.z))l=3*j,y[l]=St.x,y[l+1]=St.y,y[l+2]=St.z,W.gammaInput?T(g,l,p,d*d):N(g,l,p,d),j+=1}else l instanceof THREE.PointLight?(z+=1,l.visible&&(K=3*F,W.gammaInput?T(b,K,p,d*d):N(b,K,p,d),Et.setFromMatrixPosition(l.matrixWorld),w[K]=Et.x,w[K+1]=Et.y,w[K+2]=Et.z,E[F]=v,F+=1)):l instanceof THREE.SpotLight?(X+=1,l.visible&&(K=3*I,W.gammaInput?T(S,K,p,d*d):N(S,K,p,d),Et.setFromMatrixPosition(l.matrixWorld),C[K]=Et.x,C[K+1]=Et.y,C[K+2]=Et.z,k[I]=v,St.copy(Et),Et.setFromMatrixPosition(l.target.matrixWorld),St.sub(Et),St.normalize(),A[K]=St.x,A[K+1]=St.y,A[K+2]=St.z,O[I]=Math.cos(l.angle),D[I]=l.exponent,I+=1)):l instanceof THREE.HemisphereLight&&($+=1,l.visible&&(St.setFromMatrixPosition(l.matrixWorld),St.normalize(),0!==St.x||0!==St.y||0!==St.z))&&(v=3*q,B[v]=St.x,B[v+1]=St.y,B[v+2]=St.z,p=l.color,l=l.groundColor,W.gammaInput?(d*=d,T(P,v,p,d),T(H,v,l,d)):(N(P,v,p,d),N(H,v,l,d)),q+=1);n=3*j;for(s=Math.max(g.length,3*U);n<s;n++)g[n]=0;n=3*F;for(s=Math.max(b.length,3*z);n<s;n++)b[n]=0;n=3*I;for(s=Math.max(S.length,3*X);n<s;n++)S[n]=0;n=3*q;for(s=Math.max(P.length,3*$);n<s;n++)P[n]=0;n=3*q;for(s=Math.max(H.length,3*$);n<s;n++)H[n]=0;m.directional.length=j,m.point.length=F,m.spot.length=I,m.hemi.length=q,m.ambient[0]=f,m.ambient[1]=c,m.ambient[2]=h,xt=!1}n=Tt,a.ambientLightColor.value=n.ambient,a.directionalLightColor.value=n.directional.colors,a.directionalLightDirection.value=n.directional.positions,a.pointLightColor.value=n.point.colors,a.pointLightPosition.value=n.point.positions,a.pointLightDistance.value=n.point.distances,a.spotLightColor.value=n.spot.colors,a.spotLightPosition.value=n.spot.positions,a.spotLightDistance.value=n.spot.distances,a.spotLightDirection.value=n.spot.directions,a.spotLightAngleCos.value=n.spot.anglesCos,a.spotLightExponent.value=n.spot.exponents,a.hemisphereLightSkyColor.value=n.hemi.skyColors,a.hemisphereLightGroundColor.value=n.hemi.groundColors,a.hemisphereLightDirection.value=n.hemi.positions}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){a.opacity.value=r.opacity,W.gammaInput?a.diffuse.value.copyGammaToLinear(r.color):a.diffuse.value=r.color,a.map.value=r.map,a.lightMap.value=r.lightMap,a.specularMap.value=r.specularMap,r.bumpMap&&(a.bumpMap.value=r.bumpMap,a.bumpScale.value=r.bumpScale),r.normalMap&&(a.normalMap.value=r.normalMap,a.normalScale.value.copy(r.normalScale));var Y;r.map?Y=r.map:r.specularMap?Y=r.specularMap:r.normalMap?Y=r.normalMap:r.bumpMap&&(Y=r.bumpMap),void 0!==Y&&(n=Y.offset,Y=Y.repeat,a.offsetRepeat.value.set(n.x,n.y,Y.x,Y.y)),a.envMap.value=r.envMap,a.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,a.reflectivity.value=r.reflectivity,a.refractionRatio.value=r.refractionRatio,a.combine.value=r.combine,a.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping}r instanceof THREE.LineBasicMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity):r instanceof THREE.LineDashedMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity,a.dashSize.value=r.dashSize,a.totalSize.value=r.dashSize+r.gapSize,a.scale.value=r.scale):r instanceof THREE.ParticleSystemMaterial?(a.psColor.value=r.color,a.opacity.value=r.opacity,a.size.value=r.size,a.scale.value=_.height/2,a.map.value=r.map):r instanceof THREE.MeshPhongMaterial?(a.shininess.value=r.shininess,W.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive),a.specular.value.copyGammaToLinear(r.specular)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive,a.specular.value=r.specular),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshLambertMaterial?(W.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshDepthMaterial?(a.mNear.value=e.near,a.mFar.value=e.far,a.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(a.opacity.value=r.opacity);if(i.receiveShadow&&!r._shadowPass&&a.shadowMatrix)for(n=Y=0,s=t.length;n<s;n++)f=t[n],f.castShadow&&(f instanceof THREE.SpotLight||f instanceof THREE.DirectionalLight&&!f.shadowCascade)&&(a.shadowMap.value[Y]=f.shadowMap,a.shadowMapSize.value[Y]=f.shadowMapSize,a.shadowMatrix.value[Y]=f.shadowMatrix,a.shadowDarkness.value[Y]=f.shadowDarkness,a.shadowBias.value[Y]=f.shadowBias,Y++);t=r.uniformsList,a=0;for(Y=t.length;a<Y;a++)if(s=o.uniforms[t[a][1]])if(n=t[a][0],c=n.type,f=n.value,"i"===c)Nt.uniform1i(s,f);else if("f"===c)Nt.uniform1f(s,f);else if("v2"===c)Nt.uniform2f(s,f.x,f.y);else if("v3"===c)Nt.uniform3f(s,f.x,f.y,f.z);else if("v4"===c)Nt.uniform4f(s,f.x,f.y,f.z,f.w);else if("c"===c)Nt.uniform3f(s,f.r,f.g,f.b);else if("iv1"===c)Nt.uniform1iv(s,f);else if("iv"===c)Nt.uniform3iv(s,f);else if("fv1"===c)Nt.uniform1fv(s,f);else if("fv"===c)Nt.uniform3fv(s,f);else if("v2v"===c){void 0===n._array&&(n._array=new Float32Array(2*f.length)),c=0;for(h=f.length;c<h;c++)m=2*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y;Nt.uniform2fv(s,n._array)}else if("v3v"===c){void 0===n._array&&(n._array=new Float32Array(3*f.length)),c=0;for(h=f.length;c<h;c++)m=3*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y,n._array[m+2]=f[c].z;Nt.uniform3fv(s,n._array)}else if("v4v"===c){void 0===n._array&&(n._array=new Float32Array(4*f.length)),c=0;for(h=f.length;c<h;c++)m=4*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y,n._array[m+2]=f[c].z,n._array[m+3]=f[c].w;Nt.uniform4fv(s,n._array)}else if("m3"===c)Nt.uniformMatrix3fv(s,!1,f.elements);else if("m3v"===c){void 0===n._array&&(n._array=new Float32Array(9*f.length)),c=0;for(h=f.length;c<h;c++)f[c].flattenToArrayOffset(n._array,9*c);Nt.uniformMatrix3fv(s,!1,n._array)}else if("m4"===c)Nt.uniformMatrix4fv(s,!1,f.elements);else if("m4v"===c){void 0===n._array&&(n._array=new Float32Array(16*f.length)),c=0;for(h=f.length;c<h;c++)f[c].flattenToArrayOffset(n._array,16*c);Nt.uniformMatrix4fv(s,!1,n._array)}else if("t"===c){if(m=f,f=x(),Nt.uniform1i(s,f),m)if(m.image instanceof Array&&6===m.image.length){if(n=m,s=f,6===n.image.length)if(n.needsUpdate){n.image.__webglTextureCube||(n.addEventListener("dispose",Wt),n.image.__webglTextureCube=Nt.createTexture(),W.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+s),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,n.flipY),s=n instanceof THREE.CompressedTexture,f=[];for(c=0;6>c;c++)W.autoScaleCubemaps&&!s?(h=f,m=c,g=n.image[c],b=Dt,g.width<=b&&g.height<=b||(w=Math.max(g.width,g.height),y=Math.floor(g.width*b/w),b=Math.floor(g.height*b/w),w=document.createElement("canvas"),w.width=y,w.height=b,w.getContext("2d").drawImage(g,0,0,g.width,g.height,0,0,y,b),g=w),h[m]=g):f[c]=n.image[c];c=f[0],h=THREE.Math.isPowerOfTwo(c.width)&&THREE.Math.isPowerOfTwo(c.height),m=M(n.format),g=M(n.type),L(Nt.TEXTURE_CUBE_MAP,n,h);for(c=0;6>c;c++)if(s)for(b=f[c].mipmaps,w=0,E=b.length;w<E;w++)y=b[w],n.format!==THREE.RGBAFormat?Nt.compressedTexImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+c,w,m,y.width,y.height,0,y.data):Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+c,w,m,y.width,y.height,0,m,g,y.data);else Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,m,m,g,f[c]);n.generateMipmaps&&h&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),n.needsUpdate=!1,n.onUpdate&&n.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+s),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.image.__webglTextureCube)}else m instanceof THREE.WebGLRenderTargetCube?(n=m,Nt.activeTexture(Nt.TEXTURE0+f),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.__webglTexture)):W.setTexture(m,f)}else if("tv"===c){void 0===n._array&&(n._array=[]),c=0;for(h=n.value.length;c<h;c++)n._array[c]=x();Nt.uniform1iv(s,n._array),c=0;for(h=n.value.length;c<h;c++)m=n.value[c],f=n._array[c],m&&W.setTexture(m,f)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+c);(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==u.cameraPosition&&(Et.setFromMatrixPosition(e.matrixWorld),Nt.uniform3f(u.cameraPosition,Et.x,Et.y,Et.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==u.viewMatrix&&Nt.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)}return Nt.uniformMatrix4fv(u.modelViewMatrix,!1,i._modelViewMatrix.elements),u.normalMatrix&&Nt.uniformMatrix3fv(u.normalMatrix,!1,i._normalMatrix.elements),null!==u.modelMatrix&&Nt.uniformMatrix4fv(u.modelMatrix,!1,i.matrixWorld.elements),o}function x(){var e=G;return e>=Mt&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Mt),G+=1,e}function T(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function N(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function C(e){e!==ft&&(Nt.lineWidth(e),ft=e)}function k(e,t,n){ot!==e&&(e?Nt.enable(Nt.POLYGON_OFFSET_FILL):Nt.disable(Nt.POLYGON_OFFSET_FILL),ot=e),!e||ut===t&&at===n||(Nt.polygonOffset(t,n),ut=t,at=n)}function L(e,t,n){n?(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,M(t.wrapS)),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,M(t.wrapT)),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,M(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,M(t.minFilter))):(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,Nt.CLAMP_TO_EDGE),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,Nt.CLAMP_TO_EDGE),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,O(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,O(t.minFilter))),Lt&&t.type!==THREE.FloatType&&(1<t.anisotropy||t.__oldAnisotropy)&&(Nt.texParameterf(e,Lt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Pt)),t.__oldAnisotropy=t.anisotropy)}function A(e,t){Nt.bindRenderbuffer(Nt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_COMPONENT16,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_STENCIL,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e)):Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.RGBA4,t.width,t.height)}function O(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Nt.NEAREST:Nt.LINEAR}function M(e){if(e===THREE.RepeatWrapping)return Nt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Nt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Nt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Nt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Nt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Nt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Nt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Nt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Nt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Nt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Nt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Nt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Nt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Nt.BYTE;if(e===THREE.ShortType)return Nt.SHORT;if(e===THREE.UnsignedShortType)return Nt.UNSIGNED_SHORT;if(e===THREE.IntType)return Nt.INT;if(e===THREE.UnsignedIntType)return Nt.UNSIGNED_INT;if(e===THREE.FloatType)return Nt.FLOAT;if(e===THREE.AlphaFormat)return Nt.ALPHA;if(e===THREE.RGBFormat)return Nt.RGB;if(e===THREE.RGBAFormat)return Nt.RGBA;if(e===THREE.LuminanceFormat)return Nt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Nt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Nt.FUNC_ADD;if(e===THREE.SubtractEquation)return Nt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Nt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Nt.ZERO;if(e===THREE.OneFactor)return Nt.ONE;if(e===THREE.SrcColorFactor)return Nt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Nt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Nt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Nt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Nt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Nt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Nt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Nt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Nt.SRC_ALPHA_SATURATE;if(void 0!==At){if(e===THREE.RGB_S3TC_DXT1_Format)return At.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return At.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return At.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return At.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var _=void 0!==e.canvas?e.canvas:document.createElement("canvas"),D=void 0!==e.context?e.context:null,P=void 0!==e.precision?e.precision:"highp",H=void 0!==e.alpha?e.alpha:!1,B=void 0!==e.depth?e.depth:!0,j=void 0!==e.stencil?e.stencil:!0,F=void 0!==e.antialias?e.antialias:!1,I=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,q=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,R=void 0!==e.logarithmicDepthBuffer?e.logarithmicDepthBuffer:!1,U=new THREE.Color(0),z=0;this.domElement=_,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var W=this,X=[],V=null,$=null,J=-1,K=null,Q=null,G=0,Y=-1,Z=-1,et=-1,tt=-1,nt=-1,rt=-1,it=-1,st=-1,ot=null,ut=null,at=null,ft=null,lt=0,ct=0,ht=_.width,pt=_.height,dt=0,vt=0,mt=new Uint8Array(16),gt=new Uint8Array(16),yt=new THREE.Frustum,bt=new THREE.Matrix4,wt=new THREE.Matrix4,Et=new THREE.Vector3,St=new THREE.Vector3,xt=!0,Tt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Nt,Ct,kt,Lt,At,Ot;(function(){try{var e={alpha:H,depth:B,stencil:j,antialias:F,premultipliedAlpha:I,preserveDrawingBuffer:q};Nt=D||_.getContext("webgl",e)||_.getContext("experimental-webgl",e);if(null===Nt)throw"Error creating WebGL context."}catch(t){console.error(t)}Ct=Nt.getExtension("OES_texture_float"),Nt.getExtension("OES_texture_float_linear"),kt=Nt.getExtension("OES_standard_derivatives"),Lt=Nt.getExtension("EXT_texture_filter_anisotropic")||Nt.getExtension("MOZ_EXT_texture_filter_anisotropic")||Nt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),At=Nt.getExtension("WEBGL_compressed_texture_s3tc")||Nt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Nt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Ot=Nt.getExtension("OES_element_index_uint"),null===Ct&&console.log("THREE.WebGLRenderer: Float textures not supported."),null===kt&&console.log("THREE.WebGLRenderer: Standard derivatives not supported."),null===Lt&&console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),null===At&&console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),null===Ot&&console.log("THREE.WebGLRenderer: elementindex as unsigned integer not supported."),void 0===Nt.getShaderPrecisionFormat&&(Nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),R&&Nt.getExtension("EXT_frag_depth")})(),Nt.clearColor(0,0,0,1),Nt.clearDepth(1),Nt.clearStencil(0),Nt.enable(Nt.DEPTH_TEST),Nt.depthFunc(Nt.LEQUAL),Nt.frontFace(Nt.CCW),Nt.cullFace(Nt.BACK),Nt.enable(Nt.CULL_FACE),Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA),Nt.viewport(lt,ct,ht,pt),Nt.clearColor(U.r,U.g,U.b,z),this.context=Nt;var Mt=Nt.getParameter(Nt.MAX_TEXTURE_IMAGE_UNITS),_t=Nt.getParameter(Nt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Nt.getParameter(Nt.MAX_TEXTURE_SIZE);var Dt=Nt.getParameter(Nt.MAX_CUBE_MAP_TEXTURE_SIZE),Pt=Lt?Nt.getParameter(Lt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Ht=0<_t,Bt=Ht&&Ct;At&&Nt.getParameter(Nt.COMPRESSED_TEXTURE_FORMATS);var jt=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.HIGH_FLOAT),Ft=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.LOW_FLOAT);var It=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.HIGH_FLOAT),qt=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.LOW_FLOAT);var Rt=0<jt.precision&&0<It.precision,Ut=0<Ft.precision&&0<qt.precision;"highp"!==P||Rt||(Ut?(P="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(P="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==P||Ut||(P="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Nt},this.supportsVertexTextures=function(){return Ht},this.supportsFloatTextures=function(){return Ct},this.supportsStandardDerivatives=function(){return kt},this.supportsCompressedTextureS3TC=function(){return At},this.getMaxAnisotropy=function(){return Pt},this.getPrecision=function(){return P},this.setSize=function(e,t,n){_.width=e*this.devicePixelRatio,_.height=t*this.devicePixelRatio,!1!==n&&(_.style.width=e+"px",_.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,r){lt=e*this.devicePixelRatio,ct=t*this.devicePixelRatio,ht=n*this.devicePixelRatio,pt=r*this.devicePixelRatio,Nt.viewport(lt,ct,ht,pt)},this.setScissor=function(e,t,n,r){Nt.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)},this.enableScissorTest=function(e){e?Nt.enable(Nt.SCISSOR_TEST):Nt.disable(Nt.SCISSOR_TEST)},this.setClearColor=function(e,t){U.set(e),z=void 0!==t?t:1,Nt.clearColor(U.r,U.g,U.b,z)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return U},this.getClearAlpha=function(){return z},this.clear=function(e,t,n){var r=0;if(void 0===e||e)r|=Nt.COLOR_BUFFER_BIT;if(void 0===t||t)r|=Nt.DEPTH_BUFFER_BIT;if(void 0===n||n)r|=Nt.STENCIL_BUFFER_BIT;Nt.clear(r)},this.clearColor=function(){Nt.clear(Nt.COLOR_BUFFER_BIT)},this.clearDepth=function(){Nt.clear(Nt.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Nt.clear(Nt.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){V=null,J=K=st=it=et=-1,xt=!0,Z=Y=-1,this.shadowMapPlugin.update(e,t)};var zt=function(e){e=e.target,e.removeEventListener("dispose",zt),e.__webglInit=void 0;if(e instanceof THREE.BufferGeometry){var t=e.attributes,n;for(n in t)void 0!==t[n].buffer&&Nt.deleteBuffer(t[n].buffer);W.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(t in e.geometryGroups){n=e.geometryGroups[t];if(void 0!==n.numMorphTargets)for(var r=0,i=n.numMorphTargets;r<i;r++)Nt.deleteBuffer(n.__webglMorphTargetsBuffers[r]);if(void 0!==n.numMorphNormals)for(r=0,i=n.numMorphNormals;r<i;r++)Nt.deleteBuffer(n.__webglMorphNormalsBuffers[r]);$t(n)}else $t(e)},Wt=function(e){e=e.target,e.removeEventListener("dispose",Wt),e.image&&e.image.__webglTextureCube?Nt.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,Nt.deleteTexture(e.__webglTexture)),W.info.memory.textures--},Xt=function(e){e=e.target,e.removeEventListener("dispose",Xt);if(e&&e.__webglTexture)if(Nt.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)Nt.deleteFramebuffer(e.__webglFramebuffer[t]),Nt.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Nt.deleteFramebuffer(e.__webglFramebuffer),Nt.deleteRenderbuffer(e.__webglRenderbuffer);W.info.memory.textures--},Vt=function(e){e=e.target,e.removeEventListener("dispose",Vt),Jt(e)},$t=function(e){void 0!==e.__webglVertexBuffer&&Nt.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Nt.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Nt.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Nt.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Nt.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Nt.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Nt.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Nt.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Nt.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Nt.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Nt.deleteBuffer(e.__webglLineDistanceBuffer);if(void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Nt.deleteBuffer(e.__webglCustomAttributesList[t].buffer);W.info.memory.geometries--},Jt=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var n,r,i=!1;e=0;for(n=X.length;e<n;e++)if(r=X[e],r.program===t){r.usedTimes--,0===r.usedTimes&&(i=!0);break}if(!0===i){i=[],e=0;for(n=X.length;e<n;e++)r=X[e],r.program!==t&&i.push(r);X=i,Nt.deleteProgram(t),W.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,n){u(),e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Nt.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Nt.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Nt.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Nt.createBuffer()),e.hasPositions&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.positionArray,Nt.DYNAMIC_DRAW),a(t.attributes.position),Nt.vertexAttribPointer(t.attributes.position,3,Nt.FLOAT,!1,0,0));if(e.hasNormals){Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglNormalBuffer);if(n.shading===THREE.FlatShading){var r,i,s,o,l,c,h,p,d,v,m,g=3*e.count;for(m=0;m<g;m+=9)v=e.normalArray,r=v[m],i=v[m+1],s=v[m+2],o=v[m+3],c=v[m+4],p=v[m+5],l=v[m+6],h=v[m+7],d=v[m+8],r=(r+o+l)/3,i=(i+c+h)/3,s=(s+p+d)/3,v[m]=r,v[m+1]=i,v[m+2]=s,v[m+3]=r,v[m+4]=i,v[m+5]=s,v[m+6]=r,v[m+7]=i,v[m+8]=s}Nt.bufferData(Nt.ARRAY_BUFFER,e.normalArray,Nt.DYNAMIC_DRAW),a(t.attributes.normal),Nt.vertexAttribPointer(t.attributes.normal,3,Nt.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglUvBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.uvArray,Nt.DYNAMIC_DRAW),a(t.attributes.uv),Nt.vertexAttribPointer(t.attributes.uv,2,Nt.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==THREE.NoColors&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.colorArray,Nt.DYNAMIC_DRAW),a(t.attributes.color),Nt.vertexAttribPointer(t.attributes.color,3,Nt.FLOAT,!1,0,0)),f(),Nt.drawArrays(Nt.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,s){if(!1!==r.visible){var a=S(e,t,n,r,s);e=a.attributes,t=i.attributes,n=!1,a=16777215*i.id+2*a.id+(r.wireframe?1:0),a!==K&&(K=a,n=!0),n&&u();if(s instanceof THREE.Mesh)if(s=t.index){var f;s.array instanceof Uint32Array?(a=Nt.UNSIGNED_INT,f=4):(a=Nt.UNSIGNED_SHORT,f=2),i=i.offsets;if(0===i.length)n&&(o(r,e,t,0),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.buffer)),Nt.drawElements(Nt.TRIANGLES,s.array.length,a,0),W.info.render.calls++,W.info.render.vertices+=s.array.length,W.info.render.faces+=s.array.length/3;else{n=!0;for(var l=0,c=i.length;l<c;l++){var h=i[l].index;n&&(o(r,e,t,h),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.buffer)),Nt.drawElements(Nt.TRIANGLES,i[l].count,a,i[l].start*f),W.info.render.calls++,W.info.render.vertices+=i[l].count,W.info.render.faces+=i[l].count/3}}}else n&&o(r,e,t,0),r=i.attributes.position,Nt.drawArrays(Nt.TRIANGLES,0,r.array.length/3),W.info.render.calls++,W.info.render.vertices+=r.array.length/3,W.info.render.faces+=r.array.length/9;else if(s instanceof THREE.ParticleSystem)n&&o(r,e,t,0),r=t.position,Nt.drawArrays(Nt.POINTS,0,r.array.length/3),W.info.render.calls++,W.info.render.points+=r.array.length/3;else if(s instanceof THREE.Line)if(a=s.type===THREE.LineStrip?Nt.LINE_STRIP:Nt.LINES,C(r.linewidth),s=t.index)if(s.array instanceof Uint32Array?(a=Nt.UNSIGNED_INT,f=4):(a=Nt.UNSIGNED_SHORT,f=2),i=i.offsets,0===i.length)n&&(o(r,e,t,0),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.buffer)),Nt.drawElements(Nt.LINES,s.array.length,a,0),W.info.render.calls++,W.info.render.vertices+=s.array.length;else for(1<i.length&&(n=!0),l=0,c=i.length;l<c;l++)h=i[l].index,n&&(o(r,e,t,h),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.buffer)),Nt.drawElements(Nt.LINES,i[l].count,a,i[l].start*f),W.info.render.calls++,W.info.render.vertices+=i[l].count;else n&&o(r,e,t,0),r=t.position,Nt.drawArrays(a,0,r.array.length/3),W.info.render.calls++,W.info.render.points+=r.array.length/3}},this.renderBuffer=function(e,t,n,r,i,s){if(!1!==r.visible){var o,l;n=S(e,t,n,r,s),t=n.attributes,e=!1,n=16777215*i.id+2*n.id+(r.wireframe?1:0),n!==K&&(K=n,e=!0),e&&u();if(!r.morphTargets&&0<=t.position)e&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglVertexBuffer),a(t.position),Nt.vertexAttribPointer(t.position,3,Nt.FLOAT,!1,0,0));else if(s.morphTargetBase){n=r.program.attributes,-1!==s.morphTargetBase&&0<=n.position?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[s.morphTargetBase]),a(n.position),Nt.vertexAttribPointer(n.position,3,Nt.FLOAT,!1,0,0)):0<=n.position&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglVertexBuffer),a(n.position),Nt.vertexAttribPointer(n.position,3,Nt.FLOAT,!1,0,0));if(s.morphTargetForcedOrder.length){var h=0;l=s.morphTargetForcedOrder;for(o=s.morphTargetInfluences;h<r.numSupportedMorphTargets&&h<l.length;)0<=n["morphTarget"+h]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[l[h]]),a(n["morphTarget"+h]),Nt.vertexAttribPointer(n["morphTarget"+h],3,Nt.FLOAT,!1,0,0)),0<=n["morphNormal"+h]&&r.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[l[h]]),a(n["morphNormal"+h]),Nt.vertexAttribPointer(n["morphNormal"+h],3,Nt.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[h]=o[l[h]],h++}else{l=[],o=s.morphTargetInfluences;var p,d=o.length;for(p=0;p<d;p++)h=o[p],0<h&&l.push([h,p]);l.length>r.numSupportedMorphTargets?(l.sort(c),l.length=r.numSupportedMorphTargets):l.length>r.numSupportedMorphNormals?l.sort(c):0===l.length&&l.push([0,0]);for(h=0;h<r.numSupportedMorphTargets;)l[h]?(p=l[h][1],0<=n["morphTarget"+h]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[p]),a(n["morphTarget"+h]),Nt.vertexAttribPointer(n["morphTarget"+h],3,Nt.FLOAT,!1,0,0)),0<=n["morphNormal"+h]&&r.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[p]),a(n["morphNormal"+h]),Nt.vertexAttribPointer(n["morphNormal"+h],3,Nt.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[h]=o[p]):s.__webglMorphTargetInfluences[h]=0,h++}null!==r.program.uniforms.morphTargetInfluences&&Nt.uniform1fv(r.program.uniforms.morphTargetInfluences,s.__webglMorphTargetInfluences)}if(e){if(i.__webglCustomAttributesList)for(o=0,l=i.__webglCustomAttributesList.length;o<l;o++)n=i.__webglCustomAttributesList[o],0<=t[n.buffer.belongsToAttribute]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,n.buffer),a(t[n.buffer.belongsToAttribute]),Nt.vertexAttribPointer(t[n.buffer.belongsToAttribute],n.size,Nt.FLOAT,!1,0,0));0<=t.color&&(0<s.geometry.colors.length||0<s.geometry.faces.length?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglColorBuffer),a(t.color),Nt.vertexAttribPointer(t.color,3,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&Nt.vertexAttrib3fv(t.color,r.defaultAttributeValues.color)),0<=t.normal&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglNormalBuffer),a(t.normal),Nt.vertexAttribPointer(t.normal,3,Nt.FLOAT,!1,0,0)),0<=t.tangent&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglTangentBuffer),a(t.tangent),Nt.vertexAttribPointer(t.tangent,4,Nt.FLOAT,!1,0,0)),0<=t.uv&&(s.geometry.faceVertexUvs[0]?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglUVBuffer),a(t.uv),Nt.vertexAttribPointer(t.uv,2,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&Nt.vertexAttrib2fv(t.uv,r.defaultAttributeValues.uv)),0<=t.uv2&&(s.geometry.faceVertexUvs[1]?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglUV2Buffer),a(t.uv2),Nt.vertexAttribPointer(t.uv2,2,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&Nt.vertexAttrib2fv(t.uv2,r.defaultAttributeValues.uv2)),r.skinning&&0<=t.skinIndex&&0<=t.skinWeight&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),a(t.skinIndex),Nt.vertexAttribPointer(t.skinIndex,4,Nt.FLOAT,!1,0,0),Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),a(t.skinWeight),Nt.vertexAttribPointer(t.skinWeight,4,Nt.FLOAT,!1,0,0)),0<=t.lineDistance&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglLineDistanceBuffer),a(t.lineDistance),Nt.vertexAttribPointer(t.lineDistance,1,Nt.FLOAT,!1,0,0))}f(),s instanceof THREE.Mesh?(s=i.__typeArray===Uint32Array?Nt.UNSIGNED_INT:Nt.UNSIGNED_SHORT,r.wireframe?(C(r.wireframeLinewidth),e&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),Nt.drawElements(Nt.LINES,i.__webglLineCount,s,0)):(e&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),Nt.drawElements(Nt.TRIANGLES,i.__webglFaceCount,s,0)),W.info.render.calls++,W.info.render.vertices+=i.__webglFaceCount,W.info.render.faces+=i.__webglFaceCount/3):s instanceof THREE.Line?(s=s.type===THREE.LineStrip?Nt.LINE_STRIP:Nt.LINES,C(r.linewidth),Nt.drawArrays(s,0,i.__webglLineCount),W.info.render.calls++):s instanceof THREE.ParticleSystem&&(Nt.drawArrays(Nt.POINTS,0,i.__webglParticleCount),W.info.render.calls++,W.info.render.points+=i.__webglParticleCount)}},this.render=function(e,t,n,r){if(0==t instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var i,s,o,u,a=e.__lights,f=e.fog;J=-1,xt=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),bt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),yt.setFromMatrix(bt),this.autoUpdateObjects&&this.initWebGLObjects(e),h(this.renderPluginsPre,e,t),W.info.render.calls=0,W.info.render.vertices=0,W.info.render.faces=0,W.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),u=e.__webglObjects,r=0;for(i=u.length;r<i;r++)if(s=u[r],o=s.object,s.id=r,s.render=!1,o.visible&&(!(o instanceof THREE.Mesh||o instanceof THREE.ParticleSystem)||!o.frustumCulled||yt.intersectsObject(o))){var c=o;c._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,c.matrixWorld),c._normalMatrix.getNormalMatrix(c._modelViewMatrix);var c=s,v=c.object,m=c.buffer,g=v.geometry,v=v.material;v instanceof THREE.MeshFaceMaterial?(v=v.materials[g instanceof THREE.BufferGeometry?0:m.materialIndex],v.transparent?(c.transparent=v,c.opaque=null):(c.opaque=v,c.transparent=null)):v&&(v.transparent?(c.transparent=v,c.opaque=null):(c.opaque=v,c.transparent=null)),s.render=!0,!0===this.sortObjects&&(null!==o.renderDepth?s.z=o.renderDepth:(Et.setFromMatrixPosition(o.matrixWorld),Et.applyProjection(bt),s.z=Et.z))}this.sortObjects&&u.sort(l),u=e.__webglObjectsImmediate,r=0;for(i=u.length;r<i;r++)s=u[r],o=s.object,o.visible&&(o._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,o.matrixWorld),o._normalMatrix.getNormalMatrix(o._modelViewMatrix),o=s.object.material,o.transparent?(s.transparent=o,s.opaque=null):(s.opaque=o,s.transparent=null));e.overrideMaterial?(r=e.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),k(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),p(e.__webglObjects,!1,"",t,a,f,!0,r),d(e.__webglObjectsImmediate,"",t,a,f,!1,r)):(r=null,this.setBlending(THREE.NoBlending),p(e.__webglObjects,!0,"opaque",t,a,f,!1,r),d(e.__webglObjectsImmediate,"opaque",t,a,f,!1,r),p(e.__webglObjects,!1,"transparent",t,a,f,!0,r),d(e.__webglObjectsImmediate,"transparent",t,a,f,!0,r)),h(this.renderPluginsPost,e,t),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&(n instanceof THREE.WebGLRenderTargetCube?(Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null)):(Nt.bindTexture(Nt.TEXTURE_2D,n.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_2D),Nt.bindTexture(Nt.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,n,r,i){var s=S(e,t,n,r,i);K=-1,W.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,Nt,yt):i.render(function(e){W.renderBufferImmediate(e,s,r)})},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);for(;e.__objectsAdded.length;)v(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)b(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,o=e.__webglObjects.length;t<o;t++){var u=e.__webglObjects[t].object;void 0===u.__webglInit&&(void 0!==u.__webglActive&&b(u,e),v(u,e));var a=u,f=a.geometry,l=void 0,h=void 0,p=void 0;if(f instanceof THREE.BufferGeometry){var d=Nt.DYNAMIC_DRAW,m=f.attributes,w=void 0,E=void 0;for(w in m)E=m[w],E.needsUpdate&&("index"===w?(Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,E.buffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,E.array,d)):(Nt.bindBuffer(Nt.ARRAY_BUFFER,E.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,E.array,d)),E.needsUpdate=!1)}else if(a instanceof THREE.Mesh){for(var S=0,x=f.geometryGroupsList.length;S<x;S++)if(l=f.geometryGroupsList[S],p=r(a,l),f.buffersNeedUpdate&&n(l,a),h=p.attributes&&g(p),f.verticesNeedUpdate||f.morphTargetsNeedUpdate||f.elementsNeedUpdate||f.uvsNeedUpdate||f.normalsNeedUpdate||f.colorsNeedUpdate||f.tangentsNeedUpdate||h){var T=l,N=a,C=Nt.DYNAMIC_DRAW,k=!f.dynamic,L=p;if(T.__inittedArrays){var A=i(L),O=L.vertexColors?L.vertexColors:!1,M=s(L),_=A===THREE.SmoothShading,D=void 0,P=void 0,H=void 0,B=void 0,j=void 0,F=void 0,I=void 0,q=void 0,R=void 0,U=void 0,z=void 0,W=void 0,X=void 0,V=void 0,$=void 0,J=void 0,K=void 0,Q=void 0,G=void 0,Y=void 0,Z=void 0,et=void 0,tt=void 0,nt=void 0,rt=void 0,it=void 0,st=void 0,ot=void 0,ut=void 0,at=void 0,ft=void 0,lt=void 0,ct=void 0,ht=void 0,pt=void 0,dt=void 0,vt=void 0,mt=void 0,gt=void 0,yt=void 0,St=0,xt=0,Tt=0,Ct=0,kt=0,Lt=0,At=0,Ot=0,Mt=0,_t=0,Dt=0,Pt=0,Ht=void 0,Bt=T.__vertexArray,jt=T.__uvArray,Ft=T.__uv2Array,It=T.__normalArray,qt=T.__tangentArray,Rt=T.__colorArray,Ut=T.__skinIndexArray,zt=T.__skinWeightArray,Wt=T.__morphTargetsArrays,Xt=T.__morphNormalsArrays,Vt=T.__webglCustomAttributesList,$t=void 0,Jt=T.__faceArray,Kt=T.__lineArray,Qt=N.geometry,Gt=Qt.elementsNeedUpdate,Yt=Qt.uvsNeedUpdate,Zt=Qt.normalsNeedUpdate,en=Qt.tangentsNeedUpdate,tn=Qt.colorsNeedUpdate,nn=Qt.morphTargetsNeedUpdate,rn=Qt.vertices,sn=T.faces3,on=Qt.faces,un=Qt.faceVertexUvs[0],an=Qt.faceVertexUvs[1],fn=Qt.skinIndices,ln=Qt.skinWeights,cn=Qt.morphTargets,hn=Qt.morphNormals;if(Qt.verticesNeedUpdate){D=0;for(P=sn.length;D<P;D++)B=on[sn[D]],W=rn[B.a],X=rn[B.b],V=rn[B.c],Bt[xt]=W.x,Bt[xt+1]=W.y,Bt[xt+2]=W.z,Bt[xt+3]=X.x,Bt[xt+4]=X.y,Bt[xt+5]=X.z,Bt[xt+6]=V.x,Bt[xt+7]=V.y,Bt[xt+8]=V.z,xt+=9;Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Bt,C)}if(nn)for(pt=0,dt=cn.length;pt<dt;pt++){D=Dt=0;for(P=sn.length;D<P;D++)gt=sn[D],B=on[gt],W=cn[pt].vertices[B.a],X=cn[pt].vertices[B.b],V=cn[pt].vertices[B.c],vt=Wt[pt],vt[Dt]=W.x,vt[Dt+1]=W.y,vt[Dt+2]=W.z,vt[Dt+3]=X.x,vt[Dt+4]=X.y,vt[Dt+5]=X.z,vt[Dt+6]=V.x,vt[Dt+7]=V.y,vt[Dt+8]=V.z,L.morphNormals&&(_?(yt=hn[pt].vertexNormals[gt],Q=yt.a,G=yt.b,Y=yt.c):Y=G=Q=hn[pt].faceNormals[gt],mt=Xt[pt],mt[Dt]=Q.x,mt[Dt+1]=Q.y,mt[Dt+2]=Q.z,mt[Dt+3]=G.x,mt[Dt+4]=G.y,mt[Dt+5]=G.z,mt[Dt+6]=Y.x,mt[Dt+7]=Y.y,mt[Dt+8]=Y.z),Dt+=9;Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglMorphTargetsBuffers[pt]),Nt.bufferData(Nt.ARRAY_BUFFER,Wt[pt],C),L.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglMorphNormalsBuffers[pt]),Nt.bufferData(Nt.ARRAY_BUFFER,Xt[pt],C))}if(ln.length){D=0;for(P=sn.length;D<P;D++)B=on[sn[D]],nt=ln[B.a],rt=ln[B.b],it=ln[B.c],zt[_t]=nt.x,zt[_t+1]=nt.y,zt[_t+2]=nt.z,zt[_t+3]=nt.w,zt[_t+4]=rt.x,zt[_t+5]=rt.y,zt[_t+6]=rt.z,zt[_t+7]=rt.w,zt[_t+8]=it.x,zt[_t+9]=it.y,zt[_t+10]=it.z,zt[_t+11]=it.w,st=fn[B.a],ot=fn[B.b],ut=fn[B.c],Ut[_t]=st.x,Ut[_t+1]=st.y,Ut[_t+2]=st.z,Ut[_t+3]=st.w,Ut[_t+4]=ot.x,Ut[_t+5]=ot.y,Ut[_t+6]=ot.z,Ut[_t+7]=ot.w,Ut[_t+8]=ut.x,Ut[_t+9]=ut.y,Ut[_t+10]=ut.z,Ut[_t+11]=ut.w,_t+=12;0<_t&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglSkinIndicesBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Ut,C),Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglSkinWeightsBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,zt,C))}if(tn&&O){D=0;for(P=sn.length;D<P;D++)B=on[sn[D]],I=B.vertexColors,q=B.color,3===I.length&&O===THREE.VertexColors?(Z=I[0],et=I[1],tt=I[2]):tt=et=Z=q,Rt[Mt]=Z.r,Rt[Mt+1]=Z.g,Rt[Mt+2]=Z.b,Rt[Mt+3]=et.r,Rt[Mt+4]=et.g,Rt[Mt+5]=et.b,Rt[Mt+6]=tt.r,Rt[Mt+7]=tt.g,Rt[Mt+8]=tt.b,Mt+=9;0<Mt&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Rt,C))}if(en&&Qt.hasTangents){D=0;for(P=sn.length;D<P;D++)B=on[sn[D]],R=B.vertexTangents,$=R[0],J=R[1],K=R[2],qt[At]=$.x,qt[At+1]=$.y,qt[At+2]=$.z,qt[At+3]=$.w,qt[At+4]=J.x,qt[At+5]=J.y,qt[At+6]=J.z,qt[At+7]=J.w,qt[At+8]=K.x,qt[At+9]=K.y,qt[At+10]=K.z,qt[At+11]=K.w,At+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglTangentBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,qt,C)}if(Zt&&A){D=0;for(P=sn.length;D<P;D++)if(B=on[sn[D]],j=B.vertexNormals,F=B.normal,3===j.length&&_)for(at=0;3>at;at++)lt=j[at],It[Lt]=lt.x,It[Lt+1]=lt.y,It[Lt+2]=lt.z,Lt+=3;else for(at=0;3>at;at++)It[Lt]=F.x,It[Lt+1]=F.y,It[Lt+2]=F.z,Lt+=3;Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglNormalBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,It,C)}if(Yt&&un&&M){D=0;for(P=sn.length;D<P;D++)if(H=sn[D],U=un[H],void 0!==U)for(at=0;3>at;at++)ct=U[at],jt[Tt]=ct.x,jt[Tt+1]=ct.y,Tt+=2;0<Tt&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglUVBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,jt,C))}if(Yt&&an&&M){D=0;for(P=sn.length;D<P;D++)if(H=sn[D],z=an[H],void 0!==z)for(at=0;3>at;at++)ht=z[at],Ft[Ct]=ht.x,Ft[Ct+1]=ht.y,Ct+=2;0<Ct&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,T.__webglUV2Buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Ft,C))}if(Gt){D=0;for(P=sn.length;D<P;D++)Jt[kt]=St,Jt[kt+1]=St+1,Jt[kt+2]=St+2,kt+=3,Kt[Ot]=St,Kt[Ot+1]=St+1,Kt[Ot+2]=St,Kt[Ot+3]=St+2,Kt[Ot+4]=St+1,Kt[Ot+5]=St+2,Ot+=6,St+=3;Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,T.__webglFaceBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,Jt,C),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,T.__webglLineBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,Kt,C)}if(Vt)for(at=0,ft=Vt.length;at<ft;at++)if($t=Vt[at],$t.__original.needsUpdate){Pt=0;if(1===$t.size){if(void 0===$t.boundTo||"vertices"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)B=on[sn[D]],$t.array[Pt]=$t.value[B.a],$t.array[Pt+1]=$t.value[B.b],$t.array[Pt+2]=$t.value[B.c],Pt+=3;else if("faces"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)Ht=$t.value[sn[D]],$t.array[Pt]=Ht,$t.array[Pt+1]=Ht,$t.array[Pt+2]=Ht,Pt+=3}else if(2===$t.size){if(void 0===$t.boundTo||"vertices"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)B=on[sn[D]],W=$t.value[B.a],X=$t.value[B.b],V=$t.value[B.c],$t.array[Pt]=W.x,$t.array[Pt+1]=W.y,$t.array[Pt+2]=X.x,$t.array[Pt+3]=X.y,$t.array[Pt+4]=V.x,$t.array[Pt+5]=V.y,Pt+=6;else if("faces"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)V=X=W=Ht=$t.value[sn[D]],$t.array[Pt]=W.x,$t.array[Pt+1]=W.y,$t.array[Pt+2]=X.x,$t.array[Pt+3]=X.y,$t.array[Pt+4]=V.x,$t.array[Pt+5]=V.y,Pt+=6}else if(3===$t.size){var pn;pn="c"===$t.type?["r","g","b"]:["x","y","z"];if(void 0===$t.boundTo||"vertices"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)B=on[sn[D]],W=$t.value[B.a],X=$t.value[B.b],V=$t.value[B.c],$t.array[Pt]=W[pn[0]],$t.array[Pt+1]=W[pn[1]],$t.array[Pt+2]=W[pn[2]],$t.array[Pt+3]=X[pn[0]],$t.array[Pt+4]=X[pn[1]],$t.array[Pt+5]=X[pn[2]],$t.array[Pt+6]=V[pn[0]],$t.array[Pt+7]=V[pn[1]],$t.array[Pt+8]=V[pn[2]],Pt+=9;else if("faces"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)V=X=W=Ht=$t.value[sn[D]],$t.array[Pt]=W[pn[0]],$t.array[Pt+1]=W[pn[1]],$t.array[Pt+2]=W[pn[2]],$t.array[Pt+3]=X[pn[0]],$t.array[Pt+4]=X[pn[1]],$t.array[Pt+5]=X[pn[2]],$t.array[Pt+6]=V[pn[0]],$t.array[Pt+7]=V[pn[1]],$t.array[Pt+8]=V[pn[2]],Pt+=9;else if("faceVertices"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)Ht=$t.value[sn[D]],W=Ht[0],X=Ht[1],V=Ht[2],$t.array[Pt]=W[pn[0]],$t.array[Pt+1]=W[pn[1]],$t.array[Pt+2]=W[pn[2]],$t.array[Pt+3]=X[pn[0]],$t.array[Pt+4]=X[pn[1]],$t.array[Pt+5]=X[pn[2]],$t.array[Pt+6]=V[pn[0]],$t.array[Pt+7]=V[pn[1]],$t.array[Pt+8]=V[pn[2]],Pt+=9}else if(4===$t.size)if(void 0===$t.boundTo||"vertices"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)B=on[sn[D]],W=$t.value[B.a],X=$t.value[B.b],V=$t.value[B.c],$t.array[Pt]=W.x,$t.array[Pt+1]=W.y,$t.array[Pt+2]=W.z,$t.array[Pt+3]=W.w,$t.array[Pt+4]=X.x,$t.array[Pt+5]=X.y,$t.array[Pt+6]=X.z,$t.array[Pt+7]=X.w,$t.array[Pt+8]=V.x,$t.array[Pt+9]=V.y,$t.array[Pt+10]=V.z,$t.array[Pt+11]=V.w,Pt+=12;else if("faces"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)V=X=W=Ht=$t.value[sn[D]],$t.array[Pt]=W.x,$t.array[Pt+1]=W.y,$t.array[Pt+2]=W.z,$t.array[Pt+3]=W.w,$t.array[Pt+4]=X.x,$t.array[Pt+5]=X.y,$t.array[Pt+6]=X.z,$t.array[Pt+7]=X.w,$t.array[Pt+8]=V.x,$t.array[Pt+9]=V.y,$t.array[Pt+10]=V.z,$t.array[Pt+11]=V.w,Pt+=12;else if("faceVertices"===$t.boundTo)for(D=0,P=sn.length;D<P;D++)Ht=$t.value[sn[D]],W=Ht[0],X=Ht[1],V=Ht[2],$t.array[Pt]=W.x,$t.array[Pt+1]=W.y,$t.array[Pt+2]=W.z,$t.array[Pt+3]=W.w,$t.array[Pt+4]=X.x,$t.array[Pt+5]=X.y,$t.array[Pt+6]=X.z,$t.array[Pt+7]=X.w,$t.array[Pt+8]=V.x,$t.array[Pt+9]=V.y,$t.array[Pt+10]=V.z,$t.array[Pt+11]=V.w,Pt+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,$t.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,$t.array,C)}k&&(delete T.__inittedArrays,delete T.__colorArray,delete T.__normalArray,delete T.__tangentArray,delete T.__uvArray,delete T.__uv2Array,delete T.__faceArray,delete T.__vertexArray,delete T.__lineArray,delete T.__skinIndexArray,delete T.__skinWeightArray)}}f.verticesNeedUpdate=!1,f.morphTargetsNeedUpdate=!1,f.elementsNeedUpdate=!1,f.uvsNeedUpdate=!1,f.normalsNeedUpdate=!1,f.colorsNeedUpdate=!1,f.tangentsNeedUpdate=!1,f.buffersNeedUpdate=!1,p.attributes&&y(p)}else if(a instanceof THREE.Line){p=r(a,f),h=p.attributes&&g(p);if(f.verticesNeedUpdate||f.colorsNeedUpdate||f.lineDistancesNeedUpdate||h){var dn=f,vn=Nt.DYNAMIC_DRAW,mn=void 0,gn=void 0,yn=void 0,bn=void 0,wn=void 0,En=void 0,Sn=dn.vertices,xn=dn.colors,Tn=dn.lineDistances,Nn=Sn.length,Cn=xn.length,kn=Tn.length,Ln=dn.__vertexArray,An=dn.__colorArray,On=dn.__lineDistanceArray,Mn=dn.colorsNeedUpdate,_n=dn.lineDistancesNeedUpdate,Dn=dn.__webglCustomAttributesList,Pn=void 0,Hn=void 0,Bn=void 0,jn=void 0,Fn=void 0,In=void 0;if(dn.verticesNeedUpdate){for(mn=0;mn<Nn;mn++)bn=Sn[mn],wn=3*mn,Ln[wn]=bn.x,Ln[wn+1]=bn.y,Ln[wn+2]=bn.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,dn.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Ln,vn)}if(Mn){for(gn=0;gn<Cn;gn++)En=xn[gn],wn=3*gn,An[wn]=En.r,An[wn+1]=En.g,An[wn+2]=En.b;Nt.bindBuffer(Nt.ARRAY_BUFFER,dn.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,An,vn)}if(_n){for(yn=0;yn<kn;yn++)On[yn]=Tn[yn];Nt.bindBuffer(Nt.ARRAY_BUFFER,dn.__webglLineDistanceBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,On,vn)}if(Dn)for(Pn=0,Hn=Dn.length;Pn<Hn;Pn++)if(In=Dn[Pn],In.needsUpdate&&(void 0===In.boundTo||"vertices"===In.boundTo)){wn=0,jn=In.value.length;if(1===In.size)for(Bn=0;Bn<jn;Bn++)In.array[Bn]=In.value[Bn];else if(2===In.size)for(Bn=0;Bn<jn;Bn++)Fn=In.value[Bn],In.array[wn]=Fn.x,In.array[wn+1]=Fn.y,wn+=2;else if(3===In.size)if("c"===In.type)for(Bn=0;Bn<jn;Bn++)Fn=In.value[Bn],In.array[wn]=Fn.r,In.array[wn+1]=Fn.g,In.array[wn+2]=Fn.b,wn+=3;else for(Bn=0;Bn<jn;Bn++)Fn=In.value[Bn],In.array[wn]=Fn.x,In.array[wn+1]=Fn.y,In.array[wn+2]=Fn.z,wn+=3;else if(4===In.size)for(Bn=0;Bn<jn;Bn++)Fn=In.value[Bn],In.array[wn]=Fn.x,In.array[wn+1]=Fn.y,In.array[wn+2]=Fn.z,In.array[wn+3]=Fn.w,wn+=4;Nt.bindBuffer(Nt.ARRAY_BUFFER,In.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,In.array,vn)}}f.verticesNeedUpdate=!1,f.colorsNeedUpdate=!1,f.lineDistancesNeedUpdate=!1,p.attributes&&y(p)}else if(a instanceof THREE.ParticleSystem){p=r(a,f),h=p.attributes&&g(p);if(f.verticesNeedUpdate||f.colorsNeedUpdate||a.sortParticles||h){var qn=f,Rn=Nt.DYNAMIC_DRAW,Un=a,zn=void 0,Wn=void 0,Xn=void 0,Vn=void 0,$n=void 0,Jn=void 0,Kn=qn.vertices,Qn=Kn.length,Gn=qn.colors,Yn=Gn.length,Zn=qn.__vertexArray,er=qn.__colorArray,tr=qn.__sortArray,nr=qn.verticesNeedUpdate,rr=qn.colorsNeedUpdate,ir=qn.__webglCustomAttributesList,sr=void 0,or=void 0,ur=void 0,ar=void 0,fr=void 0,lr=void 0;if(Un.sortParticles){wt.copy(bt),wt.multiply(Un.matrixWorld);for(zn=0;zn<Qn;zn++)Xn=Kn[zn],Et.copy(Xn),Et.applyProjection(wt),tr[zn]=[Et.z,zn];tr.sort(c);for(zn=0;zn<Qn;zn++)Xn=Kn[tr[zn][1]],Vn=3*zn,Zn[Vn]=Xn.x,Zn[Vn+1]=Xn.y,Zn[Vn+2]=Xn.z;for(Wn=0;Wn<Yn;Wn++)Vn=3*Wn,Jn=Gn[tr[Wn][1]],er[Vn]=Jn.r,er[Vn+1]=Jn.g,er[Vn+2]=Jn.b;if(ir)for(sr=0,or=ir.length;sr<or;sr++)if(lr=ir[sr],void 0===lr.boundTo||"vertices"===lr.boundTo)if(Vn=0,ar=lr.value.length,1===lr.size)for(ur=0;ur<ar;ur++)$n=tr[ur][1],lr.array[ur]=lr.value[$n];else if(2===lr.size)for(ur=0;ur<ar;ur++)$n=tr[ur][1],fr=lr.value[$n],lr.array[Vn]=fr.x,lr.array[Vn+1]=fr.y,Vn+=2;else if(3===lr.size)if("c"===lr.type)for(ur=0;ur<ar;ur++)$n=tr[ur][1],fr=lr.value[$n],lr.array[Vn]=fr.r,lr.array[Vn+1]=fr.g,lr.array[Vn+2]=fr.b,Vn+=3;else for(ur=0;ur<ar;ur++)$n=tr[ur][1],fr=lr.value[$n],lr.array[Vn]=fr.x,lr.array[Vn+1]=fr.y,lr.array[Vn+2]=fr.z,Vn+=3;else if(4===lr.size)for(ur=0;ur<ar;ur++)$n=tr[ur][1],fr=lr.value[$n],lr.array[Vn]=fr.x,lr.array[Vn+1]=fr.y,lr.array[Vn+2]=fr.z,lr.array[Vn+3]=fr.w,Vn+=4}else{if(nr)for(zn=0;zn<Qn;zn++)Xn=Kn[zn],Vn=3*zn,Zn[Vn]=Xn.x,Zn[Vn+1]=Xn.y,Zn[Vn+2]=Xn.z;if(rr)for(Wn=0;Wn<Yn;Wn++)Jn=Gn[Wn],Vn=3*Wn,er[Vn]=Jn.r,er[Vn+1]=Jn.g,er[Vn+2]=Jn.b;if(ir)for(sr=0,or=ir.length;sr<or;sr++)if(lr=ir[sr],lr.needsUpdate&&(void 0===lr.boundTo||"vertices"===lr.boundTo))if(ar=lr.value.length,Vn=0,1===lr.size)for(ur=0;ur<ar;ur++)lr.array[ur]=lr.value[ur];else if(2===lr.size)for(ur=0;ur<ar;ur++)fr=lr.value[ur],lr.array[Vn]=fr.x,lr.array[Vn+1]=fr.y,Vn+=2;else if(3===lr.size)if("c"===lr.type)for(ur=0;ur<ar;ur++)fr=lr.value[ur],lr.array[Vn]=fr.r,lr.array[Vn+1]=fr.g,lr.array[Vn+2]=fr.b,Vn+=3;else for(ur=0;ur<ar;ur++)fr=lr.value[ur],lr.array[Vn]=fr.x,lr.array[Vn+1]=fr.y,lr.array[Vn+2]=fr.z,Vn+=3;else if(4===lr.size)for(ur=0;ur<ar;ur++)fr=lr.value[ur],lr.array[Vn]=fr.x,lr.array[Vn+1]=fr.y,lr.array[Vn+2]=fr.z,lr.array[Vn+3]=fr.w,Vn+=4}if(nr||Un.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,qn.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Zn,Rn);if(rr||Un.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,qn.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,er,Rn);if(ir)for(sr=0,or=ir.length;sr<or;sr++)if(lr=ir[sr],lr.needsUpdate||Un.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,lr.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,lr.array,Rn)}f.verticesNeedUpdate=!1,f.colorsNeedUpdate=!1,p.attributes&&y(p)}}},this.initMaterial=function(e,t,n,r){var i,s,o,u;e.addEventListener("dispose",Vt);var a,f,l,c;e instanceof THREE.MeshDepthMaterial?c="depth":e instanceof THREE.MeshNormalMaterial?c="normal":e instanceof THREE.MeshBasicMaterial?c="basic":e instanceof THREE.MeshLambertMaterial?c="lambert":e instanceof THREE.MeshPhongMaterial?c="phong":e instanceof THREE.LineBasicMaterial?c="basic":e instanceof THREE.LineDashedMaterial?c="dashed":e instanceof THREE.ParticleSystemMaterial&&(c="particle_basic"),c&&(i=THREE.ShaderLib[c],e.uniforms=THREE.UniformsUtils.clone(i.uniforms),e.vertexShader=i.vertexShader,e.fragmentShader=i.fragmentShader),l=u=o=s=i=0;for(var h=t.length;l<h;l++){var p=t[l];p.onlyShadow||!1===p.visible||(p instanceof THREE.DirectionalLight&&i++,p instanceof THREE.PointLight&&s++,p instanceof THREE.SpotLight&&o++,p instanceof THREE.HemisphereLight&&u++)}h=l=0;for(p=t.length;h<p;h++){var d=t[h];d.castShadow&&(d instanceof THREE.SpotLight&&l++,d instanceof THREE.DirectionalLight&&!d.shadowCascade&&l++)}t=l,Bt&&r&&r.skeleton&&r.skeleton.useVertexTexture?l=1024:(l=Nt.getParameter(Nt.MAX_VERTEX_UNIFORM_VECTORS),l=Math.floor((l-20)/4),void 0!==r&&r instanceof THREE.SkinnedMesh&&(l=Math.min(r.skeleton.bones.length,l),l<r.skeleton.bones.length&&console.warn("WebGLRenderer: too many bones - "+r.skeleton.bones.length+", this GPU supports just "+l+" (try OpenGL instead of ANGLE)"))),n={precision:P,supportsVertexTextures:Ht,map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,logarithmicDepthBuffer:R,skinning:e.skinning,maxBones:l,useVertexTexture:Bt&&r&&r.skeleton&&r.skeleton.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:i,maxPointLights:s,maxSpotLights:o,maxHemiLights:u,maxShadows:t,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow&&0<t,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},r=[],c?r.push(c):(r.push(e.fragmentShader),r.push(e.vertexShader));for(var v in e.defines)r.push(v),r.push(e.defines[v]);for(f in n)r.push(f),r.push(n[f]);c=r.join();var m;f=0;for(v=X.length;f<v;f++)if(r=X[f],r.code===c){m=r,m.usedTimes++;break}void 0===m&&(m=new THREE.WebGLProgram(this,c,e,n),X.push(m),W.info.memory.programs=X.length),e.program=m,m=e.program.attributes;if(e.morphTargets)for(e.numSupportedMorphTargets=0,v="morphTarget",f=0;f<this.maxMorphTargets;f++)c=v+f,0<=m[c]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(e.numSupportedMorphNormals=0,v="morphNormal",f=0;f<this.maxMorphNormals;f++)c=v+f,0<=m[c]&&e.numSupportedMorphNormals++;e.uniformsList=[];for(a in e.uniforms)e.uniformsList.push([e.uniforms[a],a])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?Nt.disable(Nt.CULL_FACE):(t===THREE.FrontFaceDirectionCW?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),e===THREE.CullFaceBack?Nt.cullFace(Nt.BACK):e===THREE.CullFaceFront?Nt.cullFace(Nt.FRONT):Nt.cullFace(Nt.FRONT_AND_BACK),Nt.enable(Nt.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide;e=e.side===THREE.BackSide,Y!==t&&(t?Nt.disable(Nt.CULL_FACE):Nt.enable(Nt.CULL_FACE),Y=t),Z!==e&&(e?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),Z=e)},this.setDepthTest=function(e){it!==e&&(e?Nt.enable(Nt.DEPTH_TEST):Nt.disable(Nt.DEPTH_TEST),it=e)},this.setDepthWrite=function(e){st!==e&&(Nt.depthMask(e),st=e)},this.setBlending=function(e,t,n,r){e!==et&&(e===THREE.NoBlending?Nt.disable(Nt.BLEND):e===THREE.AdditiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE)):e===THREE.SubtractiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.SRC_COLOR)):e===THREE.CustomBlending?Nt.enable(Nt.BLEND):(Nt.enable(Nt.BLEND),Nt.blendEquationSeparate(Nt.FUNC_ADD,Nt.FUNC_ADD),Nt.blendFuncSeparate(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA,Nt.ONE,Nt.ONE_MINUS_SRC_ALPHA)),et=e);if(e===THREE.CustomBlending){if(t!==tt&&(Nt.blendEquation(M(t)),tt=t),n!==nt||r!==rt)Nt.blendFunc(M(n),M(r)),nt=n,rt=r}else rt=nt=tt=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Wt),e.__webglTexture=Nt.createTexture(),W.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,e.flipY),Nt.pixelStorei(Nt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Nt.pixelStorei(Nt.UNPACK_ALIGNMENT,e.unpackAlignment);var n=e.image,r=THREE.Math.isPowerOfTwo(n.width)&&THREE.Math.isPowerOfTwo(n.height),i=M(e.format),s=M(e.type);L(Nt.TEXTURE_2D,e,r);var o=e.mipmaps;if(e instanceof THREE.DataTexture)if(0<o.length&&r){for(var u=0,a=o.length;u<a;u++)n=o[u],Nt.texImage2D(Nt.TEXTURE_2D,u,i,n.width,n.height,0,i,s,n.data);e.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,i,n.width,n.height,0,i,s,n.data);else if(e instanceof THREE.CompressedTexture)for(u=0,a=o.length;u<a;u++)n=o[u],e.format!==THREE.RGBAFormat?Nt.compressedTexImage2D(Nt.TEXTURE_2D,u,i,n.width,n.height,0,n.data):Nt.texImage2D(Nt.TEXTURE_2D,u,i,n.width,n.height,0,i,s,n.data);else if(0<o.length&&r){u=0;for(a=o.length;u<a;u++)n=o[u],Nt.texImage2D(Nt.TEXTURE_2D,u,i,i,s,n);e.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,i,i,s,e.image);e.generateMipmaps&&r&&Nt.generateMipmap(Nt.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Xt),e.__webglTexture=Nt.createTexture(),W.info.memory.textures++;var n=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height),r=M(e.format),i=M(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,e.__webglTexture),L(Nt.TEXTURE_CUBE_MAP,e,n);for(var s=0;6>s;s++){e.__webglFramebuffer[s]=Nt.createFramebuffer(),e.__webglRenderbuffer[s]=Nt.createRenderbuffer(),Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r,e.width,e.height,0,r,i,null);var o=e,u=Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s;Nt.bindFramebuffer(Nt.FRAMEBUFFER,e.__webglFramebuffer[s]),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,u,o.__webglTexture,0),A(e.__webglRenderbuffer[s],e)}n&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Nt.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:Nt.createRenderbuffer(),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),L(Nt.TEXTURE_2D,e,n),Nt.texImage2D(Nt.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null),r=Nt.TEXTURE_2D,Nt.bindFramebuffer(Nt.FRAMEBUFFER,e.__webglFramebuffer),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,r,e.__webglTexture,0),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e.__webglRenderbuffer):A(e.__webglRenderbuffer,e),n&&Nt.generateMipmap(Nt.TEXTURE_2D);t?Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null):Nt.bindTexture(Nt.TEXTURE_2D,null),Nt.bindRenderbuffer(Nt.RENDERBUFFER,null),Nt.bindFramebuffer(Nt.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=r=0):(t=null,n=ht,e=pt,r=lt,i=ct),t!==$&&(Nt.bindFramebuffer(Nt.FRAMEBUFFER,t),Nt.viewport(r,i,n,e),$=t),dt=n,vt=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==n.format?n.format:THREE.RGBAFormat,this.type=void 0!==n.type?n.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==n.depthBuffer?n.depthBuffer:!0,this.stencilBuffer=void 0!==n.stencilBuffer?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(e,t){this.width=e,this.height=t},clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.WebGLProgram=function(){var e=0;return function(t,n,r,i){var s=t.context,o=r.fragmentShader,u=r.vertexShader,f=r.uniforms,l=r.attributes,c=r.defines,h=r.index0AttributeName;void 0===h&&!0===i.morphTargets&&(h="position");var p="SHADOWMAP_TYPE_BASIC";i.shadowMapType===THREE.PCFShadowMap?p="SHADOWMAP_TYPE_PCF":i.shadowMapType===THREE.PCFSoftShadowMap&&(p="SHADOWMAP_TYPE_PCF_SOFT");var d,v;d=[];for(var m in c)v=c[m],!1!==v&&(v="#define "+m+" "+v,d.push(v));d=d.join("\n"),c=s.createProgram(),r instanceof THREE.RawShaderMaterial?t=r="":(r=["precision "+i.precision+" float;","precision "+i.precision+" int;",d,i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.gammaInput?"#define GAMMA_INPUT":"",t.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+p:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\n	attribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\n	attribute vec3 morphTarget0;\n	attribute vec3 morphTarget1;\n	attribute vec3 morphTarget2;\n	attribute vec3 morphTarget3;\n	#ifdef USE_MORPHNORMALS\n		attribute vec3 morphNormal0;\n		attribute vec3 morphNormal1;\n		attribute vec3 morphNormal2;\n		attribute vec3 morphNormal3;\n	#else\n		attribute vec3 morphTarget4;\n		attribute vec3 morphTarget5;\n		attribute vec3 morphTarget6;\n		attribute vec3 morphTarget7;\n	#endif\n#endif\n#ifdef USE_SKINNING\n	attribute vec4 skinIndex;\n	attribute vec4 skinWeight;\n#endif\n"].join("\n"),t=["precision "+i.precision+" float;","precision "+i.precision+" int;",i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",d,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",t.gammaInput?"#define GAMMA_INPUT":"",t.gammaOutput?"#define GAMMA_OUTPUT":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+p:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n")),u=new THREE.WebGLShader(s,s.VERTEX_SHADER,r+u),o=new THREE.WebGLShader(s,s.FRAGMENT_SHADER,t+o),s.attachShader(c,u),s.attachShader(c,o),void 0!==h&&s.bindAttribLocation(c,0,h),s.linkProgram(c),!1===s.getProgramParameter(c,s.LINK_STATUS)&&(console.error("Could not initialise shader"),console.error("gl.VALIDATE_STATUS",s.getProgramParameter(c,s.VALIDATE_STATUS)),console.error("gl.getError()",s.getError())),""!==s.getProgramInfoLog(c)&&console.error("gl.getProgramInfoLog()",s.getProgramInfoLog(c)),s.deleteShader(u),s.deleteShader(o),h="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),i.useVertexTexture?(h.push("boneTexture"),h.push("boneTextureWidth"),h.push("boneTextureHeight")):h.push("boneGlobalMatrices"),i.logarithmicDepthBuffer&&h.push("logDepthBufFC");for(var g in f)h.push(g);f=h,g={},h=0;for(t=f.length;h<t;h++)p=f[h],g[p]=s.getUniformLocation(c,p);this.uniforms=g,h="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(f=0;f<i.maxMorphTargets;f++)h.push("morphTarget"+f);for(f=0;f<i.maxMorphNormals;f++)h.push("morphNormal"+f);for(var y in l)h.push(y);i=h,l={},y=0;for(f=i.length;y<f;y++)g=i[y],l[g]=s.getAttribLocation(c,g);return this.attributes=l,this.id=e++,this.code=n,this.usedTimes=1,this.program=c,this.vertexShader=u,this.fragmentShader=o,this}}(),THREE.WebGLShader=function(){var e=function(e){e=e.split("\n");for(var t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")};return function(t,n,r){return n=t.createShader(n),t.shaderSource(n,r),t.compileShader(n),!1===t.getShaderParameter(n,t.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==t.getShaderInfoLog(n)&&(console.error("THREE.WebGLShader:","gl.getShaderInfoLog()",t.getShaderInfoLog(n)),console.error(e(r))),n}}(),THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.material=this.color=null,this.uvs=[new THREE.Vector2,new THREE.Vector2,new THREE.Vector2],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.rotation=this.z=this.y=this.x=0,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(e,t,n){console.warn("DEPRECATED: GeometryUtils's .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var r;t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},randomPointInTriangle:function(){var e=new THREE.Vector3;return function(t,n,r){var i=new THREE.Vector3,s=THREE.Math.random16(),o=THREE.Math.random16();1<s+o&&(s=1-s,o=1-o);var u=1-s-o;return i.copy(t),i.multiplyScalar(s),e.copy(n),e.multiplyScalar(o),i.add(e),e.copy(r),e.multiplyScalar(u),i.add(e),i}}(),randomPointInFace:function(e,t,n){return THREE.GeometryUtils.randomPointInTriangle(t.vertices[e.a],t.vertices[e.b],t.vertices[e.c])},randomPointsInGeometry:function(e,t){function n(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return f[i]>e?t(n,i-1):f[i]<e?t(i+1,r):i}return t(0,f.length-1)}var r,i,s=e.faces,o=e.vertices,u=s.length,a=0,f=[],l,c,h;for(i=0;i<u;i++)r=s[i],l=o[r.a],c=o[r.b],h=o[r.c],r._area=THREE.GeometryUtils.triangleArea(l,c,h),a+=r._area,f[i]=a;r=[];for(i=0;i<t;i++)o=THREE.Math.random16()*a,o=n(o),r[i]=THREE.GeometryUtils.randomPointInFace(s[o],e,!0);return r},triangleArea:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r,i){return e.subVectors(r,n),t.subVectors(i,n),e.cross(t),.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox,n=new THREE.Vector3;return n.addVectors(t.min,t.max),n.multiplyScalar(-0.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(n.x,n.y,n.z)),e.computeBoundingBox(),n}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,n,r){var i=new THREE.ImageLoader;i.crossOrigin=this.crossOrigin;var s=new THREE.Texture(void 0,t);return t=i.load(e,function(){s.needsUpdate=!0,n&&n(s)},void 0,function(e){r&&r(e)}),s.image=t,s.sourceFile=e,s},loadCompressedTexture:function(e,t,n,r){var i=new THREE.CompressedTexture;i.mapping=t;var s=new XMLHttpRequest;return s.onload=function(){var e=THREE.ImageUtils.parseDDS(s.response,!0);i.format=e.format,i.mipmaps=e.mipmaps,i.image.width=e.width,i.image.height=e.height,i.generateMipmaps=!1,i.needsUpdate=!0,n&&n(i)},s.onerror=r,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),i},loadTextureCube:function(e,t,n,r){var i=[];i.loadCount=0,r=new THREE.ImageLoader,r.crossOrigin=this.crossOrigin;var s=new THREE.Texture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1,t=0;for(var o=e.length;t<o;++t){var u=r.load(e[t],function(){i.loadCount+=1,6===i.loadCount&&(s.needsUpdate=!0,n&&n(s))});i[t]=u}return s},loadCompressedTextureCube:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.CompressedTexture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1,t=function(e,t){return function(){var r=THREE.ImageUtils.parseDDS(e.response,!0);t.format=r.format,t.mipmaps=r.mipmaps,t.width=r.width,t.height=r.height,i.loadCount+=1,6===i.loadCount&&(s.format=r.format,s.needsUpdate=!0,n&&n(s))}};if(e instanceof Array)for(var o=0,u=e.length;o<u;++o){var a={};i[o]=a;var f=new XMLHttpRequest;f.onload=t(f,a),f.onerror=r,a=e[o],f.open("GET",a,!0),f.responseType="arraybuffer",f.send(null)}else f=new XMLHttpRequest,f.onload=function(){var e=THREE.ImageUtils.parseDDS(f.response,!0);if(e.isCubemap){for(var t=e.mipmaps.length/e.mipmapCount,r=0;r<t;r++){i[r]={mipmaps:[]};for(var o=0;o<e.mipmapCount;o++)i[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+o]),i[r].format=e.format,i[r].width=e.width,i[r].height=e.height}s.format=e.format,s.needsUpdate=!0,n&&n(s)}},f.onerror=r,f.open("GET",e,!0),f.responseType="arraybuffer",f.send(null);return s},loadDDSTexture:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.CompressedTexture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1;var o=new XMLHttpRequest;return o.onload=function(){var e=THREE.ImageUtils.parseDDS(o.response,!0);if(e.isCubemap)for(var t=e.mipmaps.length/e.mipmapCount,r=0;r<t;r++){i[r]={mipmaps:[]};for(var u=0;u<e.mipmapCount;u++)i[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+u]),i[r].format=e.format,i[r].width=e.width,i[r].height=e.height}else s.image.width=e.width,s.image.height=e.height,s.mipmaps=e.mipmaps;s.format=e.format,s.needsUpdate=!0,n&&n(s)},o.onerror=r,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),s},parseDDS:function(e,t){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e,t,n,r){var i=n*r*4;e=new Uint8Array(e,t,i);for(var i=new Uint8Array(i),s=t=0,o=0;o<r;o++)for(var u=0;u<n;u++){var a=e[s];s++;var f=e[s];s++;var l=e[s];s++;var c=e[s];s++,i[t]=l,t++,i[t]=f,t++,i[t]=a,t++,i[t]=c,t++}return i}var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=n("DXT1"),o=n("DXT3"),u=n("DXT5"),a=new Int32Array(e,0,31);if(542327876!==a[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),i;if(!a[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),i;var f=a[21],l=!1;switch(f){case s:s=8,i.format=THREE.RGB_S3TC_DXT1_Format;break;case o:s=16,i.format=THREE.RGBA_S3TC_DXT3_Format;break;case u:s=16,i.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==a[22]&&a[23]&16711680&&a[24]&65280&&a[25]&255&&a[26]&4278190080))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(f&255,f>>8&255,f>>16&255,f>>24&255)),i;l=!0,s=64,i.format=THREE.RGBAFormat}i.mipmapCount=1,a[2]&131072&&!1!==t&&(i.mipmapCount=Math.max(1,a[7])),i.isCubemap=a[28]&512?!0:!1,i.width=a[4],i.height=a[3];for(var a=a[1]+4,o=i.width,u=i.height,f=i.isCubemap?6:1,c=0;c<f;c++){for(var h=0;h<i.mipmapCount;h++){if(l)var p=r(e,a,o,u),d=p.length;else d=Math.max(4,o)/4*Math.max(4,u)/4*s,p=new Uint8Array(e,a,d);i.mipmaps.push({data:p,width:o,height:u}),a+=d,o=Math.max(.5*o,1),u=Math.max(.5*u,1)}o=i.width,u=i.height}return i},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=0;c<i;c++){var h=0>c-1?0:c-1,p=c+1>i-1?i-1:c+1,d=0>l-1?0:l-1,v=l+1>r-1?r-1:l+1,m=[],g=[0,0,u[4*(c*r+l)]/255*t];m.push([-1,0,u[4*(c*r+d)]/255*t]),m.push([-1,-1,u[4*(h*r+d)]/255*t]),m.push([0,-1,u[4*(h*r+l)]/255*t]),m.push([1,-1,u[4*(h*r+v)]/255*t]),m.push([1,0,u[4*(c*r+v)]/255*t]),m.push([1,1,u[4*(p*r+v)]/255*t]),m.push([0,1,u[4*(p*r+l)]/255*t]),m.push([-1,1,u[4*(p*r+d)]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]+=h[p][0],m[1]+=h[p][1],m[2]+=h[p][2];m[0]/=h.length,m[1]/=h.length,m[2]/=h.length,g=4*(c*r+l),f[g]=(m[0]+1)/2*255|0,f[g+1]=(m[1]+1)/2*255|0,f[g+2]=255*m[2]|0,f[g+3]=255}return o.putImageData(a,0,0),s},generateDataTexture:function(e,t,n){var r=e*t,i=new Uint8Array(3*r),s=Math.floor(255*n.r),o=Math.floor(255*n.g);n=Math.floor(255*n.b);for(var u=0;u<r;u++)i[3*u]=s,i[3*u+1]=o,i[3*u+2]=n;return e=new THREE.DataTexture(i,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new THREE.Object3D,r=0,i=t.length;r<i;r++)n.add(new THREE.Mesh(e,t[r]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){var t=this.getFace(),n=this.size/t.resolution,r=0,i=String(e).split(""),s=i.length,o=[];for(e=0;e<s;e++){var u=new THREE.Path,u=this.extractGlyphPoints(i[e],t,n,r,u),r=r+u.offset;o.push(u.path)}return{paths:o,offset:r/2}},extractGlyphPoints:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h,p,d,v,m,g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o)for(t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),f=t.length,e=0;e<f;)switch(a=t[e++],a){case"m":a=t[e++]*n+r,l=t[e++]*n,i.moveTo(a,l);break;case"l":a=t[e++]*n+r,l=t[e++]*n,i.lineTo(a,l);break;case"q":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*n,i.quadraticCurveTo(p,d,a,l);if(o=s[s.length-1])for(c=o.x,h=o.y,o=1,u=this.divisions;o<=u;o++){var y=o/u;THREE.Shape.Utils.b2(y,c,p,a),THREE.Shape.Utils.b2(y,h,d,l)}break;case"b":if(a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*-n,v=t[e++]*n+r,m=t[e++]*-n,i.bezierCurveTo(a,l,p,d,v,m),o=s[s.length-1])for(c=o.x,h=o.y,o=1,u=this.divisions;o<=u;o++)y=o/u,THREE.Shape.Utils.b3(y,c,p,v,a),THREE.Shape.Utils.b3(y,h,d,m,l)}return{offset:g.ha*n,path:i}}}},THREE.FontUtils.generateShapes=function(e,t){t=t||{};var n=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",i=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=void 0!==t.size?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=s,n=THREE.FontUtils.drawText(e).paths,r=[],i=0;for(s=n.length;i<s;i++)Array.prototype.push.apply(r,n[i].toShapes());return r},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n};return e.Triangulate=function(e,n){var r=e.length;if(3>r)return null;var i=[],s=[],o=[],u,a,f;if(0<t(e))for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;2<r;){if(0>=l--){console.log("Warning, unable to triangulate polygon!");break}u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var c;e:{var h=c=void 0,p=void 0,d=void 0,v=void 0,m=void 0,g=void 0,y=void 0,w=void 0,h=e[s[u]].x,p=e[s[u]].y,d=e[s[a]].x,v=e[s[a]].y,m=e[s[f]].x,g=e[s[f]].y;if(1e-10>(d-h)*(g-p)-(v-p)*(m-h))c=!1;else{var E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,k=void 0,L=void 0,A=void 0,O=void 0,A=L=k=w=y=void 0,E=m-d,S=g-v,x=h-m,T=p-g,N=d-h,C=v-p;for(c=0;c<r;c++)if(y=e[s[c]].x,w=e[s[c]].y,!(y===h&&w===p||y===d&&w===v||y===m&&w===g)&&(k=y-h,L=w-p,A=y-d,O=w-v,y-=m,w-=g,A=E*O-S*A,k=N*L-C*k,L=x*w-T*y,-1e-10<=A&&-1e-10<=L&&-1e-10<=k)){c=!1;break e}c=!0}}if(c){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;)if(r=Math.floor(o+(u-o)/2),a=n[r]-s,0>a)o=r+1;else{if(!(0<a)){u=r;break}u=r-1}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4;return e+=1e-4,0>t&&(t=0),1<e&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){e=.5*(n-e),r=.5*(r-t);var s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength(),n=this.getCurveLengths();for(e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,r,i,s,o;t=n=Number.NEGATIVE_INFINITY,i=s=Number.POSITIVE_INFINITY;var u,a,f,l,c=e[0]instanceof THREE.Vector3;l=c?new THREE.Vector3:new THREE.Vector2,a=0;for(f=e.length;a<f;a++)u=e[a],u.x>t?t=u.x:u.x<i&&(i=u.x),u.y>n?n=u.y:u.y<s&&(s=u.y),c&&(u.z>r?r=u.z:u.z<o&&(o=u.z)),l.add(u);return e={minX:i,minY:s,maxX:t,maxY:n},c&&(e.maxZ=r,e.minZ=o),e},THREE.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,e[n].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),a=t.getTangent(a),a.set(-a.y,a.x).multiplyScalar(u),s.x=o.x+a.x,s.y=o.y+a.y;return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t));this.curves.push(r),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,s=new THREE.QuadraticBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r));this.curves.push(s),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1].args,u=new THREE.CubicBezierCurve(new THREE.Vector2(u[u.length-2],u[u.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s));this.curves.push(u),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,e),n=new THREE.SplineCurve(n),this.curves.push(n),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;this.absarc(e+o[o.length-2],t+o[o.length-1],n,r,i,s)},THREE.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},THREE.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;this.absellipse(e+u[u.length-2],t+u[u.length-1],n,r,i,s,o)},THREE.Path.prototype.absellipse=function(e,t,n,r,i,s,o){var u=Array.prototype.slice.call(arguments),a=new THREE.EllipseCurve(e,t,n,r,i,s,o);this.curves.push(a),a=a.getPoint(1),u.push(a.x),u.push(a.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:u})},THREE.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var n=[],r=0;r<e;r++)n.push(this.getPoint(r/e));return n},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var n=[],r,i,s,o,u,a,f,l,c,h,p,d,v;r=0;for(i=this.actions.length;r<i;r++)switch(s=this.actions[r],o=s.action,s=s.args,o){case THREE.PathActions.MOVE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:u=s[2],a=s[3],c=s[0],h=s[1],0<n.length?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b2(v,p,c,u),v=THREE.Shape.Utils.b2(v,d,h,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.BEZIER_CURVE_TO:u=s[4],a=s[5],c=s[0],h=s[1],f=s[2],l=s[3],0<n.length?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b3(v,p,c,f,u),v=THREE.Shape.Utils.b3(v,d,h,l,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.CSPLINE_THRU:o=this.actions[r-1].args,v=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=e*s[0].length,v=v.concat(s[0]),v=new THREE.SplineCurve(v);for(s=1;s<=o;s++)n.push(v.getPointAt(s/o));break;case THREE.PathActions.ARC:u=s[0],a=s[1],h=s[2],f=s[3],o=s[4],c=!!s[5],p=o-f,d=2*e;for(s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+h*Math.sin(v),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.ELLIPSE:for(u=s[0],a=s[1],h=s[2],l=s[3],f=s[4],o=s[5],c=!!s[6],p=o-f,d=2*e,s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+l*Math.sin(v),n.push(new THREE.Vector2(o,v))}return r=n[n.length-1],1e-10>Math.abs(r.x-n[0].x)&&1e-10>Math.abs(r.y-n[0].y)&&n.splice(n.length-1,1),t&&n.push(n[0]),n},THREE.Path.prototype.toShapes=function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],s=new THREE.Shape;s.actions=i.actions,s.curves=i.curves,t.push(s)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,s=0;s<n;i=s++){var o=t[i],u=t[s],a=u.x-o.x,f=u.y-o.y;if(1e-10<Math.abs(f)){if(0>f&&(o=t[s],a=-a,u=t[i],f=-f),!(e.y<o.y||e.y>u.y))if(e.y==o.y){if(e.x==o.x)return!0}else{i=f*(e.x-o.x)-a*(e.y-o.y);if(0==i)return!0;0>i||(r=!r)}}else if(e.y==o.y&&(u.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=u.x))return!0}return r}var i=function(e){var t,n,r,i,s=[],o=new THREE.Path;t=0;for(n=e.length;t<n;t++)r=e[t],i=r.args,r=r.action,r==THREE.PathActions.MOVE_TO&&0!=o.actions.length&&(s.push(o),o=new THREE.Path),o[r].apply(o,i);return 0!=o.actions.length&&s.push(o),s}(this.actions);if(0==i.length)return[];if(!0===t)return n(i);var s,o,u,a=[];if(1==i.length)return o=i[0],u=new THREE.Shape,u.actions=o.actions,u.curves=o.curves,a.push(u),a;var f=!THREE.Shape.Utils.isClockWise(i[0].getPoints()),f=e?!f:f;u=[];var l=[],c=[],h=0,p;l[h]=void 0,c[h]=[];var d,v;d=0;for(v=i.length;d<v;d++)o=i[d],p=o.getPoints(),s=THREE.Shape.Utils.isClockWise(p),(s=e?!s:s)?(!f&&l[h]&&h++,l[h]={s:new THREE.Shape,p:p},l[h].s.actions=o.actions,l[h].s.curves=o.curves,f&&h++,c[h]=[]):c[h].push({h:o,p:p[0]});if(!l[0])return n(i);if(1<l.length){d=!1,v=[],o=0;for(i=l.length;o<i;o++)u[o]=[];o=0;for(i=l.length;o<i;o++)for(s=c[o],f=0;f<s.length;f++){h=s[f],p=!0;for(var m=0;m<l.length;m++)r(h.p,l[m].p)&&(o!=m&&v.push({froms:o,tos:m,hole:f}),p?(p=!1,u[m].push(h)):d=!0);p&&u[o].push(h)}0<v.length&&(d||(c=u))}d=0;for(v=l.length;d<v;d++)for(u=l[d].s,a.push(u),o=c[d],i=0,s=o.length;i<s;i++)u.holes.push(o[i].h);return a},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function r(e,t,r,i,s){var o=t.x-e.x,u=t.y-e.y,a=i.x-r.x,f=i.y-r.y,l=e.x-r.x,c=e.y-r.y,h=u*a-o*f,p=u*l-o*c;if(1e-10<Math.abs(h)){if(0<h){if(0>p||p>h)return[];a=f*l-a*c;if(0>a||a>h)return[]}else{if(0<p||p<h)return[];a=f*l-a*c;if(0<a||a<h)return[]}return 0==a?!s||0!=p&&p!=h?[e]:[]:a==h?!s||0!=p&&p!=h?[t]:[]:0==p?[r]:p==h?[i]:(s=a/h,[{x:e.x+s*o,y:e.y+s*u}])}return 0!=p||f*l!=a*c?[]:(u=0==o&&0==u,a=0==a&&0==f,u&&a?e.x!=r.x||e.y!=r.y?[]:[e]:u?n(r,i,e)?[e]:[]:a?n(e,t,r)?[r]:[]:(0!=o?(e.x<t.x?(o=e,a=e.x,u=t,e=t.x):(o=t,a=t.x,u=e,e=e.x),r.x<i.x?(t=r,h=r.x,f=i,r=i.x):(t=i,h=i.x,f=r,r=r.x)):(e.y<t.y?(o=e,a=e.y,u=t,e=t.y):(o=t,a=t.y,u=e,e=e.y),r.y<i.y?(t=r,h=r.y,f=i,r=i.y):(t=i,h=i.y,f=r,r=r.y)),a<=h?e<h?[]:e==h?s?[]:[t]:e<=r?[t,u]:[t,f]:a>r?[]:a==r?s?[]:[o]:e<=r?[o,u]:[o,f]))}function i(e,t,n,r){var i=t.x-e.x,s=t.y-e.y;t=n.x-e.x,n=n.y-e.y;var o=r.x-e.x;return r=r.y-e.y,e=i*n-s*t,i=i*r-s*o,1e-10<Math.abs(e)?(t=o*n-r*t,0<e?0<=i&&0<=t:0<=i||0<=t):0<i}var s,o,u,a,f,l={};u=e.concat(),s=0;for(o=t.length;s<o;s++)Array.prototype.push.apply(u,t[s]);s=0;for(o=u.length;s<o;s++)f=u[s].x+":"+u[s].y,void 0!==l[f]&&console.log("Duplicate point",f),l[f]=s;s=function(e,t){function n(e,t){var n=u.length-1,r=e-1;0>r&&(r=n);var s=e+1;return s>n&&(s=0),n=i(u[e],u[r],u[s],a[t]),n?(n=a.length-1,r=t-1,0>r&&(r=n),s=t+1,s>n&&(s=0),(n=i(a[t],a[r],a[s],u[e]))?!0:!1):!1}function s(e,t){var n,i;for(n=0;n<u.length;n++)if(i=n+1,i%=u.length,i=r(e,t,u[n],u[i],!0),0<i.length)return!0;return!1}function o(e,n){var i,s,o,u;for(i=0;i<f.length;i++)for(s=t[f[i]],o=0;o<s.length;o++)if(u=o+1,u%=s.length,u=r(e,n,s[o],s[u],!0),0<u.length)return!0;return!1}var u=e.concat(),a,f=[],l,c,h,p,v,m=[],g,y,b,w=0;for(l=t.length;w<l;w++)f.push(w);g=0;for(var E=2*f.length;0<f.length;){E--;if(0>E){console.log("Infinite Loop! Holes left:"+f.length+", Probably Hole outside Shape!");break}for(c=g;c<u.length;c++){h=u[c],l=-1;for(w=0;w<f.length;w++)if(p=f[w],v=h.x+":"+h.y+":"+p,void 0===m[v]){a=t[p];for(y=0;y<a.length;y++)if(p=a[y],n(c,y)&&!s(h,p)&&!o(h,p)){l=y,f.splice(w,1),g=u.slice(0,c+1),p=u.slice(c),y=a.slice(l),b=a.slice(0,l+1),u=g.concat(y).concat(b).concat(p),g=c;break}if(0<=l)break;m[v]=!0}if(0<=l)break}}return u}(e,t);var c=THREE.FontUtils.Triangulate(s,!1);s=0;for(o=c.length;s<o;s++)for(a=c[s],u=0;3>u;u++)f=a[u].x+":"+a[u].y,f=l[f],void 0!==f&&(a[u]=f);return c.concat()},isClockWise:function(e){return 0>THREE.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2,n=[],r=this.points,i;return i=(r.length-1)*e,e=Math.floor(i),i-=e,n[0]=0==e?e:e-1,n[1]=e,n[2]=e>r.length-2?r.length-1:e+1,n[3]=e>r.length-3?r.length-1:e+2,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t},THREE.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t;return t=this.aEndAngle-this.aStartAngle,0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t),t=this.aY+this.yRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.ArcCurve=function(e,t,n,r,i,s){THREE.EllipseCurve.call(this,e,t,n,n,r,i,s)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,n,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;e*=r.length-1,i=Math.floor(e),e-=i,n[0]=0==i?i:i-1,n[1]=i,n[2]=i>r.length-2?r.length-1:i+1,n[3]=i>r.length-3?r.length-1:i+2,i=r[n[0]];var s=r[n[1]],o=r[n[2]],n=r[n[3]];return t.x=THREE.Curve.Utils.interpolate(i.x,s.x,o.x,n.x,e),t.y=THREE.Curve.Utils.interpolate(i.y,s.y,o.y,n.y,e),t.z=THREE.Curve.Utils.interpolate(i.z,s.z,o.z,n.z,e),t}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;return i=(r.length-0)*e,e=Math.floor(i),i-=e,e+=0<e?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length,n[0]=(e-1)%r.length,n[1]=e%r.length,n[2]=(e+1)%r.length,n[3]=(e+2)%r.length,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,i),t}),THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},add:function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e;if(!0!==e.initialized){for(var n=0;n<e.hierarchy.length;n++){for(var r=0;r<e.hierarchy[n].keys.length;r++)if(0>e.hierarchy[n].keys[r].time&&(e.hierarchy[n].keys[r].time=0),void 0!==e.hierarchy[n].keys[r].rot&&!(e.hierarchy[n].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[n].keys[r].rot;e.hierarchy[n].keys[r].rot=(new THREE.Quaternion).fromArray(i)}if(e.hierarchy[n].keys.length&&void 0!==e.hierarchy[n].keys[0].morphTargets){i={};for(r=0;r<e.hierarchy[n].keys.length;r++)for(var s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++){var o=e.hierarchy[n].keys[r].morphTargets[s];i[o]=-1}e.hierarchy[n].usedMorphTargets=i;for(r=0;r<e.hierarchy[n].keys.length;r++){var u={};for(o in i){for(s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++)if(e.hierarchy[n].keys[r].morphTargets[s]===o){u[o]=e.hierarchy[n].keys[r].morphTargetsInfluences[s];break}s===e.hierarchy[n].keys[r].morphTargets.length&&(u[o]=0)}e.hierarchy[n].keys[r].morphTargetsInfluences=u}}for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].time===e.hierarchy[n].keys[r-1].time&&(e.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].index=r}e.initialized=!0}},remove:function(e){void 0===t[e]&&console.log("THREE.AnimationHandler.add: Warning! "+e+" doesn't exists in library. Doing nothing."),t[e]=void 0},get:function(e){if("string"==typeof e)return t[e]?t[e]:null},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.skeleton.bones.length;n++)t.push(e.skeleton.bones[n]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.weight=0,this.interpolationType=THREE.AnimationHandler.LINEAR},THREE.Animation.prototype.keyTypes=["pos","rot","scl"],THREE.Animation.prototype.play=function(e,t){this.currentTime=void 0!==e?e:0,this.weight=void 0!==t?t:1,this.isPlaying=!0,this.isPaused=!1,this.reset(),THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={}),void 0===n.animationCache[this.data.name]&&(n.animationCache[this.data.name]={},n.animationCache[this.data.name].prevKey={pos:0,rot:0,scl:0},n.animationCache[this.data.name].nextKey={pos:0,rot:0,scl:0},n.animationCache[this.data.name].originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix);for(var n=n.animationCache[this.data.name],r=0;3>r;r++){for(var i=this.keyTypes[r],s=this.data.hierarchy[e].keys[0],o=this.getNextKeyWith(i,e,1);o.time<this.currentTime&&o.index>s.index;)s=o,o=this.getNextKeyWith(i,e,o.index+1);n.prevKey[i]=s,n.nextKey[i]=o}}},THREE.Animation.prototype.update=function(){var e=[],t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Quaternion,i=function(e,t){var n=[],r=[],i,o,u,a,l,c;return i=(e.length-1)*t,o=Math.floor(i),i-=o,n[0]=0===o?o:o-1,n[1]=o,n[2]=o>e.length-2?o:o+1,n[3]=o>e.length-3?o:o+2,o=e[n[0]],a=e[n[1]],l=e[n[2]],c=e[n[3]],n=i*i,u=i*n,r[0]=s(o[0],a[0],l[0],c[0],i,n,u),r[1]=s(o[1],a[1],l[1],c[1],i,n,u),r[2]=s(o[2],a[2],l[2],c[2],i,n,u),r},s=function(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t};return function(s){if(!1!==this.isPlaying&&(this.currentTime+=s*this.timeScale,0!==this.weight)){var o;s=this.data.length;if(!0===this.loop&&this.currentTime>s)this.currentTime%=s,this.reset();else if(!1===this.loop&&this.currentTime>s){this.stop();return}s=0;for(var u=this.hierarchy.length;s<u;s++)for(var f=this.hierarchy[s],l=f.animationCache[this.data.name],h=0;3>h;h++){o=this.keyTypes[h];var p=l.prevKey[o],v=l.nextKey[o];if(v.time<=this.currentTime){p=this.data.hierarchy[s].keys[0];for(v=this.getNextKeyWith(o,s,1);v.time<this.currentTime&&v.index>p.index;)p=v,v=this.getNextKeyWith(o,s,v.index+1);l.prevKey[o]=p,l.nextKey[o]=v}f.matrixAutoUpdate=!0,f.matrixWorldNeedsUpdate=!0;var m=(this.currentTime-p.time)/(v.time-p.time),g=p[o],y=v[o];0>m&&(m=0),1<m&&(m=1);if("pos"===o){if(o=f.position,this.interpolationType===THREE.AnimationHandler.LINEAR)n.x=g[0]+(y[0]-g[0])*m,n.y=g[1]+(y[1]-g[1])*m,n.z=g[2]+(y[2]-g[2])*m,f instanceof THREE.Bone&&(p=this.weight/(this.weight+f.accumulatedPosWeight),o.lerp(n,p),f.accumulatedPosWeight+=this.weight);else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)e[0]=this.getPrevKeyWith("pos",s,p.index-1).pos,e[1]=g,e[2]=y,e[3]=this.getNextKeyWith("pos",s,v.index+1).pos,m=.33*m+.33,v=i(e,m),f instanceof THREE.Bone?(p=this.weight/(this.weight+f.accumulatedPosWeight),f.accumulatedPosWeight+=this.weight):p=1,o.x+=(v[0]-o.x)*p,o.y+=(v[1]-o.y)*p,o.z+=(v[2]-o.z)*p,this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(m=i(e,1.01*m),t.set(m[0],m[1],m[2]),t.sub(o),t.y=0,t.normalize(),o=Math.atan2(t.x,t.z),f.rotation.set(0,o,0))}else"rot"===o?(THREE.Quaternion.slerp(g,y,r,m),f instanceof THREE.Bone?0===f.accumulatedRotWeight?(f.quaternion.copy(r),f.accumulatedRotWeight=this.weight):(p=this.weight/(this.weight+f.accumulatedRotWeight),THREE.Quaternion.slerp(f.quaternion,r,f.quaternion,p),f.accumulatedRotWeight+=this.weight):f.quaternion.copy(r)):"scl"===o&&(o=f.scale,n.x=g[0]+(y[0]-g[0])*m,n.y=g[1]+(y[1]-g[1])*m,n.z=g[2]+(y[2]-g[2])*m,f instanceof THREE.Bone&&(p=this.weight/(this.weight+f.accumulatedSclWeight),o.lerp(n,p),f.accumulatedSclWeight+=this.weight))}return!0}}}(),THREE.Animation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<n?n:0:0<=n?n:n+r.length;0<=n;n--)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[r.length-1]},THREE.KeyFrameAnimation=function(e,t){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0;for(var n=0,r=this.hierarchy.length;n<r;n++){var i=this.data.hierarchy[n].sids,s=this.hierarchy[n];if(this.data.hierarchy[n].keys.length&&i){for(var o=0;o<i.length;o++){var u=i[o],a=this.getNextKeyWith(u,n,0);a&&a.apply(u)}s.matrixAutoUpdate=!1,this.data.hierarchy[n].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e){this.currentTime=void 0!==e?e:0;if(!1===this.isPlaying){this.isPlaying=!0;var t=this.hierarchy.length,n,r;for(e=0;e<t;e++)n=this.hierarchy[e],r=this.data.hierarchy[e],void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix),n=this.data.hierarchy[e].keys,n.length&&(r.animationCache.prevKey=n[0],r.animationCache.nextKey=n[1],this.startTime=Math.min(n[0].time,this.startTime),this.endTime=Math.max(n[n.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete n.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale,e=this.data.length,!0===this.loop&&this.currentTime>e&&(this.currentTime%=e),this.currentTime=Math.min(this.currentTime,e),e=0;for(var t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e],r=this.data.hierarchy[e],i=r.keys,r=r.animationCache;if(i.length){var s=r.prevKey,o=r.nextKey;if(o.time<=this.currentTime){for(;o.time<this.currentTime&&o.index>s.index;)s=o,o=i[s.index+1];r.prevKey=s,r.nextKey=o}o.time>=this.currentTime?s.interpolate(o,this.currentTime):s.interpolate(o,o.time),this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n=0<=n?n:n+t.length;0<=n;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},THREE.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var e=0,t=0;return function(n){if(!1!==this.isPlaying){this.currentTime+=n,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration),n=this.duration/this.frames;var r=Math.floor(this.currentTime/n);r!=t&&(this.mesh.morphTargetInfluences[e]=0,this.mesh.morphTargetInfluences[t]=1,this.mesh.morphTargetInfluences[r]=0,e=t,t=r),this.mesh.morphTargetInfluences[r]=this.currentTime%n/n,this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[r]}}}()},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var i=new THREE.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(-1,0,0)),this.add(i);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new THREE.Vector3(0,-1,0)),this.add(o);var u=new THREE.PerspectiveCamera(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new THREE.Vector3(0,0,1)),this.add(u);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(0,0,-1)),this.add(a),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,l=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,s,n),n.activeCubeFace=3,e.render(t,o,n),n.activeCubeFace=4,e.render(t,u,n),n.generateMipmaps=l,n.activeCubeFace=5,e.render(t,a,n)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,n,r,i,s,o){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,s,o),this.cameraP=new THREE.PerspectiveCamera(n,e/t,r,i),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.BoxGeometry=function(e,t,n,r,i,s){function o(e,t,n,r,i,s,o,a){var f,l=u.widthSegments,c=u.heightSegments,p=i/2,d=s/2,v=u.vertices.length;if("x"===e&&"y"===t||"y"===e&&"x"===t)f="z";else if("x"===e&&"z"===t||"z"===e&&"x"===t)f="y",c=u.depthSegments;else if("z"===e&&"y"===t||"y"===e&&"z"===t)f="x",l=u.depthSegments;var m=l+1,g=c+1,y=i/l,b=s/c,w=new THREE.Vector3;w[f]=0<o?1:-1;for(i=0;i<g;i++)for(s=0;s<m;s++){var E=new THREE.Vector3;E[e]=(s*y-p)*n,E[t]=(i*b-d)*r,E[f]=o,u.vertices.push(E)}for(i=0;i<c;i++)for(s=0;s<l;s++)d=s+m*i,e=s+m*(i+1),t=s+1+m*(i+1),n=s+1+m*i,r=new THREE.Vector2(s/l,1-i/c),o=new THREE.Vector2(s/l,1-(i+1)/c),f=new THREE.Vector2((s+1)/l,1-(i+1)/c),p=new THREE.Vector2((s+1)/l,1-i/c),d=new THREE.Face3(d+v,e+v,n+v),d.normal.copy(w),d.vertexNormals.push(w.clone(),w.clone(),w.clone()),d.materialIndex=a,u.faces.push(d),u.faceVertexUvs[0].push([r,o,p]),d=new THREE.Face3(e+v,t+v,n+v),d.normal.copy(w),d.vertexNormals.push(w.clone(),w.clone(),w.clone()),d.materialIndex=a,u.faces.push(d),u.faceVertexUvs[0].push([o.clone(),f,p.clone()])}THREE.Geometry.call(this),this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:s},this.widthSegments=r||1,this.heightSegments=i||1,this.depthSegments=s||1;var u=this;r=e/2,i=t/2,s=n/2,o("z","y",-1,-1,n,t,r,0),o("z","y",1,-1,n,t,-r,1),o("x","z",1,1,e,n,i,2),o("x","z",1,-1,e,n,-i,3),o("x","y",1,-1,e,t,s,4),o("x","y",-1,-1,e,t,-s,5),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},e=e||50,t=void 0!==t?Math.max(3,t):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;var i,s=[];i=new THREE.Vector3;var o=new THREE.Vector2(.5,.5);this.vertices.push(i),s.push(o);for(i=0;i<=t;i++){var u=new THREE.Vector3,a=n+i/t*r;u.x=e*Math.cos(a),u.y=e*Math.sin(a),this.vertices.push(u),s.push(new THREE.Vector2((u.x/e+1)/2,(u.y/e+1)/2))}n=new THREE.Vector3(0,0,1);for(i=1;i<=t;i++)this.faces.push(new THREE.Face3(i,i+1,0,[n.clone(),n.clone(),n.clone()])),this.faceVertexUvs[0].push([s[i].clone(),s[i+1].clone(),o.clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,n,r,i,s){return console.warn("DEPRECATED: THREE.CubeGeometry is deprecated. Use THREE.BoxGeometry instead."),new THREE.BoxGeometry(e,t,n,r,i,s)},THREE.CylinderGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:s},e=void 0!==e?e:20,t=void 0!==t?t:20,n=void 0!==n?n:100,r=r||8,i=i||1,s=void 0!==s?s:!1;var o=n/2,u,a,f=[],l=[];for(a=0;a<=i;a++){var c=[],h=[],p=a/i,d=p*(t-e)+e;for(u=0;u<=r;u++){var v=u/r,m=new THREE.Vector3;m.x=d*Math.sin(v*Math.PI*2),m.y=-p*n+o,m.z=d*Math.cos(v*Math.PI*2),this.vertices.push(m),c.push(this.vertices.length-1),h.push(new THREE.Vector2(v,1-p))}f.push(c),l.push(h)}n=(t-e)/n;for(u=0;u<r;u++)for(0!==e?(c=this.vertices[f[0][u]].clone(),h=this.vertices[f[0][u+1]].clone()):(c=this.vertices[f[1][u]].clone(),h=this.vertices[f[1][u+1]].clone()),c.setY(Math.sqrt(c.x*c.x+c.z*c.z)*n).normalize(),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*n).normalize(),a=0;a<i;a++){var p=f[a][u],d=f[a+1][u],v=f[a+1][u+1],m=f[a][u+1],g=c.clone(),y=c.clone(),b=h.clone(),w=h.clone(),E=l[a][u].clone(),S=l[a+1][u].clone(),x=l[a+1][u+1].clone(),T=l[a][u+1].clone();this.faces.push(new THREE.Face3(p,d,m,[g,y,w])),this.faceVertexUvs[0].push([E,S,T]),this.faces.push(new THREE.Face3(d,v,m,[y.clone(),b,w.clone()])),this.faceVertexUvs[0].push([S.clone(),x,T.clone()])}if(!1===s&&0<e)for(this.vertices.push(new THREE.Vector3(0,o,0)),u=0;u<r;u++)p=f[0][u],d=f[0][u+1],v=this.vertices.length-1,g=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),b=new THREE.Vector3(0,1,0),E=l[0][u].clone(),S=l[0][u+1].clone(),x=new THREE.Vector2(S.x,0),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x]);if(!1===s&&0<t)for(this.vertices.push(new THREE.Vector3(0,-o,0)),u=0;u<r;u++)p=f[a][u+1],d=f[a][u],v=this.vertices.length-1,g=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),b=new THREE.Vector3(0,-1,0),E=l[a][u+1].clone(),S=l[a][u].clone(),x=new THREE.Vector2(S.x,1),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x]);this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){"undefined"!=typeof e&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function r(e,t,n){var r=THREE.Math.sign,i=1,i=e.x-t.x,s=e.y-t.y,o=n.x-e.x,u=n.y-e.y,a=i*i+s*s;if(1e-10<Math.abs(i*u-s*o)){var f=Math.sqrt(a),r=Math.sqrt(o*o+u*u),a=t.x-s/f;t=t.y+i/f,o=((n.x-u/r-a)*u-(n.y+o/r-t)*o)/(i*u-s*o),n=a+i*o-e.x,e=t+s*o-e.y,i=n*n+e*e;if(2>=i)return new THREE.Vector2(n,e);i=Math.sqrt(i/2)}else e=!1,1e-10<i?1e-10<o&&(e=!0):-1e-10>i?-1e-10>o&&(e=!0):r(s)==r(u)&&(e=!0),e?(n=-s,e=i,i=Math.sqrt(a)):(n=i,e=s,i=Math.sqrt(a/2));return new THREE.Vector2(n/i,e/i)}function i(n,r){var i,s;for(q=n.length;0<=--q;){i=q,s=q-1,0>s&&(s=n.length-1);for(var o=0,u=p+2*l,o=0;o<u;o++){var a=j*o,f=j*(o+1),c=r+i+a,a=r+s+a,h=r+s+f,f=r+i+f,d=n,v=o,m=u,g=i,w=s,c=c+L,a=a+L,h=h+L,f=f+L;k.faces.push(new THREE.Face3(c,a,f,null,null,y)),k.faces.push(new THREE.Face3(a,h,f,null,null,y)),c=b.generateSideWallUV(k,e,d,t,c,a,h,f,v,m,g,w),k.faceVertexUvs[0].push([c[0],c[1],c[3]]),k.faceVertexUvs[0].push([c[1],c[2],c[3]])}}}function s(e,t,n){k.vertices.push(new THREE.Vector3(e,t,n))}function o(n,r,i,s){n+=L,r+=L,i+=L,k.faces.push(new THREE.Face3(n,r,i,null,null,g)),n=s?b.generateBottomUV(k,e,t,n,r,i):b.generateTopUV(k,e,t,n,r,i),k.faceVertexUvs[0].push(n)}var u=void 0!==t.amount?t.amount:100,a=void 0!==t.bevelThickness?t.bevelThickness:6,f=void 0!==t.bevelSize?t.bevelSize:a-2,l=void 0!==t.bevelSegments?t.bevelSegments:3,c=void 0!==t.bevelEnabled?t.bevelEnabled:!0,h=void 0!==t.curveSegments?t.curveSegments:12,p=void 0!==t.steps?t.steps:1,d=t.extrudePath,v,m=!1,g=t.material,y=t.extrudeMaterial,b=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,w,E,S,x;d&&(v=d.getSpacedPoints(p),m=!0,c=!1,w=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(d,p,!1),E=new THREE.Vector3,S=new THREE.Vector3,x=new THREE.Vector3),c||(f=a=l=0);var T,N,C,k=this,L=this.vertices.length,d=e.extractPoints(h),h=d.shape,A=d.holes;if(d=!THREE.Shape.Utils.isClockWise(h)){h=h.reverse(),N=0;for(C=A.length;N<C;N++)T=A[N],THREE.Shape.Utils.isClockWise(T)&&(A[N]=T.reverse());d=!1}var O=THREE.Shape.Utils.triangulateShape(h,A),M=h;N=0;for(C=A.length;N<C;N++)T=A[N],h=h.concat(T);var _,D,P,H,B,j=h.length,F,I=O.length,d=[],q=0;P=M.length,_=P-1;for(D=q+1;q<P;q++,_++,D++)_===P&&(_=0),D===P&&(D=0),d[q]=r(M[q],M[_],M[D]);var R=[],U,z=d.concat();N=0;for(C=A.length;N<C;N++){T=A[N],U=[],q=0,P=T.length,_=P-1;for(D=q+1;q<P;q++,_++,D++)_===P&&(_=0),D===P&&(D=0),U[q]=r(T[q],T[_],T[D]);R.push(U),z=z.concat(U)}for(_=0;_<l;_++){P=_/l,H=a*(1-P),D=f*Math.sin(P*Math.PI/2),q=0;for(P=M.length;q<P;q++)B=n(M[q],d[q],D),s(B.x,B.y,-H);N=0;for(C=A.length;N<C;N++)for(T=A[N],U=R[N],q=0,P=T.length;q<P;q++)B=n(T[q],U[q],D),s(B.x,B.y,-H)}D=f;for(q=0;q<j;q++)B=c?n(h[q],z[q],D):h[q],m?(S.copy(w.normals[0]).multiplyScalar(B.x),E.copy(w.binormals[0]).multiplyScalar(B.y),x.copy(v[0]).add(S).add(E),s(x.x,x.y,x.z)):s(B.x,B.y,0);for(P=1;P<=p;P++)for(q=0;q<j;q++)B=c?n(h[q],z[q],D):h[q],m?(S.copy(w.normals[P]).multiplyScalar(B.x),E.copy(w.binormals[P]).multiplyScalar(B.y),x.copy(v[P]).add(S).add(E),s(x.x,x.y,x.z)):s(B.x,B.y,u/p*P);for(_=l-1;0<=_;_--){P=_/l,H=a*(1-P),D=f*Math.sin(P*Math.PI/2),q=0;for(P=M.length;q<P;q++)B=n(M[q],d[q],D),s(B.x,B.y,u+H);N=0;for(C=A.length;N<C;N++)for(T=A[N],U=R[N],q=0,P=T.length;q<P;q++)B=n(T[q],U[q],D),m?s(B.x,B.y+v[p-1].y,v[p-1].x+H):s(B.x,B.y,u+H)}(function(){if(c){var e;e=0*j;for(q=0;q<I;q++)F=O[q],o(F[2]+e,F[1]+e,F[0]+e,!0);e=p+2*l,e*=j;for(q=0;q<I;q++)F=O[q],o(F[0]+e,F[1]+e,F[2]+e,!1)}else{for(q=0;q<I;q++)F=O[q],o(F[2],F[1],F[0],!0);for(q=0;q<I;q++)F=O[q],o(F[0]+j*p,F[1]+j*p,F[2]+j*p,!1)}})(),function(){var e=0;i(M,e),e+=M.length,N=0;for(C=A.length;N<C;N++)T=A[N],i(T,e),e+=T.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r,i,s){return t=e.vertices[i].x,i=e.vertices[i].y,n=e.vertices[s].x,s=e.vertices[s].y,[new THREE.Vector2(e.vertices[r].x,e.vertices[r].y),new THREE.Vector2(t,i),new THREE.Vector2(n,s)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(e,t,n,r,i,s,o,u,a,f,l,c){t=e.vertices[i].x,n=e.vertices[i].y,i=e.vertices[i].z,r=e.vertices[s].x,a=e.vertices[s].y,s=e.vertices[s].z,f=e.vertices[o].x,l=e.vertices[o].y,o=e.vertices[o].z,c=e.vertices[u].x;var h=e.vertices[u].y;return e=e.vertices[u].z,.01>Math.abs(n-a)?[new THREE.Vector2(t,1-i),new THREE.Vector2(r,1-s),new THREE.Vector2(f,1-o),new THREE.Vector2(c,1-e)]:[new THREE.Vector2(n,1-i),new THREE.Vector2(a,1-s),new THREE.Vector2(l,1-o),new THREE.Vector2(h,1-e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),0==e instanceof Array&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var n=t.material,r=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,i,s,o,u=this.vertices.length;i=e.extractPoints(void 0!==t.curveSegments?t.curveSegments:12);var a=i.shape,f=i.holes;if(!THREE.Shape.Utils.isClockWise(a))for(a=a.reverse(),i=0,s=f.length;i<s;i++)o=f[i],THREE.Shape.Utils.isClockWise(o)&&(f[i]=o.reverse());var l=THREE.Shape.Utils.triangulateShape(a,f);i=0;for(s=f.length;i<s;i++)o=f[i],a=a.concat(o);f=a.length,s=l.length;for(i=0;i<f;i++)o=a[i],this.vertices.push(new THREE.Vector3(o.x,o.y,0));for(i=0;i<s;i++)f=l[i],a=f[0]+u,o=f[1]+u,f=f[2]+u,this.faces.push(new THREE.Face3(a,o,f,null,null,n)),this.faceVertexUvs[0].push(r.generateBottomUV(this,e,t,a,o,f))},THREE.LatheGeometry=function(e,t,n,r){THREE.Geometry.call(this),t=t||12,n=n||0,r=r||2*Math.PI;for(var i=1/(e.length-1),s=1/t,o=0,u=t;o<=u;o++)for(var a=n+o*s*r,f=Math.cos(a),l=Math.sin(a),a=0,c=e.length;a<c;a++){var h=e[a],p=new THREE.Vector3;p.x=f*h.x-l*h.y,p.y=l*h.x+f*h.y,p.z=h.z,this.vertices.push(p)}n=e.length,o=0;for(u=t;o<u;o++)for(a=0,c=e.length-1;a<c;a++){t=l=a+n*o,r=l+n;var f=l+1+n,l=l+1,h=o*s,p=a*i,d=h+s,v=p+i;this.faces.push(new THREE.Face3(t,r,l)),this.faceVertexUvs[0].push([new THREE.Vector2(h,p),new THREE.Vector2(d,p),new THREE.Vector2(h,v)]),this.faces.push(new THREE.Face3(r,f,l)),this.faceVertexUvs[0].push([new THREE.Vector2(d,p),new THREE.Vector2(d,v),new THREE.Vector2(h,v)])}this.mergeVertices(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};var i=e/2,s=t/2;n=n||1,r=r||1;var o=n+1,u=r+1,a=e/n,f=t/r,l=new THREE.Vector3(0,0,1);for(e=0;e<u;e++){var c=e*f-s;for(t=0;t<o;t++)this.vertices.push(new THREE.Vector3(t*a-i,-c,0))}for(e=0;e<r;e++)for(t=0;t<n;t++){var h=t+o*e,i=t+o*(e+1),s=t+1+o*(e+1),u=t+1+o*e,a=new THREE.Vector2(t/n,1-e/r),f=new THREE.Vector2(t/n,1-(e+1)/r),c=new THREE.Vector2((t+1)/n,1-(e+1)/r),p=new THREE.Vector2((t+1)/n,1-e/r),h=new THREE.Face3(h,i,u);h.normal.copy(l),h.vertexNormals.push(l.clone(),l.clone(),l.clone()),this.faces.push(h),this.faceVertexUvs[0].push([a,f,p]),h=new THREE.Face3(i,s,u),h.normal.copy(l),h.vertexNormals.push(l.clone(),l.clone(),l.clone()),this.faces.push(h),this.faceVertexUvs[0].push([f.clone(),c,p.clone()])}},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),e=e||0,t=t||50,i=void 0!==i?i:0,s=void 0!==s?s:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(3,r):8;var o,u=[],a=e,f=(t-e)/r;for(e=0;e<=r;e++){for(o=0;o<=n;o++){var l=new THREE.Vector3,c=i+o/n*s;l.x=a*Math.cos(c),l.y=a*Math.sin(c),this.vertices.push(l),u.push(new THREE.Vector2((l.x/t+1)/2,(l.y/t+1)/2))}a+=f}t=new THREE.Vector3(0,0,1);for(e=0;e<r;e++)for(i=e*n,o=0;o<=n;o++)c=o+i,s=c+e,f=c+n+e,l=c+n+1+e,this.faces.push(new THREE.Face3(s,f,l,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([u[s].clone(),u[f].clone(),u[l].clone()]),s=c+e,f=c+n+1+e,l=c+1+e,this.faces.push(new THREE.Face3(s,f,l,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([u[s].clone(),u[f].clone(),u[l].clone()]);this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this),this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:s,thetaLength:o},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,i=void 0!==i?i:2*Math.PI,s=void 0!==s?s:0,o=void 0!==o?o:Math.PI;var u,a,f=[],l=[];for(a=0;a<=n;a++){var c=[],h=[];for(u=0;u<=t;u++){var p=u/t,d=a/n,v=new THREE.Vector3;v.x=-e*Math.cos(r+p*i)*Math.sin(s+d*o),v.y=e*Math.cos(s+d*o),v.z=e*Math.sin(r+p*i)*Math.sin(s+d*o),this.vertices.push(v),c.push(this.vertices.length-1),h.push(new THREE.Vector2(p,1-d))}f.push(c),l.push(h)}for(a=0;a<n;a++)for(u=0;u<t;u++){r=f[a][u+1],i=f[a][u],s=f[a+1][u],o=f[a+1][u+1];var c=this.vertices[r].clone().normalize(),h=this.vertices[i].clone().normalize(),p=this.vertices[s].clone().normalize(),d=this.vertices[o].clone().normalize(),v=l[a][u+1].clone(),m=l[a][u].clone(),g=l[a+1][u].clone(),y=l[a+1][u+1].clone();Math.abs(this.vertices[r].y)===e?(v.x=(v.x+m.x)/2,this.faces.push(new THREE.Face3(r,s,o,[c,p,d])),this.faceVertexUvs[0].push([v,g,y])):Math.abs(this.vertices[s].y)===e?(g.x=(g.x+y.x)/2,this.faces.push(new THREE.Face3(r,i,s,[c,h,p])),this.faceVertexUvs[0].push([v,m,g])):(this.faces.push(new THREE.Face3(r,i,o,[c,h,d])),this.faceVertexUvs[0].push([v,m,y]),this.faces.push(new THREE.Face3(i,s,o,[h.clone(),p,d.clone()])),this.faceVertexUvs[0].push([m.clone(),g,y.clone()]))}this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){t=t||{};var n=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},e=e||100,t=t||40,n=n||8,r=r||6,i=i||2*Math.PI;for(var s=new THREE.Vector3,o=[],u=[],a=0;a<=n;a++)for(var f=0;f<=r;f++){var l=f/r*i,c=a/n*Math.PI*2;s.x=e*Math.cos(l),s.y=e*Math.sin(l);var h=new THREE.Vector3;h.x=(e+t*Math.cos(c))*Math.cos(l),h.y=(e+t*Math.cos(c))*Math.sin(l),h.z=t*Math.sin(c),this.vertices.push(h),o.push(new THREE.Vector2(f/r,a/n)),u.push(h.clone().sub(s).normalize())}for(a=1;a<=n;a++)for(f=1;f<=r;f++)e=(r+1)*a+f-1,t=(r+1)*(a-1)+f-1,i=(r+1)*(a-1)+f,s=(r+1)*a+f,l=new THREE.Face3(e,t,s,[u[e].clone(),u[t].clone(),u[s].clone()]),this.faces.push(l),this.faceVertexUvs[0].push([o[e].clone(),o[t].clone(),o[s].clone()]),l=new THREE.Face3(t,i,s,[u[t].clone(),u[i].clone(),u[s].clone()]),this.faces.push(l),this.faceVertexUvs[0].push([o[t].clone(),o[i].clone(),o[s].clone()]);this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function u(e,t,n,r,i){var s=Math.cos(e),o=Math.sin(e);return e*=t/n,t=Math.cos(e),s*=r*(2+t)*.5,o=r*(2+t)*o*.5,r=i*r*Math.sin(e)*.5,new THREE.Vector3(s,o,r)}THREE.Geometry.call(this),this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,p:i,q:s,heightScale:o},e=e||100,t=t||40,n=n||64,r=r||8,i=i||2,s=s||3,o=o||1;for(var a=Array(n),f=new THREE.Vector3,l=new THREE.Vector3,c=new THREE.Vector3,h=0;h<n;++h){a[h]=Array(r);var p=h/n*2*i*Math.PI,d=u(p,s,i,e,o),p=u(p+.01,s,i,e,o);f.subVectors(p,d),l.addVectors(p,d),c.crossVectors(f,l),l.crossVectors(c,f),c.normalize(),l.normalize();for(p=0;p<r;++p){var v=p/r*2*Math.PI,m=-t*Math.cos(v),v=t*Math.sin(v),g=new THREE.Vector3;g.x=d.x+m*l.x+v*c.x,g.y=d.y+m*l.y+v*c.y,g.z=d.z+m*l.z+v*c.z,a[h][p]=this.vertices.push(g)-1}}for(h=0;h<n;++h)for(p=0;p<r;++p)i=(h+1)%n,s=(p+1)%r,e=a[h][p],t=a[i][p],i=a[i][s],s=a[h][s],o=new THREE.Vector2(h/n,p/r),f=new THREE.Vector2((h+1)/n,p/r),l=new THREE.Vector2((h+1)/n,(p+1)/r),c=new THREE.Vector2(h/n,(p+1)/r),this.faces.push(new THREE.Face3(e,t,s)),this.faceVertexUvs[0].push([o,f,c]),this.faces.push(new THREE.Face3(t,i,s)),this.faceVertexUvs[0].push([f.clone(),l,c.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.parameters={path:e,segments:t,radius:n,radialSegments:r,closed:i},t=t||64,n=n||1,r=r||8,i=i||!1;var s=[],o,u,a=t+1,f,l,c,h,p=new THREE.Vector3,d,v,m;d=new THREE.TubeGeometry.FrenetFrames(e,t,i),v=d.normals,m=d.binormals,this.tangents=d.tangents,this.normals=v,this.binormals=m;for(d=0;d<a;d++)for(s[d]=[],f=d/(a-1),h=e.getPointAt(f),o=v[d],u=m[d],f=0;f<r;f++)l=f/r*2*Math.PI,c=-n*Math.cos(l),l=n*Math.sin(l),p.copy(h),p.x+=c*o.x+l*u.x,p.y+=c*o.y+l*u.y,p.z+=c*o.z+l*u.z,s[d][f]=this.vertices.push(new THREE.Vector3(p.x,p.y,p.z))-1;for(d=0;d<t;d++)for(f=0;f<r;f++)a=i?(d+1)%t:d+1,p=(f+1)%r,e=s[d][f],n=s[a][f],a=s[a][p],p=s[d][p],v=new THREE.Vector2(d/t,f/r),m=new THREE.Vector2((d+1)/t,f/r),o=new THREE.Vector2((d+1)/t,(f+1)/r),u=new THREE.Vector2(d/t,(f+1)/r),this.faces.push(new THREE.Face3(e,n,p)),this.faceVertexUvs[0].push([v,m,u]),this.faces.push(new THREE.Face3(n,a,p)),this.faceVertexUvs[0].push([m.clone(),o,u.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,n){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var i=[],s=[],o=[],u=new THREE.Vector3,a=new THREE.Matrix4;t+=1;var f,l,c;this.tangents=i,this.normals=s,this.binormals=o;for(f=0;f<t;f++)l=f/(t-1),i[f]=e.getTangentAt(l),i[f].normalize();s[0]=new THREE.Vector3,o[0]=new THREE.Vector3,e=Number.MAX_VALUE,f=Math.abs(i[0].x),l=Math.abs(i[0].y),c=Math.abs(i[0].z),f<=e&&(e=f,r.set(1,0,0)),l<=e&&(e=l,r.set(0,1,0)),c<=e&&r.set(0,0,1),u.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],u),o[0].crossVectors(i[0],s[0]);for(f=1;f<t;f++)s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),u.crossVectors(i[f-1],i[f]),1e-4<u.length()&&(u.normalize(),r=Math.acos(THREE.Math.clamp(i[f-1].dot(i[f]),-1,1)),s[f].applyMatrix4(a.makeRotationAxis(u,r))),o[f].crossVectors(i[f],s[f]);if(n)for(r=Math.acos(THREE.Math.clamp(s[0].dot(s[t-1]),-1,1)),r/=t-1,0<i[0].dot(u.crossVectors(s[0],s[t-1]))&&(r=-r),f=1;f<t;f++)s[f].applyMatrix4(a.makeRotationAxis(i[f],r*f)),o[f].crossVectors(i[f],s[f])},THREE.PolyhedronGeometry=function(e,t,n,r){function i(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var n=Math.atan2(e.z,-e.x)/2/Math.PI+.5;return e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5,t.uv=new THREE.Vector2(n,1-e),t}function s(e,t,n){var r=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);a.faces.push(r),m.copy(e).add(t).add(n).divideScalar(3),r=Math.atan2(m.z,-m.x),a.faceVertexUvs[0].push([u(e.uv,e,r),u(t.uv,t,r),u(n.uv,n,r)])}function o(e,t){var n=Math.pow(2,t);Math.pow(4,t);for(var r=i(a.vertices[e.a]),o=i(a.vertices[e.b]),u=i(a.vertices[e.c]),f=[],l=0;l<=n;l++){f[l]=[];for(var c=i(r.clone().lerp(u,l/n)),h=i(o.clone().lerp(u,l/n)),p=n-l,d=0;d<=p;d++)f[l][d]=0==d&&l==n?c:i(c.clone().lerp(h,d/p))}for(l=0;l<n;l++)for(d=0;d<2*(n-l)-1;d++)r=Math.floor(d/2),0==d%2?s(f[l][r+1],f[l+1][r],f[l][r]):s(f[l][r+1],f[l+1][r+1],f[l+1][r])}function u(e,t,n){return 0>n&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),n=n||1,r=r||0;for(var a=this,f=0,l=e.length;f<l;f+=3)i(new THREE.Vector3(e[f],e[f+1],e[f+2]));e=this.vertices;for(var c=[],h=f=0,l=t.length;f<l;f+=3,h++){var p=e[t[f]],d=e[t[f+1]],v=e[t[f+2]];c[h]=new THREE.Face3(p.index,d.index,v.index,[p.clone(),d.clone(),v.clone()])}for(var m=new THREE.Vector3,f=0,l=c.length;f<l;f++)o(c[f],r);f=0;for(l=this.faceVertexUvs[0].length;f<l;f++)t=this.faceVertexUvs[0][f],r=t[0].x,e=t[1].x,c=t[2].x,h=Math.max(r,Math.max(e,c)),p=Math.min(r,Math.min(e,c)),.9<h&&.1>p&&(.2>r&&(t[0].x+=1),.2>e&&(t[1].x+=1),.2>c&&(t[2].x+=1));f=0;for(l=this.vertices.length;f<l;f++)this.vertices[f].multiplyScalar(n);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){this.parameters={radius:e,detail:t};var n=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){this.parameters={radius:e,detail:t},THREE.PolyhedronGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,n){THREE.Geometry.call(this);var r=this.vertices,i=this.faces,s=this.faceVertexUvs[0],o,u,a,f,l=t+1;for(o=0;o<=n;o++)for(f=o/n,u=0;u<=t;u++)a=u/t,a=e(a,f),r.push(a);var c,h,p,d;for(o=0;o<n;o++)for(u=0;u<t;u++)e=o*l+u,r=o*l+u+1,f=(o+1)*l+u+1,a=(o+1)*l+u,c=new THREE.Vector2(u/t,o/n),h=new THREE.Vector2((u+1)/t,o/n),p=new THREE.Vector2((u+1)/t,(o+1)/n),d=new THREE.Vector2(u/t,(o+1)/n),i.push(new THREE.Face3(e,r,a)),s.push([c,h,d]),i.push(new THREE.Face3(r,f,a)),s.push([h.clone(),p,d.clone()]);this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){e=e||1;var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e,0,0),new THREE.Vector3,new THREE.Vector3(0,e,0),new THREE.Vector3,new THREE.Vector3(0,0,e)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775)),e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),THREE.Line.call(this,t,e,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,n,r,i,s){THREE.Object3D.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),void 0===i&&(i=.2*n),void 0===s&&(s=.2*i),this.position=t,t=new THREE.Geometry,t.vertices.push(new THREE.Vector3(0,0,0)),t.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(t,new THREE.LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),t=new THREE.CylinderGeometry(0,.5,1,5,1),t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0)),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,s)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var e=new THREE.Vector3,t;return function(n){.99999<n.y?this.quaternion.set(0,0,0,1):-0.99999>n.y?this.quaternion.set(1,0,0,0):(e.set(n.z,0,-n.x).normalize(),t=Math.acos(n.y),this.quaternion.setFromAxisAngle(e,t))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},THREE.BoxHelper=function(e){var t=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=t;var n=new THREE.Geometry;n.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,t=t.boundingBox.max,r=this.vertices;r[0].set(t.x,t.y,t.z),r[1].set(n.x,t.y,t.z),r[2].set(n.x,n.y,t.z),r[3].set(t.x,n.y,t.z),r[4].set(t.x,t.y,n.z),r[5].set(n.x,t.y,n.z),r[6].set(n.x,n.y,n.z),r[7].set(t.x,n.y,n.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.BoundingBoxHelper=function(e,t){var n=void 0!==t?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:n,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,r){n(e,r),n(t,r)}function n(e,t){r.vertices.push(new THREE.Vector3),r.colors.push(new THREE.Color(t)),void 0===s[e]&&(s[e]=[]),s[e].push(r.vertices.length-1)}var r=new THREE.Geometry,i=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),s={};t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),THREE.Line.call(this,r,i,THREE.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Camera,n=new THREE.Projector;return function(){function r(r,s,o,u){e.set(s,o,u),n.unprojectVector(e,t),r=i.pointMap[r];if(void 0!==r)for(s=0,o=r.length;s<o;s++)i.geometry.vertices[r[s]].copy(e)}var i=this;t.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-0.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(-t,t,0),new THREE.Vector3(t,t,0),new THREE.Vector3(t,-t,0),new THREE.Vector3(-t,-t,0),new THREE.Vector3(-t,t,0));var r=new THREE.LineBasicMaterial({fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Line(n,r),this.add(this.lightPlane),n=new THREE.Geometry,n.vertices.push(new THREE.Vector3,new THREE.Vector3),r=new THREE.LineBasicMaterial({fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(n,r),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(e,t){var n=void 0!==t?t:16777215,r=[0,0],i={},s=function(e,t){return e-t},o=["a","b","c"],u=new THREE.BufferGeometry,a=e.geometry.clone();a.mergeVertices(),a.computeFaceNormals();for(var f=a.vertices,a=a.faces,l=0,c=0,h=a.length;c<h;c++)for(var p=a[c],d=0;3>d;d++){r[0]=p[o[d]],r[1]=p[o[(d+1)%3]],r.sort(s);var v=r.toString();void 0===i[v]?(i[v]={vert1:r[0],vert2:r[1],face1:c,face2:void 0},l++):i[v].face2=c}u.addAttribute("position",new THREE.Float32Attribute(2*l,3)),r=u.attributes.position.array,s=0;for(v in i)if(o=i[v],void 0===o.face2||.9999>a[o.face1].normal.dot(a[o.face2].normal))l=f[o.vert1],r[s++]=l.x,r[s++]=l.y,r[s++]=l.z,l=f[o.vert2],r[s++]=l.x,r[s++]=l.y,r[s++]=l.z;THREE.Line.call(this,u,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,e=void 0!==n?n:16776960,r=void 0!==r?r:1,t=new THREE.Geometry,n=0;for(var i=this.object.geometry.faces.length;n<i;n++)t.vertices.push(new THREE.Vector3,new THREE.Vector3);THREE.Line.call(this,t,new THREE.LineBasicMaterial({color:e,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(){var e=this.geometry.vertices,t=this.object,n=t.geometry.vertices,r=t.geometry.faces,i=t.matrixWorld;t.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(i);for(var s=t=0,o=r.length;t<o;t++,s+=2){var u=r[t];e[s].copy(n[u.a]).add(n[u.b]).add(n[u.c]).divideScalar(3).applyMatrix4(i),e[s+1].copy(u.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(e[s])}return this.geometry.verticesNeedUpdate=!0,this},THREE.GridHelper=function(e,t){var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var i=-e;i<=e;i+=t){n.vertices.push(new THREE.Vector3(-e,0,i),new THREE.Vector3(e,0,i),new THREE.Vector3(i,0,-e),new THREE.Vector3(i,0,e));var s=0===i?this.color1:this.color2;n.colors.push(s,s,s,s)}THREE.Line.call(this,n,r,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t,n,r){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color],e=new THREE.SphereGeometry(t,4,2),e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(t=0;8>t;t++)e.faces[t].color=this.colors[4>t?0:1];t=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0}),this.lightSphere=new THREE.Mesh(e,t),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,n,r),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SkeletonHelper=function(e){for(var t=e.skeleton,n=new THREE.Geometry,r=0;r<t.bones.length;r++)t.bones[r].parent instanceof THREE.Bone&&(n.vertices.push(new THREE.Vector3),n.vertices.push(new THREE.Vector3),n.colors.push(new THREE.Color(0,0,1)),n.colors.push(new THREE.Color(0,1,0)));r=new THREE.LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,transparent:!0}),THREE.Line.call(this,n,r,THREE.LinePieces),this.skeleton=t,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.update()},THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype),THREE.SkeletonHelper.prototype.update=function(){for(var e=this.geometry,t=0,n=0;n<this.skeleton.bones.length;n++){var r=this.skeleton.bones[n];r.parent instanceof THREE.Bone&&(e.vertices[t].setFromMatrixPosition(r.skinMatrix),e.vertices[t+1].setFromMatrixPosition(r.parent.skinMatrix),t+=2)}e.verticesNeedUpdate=!0,e.computeBoundingSphere()},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,e=new THREE.CylinderGeometry(0,1,1,8,1,!0),e.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0)),e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var t=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(e,t),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,t=void 0!==n?n:16711680,r=void 0!==r?r:1,n=new THREE.Geometry,e=e.geometry.faces;for(var i=0,s=e.length;i<s;i++)for(var o=0,u=e[i].vertexNormals.length;o<u;o++)n.vertices.push(new THREE.Vector3),n.vertices.push(new THREE.Vector3);THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:t,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,s=this.object.matrixWorld,o=0,u=0,a=i.length;u<a;u++)for(var f=i[u],l=0,c=f.vertexNormals.length;l<c;l++){var h=f.vertexNormals[l];n[o].copy(r[f[e[l]]]).applyMatrix4(s),t.copy(h).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(n[o]),o+=1,n[o].copy(t),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,t=void 0!==n?n:255,r=void 0!==r?r:1,n=new THREE.Geometry,e=e.geometry.faces;for(var i=0,s=e.length;i<s;i++)for(var o=0,u=e[i].vertexTangents.length;o<u;o++)n.vertices.push(new THREE.Vector3),n.vertices.push(new THREE.Vector3);THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:t,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,s=this.object.matrixWorld,o=0,u=0,a=i.length;u<a;u++)for(var f=i[u],l=0,c=f.vertexTangents.length;l<c;l++){var h=f.vertexTangents[l];n[o].copy(r[f[e[l]]]).applyMatrix4(s),t.copy(h).transformDirection(s).multiplyScalar(this.size),t.add(n[o]),o+=1,n[o].copy(t),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var n=void 0!==t?t:16777215,r=[0,0],i={},s=function(e,t){return e-t},o=["a","b","c"],u=new THREE.BufferGeometry;if(e.geometry instanceof THREE.Geometry){for(var a=e.geometry.vertices,f=e.geometry.faces,l=0,c=new Uint32Array(6*f.length),h=0,p=f.length;h<p;h++)for(var d=f[h],v=0;3>v;v++){r[0]=d[o[v]],r[1]=d[o[(v+1)%3]],r.sort(s);var m=r.toString();void 0===i[m]&&(c[2*l]=r[0],c[2*l+1]=r[1],i[m]=!0,l++)}u.addAttribute("position",new THREE.Float32Attribute(2*l,3)),r=u.attributes.position.array,h=0;for(p=l;h<p;h++)for(v=0;2>v;v++)l=a[c[2*h+v]],o=6*h+3*v,r[o+0]=l.x,r[o+1]=l.y,r[o+2]=l.z}else if(e.geometry instanceof THREE.BufferGeometry&&void 0!==e.geometry.attributes.index){for(var a=e.geometry.attributes.position.array,p=e.geometry.attributes.index.array,f=e.geometry.offsets,l=0,c=new Uint32Array(2*p.length),d=0,g=f.length;d<g;++d)for(var v=f[d].start,m=f[d].count,o=f[d].index,h=v,y=v+m;h<y;h+=3)for(v=0;3>v;v++)r[0]=o+p[h+v],r[1]=o+p[h+(v+1)%3],r.sort(s),m=r.toString(),void 0===i[m]&&(c[2*l]=r[0],c[2*l+1]=r[1],i[m]=!0,l++);u.addAttribute("position",new THREE.Float32Attribute(2*l,3)),r=u.attributes.position.array,h=0;for(p=l;h<p;h++)for(v=0;2>v;v++)o=6*h+3*v,l=3*c[2*h+v],r[o+0]=a[l],r[o+1]=a[l+1],r[o+2]=a[l+2]}else if(e.geometry instanceof THREE.BufferGeometry)for(a=e.geometry.attributes.position.array,l=a.length/3,c=l/3,u.addAttribute("position",new THREE.Float32Attribute(2*l,3)),r=u.attributes.position.array,h=0,p=c;h<p;h++)for(v=0;3>v;v++)o=18*h+6*v,c=9*h+3*v,r[o+0]=a[c],r[o+1]=a[c+1],r[o+2]=a[c+2],l=9*h+(v+1)%3*3,r[o+3]=a[l],r[o+4]=a[l+1],r[o+5]=a[l+2];THREE.Line.call(this,u,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,r,i)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,n,r,i,s){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===s&&(s=1),void 0===i&&(i=new THREE.Color(16777215)),void 0===r&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation+=.25*(n.wantedRotation-n.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,n,r={},i=this.geometry,s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s].name.match(t);if(u&&1<u.length){var a=u[1];r[a]||(r[a]={start:Infinity,end:-Infinity}),u=r[a],s<u.start&&(u.start=s),s>u.end&&(u.end=s),n||(n=a)}}for(a in r)u=r[a],this.createAnimation(a,u.start,u.end,e);this.firstAnimation=n},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e])e.direction=1,e.directionBackwards=!1},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e])e.direction=-1,e.directionBackwards=!0},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=!1},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(r.active){var i=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||0>r.time)r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)}else r.time%=r.duration,0>r.time&&(r.time+=r.duration);var s=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),o=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*o,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s),i=r.time%i/i,r.directionBackwards&&(i=1-i),this.morphTargetInfluences[r.currentFrame]=i*o,this.morphTargetInfluences[r.lastFrame]=(1-i)*o}}},THREE.LensFlarePlugin=function(){function e(e,n){var r=t.createProgram(),i=t.createShader(t.FRAGMENT_SHADER),s=t.createShader(t.VERTEX_SHADER),o="precision "+n+" float;\n";return t.shaderSource(i,o+e.fragmentShader),t.shaderSource(s,o+e.vertexShader),t.compileShader(i),t.compileShader(s),t.attachShader(r,i),t.attachShader(r,s),t.linkProgram(r),r}var t,n,r,i,s,o,u,a,f,l,c,h,p;this.init=function(v){t=v.context,n=v,r=v.getPrecision(),i=new Float32Array(16),s=new Uint16Array(6),v=0,i[v++]=-1,i[v++]=-1,i[v++]=0,i[v++]=0,i[v++]=1,i[v++]=-1,i[v++]=1,i[v++]=0,i[v++]=1,i[v++]=1,i[v++]=1,i[v++]=1,i[v++]=-1,i[v++]=1,i[v++]=0,i[v++]=1,v=0,s[v++]=0,s[v++]=1,s[v++]=2,s[v++]=0,s[v++]=2,s[v++]=3,o=t.createBuffer(),u=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW),a=t.createTexture(),f=t.createTexture(),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,f),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),0>=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(l=!1,c=e(THREE.ShaderFlares.lensFlare,r)):(l=!0,c=e(THREE.ShaderFlares.lensFlareVertexTexture,r)),h={},p={},h.vertex=t.getAttribLocation(c,"position"),h.uv=t.getAttribLocation(c,"uv"),p.renderType=t.getUniformLocation(c,"renderType"),p.map=t.getUniformLocation(c,"map"),p.occlusionMap=t.getUniformLocation(c,"occlusionMap"),p.opacity=t.getUniformLocation(c,"opacity"),p.color=t.getUniformLocation(c,"color"),p.scale=t.getUniformLocation(c,"scale"),p.rotation=t.getUniformLocation(c,"rotation"),p.screenPosition=t.getUniformLocation(c,"screenPosition")},this.render=function(e,r,i,s){e=e.__webglFlares;var d=e.length;if(d){var v=new THREE.Vector3,m=s/i,y=.5*i,w=.5*s,E=16/s,S=new THREE.Vector2(E*m,E),x=new THREE.Vector3(1,1,0),T=new THREE.Vector2(1,1),N=p,E=h;t.useProgram(c),t.enableVertexAttribArray(h.vertex),t.enableVertexAttribArray(h.uv),t.uniform1i(N.occlusionMap,0),t.uniform1i(N.map,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(E.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(E.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.disable(t.CULL_FACE),t.depthMask(!1);var C,L,A,O,M;for(C=0;C<d;C++)if(E=16/s,S.set(E*m,E),O=e[C],v.set(O.matrixWorld.elements[12],O.matrixWorld.elements[13],O.matrixWorld.elements[14]),v.applyMatrix4(r.matrixWorldInverse),v.applyProjection(r.projectionMatrix),x.copy(v),T.x=x.x*y+y,T.y=x.y*w+w,l||0<T.x&&T.x<i&&0<T.y&&T.y<s)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,T.x-8,T.y-8,16,16,0),t.uniform1i(N.renderType,0),t.uniform2f(N.scale,S.x,S.y),t.uniform3f(N.screenPosition,x.x,x.y,x.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,T.x-8,T.y-8,16,16,0),t.uniform1i(N.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),O.positionScreen.copy(x),O.customUpdateCallback?O.customUpdateCallback(O):O.updateLensFlares(),t.uniform1i(N.renderType,2),t.enable(t.BLEND),L=0,A=O.lensFlares.length;L<A;L++)M=O.lensFlares[L],.001<M.opacity&&.001<M.scale&&(x.x=M.x,x.y=M.y,x.z=M.z,E=M.size*M.scale/s,S.x=E*m,S.y=E,t.uniform3f(N.screenPosition,x.x,x.y,x.z),t.uniform2f(N.scale,S.x,S.y),t.uniform1f(N.rotation,M.rotation),t.uniform1f(N.opacity,M.opacity),t.uniform3f(N.color,M.color.r,M.color.g,M.color.b),n.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst),n.setTexture(M.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,n,r,i,s,o=new THREE.Frustum,u=new THREE.Matrix4,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3;this.init=function(o){e=o.context,t=o,o=THREE.ShaderLib.depthRGBA;var u=THREE.UniformsUtils.clone(o.uniforms);n=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u}),r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0}),i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0},this.render=function(e,n){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,n)},this.update=function(p,v){var m,y,w,E,S,x,T,N,C,L=[];E=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===THREE.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),m=0;for(y=p.__lights.length;m<y;m++)if(w=p.__lights[m],w.castShadow)if(w instanceof THREE.DirectionalLight&&w.shadowCascade)for(S=0;S<w.shadowCascadeCount;S++){var A;if(w.shadowCascadeArray[S])A=w.shadowCascadeArray[S];else{C=w,T=S,A=new THREE.DirectionalLight,A.isVirtual=!0,A.onlyShadow=!0,A.castShadow=!0,A.shadowCameraNear=C.shadowCameraNear,A.shadowCameraFar=C.shadowCameraFar,A.shadowCameraLeft=C.shadowCameraLeft,A.shadowCameraRight=C.shadowCameraRight,A.shadowCameraBottom=C.shadowCameraBottom,A.shadowCameraTop=C.shadowCameraTop,A.shadowCameraVisible=C.shadowCameraVisible,A.shadowDarkness=C.shadowDarkness,A.shadowBias=C.shadowCascadeBias[T],A.shadowMapWidth=C.shadowCascadeWidth[T],A.shadowMapHeight=C.shadowCascadeHeight[T],A.pointsWorld=[],A.pointsFrustum=[];var O=A.pointsWorld;x=A.pointsFrustum;for(N=0;8>N;N++)O[N]=new THREE.Vector3,x[N]=new THREE.Vector3;O=C.shadowCascadeNearZ[T],C=C.shadowCascadeFarZ[T],x[0].set(-1,-1,O),x[1].set(1,-1,O),x[2].set(-1,1,O),x[3].set(1,1,O),x[4].set(-1,-1,C),x[5].set(1,-1,C),x[6].set(-1,1,C),x[7].set(1,1,C),A.originalCamera=v,x=new THREE.Gyroscope,x.position.copy(w.shadowCascadeOffset),x.add(A),x.add(A.target),v.add(x),w.shadowCascadeArray[S]=A,console.log("Created virtualLight",A)}T=w,O=S,C=T.shadowCascadeArray[O],C.position.copy(T.position),C.target.position.copy(T.target.position),C.lookAt(C.target),C.shadowCameraVisible=T.shadowCameraVisible,C.shadowDarkness=T.shadowDarkness,C.shadowBias=T.shadowCascadeBias[O],x=T.shadowCascadeNearZ[O],T=T.shadowCascadeFarZ[O],C=C.pointsFrustum,C[0].z=x,C[1].z=x,C[2].z=x,C[3].z=x,C[4].z=T,C[5].z=T,C[6].z=T,C[7].z=T,L[E]=A,E++}else L[E]=w,E++;m=0;for(y=L.length;m<y;m++){w=L[m],w.shadowMap||(S=THREE.LinearFilter,t.shadowMapType===THREE.PCFSoftShadowMap&&(S=THREE.NearestFilter),w.shadowMap=new THREE.WebGLRenderTarget(w.shadowMapWidth,w.shadowMapHeight,{minFilter:S,magFilter:S,format:THREE.RGBAFormat}),w.shadowMapSize=new THREE.Vector2(w.shadowMapWidth,w.shadowMapHeight),w.shadowMatrix=new THREE.Matrix4);if(!w.shadowCamera){if(w instanceof THREE.SpotLight)w.shadowCamera=new THREE.PerspectiveCamera(w.shadowCameraFov,w.shadowMapWidth/w.shadowMapHeight,w.shadowCameraNear,w.shadowCameraFar);else{if(!(w instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}w.shadowCamera=new THREE.OrthographicCamera(w.shadowCameraLeft,w.shadowCameraRight,w.shadowCameraTop,w.shadowCameraBottom,w.shadowCameraNear,w.shadowCameraFar)}p.add(w.shadowCamera),!0===p.autoUpdate&&p.updateMatrixWorld()}w.shadowCameraVisible&&!w.cameraHelper&&(w.cameraHelper=new THREE.CameraHelper(w.shadowCamera),w.shadowCamera.add(w.cameraHelper));if(w.isVirtual&&A.originalCamera==v){S=v,E=w.shadowCamera,x=w.pointsFrustum,C=w.pointsWorld,a.set(Infinity,Infinity,Infinity),f.set(-Infinity,-Infinity,-Infinity);for(T=0;8>T;T++)O=C[T],O.copy(x[T]),THREE.ShadowMapPlugin.__projector.unprojectVector(O,S),O.applyMatrix4(E.matrixWorldInverse),O.x<a.x&&(a.x=O.x),O.x>f.x&&(f.x=O.x),O.y<a.y&&(a.y=O.y),O.y>f.y&&(f.y=O.y),O.z<a.z&&(a.z=O.z),O.z>f.z&&(f.z=O.z);E.left=a.x,E.right=f.x,E.top=f.y,E.bottom=a.y,E.updateProjectionMatrix()}E=w.shadowMap,x=w.shadowMatrix,S=w.shadowCamera,S.position.setFromMatrixPosition(w.matrixWorld),l.setFromMatrixPosition(w.target.matrixWorld),S.lookAt(l),S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),w.cameraHelper&&(w.cameraHelper.visible=w.shadowCameraVisible),w.shadowCameraVisible&&w.cameraHelper.update(),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(S.projectionMatrix),x.multiply(S.matrixWorldInverse),u.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),o.setFromMatrix(u),t.setRenderTarget(E),t.clear(),C=p.__webglObjects,w=0;for(E=C.length;w<E;w++)T=C[w],x=T.object,T.render=!1,!x.visible||!x.castShadow||(x instanceof THREE.Mesh||x instanceof THREE.ParticleSystem)&&x.frustumCulled&&!o.intersectsObject(x)||(x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),T.render=!0);var M;w=0;for(E=C.length;w<E;w++)T=C[w],T.render&&(x=T.object,T=T.buffer,O=x.material instanceof THREE.MeshFaceMaterial?x.material.materials[0]:x.material,N=void 0!==x.geometry.morphTargets&&0<x.geometry.morphTargets.length&&O.morphTargets,M=x instanceof THREE.SkinnedMesh&&O.skinning,N=x.customDepthMaterial?x.customDepthMaterial:M?N?s:i:N?r:n,t.setMaterialFaces(O),T instanceof THREE.BufferGeometry?t.renderBufferDirect(S,p.__lights,null,N,T,x):t.renderBuffer(S,p.__lights,null,N,T,x));C=p.__webglObjectsImmediate,w=0;for(E=C.length;w<E;w++)T=C[w],x=T.object,x.visible&&x.castShadow&&(x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),t.renderImmediateObject(S,p.__lights,null,n,x))}m=t.getClearColor(),y=t.getClearAlpha(),e.clearColor(m.r,m.g,m.b,y),e.enable(e.BLEND),t.shadowMapCullFace===THREE.CullFaceFront&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function g(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,y,b,w,E,S,x,T,N;this.init=function(g){y=g.context,b=g,E=new Float32Array([-0.5,-0.5,0,0,.5,-0.5,1,0,.5,.5,1,1,-0.5,.5,0,1]),S=new Uint16Array([0,1,2,0,2,3]),x=y.createBuffer(),T=y.createBuffer(),y.bindBuffer(y.ARRAY_BUFFER,x),y.bufferData(y.ARRAY_BUFFER,E,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,T),y.bufferData(y.ELEMENT_ARRAY_BUFFER,S,y.STATIC_DRAW),g=y.createProgram();var C=y.createShader(y.VERTEX_SHADER),A=y.createShader(y.FRAGMENT_SHADER);y.shaderSource(C,["precision "+b.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n")),y.shaderSource(A,["precision "+b.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n")),y.compileShader(C),y.compileShader(A),y.attachShader(g,C),y.attachShader(g,A),y.linkProgram(g),N=g,v=y.getAttribLocation(N,"position"),m=y.getAttribLocation(N,"uv"),e=y.getUniformLocation(N,"uvOffset"),t=y.getUniformLocation(N,"uvScale"),n=y.getUniformLocation(N,"rotation"),r=y.getUniformLocation(N,"scale"),i=y.getUniformLocation(N,"color"),s=y.getUniformLocation(N,"map"),o=y.getUniformLocation(N,"opacity"),u=y.getUniformLocation(N,"modelViewMatrix"),a=y.getUniformLocation(N,"projectionMatrix"),f=y.getUniformLocation(N,"fogType"),l=y.getUniformLocation(N,"fogDensity"),c=y.getUniformLocation(N,"fogNear"),h=y.getUniformLocation(N,"fogFar"),p=y.getUniformLocation(N,"fogColor"),d=y.getUniformLocation(N,"alphaTest"),g=document.createElement("canvas"),g.width=8,g.height=8,C=g.getContext("2d"),C.fillStyle="#ffffff",C.fillRect(0,0,g.width,g.height),w=new THREE.Texture(g),w.needsUpdate=!0},this.render=function(E,S,C,A){C=E.__webglSprites;if(A=C.length){y.useProgram(N),y.enableVertexAttribArray(v),y.enableVertexAttribArray(m),y.disable(y.CULL_FACE),y.enable(y.BLEND),y.bindBuffer(y.ARRAY_BUFFER,x),y.vertexAttribPointer(v,2,y.FLOAT,!1,16,0),y.vertexAttribPointer(m,2,y.FLOAT,!1,16,8),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,T),y.uniformMatrix4fv(a,!1,S.projectionMatrix.elements),y.activeTexture(y.TEXTURE0),y.uniform1i(s,0);var O=0,M=0,_=E.fog;_?(y.uniform3f(p,_.color.r,_.color.g,_.color.b),_ instanceof THREE.Fog?(y.uniform1f(c,_.near),y.uniform1f(h,_.far),y.uniform1i(f,1),M=O=1):_ instanceof THREE.FogExp2&&(y.uniform1f(l,_.density),y.uniform1i(f,2),M=O=2)):(y.uniform1i(f,0),M=O=0);for(var D,P=[],_=0;_<A;_++)D=C[_],!1!==D.visible&&(D._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,D.matrixWorld),D.z=-D._modelViewMatrix.elements[14]);C.sort(g);for(_=0;_<A;_++)D=C[_],!1!==D.visible&&(S=D.material,y.uniform1f(d,S.alphaTest),y.uniformMatrix4fv(u,!1,D._modelViewMatrix.elements),P[0]=D.scale.x,P[1]=D.scale.y,D=E.fog&&S.fog?M:0,O!==D&&(y.uniform1i(f,D),O=D),null!==S.map?(y.uniform2f(e,S.map.offset.x,S.map.offset.y),y.uniform2f(t,S.map.repeat.x,S.map.repeat.y)):(y.uniform2f(e,0,0),y.uniform2f(t,1,1)),y.uniform1f(o,S.opacity),y.uniform3f(i,S.color.r,S.color.g,S.color.b),y.uniform1f(n,S.rotation),y.uniform2fv(r,P),b.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),b.setDepthTest(S.depthTest),b.setDepthWrite(S.depthWrite),S.map&&S.map.image&&S.map.image.width?b.setTexture(S.map,0):b.setTexture(w,0),y.drawElements(y.TRIANGLES,6,y.UNSIGNED_SHORT,0));y.enable(y.CULL_FACE)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,n,r,i,s,o=new THREE.Frustum,u=new THREE.Matrix4;this.init=function(o){e=o.context,t=o,o=THREE.ShaderLib.depthRGBA;var u=THREE.UniformsUtils.clone(o.uniforms);n=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u}),r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0}),i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,p){var v,m,y,w,E,S;e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),!0===l.autoUpdate&&l.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),u.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),o.setFromMatrix(u),t.setRenderTarget(this.renderTarget),t.clear(),S=l.__webglObjects,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,y.render=!1,!E.visible||(E instanceof THREE.Mesh||E instanceof THREE.ParticleSystem)&&E.frustumCulled&&!o.intersectsObject(E)||(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),y.render=!0);var x;v=0;for(m=S.length;v<m;v++)y=S[v],y.render&&(E=y.object,y=y.buffer,E instanceof THREE.ParticleSystem&&!E.customDepthMaterial||((x=E.material instanceof THREE.MeshFaceMaterial?E.material.materials[0]:E.material)&&t.setMaterialFaces(E.material),w=void 0!==E.geometry.morphTargets&&0<E.geometry.morphTargets.length&&x.morphTargets,x=E instanceof THREE.SkinnedMesh&&x.skinning,w=E.customDepthMaterial?E.customDepthMaterial:x?w?s:i:w?r:n,y instanceof THREE.BufferGeometry?t.renderBufferDirect(p,l.__lights,null,w,y,E):t.renderBuffer(p,l.__lights,null,w,y,E)));S=l.__webglObjectsImmediate,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,E.visible&&(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),t.renderImmediateObject(p,l.__lights,null,n,E));v=t.getClearColor(),m=t.getClearAlpha(),e.clearColor(v.r,v.g,v.b,m),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},define("Three",function(e){return function(){var t,n;return t||e.Three}}(this)),THREE.OrbitControls=function(e,t){function k(){return 2*Math.PI/60/60*n.autoRotateSpeed}function L(){return Math.pow(.95,n.zoomSpeed)}function A(e){if(n.enabled===!1)return;e.preventDefault();if(e.button===0){if(n.noRotate===!0)return;E=w.ROTATE,i.set(e.clientX,e.clientY)}else if(e.button===1){if(n.noZoom===!0)return;E=w.DOLLY,h.set(e.clientX,e.clientY)}else if(e.button===2){if(n.noPan===!0)return;E=w.PAN,u.set(e.clientX,e.clientY)}n.domElement.addEventListener("mousemove",O,!1),n.domElement.addEventListener("mouseup",M,!1),n.dispatchEvent(N)}function O(e){if(n.enabled===!1)return;e.preventDefault();var t=n.domElement===document?n.domElement.body:n.domElement;if(E===w.ROTATE){if(n.noRotate===!0)return;s.set(e.clientX,e.clientY),o.subVectors(s,i),n.rotateLeft(2*Math.PI*o.x/t.clientWidth*n.rotateSpeed),n.rotateUp(2*Math.PI*o.y/t.clientHeight*n.rotateSpeed),i.copy(s)}else if(E===w.DOLLY){if(n.noZoom===!0)return;p.set(e.clientX,e.clientY),d.subVectors(p,h),d.y>0?n.dollyIn():n.dollyOut(),h.copy(p)}else if(E===w.PAN){if(n.noPan===!0)return;a.set(e.clientX,e.clientY),f.subVectors(a,u),n.pan(f.x,f.y),u.copy(a)}n.update()}function M(){if(n.enabled===!1)return;n.domElement.removeEventListener("mousemove",O,!1),n.domElement.removeEventListener("mouseup",M,!1),n.dispatchEvent(C),E=w.NONE}function _(e){if(n.enabled===!1||n.noZoom===!0)return;e.preventDefault(),e.stopPropagation();var t=0;e.wheelDelta!==undefined?t=e.wheelDelta:e.detail!==undefined&&(t=-e.detail),t>0?n.dollyOut():n.dollyIn(),n.update(),n.dispatchEvent(N),n.dispatchEvent(C)}function D(e){if(n.enabled===!1||n.noKeys===!0||n.noPan===!0)return;switch(e.keyCode){case n.keys.UP:n.pan(0,n.keyPanSpeed),n.update();break;case n.keys.BOTTOM:n.pan(0,-n.keyPanSpeed),n.update();break;case n.keys.LEFT:n.pan(n.keyPanSpeed,0),n.update();break;case n.keys.RIGHT:n.pan(-n.keyPanSpeed,0),n.update()}}function P(e){if(n.enabled===!1)return;switch(e.touches.length){case 1:if(n.noRotate===!0)return;E=w.TOUCH_ROTATE,i.set(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(n.noZoom===!0)return;E=w.TOUCH_DOLLY;var t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY,s=Math.sqrt(t*t+r*r);h.set(0,s);break;case 3:if(n.noPan===!0)return;E=w.TOUCH_PAN,u.set(e.touches[0].pageX,e.touches[0].pageY);break;default:E=w.NONE}n.dispatchEvent(N)}function H(e){if(n.enabled===!1)return;e.preventDefault(),e.stopPropagation();var t=n.domElement===document?n.domElement.body:n.domElement;switch(e.touches.length){case 1:if(n.noRotate===!0)return;if(E!==w.TOUCH_ROTATE)return;s.set(e.touches[0].pageX,e.touches[0].pageY),o.subVectors(s,i),n.rotateLeft(2*Math.PI*o.x/t.clientWidth*n.rotateSpeed),n.rotateUp(2*Math.PI*o.y/t.clientHeight*n.rotateSpeed),i.copy(s),n.update();break;case 2:if(n.noZoom===!0)return;if(E!==w.TOUCH_DOLLY)return;var r=e.touches[0].pageX-e.touches[1].pageX,l=e.touches[0].pageY-e.touches[1].pageY,c=Math.sqrt(r*r+l*l);p.set(0,c),d.subVectors(p,h),d.y>0?n.dollyOut():n.dollyIn(),h.copy(p),n.update();break;case 3:if(n.noPan===!0)return;if(E!==w.TOUCH_PAN)return;a.set(e.touches[0].pageX,e.touches[0].pageY),f.subVectors(a,u),n.pan(f.x,f.y),u.copy(a),n.update();break;default:E=w.NONE}}function B(){if(n.enabled===!1)return;n.dispatchEvent(C),E=w.NONE}this.object=e,this.domElement=t!==undefined?t:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=Infinity,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var n=this,r=1e-6,i=new THREE.Vector2,s=new THREE.Vector2,o=new THREE.Vector2,u=new THREE.Vector2,a=new THREE.Vector2,f=new THREE.Vector2,l=new THREE.Vector3,c=new THREE.Vector3,h=new THREE.Vector2,p=new THREE.Vector2,d=new THREE.Vector2,v=0,m=0,g=1,y=new THREE.Vector3,b=new THREE.Vector3,w={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},E=w.NONE;this.target0=this.target.clone(),this.position0=this.object.position.clone();var S=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),x=S.clone().inverse(),T={type:"change"},N={type:"start"},C={type:"end"};this.rotateLeft=function(e){e===undefined&&(e=k()),m-=e},this.rotateUp=function(e){e===undefined&&(e=k()),v-=e},this.panLeft=function(e){var t=this.object.matrix.elements;l.set(t[0],t[1],t[2]),l.multiplyScalar(-e),y.add(l)},this.panUp=function(e){var t=this.object.matrix.elements;l.set(t[4],t[5],t[6]),l.multiplyScalar(e),y.add(l)},this.pan=function(e,t){var r=n.domElement===document?n.domElement.body:n.domElement;if(n.object.fov!==undefined){var i=n.object.position,s=i.clone().sub(n.target),o=s.length();o*=Math.tan(n.object.fov/2*Math.PI/180),n.panLeft(2*e*o/r.clientHeight),n.panUp(2*t*o/r.clientHeight)}else n.object.top!==undefined?(n.panLeft(e*(n.object.right-n.object.left)/r.clientWidth),n.panUp(t*(n.object.top-n.object.bottom)/r.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(e){e===undefined&&(e=L()),g/=e},this.dollyOut=function(e){e===undefined&&(e=L()),g*=e},this.update=function(){var e=this.object.position;c.copy(e).sub(this.target),c.applyQuaternion(S);var t=Math.atan2(c.x,c.z),n=Math.atan2(Math.sqrt(c.x*c.x+c.z*c.z),c.y);this.autoRotate&&this.rotateLeft(k()),t+=m,n+=v,n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n)),n=Math.max(r,Math.min(Math.PI-r,n));var i=c.length()*g;i=Math.max(this.minDistance,Math.min(this.maxDistance,i)),this.target.add(y),c.x=i*Math.sin(n)*Math.sin(t),c.y=i*Math.cos(n),c.z=i*Math.sin(n)*Math.cos(t),c.applyQuaternion(x),e.copy(this.target).add(c),this.object.lookAt(this.target),m=0,v=0,g=1,y.set(0,0,0),b.distanceToSquared(this.object.position)>r&&(this.dispatchEvent(T),b.copy(this.object.position))},this.reset=function(){E=w.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.update()},this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1),this.domElement.addEventListener("mousedown",A,!1),this.domElement.addEventListener("mousewheel",_,!1),this.domElement.addEventListener("DOMMouseScroll",_,!1),this.domElement.addEventListener("touchstart",P,!1),this.domElement.addEventListener("touchend",B,!1),this.domElement.addEventListener("touchmove",H,!1),window.addEventListener("keydown",D,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),define("OrbitControls",["Three"],function(e){return function(){var t,n;return t||e.OrbitControls}}(this));var container,$container,camera,controls,scene,renderer,geometry,group,mouse=new THREE.Vector2,offset=new THREE.Vector3,INTERSECTED,SELECTED,objects=[],plane,mouseX=0,mouseY=0,windowHalfX=window.innerWidth/2,windowHalfY=window.innerHeight/2;init(),render(),define("Viewport",["Three","OrbitControls"],function(e){return function(){var t,n;return t||e.Viewport}}(this)),CSG=function(){this.polygons=[]},CSG.fromPolygons=function(e){var t=new CSG;return t.polygons=e,t},CSG.prototype={clone:function(){var e=new CSG;return e.polygons=this.polygons.map(function(e){return e.clone()}),e},toPolygons:function(){return this.polygons},union:function(e){var t=new CSG.Node(this.clone().polygons),n=new CSG.Node(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),CSG.fromPolygons(t.allPolygons())},subtract:function(e){var t=new CSG.Node(this.clone().polygons),n=new CSG.Node(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},intersect:function(e){var t=new CSG.Node(this.clone().polygons),n=new CSG.Node(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},inverse:function(){var e=this.clone();return e.polygons.map(function(e){e.flip()}),e},transform:function(e){var t=this.polygons.map(function(t){return t.transform(e)});return CSG.fromPolygons(t)},translate:function(e){return this.transform(CSG.Matrix4x4.translation(e))},scale:function(e){return this.transform(CSG.Matrix4x4.scaling(e))},rotateX:function(e){return this.transform(CSG.Matrix4x4.rotationX(e))},rotateY:function(e){return this.transform(CSG.Matrix4x4.rotationY(e))},rotateZ:function(e){return this.transform(CSG.Matrix4x4.rotationZ(e))},toStlString:function(){var e="solid csg.js\n";return this.polygons.map(function(t){e+=t.toStlString()}),e+="endsolid csg.js\n",e}},CSG.cube=function(e){e=e||{};var t=new CSG.Vector(e.center||[0,0,0]),n=e.radius?e.radius.length?e.radius:[e.radius,e.radius,e.radius]:[1,1,1];return CSG.fromPolygons([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(e){return new CSG.Polygon(e[0].map(function(i){var s=new CSG.Vector(t.x+n[0]*(2*!!(i&1)-1),t.y+n[1]*(2*!!(i&2)-1),t.z+n[2]*(2*!!(i&4)-1));return new CSG.Vertex(s,new CSG.Vector(e[1]))}))}))},CSG.sphere=function(e){function u(e,r){e*=Math.PI*2,r*=Math.PI;var i=new CSG.Vector(Math.cos(e)*Math.sin(r),Math.cos(r),Math.sin(e)*Math.sin(r));o.push(new CSG.Vertex(t.plus(i.times(n)),i))}e=e||{};var t=new CSG.Vector(e.center||[0,0,0]),n=e.radius||1,r=e.slices||16,i=e.stacks||8,s=[],o;for(var a=0;a<r;a++)for(var f=0;f<i;f++)o=[],u(a/r,f/i),f>0&&u((a+1)/r,f/i),f<i-1&&u((a+1)/r,(f+1)/i),u(a/r,(f+1)/i),s.push(new CSG.Polygon(o));return CSG.fromPolygons(s)},CSG.cylinder=function(e){function p(e,n,s){var u=n*Math.PI*2,l=a.times(Math.cos(u)).plus(f.times(Math.sin(u))),c=t.plus(r.times(e)).plus(l.times(i)),h=l.times(1-Math.abs(s)).plus(o.times(s));return new CSG.Vertex(c,h)}e=e||{};var t=new CSG.Vector(e.start||[0,-1,0]),n=new CSG.Vector(e.end||[0,1,0]),r=n.minus(t),i=e.radius||1,s=e.slices||16,o=r.unit(),u=Math.abs(o.y)>.5,a=(new CSG.Vector(u,!u,0)).cross(o).unit(),f=a.cross(o).unit(),l=new CSG.Vertex(t,o.negated()),c=new CSG.Vertex(n,o.unit()),h=[];for(var d=0;d<s;d++){var v=d/s,m=(d+1)/s;h.push(new CSG.Polygon([l,p(0,v,-1),p(0,m,-1)])),h.push(new CSG.Polygon([p(0,m,0),p(0,v,0),p(1,v,0),p(1,m,0)])),h.push(new CSG.Polygon([c,p(1,m,1),p(1,v,1)]))}return CSG.fromPolygons(h)},CSG.Vector=function(e,t,n){arguments.length==3?(this.x=e,this.y=t,this.z=n):"x"in e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e[0],this.y=e[1],this.z=e[2])},CSG.Vector.prototype={clone:function(){return new CSG.Vector(this.x,this.y,this.z)},negated:function(){return new CSG.Vector(-this.x,-this.y,-this.z)},plus:function(e){return new CSG.Vector(this.x+e.x,this.y+e.y,this.z+e.z)},minus:function(e){return new CSG.Vector(this.x-e.x,this.y-e.y,this.z-e.z)},times:function(e){return new CSG.Vector(this.x*e,this.y*e,this.z*e)},dividedBy:function(e){return new CSG.Vector(this.x/e,this.y/e,this.z/e)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lerp:function(e,t){return this.plus(e.minus(this).times(t))},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.dividedBy(this.length())},cross:function(e){return new CSG.Vector(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},multiply4x4:function(e){return e.rightMultiply1x3Vector(this)},toStlString:function(){return this.x+" "+this.y+" "+this.z}},CSG.Vertex=function(e,t){this.pos=new CSG.Vector(e),this.normal=new CSG.Vector(t)},CSG.Vertex.prototype={clone:function(){return new CSG.Vertex(this.pos.clone(),this.normal.clone())},flip:function(){this.normal=this.normal.negated()},interpolate:function(e,t){return new CSG.Vertex(this.pos.lerp(e.pos,t),this.normal.lerp(e.normal,t))},transform:function(e){var t=this.pos.multiply4x4(e),n=this.pos.plus(this.normal),r=n.multiply4x4(e),i=r.minus(t).unit();return new CSG.Vertex(t,i)},toStlString:function(){return"vertex "+this.pos.toStlString()+"\n"}},CSG.Plane=function(e,t){this.normal=e,this.w=t},CSG.Plane.EPSILON=1e-5,CSG.Plane.fromPoints=function(e,t,n){var r=t.minus(e).cross(n.minus(e)).unit();return new CSG.Plane(r,r.dot(e))},CSG.Plane.prototype={clone:function(){return new CSG.Plane(this.normal.clone(),this.w)},flip:function(){this.normal=this.normal.negated(),this.w=-this.w},splitPolygon:function(e,t,n,r,i){var s=0,o=1,u=2,a=3,f=0,l=[];for(var c=0;c<e.vertices.length;c++){var h=this.normal.dot(e.vertices[c].pos)-this.w,p=h<-CSG.Plane.EPSILON?u:h>CSG.Plane.EPSILON?o:s;f|=p,l.push(p)}switch(f){case s:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case o:r.push(e);break;case u:i.push(e);break;case a:var d=[],v=[];for(var c=0;c<e.vertices.length;c++){var m=(c+1)%e.vertices.length,g=l[c],y=l[m],b=e.vertices[c],w=e.vertices[m];g!=u&&d.push(b),g!=o&&v.push(g!=u?b.clone():b);if((g|y)==a){var h=(this.w-this.normal.dot(b.pos))/this.normal.dot(w.pos.minus(b.pos)),E=b.interpolate(w,h);d.push(E),v.push(E.clone())}}d.length>=3&&r.push(new CSG.Polygon(d,e.shared)),v.length>=3&&i.push(new CSG.Polygon(v,e.shared))}}},CSG.Polygon=function(e,t){this.vertices=e,this.shared=t,this.plane=CSG.Plane.fromPoints(e[0].pos,e[1].pos,e[2].pos)},CSG.Polygon.prototype={clone:function(){var e=this.vertices.map(function(e){return e.clone()});return new CSG.Polygon(e,this.shared)},flip:function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()},transform:function(e){var t=this.vertices.map(function(t){return t.transform(e)});return new CSG.Polygon(t,this.shared)},translate:function(e){var t=this.vertices.map(function(t){return t.transform(e)});return new CSG.Polygon(t,this.shared)},scale:function(e){var t=this.vertices.map(function(t){return t.transform(e)});return new CSG.Polygon(t,this.shared)},toStlString:function(){var e="";if(this.vertices.length>=3){var t=this.vertices[0].toStlString();for(var n=0;n<this.vertices.length-2;n++)e+="facet normal "+this.plane.normal.toStlString()+"\nouter loop\n",e+=t,e+=this.vertices[n+1].toStlString(),e+=this.vertices[n+2].toStlString(),e+="endloop\nendfacet\n"}return e}},CSG.Polygon.createFromPoints=function(e,t){var n=new CSG.Vector(0,0,0),r=[];e.map(function(e){var t=new CSG.Vector(e),i=new CSG.Vertex(t,n);r.push(i)});var i=new CSG.Polygon(r,t),s=i.plane.normal;return i.vertices.map(function(e){e.normal=s}),i},CSG.Node=function(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)},CSG.Node.prototype={clone:function(){var e=new CSG.Node;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(function(e){return e.clone()}),e},invert:function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},clipPolygons:function(e){if(!this.plane)return e.slice();var t=[],n=[];for(var r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),this.back?n=this.back.clipPolygons(n):n=[],t.concat(n)},clipTo:function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},allPolygons:function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},build:function(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());var t=[],n=[];for(var r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new CSG.Node),this.front.build(t)),n.length&&(this.back||(this.back=new CSG.Node),this.back.build(n))}},CSG.Matrix4x4=function(e){arguments.length>=1?this.elements=e:this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},CSG.Matrix4x4.prototype={plus:function(e){var t=[];for(var n=0;n<16;n++)t[n]=this.elements[n]+e.elements[n];return new CSG.Matrix4x4(t)},minus:function(e){var t=[];for(var n=0;n<16;n++)t[n]=this.elements[n]-e.elements[n];return new CSG.Matrix4x4(t)},multiply:function(e){var t=this.elements[0],n=this.elements[1],r=this.elements[2],i=this.elements[3],s=this.elements[4],o=this.elements[5],u=this.elements[6],a=this.elements[7],f=this.elements[8],l=this.elements[9],c=this.elements[10],h=this.elements[11],p=this.elements[12],d=this.elements[13],v=this.elements[14],m=this.elements[15],g=e.elements[0],y=e.elements[1],b=e.elements[2],w=e.elements[3],E=e.elements[4],S=e.elements[5],x=e.elements[6],T=e.elements[7],N=e.elements[8],C=e.elements[9],k=e.elements[10],L=e.elements[11],A=e.elements[12],O=e.elements[13],M=e.elements[14],_=e.elements[15],D=[];return D[0]=t*g+n*E+r*N+i*A,D[1]=t*y+n*S+r*C+i*O,D[2]=t*b+n*x+r*k+i*M,D[3]=t*w+n*T+r*L+i*_,D[4]=s*g+o*E+u*N+a*A,D[5]=s*y+o*S+u*C+a*O,D[6]=s*b+o*x+u*k+a*M,D[7]=s*w+o*T+u*L+a*_,D[8]=f*g+l*E+c*N+h*A,D[9]=f*y+l*S+c*C+h*O,D[10]=f*b+l*x+c*k+h*M,D[11]=f*w+l*T+c*L+h*_,D[12]=p*g+d*E+v*N+m*A,D[13]=p*y+d*S+v*C+m*O,D[14]=p*b+d*x+v*k+m*M,D[15]=p*w+d*T+v*L+m*_,new CSG.Matrix4x4(D)},clone:function(){var e=this.elements.map(function(e){return e});return new CSG.Matrix4x4(e)},rightMultiply1x3Vector:function(e){var t=e.x,n=e.y,r=e.z,i=1,s=t*this.elements[0]+n*this.elements[1]+r*this.elements[2]+i*this.elements[3],o=t*this.elements[4]+n*this.elements[5]+r*this.elements[6]+i*this.elements[7],u=t*this.elements[8]+n*this.elements[9]+r*this.elements[10]+i*this.elements[11],a=t*this.elements[12]+n*this.elements[13]+r*this.elements[14]+i*this.elements[15];if(a!=1){var f=1/a;s*=f,o*=f,u*=f}return new CSG.Vector(s,o,u)},rightMultiply1x2Vector:function(e){var t=e.x,n=e.y,r=0,i=1,s=t*this.elements[0]+n*this.elements[1]+r*this.elements[2]+i*this.elements[3],o=t*this.elements[4]+n*this.elements[5]+r*this.elements[6]+i*this.elements[7],u=t*this.elements[8]+n*this.elements[9]+r*this.elements[10]+i*this.elements[11],a=t*this.elements[12]+n*this.elements[13]+r*this.elements[14]+i*this.elements[15];if(a!=1){var f=1/a;s*=f,o*=f,u*=f}return new CSG.Vector2D(s,o)}},CSG.Matrix4x4.unity=function(){return new CSG.Matrix4x4},CSG.Matrix4x4.rotationX=function(e){var t=e*Math.PI*(1/180),n=Math.cos(t),r=Math.sin(t),i=[1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1];return new CSG.Matrix4x4(i)},CSG.Matrix4x4.rotationY=function(e){var t=e*Math.PI*(1/180),n=Math.cos(t),r=Math.sin(t),i=[n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1];return new CSG.Matrix4x4(i)},CSG.Matrix4x4.rotationZ=function(e){var t=e*Math.PI*(1/180),n=Math.cos(t),r=Math.sin(t),i=[n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1];return new CSG.Matrix4x4(i)},CSG.Matrix4x4.translation=function(e){var t=new CSG.Vector(e),n=[1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1];return new CSG.Matrix4x4(n)},CSG.Matrix4x4.scaling=function(e){var t=new CSG.Vector(e),n=[t.x,0,0,0,0,t.y,0,0,0,0,t.z,0,0,0,0,1];return new CSG.Matrix4x4(n)},CSG.Vector2D=function(e,t){arguments.length==2?(this.x=e,this.y=t):"x"in e?(this.x=e.x,this.y=e.y):(this.x=e[0],this.y=e[1])},CSG.Vector2D.prototype={toVector3D:function(e){return new CSG.Vector(this.x,this.y,e)},clone:function(){return new CSG.Vector(this.x,this.y)},negated:function(){return new CSG.Vector(-this.x,-this.y)},plus:function(e){return new CSG.Vector(this.x+e.x,this.y+e.y)},minus:function(e){return new CSG.Vector(this.x-e.x,this.y-e.y)},times:function(e){return new CSG.Vector(this.x*e,this.y*e)},dividedBy:function(e){return new CSG.Vector(this.x/e,this.y/e)},dot:function(e){return this.x*e.x+this.y*e.y},lerp:function(e,t){return this.plus(e.minus(this).times(t))},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.dividedBy(this.length())},multiply4x4:function(e){return e.rightMultiply1x2Vector(this)}},CSG.Polygon2D=function(e,t){var n=[];arguments.length>=1&&e.map(function(e){n.push(new CSG.Vector2D(e))}),this.points=n,this.shared=t},CSG.Polygon2D.prototype={transform:function(e){var t=this.points.map(function(t){return t.multiply4x4(e)});return new CSG.Polygon2D(t,this.shared)},translate:function(e){return e=new CSG.Vector2D(e),this.transform(CSG.Matrix4x4.translation(e.toVector3D(0)))},scale:function(e){return e=new CSG.Vector2D(e),this.transform(CSG.Matrix4x4.scaling(e.toVector3D(1)))},rotate:function(e){return this.transform(CSG.Matrix4x4.rotationZ(e))},toPolygon3D:function(e){var t=[];return this.points.map(function(n){var r=n.toVector3D(e);t.push(r)}),CSG.Polygon.createFromPoints(t,this.shared)},extrude:function(e){e||(e={});var t;"offset"in e?t=new CSG.Vector(e.offset):t=new CSG.Vector(0,0,1);var n=0;"twistangle"in e&&(n=e.twistangle);var r=10;"twiststeps"in e&&(r=e.twiststeps),n==0&&(r=1),r<1&&(r=1);var i=[],s=this.toPolygon3D(0),o=s.plane.normal.dot(t);o>0&&s.flip(),i.push(s);var u=function(e){var i=(e+1)/r,o=n*i,u=t.times(i),a=CSG.Matrix4x4.rotationZ(o).multiply(CSG.Matrix4x4.translation(u)),f=s.transform(a);return f},a=s.vertices.length,f=s;for(var l=0;l<r;++l){var c=u(l);for(var h=0;h<a;h++){var p=[],d=h<a-1?h+1:0;p.push(f.vertices[h].pos),p.push(c.vertices[h].pos),p.push(c.vertices[d].pos),p.push(f.vertices[d].pos);var v=CSG.Polygon.createFromPoints(p,this.shared);i.push(v)}l==r-1&&(c.flip(),i.push(c)),f=c}return CSG.fromPolygons(i)}},define("CSG",function(e){return function(){var t,n;return t||e.CSG}}(this));if(typeof require!="function"&&typeof window!="object")var define=function(e,t){typeof e=="function"&&e(FLOOD),typeof t=="function"&&t(FLOOD)};define("FLOODCSG",["FLOOD"],function(e){CSG.prototype.render=function(){var e={vertices:[],faces:[]},t,n,r,i,s=this.toPolygons();for(t=0;t<s.length;t++){r=[];for(n=0;n<s[t].vertices.length;n++)r.push(this.getVertexIndex(e,s[t].vertices[n].pos));r[0]===r[r.length-1]&&r.pop();for(var n=2;n<r.length;n++){var o=s[t].plane.normal;i=[r[0],r[n-1],r[n],[o.x,o.y,o.z]],e.faces.push(i)}}return e},CSG.prototype.getVertexIndex=function(e,t){var n;for(n=0;n<e.vertices.length;n++)if(e.vertices[n][0]===t.x&&e.vertices[n][1]===t.y&&e.vertices[n][2]===t.z)return n;return e.vertices.push([t.x,t.y,t.z]),e.vertices.length-1},CSG.Polygon.prototype.render=function(){var e={linestrip:[]},t=this.vertices;for(var n=0;n<t.length;n++)e.linestrip.push([t[n].pos.x,t[n].pos.y,t[n].pos.z]);return e.linestrip.push([t[0].pos.x,t[0].pos.y,t[0].pos.z]),e},CSG.Plane.prototype.render=function(){var e=this.origin,t=[e.plus(this.xaxis),e.minus(this.xaxis),e,e.minus(this.yaxis),e.plus(this.yaxis),e,e.plus(this.normal)];return t=t.map(function(e){return[e.x,e.y,e.z]}),{linestrip:t}},e.nodeTypes.Vector=function(){var t={inputs:[new e.baseTypes.InputPort("X",[Number],0),new e.baseTypes.InputPort("Y",[Number],0),new e.baseTypes.InputPort("Z",[Number],0)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"Vector"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t,n){return new CSG.Vector([e,t,n])}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorAdd=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("B",[CSG.Vector],new CSG.Vector([0,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorAdd"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.plus(t)}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorMultiply=function(){var t={inputs:[new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("Scalar",[Number],1)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorMultiply"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.times(t)}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorSubtract=function(){var t={inputs:[new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector([1,0,0])),new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector([0,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorSubtract"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.minus(t)}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorDot=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("B",[CSG.Vector],new CSG.Vector([0,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorDot"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.dot(t)}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorCross=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG.Vector],new CSG.Vector([1,0,0])),new e.baseTypes.InputPort("B",[CSG.Vector],new CSG.Vector([0,1,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorCross"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.cross(t)}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorNormalized=function(){var t={inputs:[new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector([1,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorNormalized"};e.baseTypes.NodeType.call(this,t),this.eval=function(e){return e.unit()}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorDistance=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("B",[CSG.Vector],new CSG.Vector([0,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorDistance"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.minus(t).length()}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorLength=function(){var t={inputs:[new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector([1,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[Number])],typeName:"VectorLength"};e.baseTypes.NodeType.call(this,t),this.eval=function(e){return e.length()}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorInterp=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("B",[CSG.Vector],new CSG.Vector([1,0,0])),new e.baseTypes.InputPort("Interp",[Number],.5)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"VectorInterp"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.lerp(b,t)}}.inherits(e.baseTypes.NodeType),e.nodeTypes.VectorComponents=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG.Vector],new CSG.Vector([0,0,0]))],outputs:[new e.baseTypes.OutputPort("X",[Number]),new e.baseTypes.OutputPort("Y",[Number]),new e.baseTypes.OutputPort("Z",[Number])],typeName:"VectorComponents"};e.baseTypes.NodeType.call(this,t),this.eval=function(t){return new e.MultiOutResult({0:t.x,1:t.y,2:t.z})}}.inherits(e.baseTypes.NodeType),e.nodeTypes.Point=function(){var t={inputs:[new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector([0,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Vector])],typeName:"Point"};e.baseTypes.NodeType.call(this,t),this.eval=function(e){return e},this.postProcess=function(e){var t={vertices:[]};if(e.map)for(var n=0;n<e.length;n++){var r=e[n];t.vertices.push([r.x,r.y,r.z])}return t.vertices.push([e.x,e.y,e.z]),t}}.inherits(e.baseTypes.NodeType);var t=function(e){if(!e)return{};if(e.map){var t=[];for(var n=0;n<e.length;n++){if(e[n]===undefined)continue;t.push(e[n].render?e[n].render():e[n])}return t}return e.render?e.render():e};e.baseTypes.CSG=function(n){e.baseTypes.NodeType.call(this,n),this.postProcess=t}.inherits(e.baseTypes.NodeType),e.baseTypes.NodeType.prototype.postProcess=t,e.nodeTypes.SolidSphere=function(){var t={inputs:[new e.baseTypes.InputPort("Center",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("Radius",[Number],10),new e.baseTypes.InputPort("Slices",[Number],12),new e.baseTypes.InputPort("Stacks",[Number],6)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidSphere"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t,n,r){return CSG.sphere({center:e,radius:t,slices:n,stacks:r})}}.inherits(e.baseTypes.CSG),e.nodeTypes.SolidCylinder=function(){var t={inputs:[new e.baseTypes.InputPort("StartPoint",[CSG.Vector],new CSG.Vector([0,-5,0])),new e.baseTypes.InputPort("EndPoint",[CSG.Vector],new CSG.Vector([0,5,0])),new e.baseTypes.InputPort("Radius",[Number],5),new e.baseTypes.InputPort("Slices",[Number],20)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidCylinder"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t,n,r){return CSG.cylinder({start:e,end:t,radius:n,slices:r})}}.inherits(e.baseTypes.CSG),e.nodeTypes.SolidCube=function(){var t={inputs:[new e.baseTypes.InputPort("Center",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("Radius",[Number],10)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidCube"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return CSG.cube({center:e,radius:t})}}.inherits(e.baseTypes.CSG),e.nodeTypes.SolidIntersect=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG]),new e.baseTypes.InputPort("B",[CSG])],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidIntersect"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.intersect(t)}}.inherits(e.baseTypes.CSG),e.nodeTypes.SolidUnionAll=function(){var t={inputs:[new e.baseTypes.InputPort("Solids",[e.QuotedArray,CSG])],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidUnionAll"};e.baseTypes.NodeType.call(this,t),this.eval=function(e){var t=e.pop();return e.reduce(function(e,t){return e.union(t)},t)}}.inherits(e.baseTypes.CSG),e.nodeTypes.SolidUnion=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG]),new e.baseTypes.InputPort("B",[CSG])],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidUnion"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.union(t)}}.inherits(e.baseTypes.CSG),e.nodeTypes.SolidSubtract=function(){var t={inputs:[new e.baseTypes.InputPort("A",[CSG]),new e.baseTypes.InputPort("B",[CSG])],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidSubtract"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.subtract(t)}}.inherits(e.baseTypes.CSG),e.nodeTypes.Move=function(){var t={inputs:[new e.baseTypes.InputPort("Geom",[e.AnyTypeButQuotedArray]),new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector([0,0,0]))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"Move"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){return e.transform(CSG.Matrix4x4.translation(t))}}.inherits(e.baseTypes.CSG),e.nodeTypes.Scale=function(){var t={inputs:[new e.baseTypes.InputPort("Geom",[e.AnyTypeButQuotedArray]),new e.baseTypes.InputPort("Center",[CSG.Vector],new CSG.Vector([0,0,0])),new e.baseTypes.InputPort("Factor",[Number],1)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"Scale"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t,n){var r=CSG.Matrix4x4.translation(t.negated()),i=CSG.Matrix4x4.scaling([n,n,n]),s=CSG.Matrix4x4.translation(t),o=s.multiply(i).multiply(r);return e.transform(o)}}.inherits(e.baseTypes.CSG),e.nodeTypes.Rotate=function(){var t={inputs:[new e.baseTypes.InputPort("Geom",[e.AnyTypeButQuotedArray]),new e.baseTypes.InputPort("Axis",[CSG.Vector],new CSG.Vector([0,0,1])),new e.baseTypes.InputPort("Angle",[Number],Math.PI/2)],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"Rotate"},n=function(e,t){var n=Math.cos(e),r=Math.sin(e),i=1-n,s=n+t.x*t.x*i,o=n+t.y*t.y*i,u=n+t.z*t.z*i,a=t.x*t.y*i,f=t.z*r,l=a+f,c=a-f,a=t.x*t.z*i,f=t.y*r,h=a-f,p=a+f,a=t.y*t.z*i,f=t.x*r,d=a+f,v=a-f;return new CSG.Matrix4x4([s,c,p,0,l,o,v,0,h,d,u,0,0,0,0,1])};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t,r){var i=n(r*Math.PI/180,t.unit());return e.transform(i)}}.inherits(e.baseTypes.CSG),e.nodeTypes.Plane=function(){var t={inputs:[new e.baseTypes.InputPort("Origin",[CSG.Vector],new CSG.Vector(0,0,0)),new e.baseTypes.InputPort("XAxis",[CSG.Vector],new CSG.Vector(1,0,0)),new e.baseTypes.InputPort("YAxis",[CSG.Vector],new CSG.Vector(0,1,0))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Plane])],typeName:"Plane"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t,n){var r=t.cross(n).unit(),i=r.dot(e),s=new CSG.Plane(r,i);return s.origin=e,s.xaxis=t.unit(),s.yaxis=r.cross(s.xaxis),s}}.inherits(e.baseTypes.CSG),e.nodeTypes.RegularPolygon=function(){var t=function(){var e=new CSG.Vector(0,0,1),t=0,n=new CSG.Plane(e,t);return n.origin=new CSG.Vector(0,0,0),n.xaxis=new CSG.Vector(1,0,0),n.yaxis=new CSG.Vector(0,1,0),n},n={inputs:[new e.baseTypes.InputPort("Sides",[Number],3),new e.baseTypes.InputPort("Radius",[Number],10),new e.baseTypes.InputPort("Plane",[CSG.Plane],t())],outputs:[new e.baseTypes.OutputPort("⇒",[CSG.Polygon])],typeName:"RegularPolygon"};e.baseTypes.NodeType.call(this,n),this.eval=function(e,t,n){e=Math.floor(e);if(e<3)throw new Error("Sides must be >= 3");var r=2*Math.PI/e,i=[],s=0;for(var o=0;o<e;o++){s+=r;var u=n.xaxis.times(t*Math.cos(s)).plus(n.yaxis.times(t*Math.sin(s)));i.push(n.origin.plus(u))}return CSG.Polygon.createFromPoints(i,!1)}}.inherits(e.baseTypes.CSG),e.nodeTypes.SolidExtrusion=function(){var t={inputs:[new e.baseTypes.InputPort("Profile",[CSG.Polygon]),new e.baseTypes.InputPort("Vector",[CSG.Vector],new CSG.Vector(0,0,1))],outputs:[new e.baseTypes.OutputPort("⇒",[CSG])],typeName:"SolidExtrusion"};e.baseTypes.NodeType.call(this,t),this.eval=function(e,t){var n=e.plane,r=n.normal,i=r.times(n.w),s=r.minus(new CSG.Vector(1,0,0)).length()<1e-5?new CSG.Vector(1,0,0):new CSG.Vector(0,1,0),o=r.cross(s).unit(),u=r.cross(o),a=new CSG.Matrix4x4([o.x,o.y,o.z,i.x,u.x,u.y,u.z,i.y,r.x,r.y,r.z,i.z,0,0,0,1]),f=new CSG.Matrix4x4([o.x,u.x,r.x,-i.x,o.y,u.y,r.y,-i.y,o.z,u.z,r.z,-i.z,0,0,0,1]),l=[];for(var c=0;c<e.vertices.length;c++){var h=e.vertices[c].pos,p=h.multiply4x4(f);l.push(new CSG.Vector2D(p.x,p.y))}var d=new CSG.Polygon2D(l,!1),v=a.rightMultiply1x3Vector(t),m=d.extrude({offset:v});return m.transform(a)}}.inherits(e.baseTypes.CSG)}),require(["config"],function(){require(["backbone","App","AppView","Three","Viewport","FLOODCSG","bootstrap"],function(e,t,n){var r=new t;r.fetch({error:function(e){console.error("error"),console.error(e)},success:function(){r.enableAutosave()}});var i=new n({model:r})})}),define("main",function(){}),require(["main"])})();